<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>é€†ç‰ˆæœ¬æˆ˜å£«ã®éƒ¨è½æ ¼</title>
  
  
  <link href="http://adversarr.github.io/atom.xml" rel="self"/>
  
  <link href="http://adversarr.github.io/"/>
  <updated>2022-11-19T07:12:19.276Z</updated>
  <id>http://adversarr.github.io/</id>
  
  <author>
    <name>Adversarr</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Todo List - æŒ–å‘</title>
    <link href="http://adversarr.github.io/2022/11/19/talk-chat/todolist/"/>
    <id>http://adversarr.github.io/2022/11/19/talk-chat/todolist/</id>
    <published>2022-11-18T16:00:00.000Z</published>
    <updated>2022-11-19T07:12:19.276Z</updated>
    
    <content type="html"><![CDATA[<div class="story post-story"><h2 id="section">2022-11-19</h2><p>The 10 Algorithms with the Greatest Influence on the Development andPractice of Science and Engineering in the 20th Century (Computing inScience &amp; Engineering)</p><ol type="1"><li>Metropolis Algorithm for Monte Carlo</li><li>Simplex Method for Linear Programming</li><li>Krylov Subspace Iteration Methods</li><li>The Decompositional Approach to Matrix Computations</li><li>The Fortran Optimizing Compiler</li><li>QR Algorithm for Computing Eigenvalues</li><li>Quicksort Algorithm for Sorting</li><li>Fast Fourier Transform</li><li>Integer Relation Detection</li><li>Fast Multipole Method</li></ol></div>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;story post-story&quot;&gt;&lt;h2 id=&quot;section&quot;&gt;2022-11-19&lt;/h2&gt;
&lt;p&gt;The 10 Algorithms with the Greatest Influence on the Development and
Pract</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title></title>
    <link href="http://adversarr.github.io/2022/11/13/CG/SortByCato/Unified/ElastoMonolith/"/>
    <id>http://adversarr.github.io/2022/11/13/CG/SortByCato/Unified/ElastoMonolith/</id>
    <published>2022-11-12T16:00:00.000Z</published>
    <updated>2022-11-13T05:54:37.074Z</updated>
    
    <content type="html"><![CDATA[<p>ElastoMonolith: A Monolithic Optimization-based Liquid Solver forContact-Aware Elastic-Solid Coupling</p><span id="more"></span><div class="story post-story"><h2 id="elasto-monolith-overview">Elasto Monolith Overview</h2><p>ä½¿ç”¨åŸºäºä¼˜åŒ–çš„æ—¶é—´ç§¯åˆ†å™¨ï¼Œæ¥å®ç°æµå›ºåŠ¨åŠ›å­¦è®¡ç®—åŠå…¶è€¦åˆã€‚</p><ol type="1"><li>æµä½“åŠ¨åŠ›å­¦ï¼šä½¿ç”¨APICï¼Œç½‘æ ¼ä¸Šå…¨éšå¼çš„æ±‚è§£</li><li>å˜å½¢ä½“åŠ¨åŠ›å­¦ï¼šPosition-level Optimization</li><li>åˆšä½“åŠ¨åŠ›å­¦ï¼šVelocity-level Friction contact handling(ref: Siggraph2022 course)</li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Algorithm EM:</span><br><span class="line"><span class="bullet">1.</span> map fluid velocity (P-&gt;G)</span><br><span class="line"><span class="bullet">2.</span> add Explicit External Force</span><br><span class="line"><span class="bullet">3.</span> solve the system</span><br><span class="line"><span class="bullet">4.</span> advect particles and update rigid body positions.</span><br></pre></td></tr></table></figure><p>è¯¥æœ€å°åŒ–é—®é¢˜é›†æˆäº†ï¼š</p><ol type="1"><li>ç²˜æ€§ã€æ— ç²˜æ€§æ¶²ä½“ + Incompressibility</li><li>åˆšä½“ã€å¼¹æ€§ä½“ + Friction</li></ol><p>æ¶ˆé™¤äº†å¯è§çš„é”™è¯¯ï¼š</p><ol type="1"><li>ä½“ç§¯æµå¤±</li><li>ç©¿é€</li><li>æµå›ºè€¦åˆä¸Šçš„èƒ½é‡æŸå¤±</li></ol><p><span class="math display">\[\mathbf{u}, \mathbf{x}_e \mathbf{v}_r = \arg\min_{d\in \mathcal{D}, h\in \mathcal{H}} E(u, x, r)\]</span></p><p>å…¶ä¸­ï¼Œ<span class="math inline">\(E\)</span>ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p><p><span class="math display">\[E = E_{f} + E_{e} + E_{r}\]</span></p><p>åˆ†åˆ«æ˜¯æµä½“é¡¹ã€å¼¹æ€§ä½“é¡¹ã€åˆšä½“é¡¹</p><blockquote><p>ç›¸å½“çš„æœ´å®æ— å...</p></blockquote><h3 id="rigid-body-simulation">Rigid body Simulation</h3><p>Contact handling of rigid bodies =&gt; Energy Minimization.</p><p>Object for rigid bodies can be written as the kinematic energy-normof difference between before and after.</p><p><span class="math display">\[E_r(v_r) = \frac{1}{2} \| v_r - v_{r}^{*} \|_{\alpha M_r}\]</span> å…¶ä¸­ï¼š<span class="math inline">\(v_r^*\)</span> å’Œ <spanclass="math inline">\(v_r\)</span> æ˜¯ before å’Œ after çš„åˆšä½“é€Ÿåº¦ï¼Œ<spanclass="math inline">\(M_r\)</span> ä¸ºè´¨é‡çŸ©é˜µ</p><p><span class="math display">\[v_r = v_{r}^{*} + \Delta t (\alpha M_r)^{-1} (F_{r s} s + F_{r p} p +\alpha J_r^Tc)\]</span></p></div>]]></content>
    
    
    <summary type="html">&lt;p&gt;ElastoMonolith: A Monolithic Optimization-based Liquid Solver for
Contact-Aware Elastic-Solid Coupling&lt;/p&gt;</summary>
    
    
    
    <category term="Anything" scheme="http://adversarr.github.io/categories/Anything/"/>
    
    
    <category term="Anything" scheme="http://adversarr.github.io/tags/Anything/"/>
    
  </entry>
  
  <entry>
    <title>Digital Geometry Processing</title>
    <link href="http://adversarr.github.io/2022/11/04/CG/DGP/lec1/"/>
    <id>http://adversarr.github.io/2022/11/04/CG/DGP/lec1/</id>
    <published>2022-11-04T04:14:06.796Z</published>
    <updated>2022-11-05T01:34:39.274Z</updated>
    
    <content type="html"><![CDATA[<p>GCL-F-DGP1</p><span id="more"></span><div class="story post-story"><h2 id="representations">Representations</h2><p>How to represent geometry data in computer.</p><h3 id="point-cloud">Point cloud</h3><p><span class="math display">\[P = \{ p _ 1, \dots , p _ n\}\]</span></p><p>A set of data points in some coord-system.</p><p>Applications: scanners</p><h3 id="signed-distance-function-sdf">Signed Distance Function(SDF)</h3><p>Give the distance of a given point x from the boundary of <spanclass="math inline">\(\Omega\)</span></p><ol type="1"><li>inside -&gt; neg</li><li>outside -&gt; pos</li></ol><blockquote><p>Truncated SDF(TSDF)</p></blockquote><h3 id="implicit-function">Implicit Function</h3><p><span class="math display">\[F(x, y, z) = 0\]</span></p><p>SDF is some kind of IF.</p><h3 id="grid">Grid</h3><h4 id="pixel-voxel">Pixel, Voxel</h4><ol type="1"><li><p>Adaptive: Grid-Hierarchical Oct-Tree</p></li><li><p>Patch-based quadtree.</p><p>Ref: Adaptive O-CNN</p></li></ol><h3 id="triangle-mesh">Triangle Mesh</h3><p>A collection of triangles. without any mathematical structure.</p><p>Geometry component:</p><ul><li>Vertices: <span class="math inline">\(v _ 1 ... v _ N\)</span></li></ul><p>Topological component:</p><ul><li>Triangle: <span class="math inline">\(T\)</span></li><li>Edge: <span class="math inline">\(E\)</span></li></ul><blockquote><p>Topology describes the connectivity.</p></blockquote><h4 id="quad-mesh">Quad Mesh</h4><p>ä¸ä¸€å®šæ˜¯å…±é¢çš„ï¼</p><blockquote><p><strong>Homework 1</strong>: Shortest Path, Minimal Spaning Tree</p></blockquote><h4 id="manifold">2-manifold</h4><p>Euler Formula <span class="math display">\[N_V -N_E+ N_F= 2(1-g)\]</span></p><ul><li><span class="math inline">\(g\)</span>ä¸ºäºæ ¼æ•°é‡</li></ul><h4 id="data-structure---requirements">Data Structure -requirements</h4><ol type="1"><li>Given <span class="math inline">\(f_j\)</span>, find its containingvertices in order</li><li>Given <span class="math inline">\(v_i\)</span>, find its one-ringfacets in order</li><li>Given <span class="math inline">\(v_i\)</span>, find adjacentvertices/outgoing edges</li><li>Given <span class="math inline">\(e_k\)</span>, find its connectedtwo facets</li><li>Given <span class="math inline">\(f_j\)</span> and <spanclass="math inline">\(e_k\)</span>, find another facet which connects<span class="math inline">\(e_k\)</span></li><li>â€¦</li></ol><p>Half edge Data structure!</p></div>]]></content>
    
    
    <summary type="html">&lt;p&gt;GCL-F-DGP1&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>SPH Introduction</title>
    <link href="http://adversarr.github.io/2022/10/27/CG/SortByCato/SPH/1106paper/"/>
    <id>http://adversarr.github.io/2022/10/27/CG/SortByCato/SPH/1106paper/</id>
    <published>2022-10-26T16:00:00.000Z</published>
    <updated>2022-11-05T08:16:01.583Z</updated>
    
    <content type="html"><![CDATA[<p>1106 è®ºæ–‡æ±‡æŠ¥</p><p>SPH Fluids in computer graphic</p><span id="more"></span><div class="story post-story"><h2 id="introduction">Introduction</h2><h3 id="governing-equations">Governing Equations</h3><p>Consider fluid that consists of a set of small moving fluidelements(i.e. particles), and for each particle, it carriesattributes:</p><ol type="1"><li>Density <span class="math inline">\(\rho _ i\)</span></li><li>Pressure <span class="math inline">\(p _ i\)</span></li><li>volume <span class="math inline">\(v _ i\)</span></li></ol><p>From Newton's second law:</p><p><span class="math display">\[\frac{\mathrm d x _ i} {\mathrm d t} = v _ i\]</span></p><p>We use particles to describe the fluid flow, the time rate of changeof the velocity is governed by the <strong>Lagrange</strong> view of NSEquation.</p><p><span class="math display">\[\dot v _ i = -\frac 1 {\rho _ i} \nabla p _ i + v \nabla ^ 2 v _ i +\frac{F _ {ext}} {m _ i}\]</span></p><ol type="1"><li>Pressure</li><li>Friction force. <span class="math inline">\(v\)</span> -&gt;kinematic viscosity.</li><li>External force, such as gravity.</li></ol><h3 id="sph">SPH</h3><p>Idea: Interpolate the fluid quantities at arbitary positions and toapproximate the spatial derivatives, <strong>using a set of samplepositions, i.e. adjacent particles</strong></p><p><em>Interpolation</em>: A quantity <span class="math inline">\(A _i\)</span> at <span class="math inline">\(x _ i\)</span> is approximatedusing a weighted sum of neighbour particles:</p><p><span class="math display">\[A _ i = \sum _ {j \in \mathcal N _ i} \frac{m _ j} { \rho _ j } A _ j W_ {ij}\]</span></p><p><span class="math inline">\(W _ {ij}\)</span> should be close to aGaussian, amd can be implemented as:</p><ol type="1"><li>Bell function</li><li>Quintic Spline -- <span class="math inline">\(C^1\)</span>continuity</li><li>Cubic Spline -- <span class="math inline">\(C ^ 2\)</span>continuity</li></ol><p><em>Spatial Derivatives</em>: Spatial derivatives can be derived:</p><p><span class="math display">\[\begin{aligned}\nabla A_i = \rho_i + \sum_{j} m_j  \left ( \frac { A _ i} { \rho _ i  ^2} + \frac{A _ j} {\rho _ j ^ 2}\right) \nabla W_ { i j }\\\nabla \cdot \mathbf{A}_i = - \frac 1 { \rho _ i} \sum _ j m _ j \mathbfA _ {ij} \cdot \nabla W _ {ij} \\\nabla ^ 2 A _ i = 2 \sum _ { j } \frac { m _ j} { \rho _ j} A _ {ij}\frac {\mathbf x _ {ij} \cdot \nabla W _ { ij }}{\mathbf x _ {ij} \cdot\mathbf x _ {ij} + 0.01 h ^ 2}\end{aligned}\]</span></p><p>Here, <span class="math inline">\(\rho\)</span> is computedusing:</p><p><span class="math display">\[\rho_i  = \sum_j m_j W_{ij}\]</span></p><blockquote><p>we always use <span class="math inline">\(m / \rho\)</span>, and themeaning of <span class="math inline">\(\rho\)</span> here does notmatter.</p></blockquote><h3 id="the-solver">The solver</h3><p>Three basic steps:</p><ol type="1"><li>Neighbourhood search</li><li>Pressure Computation</li><li>Time Integrations</li></ol><p>Neighbourhood search can be solved using VDB or SpatialOrdering/Hashing methods. We focus on 2 and 3.</p><p>A typical choice is:</p><p>For <em>Pressure Computation</em>:</p><p><span class="math display">\[p_i = k \left( \left ( \frac{\rho_i}{\rho_0}\right) ^ 7 - 1 \right)\]</span></p><p>where:</p><ul><li><span class="math inline">\(\rho_0\)</span> is the restdensity.</li><li><span class="math inline">\(k\)</span> is the stiffness.</li></ul><figure class="highlight mercury"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">foreach Particle P:</span><br><span class="line">  find neighbours.</span><br><span class="line">foreach Particle P:</span><br><span class="line">  compute density.</span><br><span class="line">  compute pressure.</span><br><span class="line">foreach Particle P:</span><br><span class="line">  compute pressure force.</span><br><span class="line">  compute viscosity force</span><br><span class="line">  compute <span class="keyword">external</span> force</span><br><span class="line">  merge <span class="built_in">all</span> the forces.</span><br><span class="line"></span><br><span class="line">foreach Particle P:</span><br><span class="line">  update velocity, position.</span><br></pre></td></tr></table></figure><blockquote><p><strong>CFL Condition</strong> should be considered carefully whenusing this method.</p></blockquote><p><span class="math display">\[\Delta t \le \lambda \frac{ h } { \| v _ {\max} \| }, \qquad\mathrm{with}~~\lambda \approx 0.4\]</span></p><h3 id="neightbourhood-search">Neightbourhood Search</h3><p><em>Time</em>: 1. Grids: <span class="math inline">\(O(n)\)</span>build, <span class="math inline">\(O(1)\)</span> access 2. Hierarchy:<span class="math inline">\(O(n log n)\)</span> build, <spanclass="math inline">\(O(log n)\)</span> access.</p><p><em>Memory</em>: Hierarchy &lt; Grid.</p><ol type="1"><li><em>Iterative</em>: Reuse the structure frequently, and we can storethe neighborhood set, and rebuild it from time to time.</li><li><em>Non-Iterative</em>:</li></ol><h4 id="uniform-grid">Uniform Grid</h4><ol type="1"><li>Index Sort -&gt; See GPU Gems 3</li><li>Z-index Sort -&gt; latency, cache hit rate</li></ol><h4 id="hashing">Hashing</h4><ol type="1"><li>hashing,</li><li>compact hasihing.</li></ol><blockquote><p>To reduce the memory consumption of plain grid storaging method.</p><p>but it reduce the <em>cache-hit-rate</em></p></blockquote><h3 id="gpus">GPUs</h3></div><div class="story post-story"><h2 id="incompressibility">Incompressibility</h2><h3 id="non-iterative-eos-solver">Non Iterative EOS Solver</h3><p><strong>EOS</strong>: Describe the relation between <spanclass="math inline">\(\rho\)</span>, <spanclass="math inline">\(p\)</span>, and <spanclass="math inline">\(T\)</span>(temperature).</p><p>Original:</p><p><span class="math display">\[p = p (\rho , T) = \frac{\mu}{R} \rho T\]</span></p><p>Typically, for water:</p><p><span class="math display">\[\rho = \rho _ 0\]</span></p><p>Pressure penals the violation of the condition.</p><h3 id="non-iterative-eos-solvers-with-splitting">Non Iterative EOSSolvers with Splitting</h3><p>Split the:</p><ol type="1"><li>Pressure Force</li><li>Non-Pressure Force</li></ol><p>because:</p><p><span class="math display">\[\frac { 1 } {\Delta t} (v(t + \Delta t) - v^ * (t) ) = - (1 / \rho ^ * _i) \nabla p _ i\]</span></p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span> P: <span class="built_in">find</span> neighbours</span><br><span class="line"><span class="keyword">foreach</span> P: compute Non-Pressure forces  -&gt; Advection</span><br><span class="line"><span class="keyword">foreach</span> P: compute Pressure forces.     -&gt; Projection, use data <span class="keyword">from</span> Advection</span><br><span class="line"><span class="keyword">foreach</span> P: update <span class="built_in">velocity</span> &amp; <span class="built_in">position</span></span><br></pre></td></tr></table></figure><h3 id="iterative-eos-solvers-with-splitting">Iterative EOS Solvers withSplitting</h3><p>Alternatively, <em>strong-incompressibility</em>.</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">foreach</span> P: <span class="built_in">find</span> neighbours</span><br><span class="line"><span class="built_in">foreach</span> P: compute Non-Pressure part.       -&gt; Advection</span><br><span class="line"><span class="keyword">repeat</span> <span class="keyword">until</span> convergence:                   -&gt; Projection(weak)</span><br><span class="line">  <span class="built_in">foreach</span> P: compute density <span class="keyword">and</span> pressure</span><br><span class="line">  <span class="built_in">foreach</span> P: update velocity <span class="keyword">and</span> positions</span><br></pre></td></tr></table></figure><p>e.g.:</p><ol type="1"><li>PCISPH</li><li>LPSPH</li></ol><h3 id="pressure-projection">Pressure Projection</h3><p>Solve a pressure poisson equation(PPE).</p><p><span class="math display">\[\nabla ^ 2 p _ i = \frac {\rho _ 0} {\Delta t} \nabla \cdot v_i\]</span></p><ol type="1"><li>IISPH</li></ol><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">foreach P: find neighbours</span><br><span class="line">foreach P: <span class="built_in">compute</span> Non-Pressure part.       -&gt; Advection</span><br><span class="line">foreach P: <span class="built_in">compute</span> rho*</span><br><span class="line"><span class="built_in">solve</span> PPE                                   -&gt; Projection</span><br><span class="line"><span class="built_in">compute</span> Pressure Force</span><br><span class="line">update v, x</span><br></pre></td></tr></table></figure><blockquote><p>As the overall computation time of all solvers largely depends on theobtained incompressibility, average or maximum density errors areconsidered to specify the simulation quality.</p></blockquote></div><div class="story post-story"><h2 id="incompressibility----extra">Incompressibility -- Extra</h2><p>In (EG 2022): There are only two categories:</p><ol type="1"><li>weak-incompressible: incompressible is not enforced, only a<em>trend</em> is formulated. Pressure indicates incompressible.</li></ol><ul><li>Local Pressure Solver</li></ul><ol start="2" type="1"><li>strong-incompressible: incompressible PPE is solved.</li></ol><ul><li>Global Pressure Solver</li></ul><p>In this sense: target of PCISPH = IISPH = PBF.</p><h3 id="iisph">IISPH</h3><p><span class="math display">\[\Delta t^2 \nabla^2 p_i = \rho^0 - (\rho_i - \Delta t \rho_i\nabla \cdotv_i^{*})\]</span> step 1: compute the pressure accelerations:</p><p><span class="math display">\[(a_i^P)^l = - \frac{1}{\rho_i} \nabla p_i^l\]</span> step 2: compute density change <span class="math display">\[\Delta \rho = \Delta t \sum_j m_j\Delta t(a_i^p - a_j^p)\Delta W_{ij}\]</span> ## Boundary Handling</p><p>Most methods: Extend the field attributes to the boundary.</p><h3 id="particle-based-methods">Particle-based Methods</h3><p>Also sample the particle points on rigid/deformable bodies, computethe penalty force based on distance.</p><blockquote><p>The boundary particles serve as additional sampling points andtypically have the same radius as the fluid particles.</p></blockquote><p><span class="math display">\[\rho_i = \rho_{\mathcal{F}} + \rho_{\mathcal{B}} \approx \sum_j m_jW_{ij} + \sum_k \tilde{m}_k W_{ik}\]</span> when computing the pressure and force, these particles shouldbe considered as well.</p><p><strong>How-to-Sample</strong>:</p><ol type="1"><li>uniform / non-uniform</li><li>single-layer/multi-layer</li></ol><p><strong>Pros</strong>:</p><ol type="1"><li>simplicity: generate, integration, computation</li></ol><p><strong>Cons</strong>:</p><ol type="1"><li>result in small time-steps for weak-incompressible fluids. (pressurevariety is large)</li><li>even simple geometry shape need large amount of particles.</li><li><em>bumpy representation</em>: reduce the accuracy of pressurecomputation, introduce artificial friction. -&gt; Implicit boundaryrepresentation.</li></ol><h3 id="implicit-method">Implicit Method</h3><p>Signed Distance Function.</p><h3 id="computing-the-boundary-pressure">Computing the boundarypressure</h3><p>Original, without boundary:</p><p><span class="math display">\[(a_i^P)^l = - \frac{1}{\rho_i} \nabla p_i^l = - \sum_j m \left(p_i^l/\rho_i^2 + p_j^l/\rho_j^2 \right)\Delta W_{ij}\]</span></p><p>With boundary:</p><p><span class="math display">\[(a_i^P)^l = - \sum_j m_j \left( p_i^l/\rho_i^2 + p_j^l/\rho_j^2\right)\Delta W_{ij} - \sum_k m_k \left( p_i^l/\rho_i^2 + p_k^l/\rho_k^2\right)\Delta W_{ik}\]</span></p><p>To define <span class="math inline">\(p_k\)</span>:</p><ol type="1"><li>Pressure Mirroring: <span class="math inline">\(p_k =p_i\)</span></li><li>Pressure Extrapolation:</li></ol><p><span class="math display">\[p_k = \frac{\sum_l p_lW_{kl}+ \mathbf{g} \cdot \sum_j \rho_l(x_k -x_l)W_{kl}}{\sum_l W_{kl}}\]</span></p><h3 id="penalty-based-methods">Penalty based Methods</h3><p><strong>Cons</strong>: hard to control the stiffness, and have smalltime steps.</p></div><div class="story post-story"><h2 id="other-techniques">Other Techniques</h2><ol type="1"><li>Adaptive time-step</li><li>Data-Driven.</li></ol><h3 id="cnns">CNNs</h3><p>Target: enforce incompressibility</p><p>Steps:</p><ol type="1"><li>Rasterize to Grid.</li><li>use cnn on grid to compute the velocity correction.</li></ol></div><div class="story post-story"><h2 id="future-work">Future work</h2><ol type="1"><li>Approximate Quality:<ol type="1"><li>particle count is low =&gt; degradation of approximation</li><li>lack of practical and sufficient solution: because negative pressureare clamped to 0, only projective Jacobi or GS Iteration is allowed.Conj-Grad is not available currently.</li></ol></li><li>Unified Solver &amp; Ultimate Coupling:<ol type="1"><li>Unified Coupling solver.</li><li>Suitable for multiple particle-resolution.</li></ol></li><li>Artist Control</li><li>Data Driven</li></ol></div>]]></content>
    
    
    <summary type="html">&lt;p&gt;1106 è®ºæ–‡æ±‡æŠ¥&lt;/p&gt;
&lt;p&gt;SPH Fluids in computer graphic&lt;/p&gt;</summary>
    
    
    
    <category term="Anything" scheme="http://adversarr.github.io/categories/Anything/"/>
    
    
    <category term="Anything" scheme="http://adversarr.github.io/tags/Anything/"/>
    
  </entry>
  
  <entry>
    <title>Introduction to Computer Animation 3d.</title>
    <link href="http://adversarr.github.io/2022/10/12/CG/GAMES/games105/lec1/"/>
    <id>http://adversarr.github.io/2022/10/12/CG/GAMES/games105/lec1/</id>
    <published>2022-10-12T01:41:27.011Z</published>
    <updated>2022-11-05T01:25:11.307Z</updated>
    
    <content type="html"><![CDATA[<h2 id="introduction-to-computer-animation----in-3d.">Introduction toComputer Animation -- in 3D.</h2><h3 id="what-is-character-animation">What is character animation</h3><ol type="1"><li>Animate Movie</li><li>Virtual Idle... Digital Human...</li></ol><p><strong>Compare with CG</strong>:</p><ul><li>... -&gt; Geometry -&gt; Animation -&gt; Rendering -&gt; ...</li><li>simulation: <strong>Phenomenon</strong></li><li>character animation: <strong>Behaviour</strong></li></ul><p><em>Simulation + Control = Character Animation</em></p><h3 id="why-study-c.a.">Why study C.A.</h3><ol type="1"><li>A character typically has 20+ joints, 50-100+ parameters.<ol type="1"><li>ä¼ ç»Ÿï¼šæ‰‹è°ƒå‚æ•°</li></ol></li><li>è§’è‰²åŠ¨ç”»<ol type="1"><li>Understanding the mechanism behind the motions and behaviors</li><li>"Compute Intensive"</li></ol></li></ol><p>A Pipeline :</p><ol type="1"><li>Rigging &amp; skining:ç»‘å®šã€è’™çš®</li><li>Skeletal Animationï¼šéª¨éª¼åŠ¨ç”»</li><li>1 + 2 = Animated Character</li></ol><h3 id="where-does-motion-come-frome">where does motion come frome</h3><ol type="1"><li>brain</li><li>muscle</li><li>force</li><li>physics</li><li>body <strong>pose</strong></li></ol><p>Two approach:</p><ol type="1"><li>Key Frame-Based / Kinematic Approach: Ignore the idea, update posedirectly.(Simple)</li><li>Physics-based /dynamic Approach: merge 123, simplified control &amp;physics.</li></ol><p>Two target:</p><ol type="1"><li>Low-Level Control: More details.</li><li>High-Level Goals: focus on target. (e.g. lift up the box)</li></ol><blockquote><p>Disney's 12 priciples.</p></blockquote><div class="story post-story"><h2 id="key-frame-based.">key frame based.</h2><h3 id="two-key-techniques">Two key techniques</h3><p>(Keyframe Animation)</p><ol type="1"><li>forward Kinematics: Given rotations of every joints, computerotations of every joints.</li><li>Inverse Kinematics</li></ol><p>other solution:</p><ol type="1"><li>Motion Capture.</li><li>Motion Retargeting.</li></ol><h3 id="motion-graphs-state-machines-in-game">Motion Graphs / Statemachines (in game)</h3><blockquote><p>2002: Motion Graph</p></blockquote><p>... Motion Matching ...</p><p>åœ¨æ¸¸æˆä¸­é˜»åŠ›è¾ƒå¤§ï¼šæ–°æŠ€æœ¯ï¼ŒåŒºåˆ«äºçŠ¶æ€æœºã€‚</p><h3 id="learning-based.">Learning Based.</h3><p>Generative Model.</p><ol type="1"><li>Input: Control Signal + Current Pose</li><li>Output: Next Pose</li></ol><p>Iterative.</p><p>e.g. Character Controllers using Motion VAEs.</p></div><div class="story post-story"><h2 id="physics-based">Physics based</h2><ol type="1"><li>force, torque -&gt; simulation</li><li>PD(Proportional Derivative)</li></ol><p>Approaches</p><ol type="1"><li>Keyframe Control</li><li>Spacetime/Trajectory Optimization.</li><li>Abstract Models</li><li>Reinforcement Learning.</li><li>Generative Control Policies.</li></ol></div>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;introduction-to-computer-animation----in-3d.&quot;&gt;Introduction to
Computer Animation -- in 3D.&lt;/h2&gt;
&lt;h3 id=&quot;what-is-character-animation&quot;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Games 301</title>
    <link href="http://adversarr.github.io/2022/10/07/CG/GAMES/games301/lec1/"/>
    <id>http://adversarr.github.io/2022/10/07/CG/GAMES/games301/lec1/</id>
    <published>2022-10-07T02:26:33.747Z</published>
    <updated>2022-11-05T01:24:04.709Z</updated>
    
    <content type="html"><![CDATA[<p>Games 301-01</p><span id="more"></span><div class="story post-story"><h2 id="æ›²é¢å‚æ•°åŒ–">æ›²é¢å‚æ•°åŒ–</h2><h3 id="å¼•å…¥">å¼•å…¥</h3><ul><li>å‡ ä½•ç›´è§‚ï¼šä»ä¸‰ç»´æ›²é¢å±•å¼€æˆ2dæ›²é¢</li><li>æ•°å­¦æœ¬è´¨ï¼šä¸‰ç»´æ›²é¢åœ¨äºŒç»´å¹³é¢çš„åµŒå…¥/æ˜ å°„<ul><li>æ„å»ºæ›²é¢åˆ°å¹³é¢çš„ä¸€ä¸€å¯¹åº”</li><li>3dæ›²é¢çš„æœ¬è´¨æ˜¯2dçš„ï¼š2dæµå½¢ï¼ˆæ‹“æ‰‘åŒèƒšï¼‰</li></ul></li></ul><h4 id="åº”ç”¨æ›²é¢è´´å›¾">åº”ç”¨ï¼šæ›²é¢è´´å›¾</h4><ol type="1"><li>çº¹ç†ã€æ³•ç›¸ã€åç½®ã€é¢œè‰²ã€æè´¨â€¦â€¦</li><li>å·¥ä¸šç•Œï¼šuvå›¾</li></ol><h4 id="åº”ç”¨çº¹ç†åœ°å›¾texture-atalas">åº”ç”¨ï¼šçº¹ç†åœ°å›¾ï¼ˆTextureAtalasï¼‰</h4><ol type="1"><li>Segmentation &amp; Packing</li></ol><h4 id="åº”ç”¨æ›²é¢æ‹Ÿåˆ">åº”ç”¨ï¼šæ›²é¢æ‹Ÿåˆ</h4><ol type="1"><li>æ›²çº¿ï¼šBæ ·æ¡</li><li>æ›²é¢ï¼šTæ ·æ¡ã€NURBS</li></ol><h4 id="åº”ç”¨æ›²é¢æ¸²æŸ“">åº”ç”¨ï¼šæ›²é¢æ¸²æŸ“</h4><ol type="1"><li>è™šæ‹Ÿçº¹ç†</li><li>è™šæ‹Ÿå‡ ä½•</li><li>mipmap</li><li>LOD</li></ol><p>â€¦â€¦</p><h3 id="è¡¨è¾¾æ–¹æ³•">è¡¨è¾¾æ–¹æ³•</h3><ol type="1"><li>åŸºå‡½æ•° -- è¿ç»­å‡½æ•°</li><li>åˆ†ç‰‡æ˜ å°„æ–¹æ³•<ol type="1"><li>ä¸‰è§’ç½‘æ ¼</li><li>çº¿æ€§æ˜ å°„æ‹¼æ¥</li></ol></li></ol><h4id="å‚æ•°åŒ–çš„åº¦é‡ä»€ä¹ˆæ˜¯æœ€ä¼˜çš„å‚æ•°åŒ–">å‚æ•°åŒ–çš„åº¦é‡ï¼šä»€ä¹ˆæ˜¯â€œæœ€ä¼˜â€çš„å‚æ•°åŒ–ï¼Ÿ</h4><p>ä¸åŒçš„èŒƒæ•°ï¼ˆæˆ–åº¦é‡ï¼‰ä¸‹ï¼Œæœ€ä¼˜æ˜¯ä¸åŒçš„ã€‚</p><h4 id="jacobian-çš„å‡ ä½•æ„ä¹‰">Jacobian çš„å‡ ä½•æ„ä¹‰</h4><p><span class="math display">\[Jf(\mathbf x)\]</span></p><p>å®šä¹‰äº†å±€éƒ¨çš„å½¢å˜é‡ã€‚</p><p>è¡Œåˆ—å¼è¡¨æ˜é¢ç§¯çš„å˜åŒ–</p><h4 id="ä¿æŒxxçš„æ˜ å°„">ä¿æŒxxçš„æ˜ å°„</h4><ol type="1"><li>ä¿è§’æ˜ å°„ - conformal ï¼ˆå…±å½¢ï¼‰</li><li>ä¿é¢ç§¯ - authalicï¼ˆç­‰ç§¯ï¼‰</li><li>ç­‰è·</li></ol><p>Theoremï¼š å…±å½¢æ˜ å°„æ€»æ˜¯å­˜åœ¨çš„ã€‚</p><p>å…±å½¢æ˜ å°„</p><ul><li>å¯¹æ•°å…±å½¢å› å­</li><li>Yamabe æ–¹ç¨‹ ï¼ˆå†…è•´é«˜æ–¯æ›²ç‡ï¼‰</li></ul><p>ç­‰è·æ˜ å°„ï¼šä¿æŒä»»æ„ä¸¤ç‚¹çš„æµ‹åœ°æ›²ç‡ã€‚</p><ul><li>å¯å±•æ›²é¢ï¼šé«˜æ–¯æ›²ç‡å¤„å¤„ä¸º0<ul><li>åªæœ‰ä¸‰ç§ï¼šæŸ±é¢ã€é”¥é¢ã€åˆ‡çº¿é¢</li></ul></li></ul><h3 id="å‡ ä½•å½¢å˜-distortion">å‡ ä½•å½¢å˜ distortion</h3><p>svd on <span class="math inline">\(J\)</span>ï¼š</p><ul><li>ä¿è§’ï¼š<span class="math inline">\(\sigma _1 = \sigma_2\)</span></li><li>ç­‰ç§¯ï¼š<span class="math inline">\(\sigma _ 1 \sigma _ 2 =1\)</span></li><li>ç­‰è·ï¼š<span class="math inline">\(\sigma _ 1 = \sigma _ 2 =1\)</span></li></ul><h4 id="locally-bijactive-injective">Locally bijactive = Injective</h4><p>The sufficient condition:</p><p><span class="math display">\[det Jf &gt; 0\quad\forall x\]</span></p><h4 id="global-bijective-v.s.-locally-bijective.">Global Bijective v.s.Locally Bijective.</h4><h4 id="distortion-metric">Distortion Metric</h4><ol type="1"><li>Conformal (2003): <span class="math inline">\(\sigma_2 / \sigma _1\)</span></li><li>MIPS: <span class="math inline">\(\sigma _ 1 / \sigma _ 2 + \sigma _2 / \sigma _1\)</span></li><li>Symm Dirichlet: <span class="math inline">\(\sigma_1^2 + \frac 1{\sigma_1 ^ 2} + \sigma_2 ^ 2 + \frac 1 {\sigma_2 ^ 2}\)</span></li></ol><h3 id="å¹¿ä¹‰å‚æ•°åŒ–å’Œæ•°æ®é™ç»´">å¹¿ä¹‰å‚æ•°åŒ–å’Œæ•°æ®é™ç»´</h3><p>ç›¸å®¹æ€§ç½‘æ ¼ï¼šæ„å»ºæ›²é¢çš„æ˜ å°„ï¼ˆåŒï¼‰</p><p>ä½“å‚æ•°åŒ–(Volumetric Parameterization).</p><p>éƒ½å±äº<strong>å‡ ä½•æ˜ å°„</strong>ï¼šInversion free Geometric mappingconstruction: A Survey (Fu 2021 CVM)</p><p>å‚æ•°åŒ–è¡¨è¾¾ï¼šä½•ä¸ºå‚æ•°ï¼Ÿ</p><ol type="1"><li>æœ¬å¾ç»´åº¦</li><li>ç»´åº¦ä¼°è®¡ï¼šé«˜ç»´æ•°æ®å¯èƒ½å­˜åœ¨ä½ç»´ç»“æ„ã€‚</li></ol></div>]]></content>
    
    
    <summary type="html">&lt;p&gt;Games 301-01&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>Useful Links for programming</title>
    <link href="http://adversarr.github.io/2022/10/05/study/ComputerScience/cpp/useful-links/"/>
    <id>http://adversarr.github.io/2022/10/05/study/ComputerScience/cpp/useful-links/</id>
    <published>2022-10-04T16:00:00.000Z</published>
    <updated>2022-11-06T00:39:53.449Z</updated>
    
    <content type="html"><![CDATA[<div class="story post-story"><h2 id="cpp">Cpp</h2><h3 id="c-rvalue-references-explained">C++ Rvalue ReferencesExplained</h3><p><ahref="http://thbecker.net/articles/rvalue_references/section_01.html">http://thbecker.net/articles/rvalue_references/section_01.html</a></p><h3 id="abseil">Abseil</h3><blockquote><p>Abseil provides a number of containers as alternatives to STLcontainers. These containers generally adhere to the properties of STLcontainers, though there are often some associated API differencesand/or implementation details which differ from the standardlibrary.</p></blockquote><ul><li><a href="https://abseil.io/docs/cpp/">Document</a></li><li></li></ul><h3 id="folly">Folly</h3><blockquote><p>Folly (acronymed loosely after Facebook Open Source Library) is alibrary of C++14 components designed with practicality and efficiency inmind. Folly contains a variety of core library components usedextensively at Facebook. In particular, it's often a dependency ofFacebook's other open source C++ efforts and place where those projectscan share code.</p></blockquote><ul><li><a href="https://github.com/facebook/folly">Github</a></li></ul><h3 id="coost">Coost</h3><blockquote><p>coost æ˜¯ä¸€ä¸ªå…¼å…·æ€§èƒ½ä¸æ˜“ç”¨æ€§çš„è·¨å¹³å° C++åŸºç¡€åº“ï¼Œå…¶ç›®æ ‡æ˜¯æ‰“é€ ä¸€æŠŠåœ°è¡¨æœ€å¥½ç”¨çš„ C++ å¼€å‘ç¥å™¨ï¼Œè®© C++ç¼–ç¨‹å˜å¾—ç®€å•ã€è½»æ¾ã€æ„‰å¿«ã€‚</p><p>coost åŸåä¸º coï¼Œåæ”¹ä¸ºcocoyaxiï¼Œå‰è€…è¿‡çŸ­ï¼Œåè€…è¿‡é•¿ï¼Œå–ä¸­åº¸ä¹‹é“ï¼Œåˆæ”¹ä¸º coostã€‚å®ƒæ›¾è¢«ç§°ä¸ºå°å‹boost åº“ï¼Œä¸ boost ç›¸æ¯”ï¼Œcoost å°è€Œç²¾ç¾ï¼Œåœ¨ linux ä¸ macä¸Šç¼–è¯‘å‡ºæ¥çš„é™æ€åº“ä»… 1M å·¦å³å¤§å°ï¼Œå´åŒ…å«äº†ä¸å°‘å¼ºå¤§çš„åŠŸèƒ½ï¼š</p></blockquote><ul><li><a href="https://coostdocs.github.io/cn/about/co/">Document</a></li><li><a href="https://github.com/idealvin/coost">Github</a></li></ul><h3 id="thrust">Thrust</h3><p>Cuda Algorithm library.</p><h3 id="taskflow.">Taskflow.</h3><p>Alter to oneTBB.</p><ul><li><a href="https://github.com/taskflow/taskflow">link</a></li></ul><h3 id="awesome-parallel-computing">Awesome Parallel Computing</h3><ul><li><ahref="https://github.com/taskflow/awesome-parallel-computing">link</a></li></ul><h3 id="assimp">ASSIMP</h3><p>The official Open-Asset-Importer-Library Repository. Loads 40+3D-file-formats into one unified and clean data structure. (byassimp)</p></div><div class="story post-story"><h2 id="æ±‚è§£å™¨çº¿æ€§ä»£æ•°ç­‰">æ±‚è§£å™¨ã€çº¿æ€§ä»£æ•°ç­‰</h2><h3 id="spectra">Spectra</h3><p>Spectra stands for Sparse Eigenvalue Computation Toolkit as aRedesigned ARPACK. It is a C++ library for large scale eigenvalueproblems, built on top of Eigen, an open source linear algebralibrary.</p><p>Spectra is implemented as a header-only C++ library, whose onlydependency, Eigen, is also header-only. Hence Spectra can be easilyembedded in C++ projects that require calculating eigenvalues of largematrices.</p><p>https://github.com/yixuan/spectra/</p></div><div class="story post-story"><h2 id="vulkan">Vulkan</h2><h3 id="vkbootstrap">VkBootstrap</h3><p>As Vulkan is a very explicit API that gives very â€œdirectâ€ control,you need to initialize it to do things such as load extensions, selectwhich GPU (or multiple!) you are going to use, and create the initialVkInstance and VkDevice structures that you then use with Vulkancommands.</p><p>https://github.com/charles-lunarg/vk-bootstrap</p></div><div class="story post-story"><h2 id="pages">Pages</h2><blockquote><p>ğŸ“šç»å…¸æŠ€æœ¯ä¹¦ç± PDFæ–‡ä»¶ï¼Œæ¶µç›–ï¼šç¼–ç¨‹è¯­è¨€ã€è®¡ç®—æœºç³»ç»Ÿã€ç½‘ç»œåè®®ã€æ•°æ®åº“ã€ä»£ç è‰ºæœ¯ã€è®¾è®¡æ¨¡å¼ã€ç®—æ³•ä¸æ•°æ®ç»“æ„ã€ç³»ç»Ÿæ¶æ„ã€å¾®æœåŠ¡ã€æµ‹è¯•ã€ç¨‹åºå‘˜èŒä¸šä¿®ç‚¼ç­‰ç›¸å…³ä¹¦ç±ã€‚</p></blockquote><p><a href="https://awesome-programming-books.github.io">link</a></p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;story post-story&quot;&gt;&lt;h2 id=&quot;cpp&quot;&gt;Cpp&lt;/h2&gt;
&lt;h3 id=&quot;c-rvalue-references-explained&quot;&gt;C++ Rvalue References
Explained&lt;/h3&gt;
&lt;p&gt;&lt;a
href=&quot;</summary>
      
    
    
    
    <category term="Programming" scheme="http://adversarr.github.io/categories/Programming/"/>
    
    
    <category term="C/C++" scheme="http://adversarr.github.io/tags/C-C/"/>
    
    <category term="Programming" scheme="http://adversarr.github.io/tags/Programming/"/>
    
  </entry>
  
  <entry>
    <title>Implement Autodiff using Meta Programming in C++</title>
    <link href="http://adversarr.github.io/2022/10/05/study/bachelor_final/meta_intro/"/>
    <id>http://adversarr.github.io/2022/10/05/study/bachelor_final/meta_intro/</id>
    <published>2022-10-04T16:00:00.000Z</published>
    <updated>2022-11-22T08:35:02.026Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ¥æ˜¯æƒ³å‘åœ¨çŸ¥ä¹çš„ï¼Œä½†æƒ³äº†æƒ³è¿˜æ˜¯å…ˆé¦–å‘åœ¨è‡ªå·±çš„blogä¸Šã€‚</p><span id="more"></span><blockquote><p>Template metaprogramming is a family of techniques to create newtypes and compute values at compile time. C++ templates are Turingcomplete if there are no limits to the amount of recursiveinstantiations and the number of allowed state variables. Erwin Unruhwas the first to demonstrate template metaprogramming at a committeemeeting by instructing the compiler to print out prime numbers in errormessages. The standard recommends an implementation support at least1024 levels of recursive instantiation, and infinite recursion intemplate instantiations is undefined behavior.</p></blockquote><h2id="ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦è‡ªåŠ¨æ±‚å¯¼ä¸ºä»€ä¹ˆæ˜¯ç¼–è¯‘æœŸè‡ªåŠ¨æ±‚å¯¼">ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦è‡ªåŠ¨æ±‚å¯¼ï¼Œä¸ºä»€ä¹ˆæ˜¯ç¼–è¯‘æœŸè‡ªåŠ¨æ±‚å¯¼</h2><p>é¦–å…ˆå›ç­”ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šåœ¨æˆ‘çœ‹æ¥è‡ªåŠ¨æ±‚å¯¼èƒ½å¤Ÿé¿å…ä¸å¿…è¦çš„é”™è¯¯ã€æ–¹ä¾¿æƒ³æ³•çš„å¿«é€Ÿå®ç°ã€‚ä¾‹å¦‚åœ¨ç‰©ç†ä»¿çœŸé¢†åŸŸçš„è®¡ç®—ä¸­ï¼Œå¤§éƒ½éœ€è¦â€œèƒ½é‡å‡½æ•°â€ï¼ˆç‰¹åˆ«æ˜¯å¼¹æ€§èƒ½é‡ï¼‰çš„æ¢¯åº¦ã€Hessianï¼Œä»¥æ”¯æŒç‰›é¡¿è¿­ä»£æ³•è¿›è¡Œå¿«é€Ÿæ±‚è§£ã€‚è€Œå¤§å¤šæ•°çš„èƒ½é‡å½¢å¼éƒ½ååˆ†å¤æ‚ï¼Œç›´æ¥æ‰‹æ¨å…¬å¼ååˆ†å®¹æ˜“å‡ºé”™ï¼Œå¹¶ä¸”å†™å‡ºçš„è¡¨è¾¾å¼ä¹Ÿä¸åˆ©äºæœºå™¨è¿›è¡Œä¼˜åŒ–ï¼ˆä¾‹å¦‚Eigençš„LazyEvaluationï¼‰ï¼Œå› æ­¤è‡ªåŠ¨æ±‚å¯¼æ˜¯ååˆ†æœ‰å¿…è¦çš„ã€‚<ahref="https://zhuanlan.zhihu.com/p/413934057">Ref</a></p><p>å†å›ç­”å¦ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆæ˜¯ç¼–è¯‘æœŸçš„è‡ªåŠ¨æ±‚å¯¼ï¼Œä¸»è¦æ˜¯åŸå› ï¼š</p><ol type="1"><li>ç‰©ç†ä»¿çœŸä¸­çš„å¯¼æ•°å½¢å¼ç›¸å¯¹å›ºå®šï¼Œæ²¡æœ‰å¿…è¦å¤šæ¬¡è¿›è¡Œè®¡ç®—å›¾çš„æ„å»ºï¼›</li><li>è®¡ç®—å›¾æ¨¡å‹çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½è¿›è¡Œäº†æ•°æ®çš„å­˜å‚¨ï¼Œä¸åˆ©äºEigenç­‰æ•°å­¦åº“çš„LazyEvaluationä¼˜åŒ–ï¼Œä¹Ÿä¸åˆ©äºSIMDæŒ‡ä»¤çš„ä¼˜åŒ–ï¼ˆä¾‹å¦‚<spanclass="math inline">\(ax+b\)</span>ï¼Œä¼šè¢«æ‹†åˆ†ä¸ºä¹˜æ³•ã€åŠ æ³•ä¸¤ä¸ªèŠ‚ç‚¹ï¼‰ä½†é™æ€çš„ç¼–è¯‘æœŸè‡ªåŠ¨æ±‚å¯¼åˆ™å¯ä»¥åˆ©ç”¨åˆ°ï¼Œè¿™äº›ç¼–è¯‘æœŸä¼˜åŒ–ã€‚</li></ol><p>è¿™ç¯‡æ–‡ç« å¤§è‡´åˆ†ä¸ºä¸‰ä¸ªæ¨¡å—</p><ol type="1"><li>æ¨¡ç‰ˆå…ƒã€è‡ªåŠ¨æ±‚å¯¼çš„ç®—æ³•ä¸æ•°å­¦åŸºç¡€</li><li>ä¸€ä¸ªåŸºæœ¬çš„è‡ªåŠ¨æ±‚å¯¼å®ç°</li><li>æ€§èƒ½ä¼˜åŒ–ä¸å±•æœ›</li></ol><div class="story post-story"><h2 id="å¼•è¨€æ¨¡ç‰ˆå…ƒå’Œè‡ªåŠ¨æ±‚å¯¼çš„åŸºç¡€">å¼•è¨€ï¼šæ¨¡ç‰ˆå…ƒå’Œè‡ªåŠ¨æ±‚å¯¼çš„åŸºç¡€</h2><h3id="æ¨¡ç‰ˆå…ƒç¼–ç¨‹åˆ°åº•åšäº†ä»€ä¹ˆä¸ºä»€ä¹ˆéœ€è¦æ¨¡ç‰ˆå…ƒç¼–ç¨‹">æ¨¡ç‰ˆå…ƒç¼–ç¨‹åˆ°åº•åšäº†ä»€ä¹ˆã€ä¸ºä»€ä¹ˆéœ€è¦æ¨¡ç‰ˆå…ƒç¼–ç¨‹</h3><p>å®é™…ä¸Šæˆ‘æ„Ÿè§‰æ¨¡ç‰ˆå…ƒç¼–ç¨‹åœ¨å¤§å­¦æœ¬ç§‘é˜¶æ®µä¸­ä»‹ç»çš„å¹¶ä¸å¤šï¼Œè€ŒçœŸæ­£ä½¿ç”¨è¿‡æ¨¡ç‰ˆå…ƒç¼–ç¨‹çš„åŒå­¦ä¹Ÿå°‘ä¹‹åˆå°‘ï¼Œæˆ‘è§‰å¾—åŸå› ä¸»è¦æ˜¯ï¼š</p><ol type="1"><li>è¯¾å ‚ä¸­æ•™æˆçš„æœ‰å…³æ³›å‹çš„å†…å®¹ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªåç»­è§£å†³é—®é¢˜æ—¶çš„æ ¸å¿ƒæ‰‹æ®µï¼šå¯¹äºå¤§ä¸€å¹¶æ²¡æœ‰ä¸“ä¸šæ–¹å‘çš„åŒå­¦è€Œè¨€ï¼Œåç»­çš„å‘å±•çš„å¤šæ ·æ€§éå¸¸é«˜ï¼Œè€Œæ³›å‹åªæ˜¯ä¸ªåˆ«è¯­è¨€ä¸­çš„æ ¸å¿ƒç‰¹æ€§ï¼Œä¸”å…·æœ‰å’ŒC++ç›¸ç±»ä¼¼çš„æ¨¡ç‰ˆæ¨å¯¼èƒ½åŠ›çš„è¯­è¨€å¹¶ä¸å¤šï¼›</li><li>æ¨¡ç‰ˆå…ƒç¼–ç¨‹å¹¶ä¸æ˜¯æœ€ä¸»æµçš„è®¾è®¡ï¼Œä¹Ÿä¸æ˜¯æœ€ç»æµçš„è®¾è®¡æ–¹æ³•ï¼šæ€»ä½“ä¸Šæ¨¡ç‰ˆå…ƒè¿˜æ˜¯ä¸€ä¸ªè¾ƒä¸ºæ–°é¢–çš„æ–¹æ³•ï¼Œä¸€æ¥ä¸€äº›æœºå™¨ä¸Šæ— æ³•é€šè¿‡ç¼–è¯‘ï¼ˆC++11/17ï¼‰ï¼Œæ¨¡ç‰ˆå…ƒå¹¶ä¸æ˜¯ä¸€ä¸ªâ€œç¨³å®šâ€çš„è§£å†³æ–¹æ¡ˆï¼Œç›¸æ¯”é¢å‘å¯¹è±¡ç­‰å·²ç»å¹¿æ³›åº”ç”¨çš„æ–¹æ³•è€Œè¨€ï¼Œå…¶åº”ç”¨ä¸Šè¿˜æ˜¯å…·æœ‰ä¸€å®šçš„å±€é™ï¼›äºŒæ¥åœ¨ç®—æ³•çš„è®¾è®¡ã€codingæœ¬èº«çš„å¤æ‚åº¦ä¸Šéƒ½ç›¸è¾ƒäºåŸæœ‰çš„é¢å‘å¯¹è±¡æ–¹æ³•æå‡äº†ä¸æ­¢ä¸€ä¸ªæ¡£æ¬¡ï¼Œå…¥é—¨é—¨æ§›å˜é«˜ï¼›</li><li>æ¨¡ç‰ˆå…ƒç¼–ç¨‹è§£å†³çš„å¹¶ä¸æ˜¯åŸæœ¬ï¼ˆæŒ‡æ³›å‹ï¼‰ä¸èƒ½è§£å†³çš„é—®é¢˜ï¼Œè€Œæ˜¯æå‡ç®—æ³•è¿è¡Œæ—¶æ•ˆç‡/æå‡æŠ½è±¡ç¨‹åº¦çš„ä¸€ä¸ªæ‰‹æ®µ</li></ol><p>å…¶å®è¿˜æœ‰ä¸€äº›åŸå› ï¼Œä½†å—é™äºæˆ‘çš„å¼€å‘ç»éªŒå¹¶ä¸å¤šï¼Œè€Œä¸”æœ¬æ–‡çš„ä¸»è¦ç›®çš„æ˜¯ä»‹ç»æ¨¡ç‰ˆå…ƒç¼–ç¨‹ï¼Œå°±ä»…ä»…åœ¨æ­¤æä¸€å˜´ã€‚</p><p>å›åˆ°æ­£é¢˜ï¼ŒæŠ›å¼€æ¨¡ç‰ˆæœ¬èº«çš„å¤æ‚ç¨‹åº¦ï¼Œåœ¨å®é™…åº”ç”¨ä¸Šçš„ä»·å€¼æ˜¯å¾ˆå¤§çš„ï¼š</p><h4 id="c11">ï½C++11</h4><p>å¯¹äºåŸæœ¬ï¼ˆæŒ‡C++11å‰ï¼‰çš„æ¨¡ç‰ˆè€Œè¨€ï¼Œå…¶ä¸»è¦èµ·åˆ°çš„åŠŸèƒ½æ˜¯ä½œä¸ºç±»å‹æ„é€ å™¨å­˜åœ¨ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">class</span> <span class="title class_">vector</span> &#123;</span><br><span class="line"> <span class="comment">// ...</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  T* data_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™ä¹Ÿæ˜¯STLä¸­çš„å¤§å¤šæ•°<strong>å®¹å™¨</strong>èµ·åˆ°çš„åŠŸèƒ½ï¼Œé€šè¿‡è®¾ç½®æ¨¡ç‰ˆå‚æ•°ï¼Œèƒ½å¤Ÿç®€åŒ–å¹¶å°è£…å¯¹äºæ•°ç»„<code>vector/array</code>ã€å…³è”å®¹å™¨<code>map/unordered_map</code>ã€é“¾è¡¨<code>list/deque</code>ç­‰çš„å°è£…ã€‚</p><p>ä»¥åŠä¹Ÿæœ‰å®¹å™¨é€‚é…å™¨ï¼Œä¾‹å¦‚<code>stack</code>ç±»æ¨¡ç‰ˆï¼Œå…¶æœ¬èº«å¹¶ä¸æ˜¯ä¸€ä¸ªå®¹å™¨æ¨¡ç‰ˆï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">Container</span> = deque&lt;T&gt;&gt; <span class="keyword">class</span> stack;</span><br></pre></td></tr></table></figure><p>å…¶ä¾èµ–äº <code>Container</code>æ¥è¡¨æ˜åº•å±‚å®é™…ä½¿ç”¨çš„å®¹å™¨ï¼Œå†é€šè¿‡è‡ªèº«å°è£…çš„æ¥å£ä¸ºç”¨æˆ·æä¾›æ ˆè¿™ç§æ•°æ®ç»“æ„çš„åŠŸèƒ½ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼ŒC++11ä¹‹å‰ï¼Œæ¨¡ç‰ˆçš„åŠŸèƒ½è¿˜æ˜¯ç›¸å¯¹å•ä¸€ï¼Œæ¨¡ç‰ˆä¸»è¦æä¾›ä¸€ä¸ªç±»å‹/å‡½æ•°æ„é€ çš„æ–¹æ³•ï¼Œå³ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keyword">struct</span> <span class="title class_">Array</span>&#123;&#125;;</span><br></pre></td></tr></table></figure><p><code>Array</code>æœ¬èº«<strong>å¹¶ä¸æ˜¯ç±»å‹</strong>ï¼Œåªæœ‰<code>Array&lt;int&gt;</code>æ‰æ˜¯ç±»å‹ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæ¨¡ç‰ˆç±»/æ¨¡ç‰ˆå‡½æ•°çš„å®ç°ä¸€å®šè¦æ”¾åœ¨å¤´æ–‡ä»¶é‡Œé¢çš„åŸå› ï¼Œå› ä¸ºä»æ¦‚å¿µä¸Šè®²ï¼Œtemplateæ ‡è®°çš„ä¸œè¥¿å¹¶ä¸ç›´æ¥ç”Ÿæˆæœºå™¨äºŒè¿›åˆ¶ä»£ç ï¼Œè€Œåªæœ‰ä½ å°è¯•å°†å…¶å˜ä¸ºç±»å‹ï¼Œä¹Ÿå°±æ˜¯ä½ ä½¿ç”¨æ¨¡ç‰ˆçš„æ—¶å€™æ‰è¿›è¡ŒäºŒè¿›åˆ¶ä»£ç ç”Ÿæˆã€‚</p><p>åœ¨C++11ä¹‹å‰ï¼Œæ¨¡ç‰ˆå·²ç»å¼•å…¥äº†ç‰¹åŒ–çš„åŠŸèƒ½ï¼Œæœ€ç»å…¸çš„ä¾‹å­æ˜¯<code>std::vector&lt;bool&gt;</code>ï¼šå¦‚æœæ²¡æœ‰ç‰¹åŒ–çš„åŠŸèƒ½ï¼Œåœ¨ä½¿ç”¨è¿™ä¸ªç±»çš„æ—¶å€™ï¼Œæœ‰å¤šå°‘ä¸ª<code>bool</code>å°±ä¼šå¼€è¾Ÿå¤šå°‘ç©ºé—´ï¼Œè¿™æ ·æ˜¯å¾ˆæµªè´¹çš„ï¼Œå°±ç®—ä¸€ä¸ª<code>bool</code>åªæœ‰ä¸€å­—èŠ‚ï¼ˆæœ€å°‘ä¹Ÿæ˜¯ï¼‰ï¼Œä¹Ÿä¼šä¸ºæ­¤æµªè´¹8å€çš„å­˜å‚¨ç©ºé—´ã€‚å…·ä½“çš„å®ç°å¤§å®¶å¯ä»¥å»å„å¤§å¹³å°é€›ä¸€é€›ï¼Œå¤§å¤šæ•°è¿˜æ˜¯è®²çš„å¾ˆæ¸…æ¥šçš„ï¼Œè¿™é‡Œå°±æš‚æ—¶ç•¥è¿‡ã€‚æ€»ä¹‹ï¼Œæ¨¡ç‰ˆç‰¹åŒ–æ˜¯ä¸€ç§ä¸ºç‰¹å®šçš„æ¨¡ç‰ˆå‚æ•°è¿›è¡Œâ€œå®šåˆ¶â€çš„æ–¹æ³•ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œc++ä¼šä¼˜å…ˆä½¿ç”¨ç‰¹åŒ–çš„æ¨¡ç‰ˆï¼Œè€ŒéåŸæœ¬æ²¡æœ‰ç‰¹åŒ–çš„æ¨¡ç‰ˆï¼ˆPartialOrderingï¼‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">class</span> <span class="title class_">Array</span> &#123;<span class="comment">/* impl */</span>&#125;</span><br><span class="line"><span class="keyword">template</span>&lt;&gt; <span class="keyword">class</span> <span class="title class_">Array</span>&lt;<span class="type">bool</span>&gt; &#123;<span class="comment">/* spec impl */</span>&#125;</span><br><span class="line">Array&lt;<span class="type">bool</span>&gt; <span class="comment">// ä½¿ç”¨ spec impl è€Œé impl</span></span><br></pre></td></tr></table></figure><p>ç‰¹åŒ–çš„ä¸€ä¸ªé‡è¦åŠŸèƒ½æ˜¯ï¼Œèƒ½å¤Ÿåœ¨ç¼–è¯‘æœŸç»™å‡ºä¸€ä¸ªç±»å‹çš„æŸäº›ç‰¹æ€§ï¼Œä¾‹å¦‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">struct</span> <span class="title class_">is_floating_point</span>&#123;</span><br><span class="line">  <span class="keyword">constexpr</span> <span class="type">static</span> value = <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">template</span>&lt;&gt; <span class="keyword">struct</span> <span class="title class_">is_floating_point</span>&lt;<span class="type">float</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">constexpr</span> <span class="type">static</span> value = <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">template</span>&lt;&gt; <span class="keyword">struct</span> <span class="title class_">is_floating_point</span>&lt;<span class="type">double</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">constexpr</span> <span class="type">static</span> value = <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="c11c17">C++11ï½C++17</h4><p>ä¸»è¦çš„åŠŸèƒ½æ˜¯æ·»åŠ äº†SFINAEï¼Œå³æ›¿æ¢å¤±è´¥å¹¶ä¸æ˜¯é”™è¯¯ï¼Œä¸¾ä¸ªæ¯”è¾ƒæ•™ç§‘ä¹¦çš„ä¾‹å­å¥½äº†ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Ref: https://en.cppreference.com/w/cpp/language/sfinae</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt; <span class="type">int</span> <span class="title">f</span><span class="params">(<span class="keyword">typename</span> T::B*)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt; <span class="type">int</span> <span class="title">f</span><span class="params">(T)</span></span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> i = <span class="built_in">f</span>&lt;<span class="type">int</span>&gt;(<span class="number">0</span>); <span class="comment">// uses second overload</span></span><br></pre></td></tr></table></figure><p>å…¶èƒ½å¤Ÿé€šè¿‡<code>int</code>æ²¡æœ‰æˆå‘˜<code>int::B</code>æ¥åˆ¤æ–­åº”è¯¥ä½¿ç”¨å“ªä¸€ä¸ªæ¨¡ç‰ˆï¼Œå³ä½¿è¿™ä¸¤ä¸ªæ¨¡ç‰ˆæ˜¯åŒåçš„ã€‚</p><p>å…¶æœ€ç»å…¸çš„ä¾‹å­åˆ™æ˜¯<code>enable_if</code> å’Œ ä¸€ç³»åˆ—<code>is_xxx</code> çš„ä½¿ç”¨ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="type">bool</span> B, <span class="keyword">class</span> <span class="title class_">T</span> = <span class="type">void</span>&gt; <span class="keyword">struct</span> enable_if &#123;&#125;;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="keyword">struct</span> <span class="title class_">enable_if</span>&lt;<span class="literal">true</span>, T&gt; &#123; <span class="keyword">typedef</span> T type; &#125;;</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">typename</span> enable_if&lt;is_floating_point&lt;T&gt;::value, <span class="type">void</span>&gt;::<span class="function">type <span class="title">func</span><span class="params">(T x)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// floating impl.</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">typename</span> enable_if&lt;! is_floating_point&lt;T&gt;::value, <span class="type">void</span>&gt;::<span class="function">type <span class="title">func</span><span class="params">(T x)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// other impl.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰SFINAEï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨<code>func&lt;int&gt;(1)</code>çš„æ—¶å€™ï¼Œä¼šæ£€æŸ¥å„ä¸ªæ¨¡ç‰ˆï¼Œå½“æ£€æŸ¥åˆ°ç¬¬ä¸€ä¸ªæ¨¡ç‰ˆçš„æ—¶å€™ï¼Œç”±äº<code>enable_if&lt;false, T&gt;</code>ä¸­å¹¶æ²¡æœ‰æˆå‘˜<code>type</code>ï¼Œåˆ™ä¼šäº§ç”Ÿä¸€ä¸ªé”™è¯¯ï¼ˆEï¼‰ã€‚ä½†æ‹¥æœ‰SFINAEååˆ™ä¸ä¼šæŠ¥é”™ï¼Œç¼–è¯‘å™¨ä¼šå°è¯•ä½¿ç”¨æ‰€æœ‰çš„å¯èƒ½æƒ…å†µï¼Œé€‰æ‹©æœ€åˆé€‚çš„æ¨¡ç‰ˆä½¿ç”¨ï¼Œå¦‚æœæ²¡æœ‰æ¨¡ç‰ˆèƒ½å¤ŸæˆåŠŸæ›¿æ¢æ‰ä¼šæŠ¥é”™ã€‚</p><p>åœ¨C++11ä¸­å¦ä¸€ä¸ªå¤§å‡çº§æ˜¯å¯å˜å‚æ•°æ¨¡ç‰ˆï¼Œå³<code>parameter-pack</code>ï¼Œç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯ç°åœ¨æ¨¡ç‰ˆå¯ä»¥å’Œå‡½æ•°ä¸€æ ·ï¼Œæ¥å—ä»»æ„å¤šä¸ªå‚æ•°ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> ...T&gt; <span class="keyword">class</span> <span class="title class_">Tuple</span>;</span><br><span class="line">Tuple&lt;&gt; tp1;</span><br><span class="line">Tuple&lt;<span class="type">int</span>&gt; tp2;</span><br><span class="line">Tuple&lt;<span class="type">int</span>, <span class="type">float</span>, <span class="type">long</span>&gt; tp3;</span><br></pre></td></tr></table></figure><p>å…¶å¯ä»¥ç”¨äºæ„é€ è¿™æ ·çš„ç±»å‹è¡¨ï¼Œå¹¶ä¸”ç»™å‡ºè¡¨ä¸­çš„å…ƒç´ ä¸ªæ•°ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> ... T&gt; <span class="keyword">struct</span> <span class="title class_">List</span> &#123;</span><br><span class="line"><span class="type">static</span> <span class="keyword">constexpr</span> <span class="type">size_t</span> length = <span class="keyword">sizeof</span>...(T);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤æˆ‘ä»¬å·²ç»èƒ½å¤Ÿéšçº¦çŸ¥é“æ¨¡ç‰ˆçš„ä¸€äº›åŸºæœ¬åŠŸèƒ½ï¼Œå¹¶ä¸”ç”±äºSFINAEçš„å­˜åœ¨ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥æ¥å†™ä¸€äº›ç®€å•çš„ç±»å‹æ¨å¯¼ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Empty</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// H, T... =&gt; H</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span>... T&gt; <span class="keyword">struct</span> <span class="title class_">Front</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;&gt; <span class="keyword">struct</span> <span class="title class_">Front</span>&lt;&gt; &#123;</span><br><span class="line">  <span class="keyword">using</span> type = Empty;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> H, <span class="keyword">typename</span>... T&gt; <span class="keyword">struct</span> <span class="title class_">Front</span>&lt;H, T...&gt; &#123;</span><br><span class="line">  <span class="keyword">using</span> type = H;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// H..., T =&gt; T</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span>... T&gt; <span class="keyword">struct</span> <span class="title class_">Back</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;&gt; <span class="keyword">struct</span> <span class="title class_">Back</span>&lt;&gt; &#123;</span><br><span class="line">  <span class="keyword">using</span> type = Empty;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keyword">struct</span> <span class="title class_">Back</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="keyword">using</span> type = T;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> H, <span class="keyword">typename</span>... T&gt; <span class="keyword">struct</span> <span class="title class_">Back</span>&lt;H, T...&gt; &#123;</span><br><span class="line">  <span class="keyword">using</span> type = <span class="keyword">typename</span> Back&lt;T...&gt;::type;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå®ç°çš„æ˜¯å–å‡ºç±»å‹å‚æ•°è¡¨çš„å¤´å’Œå°¾çš„æ“ä½œã€‚æˆ‘ä»¬å¯ä»¥æ‰©å±•è¿™ä¸ªæ“ä½œï¼Œå³è·å¾—ä¸€ä¸ªç±»å‹çš„<code>List</code>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span>... T&gt; <span class="keyword">struct</span> <span class="title class_">List</span> &#123;</span><br><span class="line">  <span class="comment">// æœ¬èº«</span></span><br><span class="line">  <span class="keyword">using</span> type = List&lt;T...&gt;;</span><br><span class="line">  <span class="comment">// é•¿åº¦</span></span><br><span class="line">  <span class="keyword">constexpr</span> <span class="type">static</span> acg::<span class="type">size_t</span> size_ = <span class="keyword">sizeof</span>...(T);</span><br><span class="line">  <span class="comment">// è½¬æ¢ï¼Œä¾‹å¦‚: List&lt;int, float, char&gt;::cast&lt;std::tuple&gt; =&gt; std::tuple&lt;int, float, char&gt;</span></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">template</span> &lt;<span class="keyword">typename</span>...&gt; <span class="keyword">typename</span> C&gt; <span class="keyword">using</span> cast = C&lt;T...&gt;;</span><br><span class="line">  <span class="comment">// å°¾éƒ¨æ‰©å±•</span></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Ts&gt; <span class="keyword">using</span> append = List&lt;T..., Ts&gt;;</span><br><span class="line">  <span class="comment">// å¤´ä¸Šæ‰©å±•</span></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Ts&gt; <span class="keyword">using</span> prepend = List&lt;Ts, T...&gt;;</span><br><span class="line">  <span class="keyword">using</span> front = <span class="keyword">typename</span> Front&lt;T...&gt;::type;</span><br><span class="line">  <span class="keyword">using</span> back = <span class="keyword">typename</span> Back&lt;T...&gt;::type;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æœ‰äº†åç‰¹åŒ–æˆ‘ä»¬å¯ä»¥åšå•¥å‘¢ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Car: [h, t...] =&gt; h</span></span><br><span class="line"><span class="comment">//      [h] =&gt; h</span></span><br><span class="line"><span class="comment">//      [] =&gt; Empty</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keyword">struct</span> <span class="title class_">Car</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span>... T&gt; <span class="keyword">struct</span> <span class="title class_">Car</span>&lt;List&lt;T...&gt;&gt; &#123;</span><br><span class="line">  <span class="keyword">using</span> type = <span class="keyword">typename</span> List&lt;T...&gt;::front;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Cdr: [h, t...] =&gt; [t...]</span></span><br><span class="line"><span class="comment">//      [h] =&gt; []</span></span><br><span class="line"><span class="comment">//      [] =&gt; Empty</span></span><br><span class="line"><span class="comment">//      ?  =&gt;</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keyword">struct</span> <span class="title class_">Cdr</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> H, <span class="keyword">typename</span>... T&gt; <span class="keyword">struct</span> <span class="title class_">Cdr</span>&lt;List&lt;H, T...&gt;&gt; &#123;</span><br><span class="line">  <span class="keyword">using</span> type = List&lt;T...&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> H&gt; <span class="keyword">struct</span> <span class="title class_">Cdr</span>&lt;List&lt;H&gt;&gt; &#123;</span><br><span class="line">  <span class="keyword">using</span> type = List&lt;&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯æœ‰å‡½æ•°å¼ç¼–ç¨‹é‚£å‘³äº†ï¼Ÿæˆ‘ä»¬ç»§ç»­ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GetElem</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">int</span> x, <span class="keyword">typename</span> T&gt; <span class="keyword">struct</span> <span class="title class_">GetElem</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetElem x [] =&gt; Empty</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">int</span> x&gt; <span class="keyword">struct</span> <span class="title class_">GetElem</span>&lt;x, List&lt;&gt;&gt; &#123;</span><br><span class="line">  <span class="keyword">using</span> type = Empty;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetElem 0 [H T ...] =&gt; H</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> H, <span class="keyword">typename</span>... T&gt; <span class="keyword">struct</span> <span class="title class_">GetElem</span>&lt;<span class="number">0</span>, List&lt;H, T...&gt;&gt; &#123;</span><br><span class="line">  <span class="keyword">using</span> type = H;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetElem x [H T ...] =&gt; GetElem (x - 1) [T ...]</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">int</span> x, <span class="keyword">typename</span>... T&gt; <span class="keyword">struct</span> <span class="title class_">GetElem</span>&lt;x, List&lt;T...&gt;&gt;</span><br><span class="line">    : <span class="keyword">public</span> GetElem&lt;x - <span class="number">1</span>, <span class="keyword">typename</span> Cdr&lt;List&lt;T...&gt;&gt;::type&gt; &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Concat</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> L, <span class="keyword">typename</span> R&gt; <span class="keyword">struct</span> <span class="title class_">Concat</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Concat [L...] [R...] =&gt; [L... R...]</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span>... LT, <span class="keyword">typename</span>... RT&gt; <span class="keyword">struct</span> <span class="title class_">Concat</span>&lt;List&lt;LT...&gt;, List&lt;RT...&gt;&gt; &#123;</span><br><span class="line">  <span class="keyword">using</span> type = List&lt;LT..., RT...&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šäº†è§£è¿‡Haskellçš„ç«¥é‹å·²ç»å‘ç°äº†ï¼Œå®ƒå’ŒHaskellçš„é£æ ¼çœŸçš„å¾ˆåƒï¼é€šè¿‡åç‰¹åŒ–å’ŒSFINAEï¼Œæˆ‘ä»¬å®ç°äº†ç±»ä¼¼äºå‡½æ•°å¼é‡Œçš„æ¨¡å¼åŒ¹é…åŠŸèƒ½ã€‚ä»¥åŠåœ¨æ¨¡ç‰ˆæ›¿æ¢è¿‡ç¨‹ä¸­ï¼Œå®é™…ä¸Šæ˜¯æœ‰ä¸€å®šçš„LazyEvaluationçš„å­˜åœ¨çš„ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Empty</span> &#123;&#125;;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keyword">struct</span> <span class="title class_">GetType</span> &#123;</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">Inner</span> &#123; <span class="keyword">using</span> type = <span class="keyword">typename</span> T::type; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  GetType&lt;Empty&gt; x; <span class="comment">// No Error! because GetType&lt;Empty&gt;::Inner is not instantiated!</span></span><br><span class="line">  <span class="comment">// GetType&lt;Empty&gt;::Inner x; -&gt; Error!</span></span><br><span class="line">  <span class="comment">// error: no type named &#x27;type&#x27; in &#x27;Empty&#x27;</span></span><br><span class="line">  <span class="comment">//  ... in instantiation of member class &#x27;GetType&lt;Empty&gt;::Inner&#x27; requested here</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="c17">C++17ï½</h4><p>è¿™é‡Œä¸»è¦å°±æ˜¯é’ˆå¯¹ä¹‹å‰çš„ä¸€äº›ç—›ç‚¹åšå‡ºçš„ä¼˜åŒ–ï¼Œæ¯”å¦‚CTADè¿™äº›ï¼Œèƒ½å¤Ÿæ›´æ–¹ä¾¿çš„å¸®ä½ å®ç°ä¸€äº›éªšæ“ä½œï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::pair <span class="title">p</span><span class="params">(<span class="number">2</span>, <span class="number">4.5</span>)</span></span>;     <span class="comment">// deduces to std::pair&lt;int, double&gt; p(2, 4.5);</span></span><br><span class="line"><span class="function">std::tuple <span class="title">t</span><span class="params">(<span class="number">4</span>, <span class="number">3</span>, <span class="number">2.5</span>)</span></span>; <span class="comment">// same as auto t = std::make_tuple(4, 3, 2.5);</span></span><br><span class="line">std::less l;             <span class="comment">// same as std::less&lt;void&gt; l;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡ŒåŸæœ¬æ˜¯éœ€è¦ç»™å‡ºæ¨¡ç‰ˆå‚æ•°çš„ï¼Œä½†ç”±äºCTADçš„å­˜åœ¨ï¼Œå…¶å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°æ¥è‡ªåŠ¨æ¨æ–­å‡ºä½ éœ€è¦çš„ç±»å‹ã€‚</p><figure><img src="./meta_intro.assets/image-20221122143024020.png"alt="image-20221122143024020" /><figcaption aria-hidden="true">image-20221122143024020</figcaption></figure><h3id="é‚£ä¹ˆæ¨¡ç‰ˆåˆ°åº•æœ‰ä»€ä¹ˆæ›´å®é™…çš„ä½œç”¨å‘¢">é‚£ä¹ˆæ¨¡ç‰ˆåˆ°åº•æœ‰ä»€ä¹ˆæ›´å®é™…çš„ä½œç”¨å‘¢ï¼Ÿ</h3><p>é¦–å…ˆï¼Œå¯ä»¥ç”¨è¿™æ ·çš„ç±»å‹æ•°æ®ç»“æ„æ¥å®ç°ç¼–è¯‘æ—¶ç®—æ³•ï¼Œä¾‹å¦‚ TaskFlowçš„è¿™ä¸ªPRï¼š<ahref="Add%20TaskBuild%20DSL%20to%20describe%20a%20graph!%20by%20netcan%20Â·%20Pull%20Request%20#222%20Â·%20taskflow/taskflowgithub.com/taskflow/taskflow/pull/222">NewFeature</a></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">def_task</span>((A), &#123; std::cout &lt;&lt; <span class="string">&quot;TaskA\n&quot;</span>; &#125;;);</span><br><span class="line"><span class="built_in">def_task</span>((B), &#123; std::cout &lt;&lt; <span class="string">&quot;TaskB\n&quot;</span>; &#125;;);</span><br><span class="line"><span class="built_in">def_task</span>((C), &#123; std::cout &lt;&lt; <span class="string">&quot;TaskC\n&quot;</span>; &#125;;);</span><br><span class="line"><span class="built_in">def_task</span>((D), &#123; std::cout &lt;&lt; <span class="string">&quot;TaskD\n&quot;</span>; &#125;;);</span><br><span class="line"><span class="built_in">def_task</span>((E), &#123; std::cout &lt;&lt; <span class="string">&quot;TaskE\n&quot;</span>; &#125;;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> tasks = <span class="built_in">taskbuild</span>(</span><br><span class="line">  <span class="built_in">task</span>(A)</span><br><span class="line">    -&gt; fork(B, C)</span><br><span class="line">    -&gt; <span class="built_in">task</span>(D),</span><br><span class="line">  <span class="built_in">merge</span>(A, B)</span><br><span class="line">    -&gt; <span class="built_in">task</span>(E)</span><br><span class="line">)(taskflow);</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™æ ·ç®€å•çš„è¯­æ³•å°±èƒ½å¤Ÿå¿«é€Ÿä¸”å‡†ç¡®åœ°æè¿°ä»»åŠ¡ä¹‹é—´çš„æ‹“æ‰‘è¿æ¥å…³ç³»ã€‚è¿™å’Œæˆ‘ä»¬çš„ç»ˆæç›®æ ‡â€”â€”AutoDiffå¾ˆåƒï¼AutoDiffå¤§å¤šéœ€è¦é€šè¿‡è®¡ç®—å›¾æ¨¡å‹æ¥è¿›è¡Œæ¢¯åº¦è®¡ç®—ï¼Œä¾‹å¦‚<ahref="https://pytorch.org/tutorials/beginner/blitz/autograd_tutorial.html#computational-graphpytorch.org/tutorials/beginner/blitz/autograd_tutorial.html#computational-graph">PyTorch</a></p><p>Taskflowä¸­ï¼Œæè¿°Taskä¹‹é—´å…³ç³»çš„å›¾ä¹Ÿæ˜¯æœ‰å‘æ— ç¯çš„ï¼Œè€Œè®¡ç®—å›¾æ¨¡å‹ä¹Ÿæ˜¯æœ‰å‘æ— ç¯çš„ã€‚TaskFlowåˆ©ç”¨æ¨¡ç‰ˆå…ƒç¼–ç¨‹å®ç°äº†è¿›è¡Œé™æ€çš„ä»»åŠ¡è°ƒåº¦ï¼Œå³é€šè¿‡å¯¹äºå›¾èŠ‚ç‚¹è¿›è¡Œæ‹“æ‰‘æ’åºï¼Œåœ¨ç¼–è¯‘æœŸåˆ©ç”¨æ¨¡ç‰ˆè‡ªåŠ¨æ¨å¯¼ã€å¹¶ç¡®å®šä»»åŠ¡æ‰§è¡Œé¡ºåºï¼Œåœ¨è¿è¡Œæ—¶ç›´æ¥æŒ‰ç…§è¯¥é¡ºåºæ‰§è¡Œï¼Œå³å¯çœå»åŸæ¥åœ¨è¿è¡Œæ—¶è®¡ç®—æ‹“æ‰‘æ’åºï¼š</p><p><ahref="netcan.github.io/2020/08/15/%E8%AE%BE%E8%AE%A1%E5%B9%B6%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8FDSL/">è®¾è®¡å¹¶å®ç°ä¸€ä¸ªæ‹“æ‰‘æ’åºDSL</a></p><p>æˆ‘ä»¬çš„Autodiffä¸­ï¼Œä½•å¤„ä½¿ç”¨äº†ç±»ä¼¼çš„æ€æƒ³å‘¢ï¼Œæˆ‘ä»¬æ¥ä»”ç»†è®²è®²</p><h3 id="meta-autodiff">Meta AutoDiff</h3><p>è¿™é‡Œæˆ‘ä»¬åˆæ­¥æ„æ€ä¸€ä¸‹AutoDiffå®ç°çš„å¤§è‡´æ–¹æ¡ˆå’Œæ€è·¯ã€‚</p><blockquote><p>P.S.ç”±äºé«˜é˜¶å¯¼æ•°æ˜¯å¯¼æ•°çš„å¯¼æ•°ï¼Œå› æ­¤æˆ‘ä»¬ï¼ˆå¦‚æœæœ‰è§£æè¡¨è¾¾å¼çš„æƒ…å†µä¸‹ï¼‰åªéœ€è¦è€ƒè™‘ä¸€é˜¶å¯¼æ•°å¦‚ä½•è¿›è¡Œè®¡ç®—ã€‚</p></blockquote><h4 id="æ–¹å‘å¯¼æ•°è®¡ç®—çš„æ•°å­¦åŸºç¡€">æ–¹å‘å¯¼æ•°è®¡ç®—çš„æ•°å­¦åŸºç¡€</h4><blockquote><p>P.S. åœ¨è¿™é‡Œå…ˆè€ƒè™‘å‡½æ•°å…‰æ»‘ã€‚</p></blockquote><p>é¦–å…ˆæ˜¯ï¼Œä¸€é˜¶å¯¼æ•°åˆ°åº•æ˜¯å¦‚ä½•æ±‚å‡ºçš„ï¼Ÿè¿™é‡Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨æ±‚æ–¹å‘å¯¼æ•°çš„æ–¹æ³•ã€‚ç°æœ‰çš„AutoDiffåº“ï¼Œä»¥åŠcereséƒ½ä½¿ç”¨äº†è¿™ç±»æ–¹æ³•</p><blockquote><p><a href="https://zhuanlan.zhihu.com/p/248865580">reference</a></p></blockquote><p>æˆ‘ä»¬è¿›è¡Œä¸€ä¸ªç®€å•çš„æ¨å¯¼ï¼Œå…ˆè€ƒè™‘å…‰æ»‘çš„ä¸€å…ƒå‡½æ•°å‡½æ•° <spanclass="math inline">\(f,g,h:\mathbb R\rightarrow \mathbb R\)</span>çš„æƒ…å†µï¼ˆè¡¨è¿°ä¸Šå¯èƒ½ä¸æ˜¯å¾ˆä¸¥è°¨ï¼‰ï¼š</p><p>é“¾å¼æ³•åˆ™å‘Šè¯‰æˆ‘ä»¬ï¼šè‹¥ <span class="math inline">\(f = g\circh\)</span>ï¼Œä¸”<span class="math inline">\(f(x) = g(h(x))\)</span>ï¼Œ<spanclass="math inline">\(\frac{\mathrm d f}{\mathrm d x}(x) = \frac{\mathrmd g}{\mathrm d h} (x)\frac{\mathrm d h}{\mathrm d x}(x)\)</span>ï¼Œä¸¾ä¸ªä¾‹å­ï¼š</p><p><span class="math display">\[\begin{aligned} &amp;f(x) = \cos x^2, g(x) = \cos(x), h(x) = x^2\\\implies&amp; \frac{\mathrm d f}{\mathrm d x} (x)= \frac{\mathrm dg}{\mathrm d h} (x)\frac{\mathrm d h}{\mathrm d x} (x)= -\sin(x^2) \cdot2x\\ \implies &amp;\mathrm{d}f = - 2x \cdot \sin(x^2)\mathrm{d}x\end{aligned}\]</span></p><p>ç”±äºä¸€å…ƒå‡½æ•°/æ ‡é‡çš„æ ‡é‡å€¼å‡½æ•°å¹¶æ²¡æœ‰æ–¹å‘çš„æ¦‚å¿µï¼ˆå§‹ç»ˆè®¤ä¸º dx å°±æ˜¯æ²¿ç€ xæ­£å‘èµ°çš„ä¸€ä¸ªå°é‡ï¼‰ï¼Œæˆ‘ä»¬æ¥ç¬¬äºŒä¸ªä¾‹å­ï¼Œæ¥åˆ†æå…¶ä¸­çš„å¯¼æ•°æ˜¯å¦‚ä½•è¿›è¡Œä¼ é€’çš„ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªäºŒå…ƒå‡½æ•°<spanclass="math inline">\(f(x, y): (x, y)\rightarrowtail xy, \mathbb R\times\mathbb R \rightarrow \mathbb R\)</span></p><p>æˆ‘ä»¬æƒ³çŸ¥é“çš„æ˜¯ï¼Œå…³äº <span class="math inline">\(x,y\)</span>çš„åå¯¼æ•°çš„è§£æå¼ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•å¯¹ <span class="math inline">\(f\)</span>è¿›è¡Œ<strong>å…¨å¾®åˆ†</strong>ï¼š</p><p><span class="math display">\[\mathrm df = x \mathrm dy + y\mathrm dx\]</span></p><p>è€ƒè™‘åˆ°å®é™…ä¸Šå…¨å¾®åˆ†æè¿°çš„æ˜¯å‡½æ•°åœ¨ä¸€ç‚¹çš„çº¿æ€§è¿‘ä¼¼ï¼Œæ”¹å†™ä¸ºï¼š</p><p><span class="math display">\[f + \delta f = xy +x \delta y + y\delta x\]</span></p><p>å®é™…ä¸Šï¼Œæˆ‘ä»¬åªéœ€è¦çº¿æ€§è¿‘ä¼¼ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è®¤ä¸ºäºŒé˜¶å°é‡ä¸º0ï¼Œå³</p><p><span class="math display">\[f+\delta f = (x+\delta x)(y+\delta y) \approx xy + x\delta y+y\delta x\]</span></p><p>åœ¨è¿™ä¸ªæ„ä¹‰ä¸‹ï¼Œæˆ‘ä»¬ç›´æ¥å– <span class="math inline">\(\delta x, \deltay\)</span> çš„ç³»æ•°ï¼Œå°±èƒ½å¾—åˆ°å…³äº <span class="math inline">\(x,y\)</span>çš„<strong>åå¯¼æ•°</strong>çš„è§£æè¡¨è¾¾ï¼å®é™…ä¸Š <spanclass="math inline">\(f\)</span> çœ‹ä½œä¸€ä¸ªå‘é‡å‡½æ•°æƒ…å†µä¸‹ï¼Œå³<spanclass="math inline">\(f:\mathbb R^2\rightarrow \mathbb R\)</span>ï¼Œé‚£ä¹ˆä¹‹å‰æåˆ°çš„ <span class="math inline">\(\delta x\)</span>å‰çš„ç³»æ•°å®é™…ä¸Šæ˜¯å®ƒçš„æ–¹å‘å¯¼æ•°ï¼Œæ–¹å‘æ˜¯ <spanclass="math inline">\(x\)</span> æ­£æ–¹å‘ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œæ ¹æ®æ–¹å‘å¯¼æ•°çš„å®šä¹‰å…¶æè¿°çš„æ˜¯è‡ªå˜é‡æ²¿ç€æŸä¸€ä¸ªæ–¹å‘èµ°å‡ºä¸€å°æ­¥ï¼ˆ<spanclass="math inline">\(\delta x =:e\)</span>ï¼‰ï¼Œå¯¹äºæœ€ç»ˆå‡½æ•°çš„å½±å“æœ‰å¤šå¤§ï¼ˆ <spanclass="math inline">\(\delta f\)</span> ï¼‰ï¼šä¾‹å¦‚åœ¨ä¸Šå¼ä¸­ï¼Œæˆ‘ä»¬åªæ²¿ç€<span class="math inline">\(x\)</span> èµ°ä¸€æ­¥ <spanclass="math inline">\(e\)</span> ï¼Œå³ <span class="math inline">\(\deltax =e, \delta y = 0\)</span> ï¼Œé‚£ä¹ˆ</p><p><span class="math display">\[f + \delta f = xy + y \cdot e\]</span></p><p>å–å‡ºè¿™ä¸ªç³»æ•°å³å¯å¾—åˆ° <span class="math inline">\(f_x\)</span> ã€‚</p><blockquote><p>P.S. ä¸ºå•¥ä¸ä¸€èµ·æ±‚ <span class="math inline">\(f_x,f_y\)</span>çš„è¡¨è¾¾å¼ï¼Œå®é™…ä¸Šæ˜¯ä¸ºäº†è®©è¿™ä¸ªé—®é¢˜å˜å¾—ç®€å•ï¼Œå› ä¸ºå¿…é¡»åŒºåˆ† <spanclass="math inline">\(x,y\)</span> å¯¹äº <spanclass="math inline">\(f\)</span> çš„è´¡çŒ®ï¼Œä»è€Œå°±ä¼šå¼•å…¥ä¸¤ä¸ªç±»ä¼¼äº eçš„å˜å…ƒï¼Œåœ¨åç»­å®ç°ä¸Šè¾ƒä¸ºå¤æ‚ã€‚å¦ä¸€æ–¹é¢ï¼Œç”±äºæ‰€æœ‰è¡¨è¾¾å¼éƒ½æ˜¯åœ¨ç¼–è¯‘æœŸæ¨å¯¼çš„ï¼Œè¿è¡Œæ—¶ä»…ä»…è¿›è¡Œè¡¨è¾¾å¼è®¡ç®—ï¼Œå› æ­¤ä¸ä¼šå› æ­¤å¸¦æ¥é¢å¤–çš„è¿è¡Œæ—¶æ¶ˆè€—ã€‚</p></blockquote><p>æˆ‘ä»¬ä¸€èˆ¬æ„ä¹‰ä¸Šè¯´çš„æ¢¯åº¦ï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªæ ‡é‡å€¼å‡½æ•°ï¼Œå¯¹äºå…¶è¾“å…¥å‘é‡çš„å„ä¸ªç»´åº¦çš„å¯¼æ•°ï¼Œå³ï¼š</p><p><span class="math display">\[f:\mathbb R^n \rightarrow \mathbb R\implies (\nabla f)^T = \left(\frac{\partial f}{\partial x_1}, \frac{\partial f}{\partial x_2},\cdots,\frac{\partial f}{\partial x_n} \right)\]</span></p><p>é‚£ä¹ˆæˆ‘ä»¬åœ¨è®¡ç®—ç¬¬ä¸€ä¸ªåå¯¼æ•°çš„æ—¶å€™ï¼Œè®¾å®š <span class="math inline">\(e= (1, 0, \cdots, 0)\)</span>ï¼Œæœ€ç»ˆå°±èƒ½æ±‚å‡ºå¾—åˆ°çš„<spanclass="math inline">\(\frac{\partial f}{\partial x_1}\)</span>ã€‚</p><p>è¿™ä¸ªæ–¹æ³•çš„æ¨å¯¼è¿‡ç¨‹ä¸­ï¼Œè¡¨è¾¾å¼å¸¸å¸¸è¢«ç§°ä¸ºDualï¼Œå› ä¸ºæ•´ä¸ªè¡¨è¾¾å¼ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œä¸€éƒ¨åˆ†æ˜¯åŸæœ¬çš„è¡¨è¾¾å¼ï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯è¡¨è¾¾å¼å…³äºæŸä¸ªæ–¹å‘çš„æ–¹å‘å¯¼æ•°å€¼ï¼Œè®°ä½œ<spanclass="math inline">\(f(x) + e\cdot g(x)\)</span>ã€‚ç”±äº<spanclass="math inline">\(e\)</span>å®é™…ä¸Šæ˜¯ä»£è¡¨é€‰å®šæ–¹å‘çš„ä¸€ä¸ªä¸€é˜¶æ— ç©·å°é‡ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¹Ÿåªéœ€è¦ä¸€é˜¶æ— ç©·å°é‡ï¼Œå› æ­¤å…³äº<spanclass="math inline">\(e\)</span>å®šä¹‰</p><p><span class="math display">\[e^2 = 0\]</span></p><p>å…¶ä»–çš„å››åˆ™è¿ç®—åˆ™ä¸åŸæœ¬ä¸€è‡´ã€‚è¿™é‡Œç»™å‡ºä¸€äº›ä¾‹å­ï¼ˆä»…å¯¹äº<spanclass="math inline">\(x\)</span>æ±‚åå¯¼ï¼Œä¹Ÿå°±æ˜¯xæ­£æ–¹å‘çš„æ–¹å‘å¯¼æ•°ï¼‰ï¼š</p><p><span class="math display">\[\begin{aligned}f(x) = x^2 &amp;\implies f + \delta f = (x + e) ^2 = x^2 + e\cdot 2x\\f(x, y) = xy &amp; \implies f + \delta f = (x + e)y = xy + e \cdot y\\f(x, y) = x+y &amp; \implies f + \delta f = (x + e)+y = x+y + e \cdot1\end{aligned}\]</span></p><p>å¦å¤–ï¼Œå¦‚æœæ˜¯å‘é‡å‡½æ•°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ±‚å‡ºå…¶å…³äºç¬¬1ä¸ªç»´åº¦çš„æ–¹å‘å¯¼æ•°ï¼Œä¾‹å¦‚è®¾<spanclass="math inline">\(x, y\in \mathbb R^3\)</span>ï¼Œä¸‹åˆ—å‡½æ•°å…³äº<spanclass="math inline">\(\delta x = e (1, 0,0)^T\)</span>çš„æ–¹å‘å¯¼æ•°å¯ä»¥ç”¨ç›¸ç±»ä¼¼çš„æ–¹æ³•è¿›è¡Œæ¨å¯¼</p><p><span class="math display">\[\begin{aligned}f(x) = x^Tx = \| x\|^2 &amp;\implies f + \delta f = (x + \delta x)^T(x+\delta x) = x^Tx + 2x\cdot \delta x= x^Tx + e\cdot (2x \cdot (1, 0, 0)^T) \\f(x, y) = x^Ty &amp; \implies f + \delta f = (x + \delta x)y = xy + e(1,0, 0)^T\cdot y\\f(x, y) = x+y &amp; \implies f + \delta f = (x + e)+y = x+y + e (1, 0,0)^T\end{aligned}\]</span></p><p>ä»ç¬¬ä¸‰ä¸ªä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨æ–¹å‘å¯¼æ•°æˆ‘ä»¬ä¸ä»…ä»…èƒ½å¤Ÿè·å¾—å¯¹äºæ ‡é‡å€¼å‡½æ•°çš„æ–¹å‘å¯¼æ•°ï¼Œæˆ‘ä»¬è¿˜èƒ½å¤Ÿå¾—åˆ°å¯¹äºå‘é‡å€¼å‡½æ•°çš„æ–¹å‘å¯¼æ•°ã€‚</p><p>å¦å¤–æˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ˜¯å¤šå…ƒå‡½æ•°ï¼Œåœ¨åº”ç”¨é“¾å¼æ³•åˆ™çš„æ—¶å€™éœ€è¦æ³¨æ„æ±‚å‡ºæ¯ä¸€ä¸ªè¾“å…¥çš„å¯¼æ•°ï¼Œå†ç»„åˆå‡ºæœ€ç»ˆç»“æœï¼š</p><p><span class="math display">\[f(x) = g(h_1(x), h_2(x), \cdots, h_n(x)) \implies\frac{\partial f}{\partial x} = \sum _{ i = 1}^n \frac{\partialg}{\partial h _ i} \frac{\partial h _ i}{\partial x}\]</span></p><h3 id="å¦‚ä½•å°†å…¬å¼å˜ä¸ºä»£ç -åŸºäºç±»å‹çš„ç¬¦å·è®¡ç®—">å¦‚ä½•å°†å…¬å¼å˜ä¸ºä»£ç  â€”åŸºäºç±»å‹çš„ç¬¦å·è®¡ç®—</h3><p>å¦‚ä½•è¿›è¡Œç¬¦å·è®¡ç®—ï¼Œç‰¹åˆ«æ˜¯ç¼–è¯‘æœŸçš„ç¬¦å·è®¡ç®—ã€‚åŒºåˆ«äºAutoDiffçš„å®ç°ï¼š</p><p><ahref="https://github.com/autodiff/autodiff/blob/main/autodiff/reverse/var/var.hpp">Autodiff/reverse/var</a></p><p>è¯¥å®ç°çš„åŸç†æ˜¯åœ¨æ¯ä¸€æ¬¡å‘ç”Ÿè®¡ç®—çš„æ—¶ï¼Œä¾èµ–äºè¿ç®—ç¬¦é‡è½½è‡ªåŠ¨ç”Ÿæˆè®¡ç®—å›¾ã€‚å¯¹äºè®¡ç®—å›¾çš„ç”Ÿæˆåœ¨æœ¬è´¨ä¸Šæ˜¯åœ¨ç¼–è¯‘æ—¶çš„ï¼Œä½†å¯¹äºå¯¼æ•°çš„è®¡ç®—æ˜¯è¿è¡Œæ—¶çš„ï¼Œå³å…¶å¹¶æ²¡æœ‰å¾—åˆ°å¯¼æ•°çš„è§£æè¡¨è¾¾å¼ï¼Œè€Œæ˜¯é€šè¿‡è¿è¡Œæ—¶æ¥è®¡ç®—å¾—åˆ°çš„ã€‚ä¾‹å¦‚å¯¹äºHessian çš„è®¡ç®—ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Return the Hessian matrix of variable y with respect to variables x.</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> X, <span class="keyword">typename</span> GradientVec&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">hessian</span><span class="params">(<span class="type">const</span> Variable&lt;T&gt;&amp; y, Eigen::DenseBase&lt;X&gt;&amp; x, GradientVec&amp; g)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">using</span> U = VariableValueType&lt;T&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> ScalarX = <span class="keyword">typename</span> X::Scalar;</span><br><span class="line">    <span class="built_in">static_assert</span>(isVariable&lt;ScalarX&gt;, <span class="string">&quot;Argument x is not a vector with Variable&lt;T&gt; (aka var) objects.&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> ScalarG = <span class="keyword">typename</span> GradientVec::Scalar;</span><br><span class="line">    <span class="built_in">static_assert</span>(std::is_same_v&lt;U, ScalarG&gt;, <span class="string">&quot;Argument g does not have the same arithmetic type as y.&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constexpr</span> <span class="keyword">auto</span> Rows = X::RowsAtCompileTime;</span><br><span class="line">    <span class="keyword">constexpr</span> <span class="keyword">auto</span> MaxRows = X::MaxRowsAtCompileTime;</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="keyword">auto</span> n = x.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Form a vector containing gradient expressions for each variable</span></span><br><span class="line">    <span class="keyword">using</span> ExpressionGradient = Vec&lt;ScalarX, Rows, MaxRows&gt;;</span><br><span class="line">    <span class="function">ExpressionGradient <span class="title">G</span><span class="params">(n)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> k = <span class="number">0</span>; k &lt; n; ++k)</span><br><span class="line">        x[k].expr-&gt;<span class="built_in">bind_expr</span>(&amp;<span class="built_in">G</span>(k).expr);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Build a full gradient expression in DFS tree traversal, updating</span></span><br><span class="line"><span class="comment">     * gradient expressions when encountering variables</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    y.expr-&gt;<span class="built_in">propagatex</span>(<span class="built_in">constant</span>&lt;T&gt;(<span class="number">1.0</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> k = <span class="number">0</span>; k &lt; n; ++k) &#123;</span><br><span class="line">      x[k].expr-&gt;<span class="built_in">bind_expr</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Read the gradient value from gradient expressions&#x27; cached values</span></span><br><span class="line">    g.<span class="built_in">resize</span>(n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">        g[i] = <span class="built_in">val</span>(G[i]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Form a numeric hessian using the gradient expressions</span></span><br><span class="line">    <span class="keyword">using</span> Hessian = Mat&lt;U, Rows, Rows, MaxRows, MaxRows&gt;;</span><br><span class="line">    Hessian H = Hessian::<span class="built_in">Zero</span>(n, n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> k = <span class="number">0</span>; k &lt; n; ++k)</span><br><span class="line">            x[k].expr-&gt;<span class="built_in">bind_value</span>(&amp;<span class="built_in">H</span>(i, k));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Propagate a second derivative value calculation down the gradient expression tree for variable i</span></span><br><span class="line">        G[i].expr-&gt;<span class="built_in">propagate</span>(<span class="number">1.0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> k = <span class="number">0</span>; k &lt; n; ++k)</span><br><span class="line">            x[k].expr-&gt;<span class="built_in">bind_value</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> H;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸ä»…ä»…å¯èƒ½äº§ç”Ÿå¤šæ¬¡é‡å¤çš„è®¡ç®—ç»“æœï¼Œè€Œä¸”ä¸­é—´åœ¨è®¡ç®—ä¸Šå¤§é‡ä½¿ç”¨äº†<code>shared_ptr</code>å¯¼è‡´äº†è®¡ç®—æ•ˆç‡ä½ä¸‹çš„é—®é¢˜ã€‚</p><p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯åœ¨<strong>ç¼–è¯‘æœŸ</strong>äº§ç”Ÿè§£æçš„<strong>æ–¹å‘å¯¼æ•°</strong>ï¼ˆä¹Ÿå°±æ˜¯è¿™ä¸ªæ–¹å‘å¯¼æ•°çš„è§£æè¡¨è¾¾å¼ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬çš„ï¼ˆæ•°å­¦ä¸Šçš„ï¼‰è¾“å…¥å˜é‡ä¸€å®šä¸æ˜¯ï¼ˆç¼–ç¨‹ä¸­çš„ï¼‰å˜é‡ï¼</p><p>åœ¨C++ä¸­ï¼Œå˜é‡æ˜¯è¿è¡Œæ—¶çš„ä¸€ä¸ªæ¦‚å¿µï¼Œé€šå¸¸è®¤ä¸ºèƒ½å¤Ÿå¯¹åº”åˆ°ä¸€ä¸ªç‰©ç†å­˜åœ¨çš„å†…å­˜å—ï¼Œèƒ½å¤Ÿå‚ä¸è¿è¡Œæ—¶çš„è®¡ç®—ã€‚è€Œç±»å‹æ‰æ˜¯C++ä¸­ç¼–è¯‘æ—¶çš„æ¦‚å¿µï¼Œåœ¨æ²¡æœ‰RAIIçš„æƒ…å†µä¸‹ï¼Œç»å¤§å¤šæ•°ç¨‹åºå¹¶ä¸èƒ½ç›´æ¥å¾—åˆ°æŸä¸ªç‰©ç†å†…å­˜å—ä¸Šå­˜å‚¨çš„å˜é‡æ‰€å¯¹åº”çš„ç±»å‹ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦äº§ç”Ÿå°½é‡å°‘çš„è¿è¡Œæ—¶å¼€é”€ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç”¨æ¥æ¨å¯¼å¯¼æ•°æ‰€ä½¿ç”¨çš„ä¸€å®šåªèƒ½æ˜¯åŸºäºç±»å‹ï¼Œè€Œéå˜é‡ã€‚</p><p>æ›´å½¢è±¡åŒ–æ¥è¯´ï¼Œé€šå¸¸å¯èƒ½ä½ è®¤ä¸ºçš„Addç±»æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Add</span>: <span class="keyword">public</span> Expr <span class="comment">/* è¡¨ç¤ºä¸€ä¸ªè®¡ç®—å›¾èŠ‚ç‚¹ */</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Add</span>(Node* lhs, Node* rhs);</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  Node* lhs, rhs; <span class="comment">// Runtime Consumption</span></span><br><span class="line">  ValueType val;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Input</span>: <span class="keyword">public</span> Expr &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">SetValue</span><span class="params">(ValueType )</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  ValueType val;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†å®é™…ä¸Šæˆ‘ä»¬æƒ³è¦çš„æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> L, <span class="keyword">typename</span> R&gt; <span class="keyword">struct</span> <span class="title class_">Add</span>: <span class="keyword">public</span> Expr &#123; </span><br><span class="line">  <span class="keyword">using</span> type = Add&lt;L, R&gt;; </span><br><span class="line">  <span class="type">static</span> <span class="keyword">constexpr</span> <span class="type">bool</span> is_leaf = <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Input</span>: <span class="keyword">public</span> Expr&#123;</span><br><span class="line">  <span class="type">static</span> <span class="keyword">constexpr</span> <span class="type">bool</span> is_leaf = <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç”Ÿæˆçš„ä¸€ä¸ªè¡¨è¾¾å¼å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">X</span>: <span class="keyword">public</span> Input&#123;&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Y</span>: <span class="keyword">public</span> Input&#123;&#125;;</span><br><span class="line"><span class="keyword">using</span> Result = Mult&lt;Add&lt;X, Y&gt;, Y&gt;;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œ<code>X</code>å’Œ<code>Y</code>ä¸å†æ˜¯è¿è¡Œæ—¶çš„å˜é‡ï¼Œè€Œæ˜¯ä¸€ä¸ªç±»å‹ï¼Œä¾¿äºæˆ‘ä»¬åç»­è¿›è¡Œæ¨å¯¼ã€‚</p></div><div class="story post-story"><h2 id="ä¸€ä¸ªåˆæ­¥çš„å®ç°">ä¸€ä¸ªåˆæ­¥çš„å®ç°</h2><h3 id="åŸºç¡€è¡¨è¾¾å¼çš„è®¾è®¡">åŸºç¡€è¡¨è¾¾å¼çš„è®¾è®¡</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span>... E&gt; <span class="keyword">struct</span> <span class="title class_">Expr</span> &#123;</span><br><span class="line">  <span class="comment">// è®°å½•è¯¥å‡½æ•°è¾“å…¥è¡¨è¾¾å¼ï¼ŒAdd&lt;L, R&gt;::InputExpr =&gt; List&lt;L, R&gt;</span></span><br><span class="line">  <span class="keyword">using</span> InputExpr = List&lt;E...&gt;;</span><br><span class="line">  <span class="comment">// è®°å½•è¯¥è¡¨è¾¾å¼çš„æ‰€æœ‰è¾“å…¥ä¾‹å¦‚ Add&lt;X, Ones&lt;float&gt;&gt;::InputNodes == List&lt;X&gt;;</span></span><br><span class="line">  <span class="keyword">using</span> InputNodes = Unique_t&lt;Reduce_t&lt;Concat, List&lt;List&lt;&gt;, <span class="keyword">typename</span> E::InputNodes...&gt;&gt;&gt;;</span><br><span class="line">  <span class="comment">// è¡¨ç¤ºçœŸå®è®¡ç®—æ—¶çš„æ•°æ®ç±»å‹</span></span><br><span class="line">  <span class="keyword">using</span> type = T;</span><br><span class="line">  <span class="comment">// è¡¨ç¤ºæ‰€æœ‰å…¶ä¾èµ–çš„å­è¡¨è¾¾å¼</span></span><br><span class="line">  <span class="keyword">using</span> SubNodes = Unique_t&lt;Reduce_t&lt;Concat, List&lt;List&lt;E...&gt;, <span class="keyword">typename</span> E::SubNodes...&gt;&gt;&gt;;</span><br><span class="line">  <span class="comment">// æ˜¯å¦æ˜¯å¸¸æ•°</span></span><br><span class="line">  <span class="type">static</span> <span class="keyword">constexpr</span> <span class="type">bool</span> is_constant = <span class="literal">false</span>;</span><br><span class="line">  <span class="comment">// æ˜¯å¦æ˜¯è¾“å…¥èŠ‚ç‚¹ï¼ˆè‡ªå˜é‡ï¼‰</span></span><br><span class="line">  <span class="type">static</span> <span class="keyword">constexpr</span> <span class="type">bool</span> is_input = <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é“¾å¼æ³•åˆ™ï¼Œæ±‚å‡º Fï¼ŒF çš„è¾“å…¥ä¸º Iï¼ˆä¸€ä¸ªè¡¨è¾¾å¼è¡¨ï¼‰ï¼Œå…³äº Xï¼Œ æ–¹å‘ä¸º D çš„å¯¼æ•°</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> F, <span class="keyword">typename</span> I, <span class="keyword">typename</span> X, <span class="keyword">typename</span> D&gt; <span class="keyword">struct</span> <span class="title class_">Chain</span>;</span><br><span class="line"><span class="comment">// æ–¹å‘å¯¼æ•°ï¼Œå¯¹äºYï¼Œæ±‚å…³äºXï¼Œæ–¹å‘ä¸º D çš„å¯¼æ•°</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Y, <span class="keyword">typename</span> X, <span class="keyword">typename</span> D&gt; <span class="keyword">struct</span> <span class="title class_">DirectionalDiff</span> &#123;</span><br><span class="line">  <span class="comment">// æ ¹æ®å¤šå…ƒå‡½æ•°é“¾å¼æ³•åˆ™ï¼Œå°±æ˜¯å¯¹äºå„ä¸ªè¾“å…¥èŠ‚ç‚¹çš„å¯¼æ•°ã€‚</span></span><br><span class="line">  <span class="keyword">using</span> type = <span class="keyword">typename</span> Chain&lt;Y, <span class="keyword">typename</span> Y::InputExpr, X, D&gt;::type;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// å¦‚æœæ˜¯ç©ºåˆ—è¡¨ï¼Œé‚£ä¹ˆè¿”å›0</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> F, <span class="keyword">typename</span> X, <span class="keyword">typename</span> D&gt; <span class="keyword">struct</span> <span class="title class_">Chain</span>&lt;F, List&lt;&gt;, X, D&gt; &#123;</span><br><span class="line">  <span class="keyword">using</span> type = Zeros&lt;<span class="keyword">typename</span> F::type&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// å¦‚æœè¾“å…¥åªæœ‰ä¸€ä¸ªï¼Œå³fæ˜¯ä¸€ä¸ªä¸€å…ƒå‡½æ•°ï¼ˆä¸ä¸€å®šæ˜¯æ ‡é‡ï¼‰ï¼Œç›´æ¥ç”¨ä¸€å…ƒå‡½æ•°é“¾å¼æ³•åˆ™ã€‚</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> F, <span class="keyword">typename</span> I, <span class="keyword">typename</span> X, <span class="keyword">typename</span> D&gt; <span class="keyword">struct</span> <span class="title class_">Chain</span>&lt;F, List&lt;I&gt;, X, D&gt; &#123;</span><br><span class="line">  <span class="comment">// å…ˆå¾—åˆ° dIï¼Œå³Iå¯¹Xæ–¹å‘ä¸ºDçš„å¯¼æ•°è¡¨è¾¾å¼ã€‚</span></span><br><span class="line">  <span class="keyword">using</span> ix = <span class="keyword">typename</span> DirectionalDiff&lt;I, X, D&gt;::type;</span><br><span class="line">  <span class="comment">// ç„¶åç®— dF Grad_tæè¿°äº†è¡¨è¾¾å¼ Fï¼Œå¯¹äºè¾“å…¥Iï¼Œå·²çŸ¥Iå¯¹Xçš„Dæ–¹å‘å¯¼æ•°ä¸ºixæƒ…å†µä¸‹çš„æ–¹å‘å¯¼æ•°ã€‚</span></span><br><span class="line">  <span class="keyword">using</span> type = <span class="keyword">typename</span> F::<span class="keyword">template</span> Grad_t&lt;I, ix&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// å¦‚æœè¾“å…¥æœ‰å¤šä¸ªï¼Œé‚£ä¹ˆå…ˆå–å‡ºç¬¬ä¸€ä¸ªè¾“å…¥ï¼Œåº”ç”¨é“¾å¼æ³•åˆ™å¾—åˆ° fhxï¼Œç„¶åå¯¹å‰©ä¸‹è¾“å…¥è¿›è¡Œé€’å½’ï¼Œå¾—åˆ°å‰©ä¸‹çš„éƒ¨åˆ†å¯¼æ•°è¡¨è¾¾å¼ï¼ŒåŠ èµ·æ¥å¾—åˆ°æœ€ç»ˆç»“æœã€‚</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> F, <span class="keyword">typename</span> X, <span class="keyword">typename</span> D, <span class="keyword">typename</span> IH, <span class="keyword">typename</span>... IT&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Chain</span>&lt;F, List&lt;IH, IT...&gt;, X, D&gt; &#123;</span><br><span class="line">  <span class="keyword">using</span> hx = <span class="keyword">typename</span> DirectionalDiff&lt;IH, X, D&gt;::type;</span><br><span class="line">  <span class="keyword">using</span> fhx = <span class="keyword">typename</span> F::<span class="keyword">template</span> Grad_t&lt;IH, dual_hx&gt;;</span><br><span class="line">  <span class="keyword">using</span> type = Add&lt;fhx, <span class="keyword">typename</span> Chain&lt;F, List&lt;IT...&gt;, X, D&gt;::type&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// é€’å½’ç»ˆç‚¹ï¼šå¦‚æœæ˜¯ X å¯¹ X æ±‚æ–¹å‘Dçš„å¯¼æ•°ï¼Œé‚£ä¹ˆç»“æœå°±æ˜¯D</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> X, <span class="keyword">typename</span> D&gt; <span class="keyword">struct</span> <span class="title class_">DirectionalDiff</span>&lt;X, X, D&gt; &#123;</span><br><span class="line">  <span class="keyword">using</span> type = D;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä»¥åŠ æ³•ä¸ºä¾‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Add Operation, L::type should equals to R::type</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> L, <span class="keyword">typename</span> R&gt; <span class="keyword">struct</span> <span class="title class_">Add</span> : <span class="keyword">public</span> Expr&lt;<span class="keyword">typename</span> L::type, L, R&gt; &#123;</span><br><span class="line">  <span class="built_in">static_assert</span>(std::is_same_v&lt;<span class="keyword">typename</span> L::type, <span class="keyword">typename</span> R::type&gt;,</span><br><span class="line">                <span class="string">&quot;L::type should be same as R::type.&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Li, <span class="keyword">typename</span> Ri&gt;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">decltype</span>(<span class="keyword">auto</span>) <span class="title">operator</span><span class="params">()</span><span class="params">(Li&amp;&amp; l, Ri&amp;&amp; r)</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> l + r;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> X, <span class="keyword">typename</span> G&gt; <span class="keyword">using</span> Grad_t = G;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>Addå¯¹åº”çš„æ•°å­¦å‡½æ•°æ˜¯ï¼š<span class="math inline">\(f(x_1, x_2) = x_1 +x_2\)</span>ï¼Œæ³¨æ„åˆ°ï¼Œ<code>Grad_t</code>æ˜¯ä¸€ä¸ªæ¨¡ç‰ˆï¼Œç¬¬ä¸€ä¸ªå‚æ•°<code>X</code>ç”¨äºè¡¨æ˜æ˜¯å¯¹å“ªä¸€ä¸ªä½ç½®æ±‚åå¯¼ï¼Œç¬¬äºŒä¸ªå‚æ•°<code>G</code>è¡¨ç¤ºçš„æ˜¯Dualè®¡ç®—æ˜¯çš„<spanclass="math inline">\(e\)</span>é¡¹çš„ç³»æ•°ï¼Œä¾‹å¦‚ï¼š</p><p><span class="math display">\[f(F(x), y) \implies f+\delta f=f(F(x)+Ae, y) = (F(x)+y) + e \cdot 1\]</span></p><p>å¯¹åº”äº†</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Add&lt;F, Y&gt;::Grad_t&lt;F, A&gt; =&gt; A</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <code>A</code> å­˜å‚¨äº†è®¡ç®—åˆ° <code>F</code> å¯¹äº <code>X</code>çš„æŸä¸€æ–¹å‘å¯¼æ•°ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> L, <span class="keyword">typename</span> R&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Mul</span>&lt;L, R&gt; : <span class="keyword">public</span> Expr&lt;<span class="keyword">typename</span> L::type, L, R&gt; &#123;</span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Li, <span class="keyword">typename</span> Ri&gt;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">decltype</span>(<span class="keyword">auto</span>) <span class="title">operator</span><span class="params">()</span><span class="params">(Li&amp;&amp; l, Ri&amp;&amp; r)</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> l * r;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> X, <span class="keyword">typename</span> G&gt; <span class="keyword">using</span> Grad_t</span><br><span class="line">      = std::<span class="type">conditional_t</span>&lt;std::is_same_v&lt;X, R&gt;, Mul&lt;L, G&gt;, Mul&lt;G, R&gt;&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¯¹äºä¹˜æ³•ï¼Œè‹¥æ˜¯å…³äº<spanclass="math inline">\(x_1\)</span>çš„æ–¹å‘å¯¼æ•°ï¼š</p><p><span class="math display">\[f(x_1, x_2) = x_1 x_2\implies f(x_1 + e, x_2) = f+ \delta f = x_1x_2 x_2e\]</span></p><p>å¯¹ <span class="math inline">\(x_2\)</span> äº¦ç„¶ã€‚</p><p>è‡³æ­¤æˆ‘ä»¬å·²ç»èƒ½å¤Ÿå¾—åˆ°ä¸€äº›åˆæ­¥çš„ç»“æœï¼š</p><p>æœªå®Œå¾…ç»­â€¦â€¦</p></div>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœ¬æ¥æ˜¯æƒ³å‘åœ¨çŸ¥ä¹çš„ï¼Œä½†æƒ³äº†æƒ³è¿˜æ˜¯å…ˆé¦–å‘åœ¨è‡ªå·±çš„blogä¸Šã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Programming" scheme="http://adversarr.github.io/categories/Programming/"/>
    
    
    <category term="C/C++" scheme="http://adversarr.github.io/tags/C-C/"/>
    
    <category term="Programming" scheme="http://adversarr.github.io/tags/Programming/"/>
    
  </entry>
  
  <entry>
    <title>Sig16-Course-The Material Point Method for Simulating Continuum Materials</title>
    <link href="http://adversarr.github.io/2022/10/04/CG/siggraph-courses/siggraph2016-mpm/"/>
    <id>http://adversarr.github.io/2022/10/04/CG/siggraph-courses/siggraph2016-mpm/</id>
    <published>2022-10-03T16:00:00.000Z</published>
    <updated>2022-10-04T05:34:47.574Z</updated>
    
    <content type="html"><![CDATA[<p>orz</p><span id="more"></span><h2id="the-material-point-method-for-simulating-continuum-materials">TheMaterial Point Method for Simulating Continuum Materials</h2><p>Siggraph 2016 Course, by Chenfanfu Jiang.</p><h3 id="introduction">Introduction</h3>]]></content>
    
    
    <summary type="html">&lt;p&gt;orz&lt;/p&gt;</summary>
    
    
    
    <category term="Computer Graphics" scheme="http://adversarr.github.io/categories/Computer-Graphics/"/>
    
    
    <category term="SIGGRAPH Course" scheme="http://adversarr.github.io/tags/SIGGRAPH-Course/"/>
    
    <category term="MPM" scheme="http://adversarr.github.io/tags/MPM/"/>
    
  </entry>
  
  <entry>
    <title>æ•°å€¼åˆ†æ-å¼•è¨€</title>
    <link href="http://adversarr.github.io/2022/09/30/study/Math/NumericRecipies/Chapter-1-Introduction/"/>
    <id>http://adversarr.github.io/2022/09/30/study/Math/NumericRecipies/Chapter-1-Introduction/</id>
    <published>2022-09-30T01:16:33.354Z</published>
    <updated>2022-09-30T01:43:27.206Z</updated>
    
    <content type="html"><![CDATA[<p>æ•°å€¼åˆ†æ ch 1 - å¼•è¨€</p><span id="more"></span><h1 id="chapter-1-introduction">Chapter-1-Introduction</h1><ol type="1"><li><p>ç»ªè®º</p></li><li><p>éçº¿æ€§æ–¹ç¨‹æ±‚æ ¹</p></li><li><p>çº¿æ€§æ–¹ç¨‹ç»„çš„æ•°å€¼è§£</p></li><li><p>æ’å€¼å’Œé€¼è¿‘</p></li><li><p>æ•°å€¼ç§¯åˆ†å’Œæ•°å€¼å¾®åˆ†</p></li><li><p>å¸¸å¾®åˆ†æ–¹ç¨‹çš„æ•°å€¼è§£</p></li><li><p>åå¾®åˆ†æ–¹ç¨‹çš„æ•°å€¼è§£</p></li></ol><h1 id="ç»ªè®º">ç»ªè®º</h1><p>ä¸»è¦å†…å®¹ï¼š</p><ol type="1"><li><p><strong>ç§‘å­¦è®¡ç®—çš„å†…å®¹</strong>ï¼šç§‘å­¦æ¨¡æ‹Ÿçš„è¿‡ç¨‹ã€ä¸€èˆ¬ç­–ç•¥</p></li><li><p><strong>è¯¯å·®çš„æ¦‚å¿µ</strong>ï¼šç»å¯¹è¯¯å·®ã€ç›¸å¯¹è¯¯å·®ã€å‘å‰/å‘åè¯¯å·®ã€æœ‰æ•ˆæ•°å­—åŠå®ƒä»¬ä¹‹é—´çš„å…³ç³»</p></li><li><p><strong>æ•°æ®è¯¯å·®å¯¹å‡½æ•°å€¼çš„å½±å“</strong>ï¼šè®¨è®ºå‡½æ•°çš„è¯¯å·®ä¸è‡ªå˜é‡è¯¯å·®ä¹‹é—´çš„å…³ç³»</p></li><li><p><strong>ç®—æ³•çš„æ•°å€¼ç¨³å®šæ€§</strong>ï¼šè®¨è®ºåˆå§‹æ•°æ®çš„è¯¯å·®å¯¹è®¡ç®—ç»“æœçš„å½±å“</p></li><li><p><strong>å®é™…è®¡ç®—ä¸­åº”è¯¥æ³¨æ„çš„é—®é¢˜</strong></p></li></ol><div class="story post-story"><h2 id="ç§‘å­¦è®¡ç®—">ç§‘å­¦è®¡ç®—</h2><h3 id="è®¡ç®—æ¨¡æ‹Ÿè§£å†³é—®é¢˜çš„è¿‡ç¨‹">è®¡ç®—æ¨¡æ‹Ÿè§£å†³é—®é¢˜çš„è¿‡ç¨‹</h3><ol type="1"><li><p>å»ºç«‹æ•°å­¦æ¨¡å‹</p></li><li><p>ç»™å‡ºæ•°å€¼ç®—æ³•</p></li><li><p>è®¡ç®—æœºè½¯ä»¶å®ç°ç®—æ³•</p></li><li><p>è¿è¡Œã€è¿›è¡Œæ•°å€¼æ¨¡æ‹Ÿ</p></li><li><p>è¡¨ç¤ºè®¡ç®—ç»“æœ</p></li><li><p>è§£é‡Šè®¡ç®—ç»“æœ</p></li></ol><h3 id="ä¸€èˆ¬ç­–ç•¥">ä¸€èˆ¬ç­–ç•¥</h3><ol type="1"><li><p>æœ‰é™ç»´ç©ºé—´ä»£æ›¿æ— é™ç»´ç©ºé—´</p></li><li><p>ç”¨æœ‰é™è¿‡ç¨‹ä»£æ›¿æ— é™è¿‡ç¨‹</p></li><li><p>ç”¨çº¿æ€§æ–¹ç¨‹ä»£æ›¿å¾®åˆ†æ–¹ç¨‹</p></li><li><p>ç”¨ä½é˜¶æ–¹ç¨‹ç»„ä»£æ›¿é«˜é˜¶æ–¹ç¨‹ç»„</p></li><li><p>ç”¨ç®€å•å‡½æ•°ä»£æ›¿å¤æ‚å‡½æ•°</p></li><li><p>ç”¨ç®€å•ç»“æ„çŸ©é˜µä»£æ›¿ä¸€èˆ¬çŸ©é˜µ</p></li></ol></div><div class="story post-story"><h2 id="æœºå™¨æ•°ç³»">æœºå™¨æ•°ç³»</h2><ol type="1"><li>è®¡ç®—æœºä¸­çš„å®æ•°ï¼ˆæµ®ç‚¹æ•°ï¼‰<span class="math inline">\(x = \pm \beta^p\times (0.\alpha _ 1\alpha _ 2\cdots)\)</span></li><li>ç‰¹ç‚¹ï¼š<ol type="1"><li>æœ‰é™çš„ç¦»æ•£é›†</li><li>æœ‰æœ€å¤§ã€ï¼ˆéé›¶éè´Ÿï¼‰æœ€å°æ•°</li><li>æº¢å‡ºé”™è¯¯ï¼ˆ<span class="math inline">\(\infty\)</span> å’Œ <spanclass="math inline">\(0\)</span>ï¼‰</li></ol></li><li>è®¡ç®—æœºå¯¹äºæ•°çš„æ¥æ”¶</li></ol></div><div class="story post-story"><h2 id="è¯¯å·®çš„åŸºæœ¬æ¦‚å¿µ">è¯¯å·®çš„åŸºæœ¬æ¦‚å¿µ</h2><h3 id="è¯¯å·®çš„æ¥æº">è¯¯å·®çš„æ¥æº</h3><ol type="1"><li><p><strong>æ¨¡å‹è¯¯å·®</strong>ï¼šå¯¹å®é™…æƒ…å†µçš„ç®€åŒ–å’Œè¿‘ä¼¼</p></li><li><p><strong>è§‚æµ‹è¯¯å·®</strong>ï¼šæµ‹é‡è¯¯å·®ç­‰ç­‰</p></li><li><p><strong>æˆªæ–­è¯¯å·®</strong>ï¼šè®¡ç®—ä¸­çš„æ— é™è¿‡ç¨‹ï¼Œä½¿ç”¨äº†æœ‰é™çš„è¿‘ä¼¼ï¼Œä¾‹å¦‚çº§æ•°æ±‚å’Œ</p></li><li><p><strong>èˆå…¥è¯¯å·®</strong>ï¼šå››èˆäº”å…¥</p></li></ol><p>ä¾‹1ï¼š<span class="math inline">\(A=4\pi r^2\)</span>ä¸­ï¼ŒåŒ…å«äº†å„ç§è¯¯å·®</p><p>ä¾‹2ï¼šTaylor å±•å¼€ï¼š<span class="math inline">\(e^{-x} = 1-x+\frac 12{x^2} -\frac{1}{6}x^3+E_r(x)\)</span> ï¼Œå…¶ä¸­ç•¥å» <spanclass="math inline">\(E_r\)</span> é¡¹ï¼Œäº§ç”Ÿäº†æˆªæ–­è¯¯å·®</p><h3 id="ç»å¯¹è¯¯å·®">ç»å¯¹è¯¯å·®</h3><ul><li><strong>ç»å¯¹è¯¯å·®</strong>ï¼šè®¾<spanclass="math inline">\(x^*\)</span>æ˜¯å‡†ç¡®å€¼ï¼Œ<spanclass="math inline">\(x\)</span>æ˜¯è¿‘ä¼¼å€¼ï¼Œåˆ™ï¼š</li></ul><p><span class="math display">\[e(x)=x^*-x\]</span></p><p>ä¸ºè¿‘ä¼¼å€¼<spanclass="math inline">\(x\)</span>çš„<strong>ç»å¯¹è¯¯å·®</strong>ï¼Œç®€ç§°<strong>è¯¯å·®</strong>ã€‚åœ¨å®é™…è®¡ç®—ä¸­ï¼Œç»å¯¹è¯¯å·®æ— æ³•æ±‚å‡ºï¼Œä½†åªéœ€è¦çŸ¥é“è¯¯å·®çš„ä¸€ä¸ªèŒƒå›´ï¼Œä»è€Œæœ‰<strong>ç»å¯¹è¯¯å·®é™</strong><span class="math inline">\(\varepsilon\)</span>ï¼š</p><p><span class="math display">\[|e(x)|\le \varepsilon\]</span></p><h3 id="ç›¸å¯¹è¯¯å·®">ç›¸å¯¹è¯¯å·®</h3><p><span class="math display">\[e_r(x)=\frac{x^*-x}{x^*}\]</span></p><p>è‹¥ <span class="math inline">\(x^*\)</span> æ— æ³•ç¡®å®šï¼Œä¹Ÿç”¨ï¼š</p><p><span class="math display">\[e_r(x)=\frac{x^*-x}{x}\]</span></p><p>ç›¸åº”çš„ï¼Œæœ‰ç›¸å¯¹è¯¯å·®é™ï¼š</p><p><span class="math display">\[|e_r(x)|\le \varepsilon\]</span></p><h3 id="æœ‰æ•ˆæ•°">æœ‰æ•ˆæ•°</h3><p>è‹¥ <span class="math inline">\(x\)</span> ä¸º <spanclass="math inline">\(x^*\)</span> çš„è¿‘ä¼¼å€¼ï¼Œè‹¥ <spanclass="math inline">\(|e(x)|\)</span>æ˜¯å…¶æŸä¸ªæ•°ä½çš„åŠä¸ªå•ä½ï¼Œä»å·¦èµ·ç¬¬ä¸€ä¸ªéé›¶æ•°åˆ°è¿™ä¸€ä½æœ‰ n ä½ï¼Œåˆ™ç§° nä¸ªæ•°å­—ä¸ºå…¶æœ‰æ•ˆæ•°å­—ã€‚</p><p>åœ¨å®é™…æƒ…å†µä¸­ï¼šn ä½æœ‰æ•ˆæ•°å­—é€šå¸¸è¡¨ç¤ºä¸ºï¼š</p><p><span class="math display">\[x = \pm 0.\alpha_1\alpha_2\alpha_3....\times10^{m}\]</span></p><p>åˆ™å…¶è¯¯å·®ï¼ˆçš„ç»å¯¹å€¼ï¼‰ä¸ºï¼š<spanclass="math inline">\(|e(x)|\le\displaystyle \frac 1 2 \times10^{m-n}\)</span>ï¼Œè¯¯å·®é™ä¸ºï¼š</p><p><span class="math display">\[\varepsilon = \frac 1 2 \times 10^{m-n}\]</span></p><p>ä¾‹å¦‚ï¼š<span class="math inline">\(\pi=3.14159.....\)</span>ï¼Œ3.14æœ‰3ä½æœ‰æ•ˆæ•°å­—ï¼Œ3.1416æœ‰5ä½æœ‰æ•ˆæ•°å­—ï¼Œ3.1415åªæœ‰4ä½æœ‰æ•ˆæ•°å­—ã€‚</p><blockquote><p>å¯¹åº”ä½œä¸šéƒ¨åˆ†ï¼š<ahref="https://www.wolai.com/vSwxZPkgTHNmW7WT1uygWa">Week1</a></p></blockquote><h3 id="æ•°æ®è¯¯å·®å’Œè®¡ç®—è¯¯å·®">æ•°æ®è¯¯å·®å’Œè®¡ç®—è¯¯å·®</h3><p>â†’ <span class="math inline">\(x\)</span>è¡¨ç¤ºè¾“å…¥çš„çœŸå€¼ï¼Œ<spanclass="math inline">\(f(x)\)</span>ä¸ºæ‰€æ±‚çš„çœŸå®ç»“æœï¼Œå‡è®¾æ‰€ç”¨çš„è¾“å…¥å€¼ä¸æ˜¯ç²¾ç¡®å€¼ï¼Œå³ä¸º<spanclass="math inline">\(\hat x\)</span>ï¼Œå¾—åˆ°çš„è¿‘ä¼¼å€¼ä¸º<spanclass="math inline">\(\hat f\)</span>åˆ™ï¼š</p><p><span class="math display">\[æ€»è¯¯å·®=(\hat f(\hat x) -f(\hat x)) + (f(\hatx)-f(x))=è®¡ç®—è¯¯å·®+æ•°æ®ä¼ æ’­è¯¯å·®\]</span></p><p>ä¾‹å¦‚ï¼š</p><ul><li><span class="math inline">\(\sin x\approx x-\frac 1{3!}x^3\Rightarrow f\approx \hat x\)</span>l</li></ul><h3 id="å‘å‰è¯¯å·®å’Œå‘åè¯¯å·®">å‘å‰è¯¯å·®å’Œå‘åè¯¯å·®</h3><p><span class="math inline">\(x,f\)</span>è¡¨ç¤ºè¾“å…¥å€¼å’Œå‡½æ•°ï¼Œ<spanclass="math inline">\(\hat f\)</span>è¡¨ç¤ºå®é™…è®¡ç®—çš„å‡½æ•°ï¼Œ<spanclass="math inline">\(x\)</span>è¡¨ç¤ºèƒ½ç²¾ç¡®åœ°å¾—å‡ºè®¡ç®—å€¼çš„è¾“å…¥ï¼Œåˆ™ï¼š<spanclass="math inline">\(\hat f(x)=f(\hat x)\)</span></p><p>åˆ™ï¼š</p><ul><li><p>ç»å¯¹å‘å‰è¯¯å·®ï¼š<span class="math inline">\(|\hatf(x)-f(x)|\)</span></p></li><li><p>ç»å¯¹å‘åè¯¯å·®ï¼š<span class="math inline">\(|\hatx-x|\)</span></p></li></ul><p>æ¡ä»¶æ•°ï¼š<span class="math inline">\(\displaystyle\frac {|(f(\hat x) -f(x))/f(x)|} { |(\hat x-x)/x|}\)</span>â†’ ç›¸å¯¹è¯¯å·®çš„æ”¾å¤§å€æ•°</p></div><div class="story post-story"><h2 id="æ•°æ®è¯¯å·®å¯¹å‡½æ•°å€¼çš„å½±å“">æ•°æ®è¯¯å·®å¯¹å‡½æ•°å€¼çš„å½±å“</h2><p>å¯¹äºå•å˜é‡å‡½æ•°è€Œè¨€ï¼š</p><p><span class="math display">\[y=f(x)\rightarrow e(y)=y^*-y=f(x^*)-f(x)\]</span></p><p>è‹¥ä½¿ç”¨Taylorå±•å¼€<span class="math inline">\(e(y)\approxf&#39;(x)(x^*-x)=f&#39;(x)e(x),\quade_r(y)=\frac{xf&#39;(x)}{f(x)}e_r(x)\)</span></p><p>å¯¹äºå¤šå˜é‡å‡½æ•°è€Œè¨€ï¼š</p><p><span class="math display">\[\begin{aligned}e(y)&amp;=f(x_1^*,x_2^*)-f(x_1,x_2)\\&amp;\approx \frac{\partial f(x_1,x_2)}{\partialx_1}e(x_1)+\frac{\partial f(x_1,x_2)}{\partial x_2}e(x_2)\\e_r(y)&amp;=e(y)/y\\&amp;\approx\frac{\partial f(x_1,x_2)}{\partialx_1}\frac{x_1}{f(x_1,x_2)}e_r(x_1)+\frac{\partial f(x_1,x_2)}{\partialx_2}\frac{x_2}{f(x_1,x_2)}e(x_2)\end{aligned}\]</span></p><p>å’Œå·®ç§¯å•†çš„è¯¯å·®è®¡ç®—æ–¹æ³•ï¼š</p><ol type="1"><li><p><span class="math inline">\(e(x_1\pm x_2)=e(x_1)\pme(x_2)\)</span></p></li><li><p><span class="math inline">\(e(x_1x_2)=x_2e(x_1)+x_1e(x_2)\)</span></p></li><li><p><span class="math inline">\(e(x_1/x_2)\approx\displaystyle\frac{1}{x_2}e(x_1)-\frac{x_1}{x_2^2}e(x_2)\)</span></p></li></ol></div><div class="story post-story"><h2 id="ç®—æ³•çš„æ•°å€¼ç¨³å®šæ€§">ç®—æ³•çš„æ•°å€¼ç¨³å®šæ€§</h2><h3 id="æ•°å€¼ç¨³å®šæ€§">æ•°å€¼ç¨³å®šæ€§</h3><blockquote><p>å¯¹äºæŸä¸€ç§ç®—æ³•ï¼Œå¦‚æœåˆå§‹æ•°æ®æœ‰å¾ˆå°çš„è¯¯å·®ï¼Œä»…ä»…ä½¿ç»“æœäº§ç”Ÿå¾ˆå°çš„è¯¯å·®ï¼Œåˆ™ç§°è¿™ä¸ªç®—æ³•æ—¶ï¼ˆæ•°å€¼ï¼‰ç¨³å®šçš„ï¼Œå¦åˆ™ç§°ä¸ºï¼ˆæ•°å€¼ï¼‰ä¸ç¨³å®šçš„ã€‚</p></blockquote><p>ä¾‹å¦‚ï¼š<span class="math inline">\(I_n=\int_0^1\frac {x^n}{x+5}\mathrmdx\)</span></p><ul><li><p><span class="math inline">\(I_n=\frac 1 n -5I_{n-1}\)</span>â†’<span class="math inline">\(|e_n|=5^n|e_0|\)</span>ï¼ˆè¯¯å·®ä¼ æ’­ï¼‰â†’ä¸ç¨³å®š</p></li><li><p><span class="math inline">\(I_{n-1}=\frac 1 5(1/n -I_n)\)</span>åˆ©ç”¨ <span class="math inline">\(I_{10}\)</span>æ¨ç®—</p></li></ul><h3 id="ç—…æ€é—®é¢˜ill-posed">ç—…æ€é—®é¢˜ï¼ˆill-posedï¼‰</h3><blockquote><p>å¤šé¡¹å¼æ±‚æ ¹æ—¶ä¸€ä¸ªç—…æ€é—®é¢˜ï¼</p></blockquote></div><div class="story post-story"><h2 id="å®é™…é—®é¢˜ä¸­åº”è¯¥æ³¨æ„çš„é—®é¢˜">å®é™…é—®é¢˜ä¸­åº”è¯¥æ³¨æ„çš„é—®é¢˜</h2><ol type="1"><li><p>é¿å…é™¤æ•°è¿œå°äºè¢«é™¤æ•°</p></li><li><p>é¿å…ä¸¤ä¸ªç›¸è¿‘çš„æ•°è¯¦è§</p></li><li><p>é˜²æ­¢å¤§æ•°â€œåƒâ€å°æ•°</p></li><li><p>ç®€åŒ–è®¡ç®—æ¬¡æ•°ï¼Œå‡å°‘è®¡ç®—æ¬¡æ•°ï¼šä¾‹å¦‚ï¼šå¿«é€Ÿå¹‚ç®—æ³•ï¼Œå¤šé¡¹å¼è®¡ç®—çš„ç§¦ä¹éŸ¶ç®—æ³•</p></li></ol></div>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ•°å€¼åˆ†æ ch 1 - å¼•è¨€&lt;/p&gt;</summary>
    
    
    
    <category term="æ•°å­¦" scheme="http://adversarr.github.io/categories/%E6%95%B0%E5%AD%A6/"/>
    
    
    <category term="æ•°å€¼åˆ†æ" scheme="http://adversarr.github.io/tags/%E6%95%B0%E5%80%BC%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>æ•°å€¼åˆ†æ-éçº¿æ€§æ–¹ç¨‹æ±‚è§£</title>
    <link href="http://adversarr.github.io/2022/09/30/study/Math/NumericRecipies/Chapter%202%20%E9%9D%9E%E7%BA%BF%E6%80%A7%E6%96%B9%E7%A8%8B%E7%BB%84%E7%9A%84%E6%B1%82%E8%A7%A3/"/>
    <id>http://adversarr.github.io/2022/09/30/study/Math/NumericRecipies/Chapter%202%20%E9%9D%9E%E7%BA%BF%E6%80%A7%E6%96%B9%E7%A8%8B%E7%BB%84%E7%9A%84%E6%B1%82%E8%A7%A3/</id>
    <published>2022-09-30T01:16:33.353Z</published>
    <updated>2022-09-30T01:16:33.353Z</updated>
    
    <content type="html"><![CDATA[<p>æ•°å€¼åˆ†æ ch 2 - éçº¿æ€§æ–¹ç¨‹æ±‚è§£</p><span id="more"></span><h1 id="chapter-2-éçº¿æ€§æ–¹ç¨‹çš„æ±‚è§£">Chapter 2 éçº¿æ€§æ–¹ç¨‹çš„æ±‚è§£</h1><ol type="1"><li><p>ä¸€ä¸ªè‡ªå˜é‡çš„éçº¿æ€§æ–¹ç¨‹ï¼š <span class="math inline">\(f(x)=0,\quadx\in R&#39;\)</span></p></li><li><p>[NO] å¤šä¸ªè‡ªå˜é‡çš„éçº¿æ€§æ–¹ç¨‹ç»„ï¼š <span class="math inline">\(\vecF (\vec x) =\vec 0,\quad \vec x\in R^n,\vec F(\vec x)\inR^m\)</span></p></li></ol><hr /><p>Contentï¼š</p><ol type="1"><li><p>äºŒåˆ†æ³•</p></li><li><p>ç®€å•è¿­ä»£æ³•</p></li><li><p>Newtonè¿­ä»£æ³•</p></li></ol><p>Ideaï¼š</p><p><span class="math display">\[çº¿æ€§ï¼šf(x)=0\iff x=\varphi(x)\rightarrow x_{n+1}=\varphi(x_n)\\éçº¿æ€§ï¼šx=\psi (x)\Rightarrow x_{n+1}:=\psi(x_n),x_n\rightarrow x^*\]</span></p><p>é‡æ•°ï¼š<span class="math inline">\(f(x) =(x-x^*)^mg(x),g(x^*)\ne0\)</span> åˆ™mç§°ä¸ºé‡æ•°</p><p>ä¸€èˆ¬åˆ†ä¸ºå¦‚ä¸‹2æ­¥ï¼š</p><ol type="1"><li>æœç´¢æ ¹ï¼Œåˆ†ææ–¹ç¨‹å­˜åœ¨å¤šå°‘ä¸ªå®æ ¹ï¼Œæ¯ä¸ªæ ¹å­˜åœ¨çš„åŒºé—´</li></ol><p>å›¾è§£æ³•ã€è¿‘ä¼¼æ–¹ç¨‹æ³•ã€è§£ææ³•ã€å®šæ­¥é•¿æœç´¢æ³•</p><ol start="2" type="1"><li>ç²¾ç¡®åŒ–ï¼šæ±‚æ»¡è¶³ç»™å®šç²¾åº¦çš„æ ¹çš„è¿‘ä¼¼å€¼</li></ol><p>ä»2é¡¹è¿­ä»£å¯¼è‡´çš„2é˜¶æ–¹æ³•ã€‚</p><div class="story post-story"><h2 id="äºŒåˆ†æ³•">äºŒåˆ†æ³•</h2></div><div class="story post-story"><h2 id="ç®€å•è¿­ä»£æ³•">ç®€å•è¿­ä»£æ³•</h2><ol type="1"><li><p>å±€éƒ¨æ”¶æ•›ï¼ˆ<spanclass="math inline">\(x_0\)</span>ä¸ç²¾ç¡®è§£é è¿‘ï¼‰</p></li><li><p>å…¨å±€æ”¶æ•›ï¼ˆ<spanclass="math inline">\(x_0\)</span>æœªå¿…ä¸ç²¾ç¡®è§£é è¿‘ï¼‰</p></li></ol><h3 id="è¿­ä»£æ ¼å¼çš„æ„é€ ">è¿­ä»£æ ¼å¼çš„æ„é€ </h3><p>é€šè¿‡æ–¹ç¨‹ <span class="math inline">\(f(x)=0\)</span> å¾—åˆ°çš„ç­‰ä»·å½¢å¼ï¼š<span class="math inline">\(x=\varphi(x)\)</span>ï¼Œå¾—åˆ°é€’æ¨å…¬å¼ã€‚</p><p>è‹¥æ ¹æ® <span class="math inline">\(x=\varphi(x)\)</span>å¾—åˆ°çš„åºåˆ—æ”¶æ•›ï¼Œ <spanclass="math inline">\(\lim_{k\rightarrow\infty}x_k=x^*\)</span>ã€‚ï¼ˆå½“<spanclass="math inline">\(x^*=\varphi(x^*)\)</span>æ—¶ï¼Œç§°ä¸ºä¸åŠ¨ç‚¹ï¼Œä¸Šè¿°æ–¹æ³•ç§°ä¸ºä¸åŠ¨ç‚¹è¿­ä»£æ³•ï¼‰</p><p>åºåˆ—æ˜¯å¦æ”¶æ•›ï¼Œç”± <span class="math inline">\(\varphi\)</span>å’Œ <spanclass="math inline">\(x_0\)</span>ç¡®å®šã€‚</p><h3 id="è¿­ä»£çš„æ”¶æ•›æ€§">è¿­ä»£çš„æ”¶æ•›æ€§</h3><p><strong>Thm</strong>è‹¥ <spanclass="math inline">\(\varphi(x)\)</span>åœ¨ <spanclass="math inline">\((a,b)\)</span>å†…æœ‰ä¸€é˜¶è¿ç»­å¯¼æ•°ï¼Œä¸”æ»¡è¶³ï¼Œ</p><ol type="1"><li><p><span class="math inline">\(x\in [a,b]\)</span>æ—¶ï¼Œ <spanclass="math inline">\(\varphi(x)\in [a,b]\)</span></p></li><li><p>å­˜åœ¨æ­£å¸¸æ•° <span class="math inline">\(L&lt;1\)</span>ä½¿å¾—å½“<span class="math inline">\(x\in[a,b]\)</span>ï¼Œ <spanclass="math inline">\(|\varphi&#39;(x)|\le L &lt;1\)</span></p></li></ol><p>åˆ™ï¼š</p><ol type="1"><li><p><span class="math inline">\(x=\varphi(x)\)</span>åœ¨ <spanclass="math inline">\([a,b]\)</span>ä¸Šæœ‰å®æ ¹ <spanclass="math inline">\(x^*\)</span></p></li><li><p>å¯¹äºä»»æ„åˆå€¼ <span class="math inline">\(x_0\in[a,b]\)</span>ï¼Œè¿­ä»£æ”¶æ•›â†’<strong>å…¨å±€æ”¶æ•›</strong></p></li></ol><p>åŒæ—¶æ»¡è¶³ï¼š</p><p><span class="math inline">\(|x^*-x_k|\le \frac {L^k}{1-L}|x_1-x_0|\)</span></p><p><strong>Thm</strong> æ–¹ç¨‹åœ¨åŒºé—´ <spanclass="math inline">\([a,b]\)</span>ä¸Šæœ‰æ ¹ï¼Œä¸”å½“ <spanclass="math inline">\(x\in [a,b]\)</span>æ—¶ï¼Œ <spanclass="math inline">\(|\varphi&#39;(x)|\ge 1\)</span>åˆ™å¯¹äºä»»æ„ <spanclass="math inline">\(x_0\)</span>è¿­ä»£å‘æ•£ã€‚</p><p><strong>Def</strong>ï¼ˆ<strong>å±€éƒ¨æ”¶æ•›</strong>ï¼‰æ–¹ç¨‹ <spanclass="math inline">\(x=\varphi(x)\)</span>ï¼Œè‹¥åœ¨ <spanclass="math inline">\(x^*\)</span> çš„æŸä¸ªé‚»åŸŸå†…ï¼Œå¯¹äºä»»æ„åˆå€¼ <spanclass="math inline">\(x_0\in S\)</span>ï¼Œè¿­ä»£éƒ½æ”¶æ•›ï¼Œåˆ™ç§°è¿­ä»£æ³•åœ¨ <spanclass="math inline">\(x^*\)</span>é™„è¿‘å±€éƒ¨æ”¶æ•›ã€‚</p><p><strong>Thm</strong>ï¼šè‹¥æ–¹ç¨‹ <spanclass="math inline">\(x=\varphi(x)\)</span>æœ‰æ ¹ <spanclass="math inline">\(x^*\)</span>ï¼Œåœ¨æŸä¸ªé‚»åŸŸå†…ä¸€é˜¶è¿ç»­å¯å¯¼ï¼š</p><ol type="1"><li><p><span class="math inline">\(|\varphi&#39;(x^*)|&lt;1\)</span>â†’å±€éƒ¨æ”¶æ•›</p></li><li><p><spanclass="math inline">\(|\varphi&#39;(x)|&gt;1\)</span>â†’å‘æ•£</p></li></ol></div><div class="story post-story"><h2 id="newton-è¿­ä»£æ³•">Newton è¿­ä»£æ³•</h2><h3 id="è¿­ä»£æ ¼å¼">è¿­ä»£æ ¼å¼</h3><blockquote><p>åŸºäº <span class="math inline">\(f(x)=0\)</span> çš„è¿‘ä¼¼å½¢å¼</p></blockquote><p><span class="math display">\[x_{k+1}=x_k-\frac{f(x_k)}{f&#39;(x_k)}=\psi(x_k)\]</span></p><p>å¦‚æœéœ€è¦è®¡ç®—äºŒé‡æ ¹ï¼ŒNewtonè¿­ä»£æ³•å¸¸å¸¸ä¸èƒ½æ»¡è¶³</p><h3 id="newton-è¿­ä»£æ³•çš„æ”¶æ•›æ€§">Newton è¿­ä»£æ³•çš„æ”¶æ•›æ€§</h3><p><strong>Thm</strong> è®¾å‡½æ•° <spanclass="math inline">\(f\)</span>åœ¨åŒºé—´ <spanclass="math inline">\([a,b]\)</span>å†…äºŒé˜¶è¿ç»­å¯å¯¼ï¼Œä¸”ï¼š</p><ol type="1"><li><p><span class="math inline">\(f(a)f(b)&lt;0\)</span></p></li><li><p>å½“<span class="math inline">\(x\in[a,b]\)</span>æ—¶ï¼Œ <spanclass="math inline">\(f&#39;(x)\ne0\)</span></p></li><li><p>å½“<span class="math inline">\(x\in (a,b)\)</span>æ—¶ï¼Œ <spanclass="math inline">\(f&#39;&#39;(x)\)</span>ä¿å·</p></li><li><p><span class="math inline">\(a-\frac{f(a)}{f&#39;(a)}\leb,b-\frac{f(b)}{f&#39;(b)}\ge a\)</span></p></li></ol><p>åˆ™å…¶Newtonè¿­ä»£æ ¼å¼æ”¶æ•›åˆ° <spanclass="math inline">\([a,b]\)</span>å†…çš„å”¯ä¸€å®æ ¹ã€‚</p><h3 id="é‡æ ¹çš„å¤„ç†">é‡æ ¹çš„å¤„ç†</h3><p>è‹¥å…¶æ˜¯<span class="math inline">\(m\)</span>é‡æ ¹ï¼Œåˆ™ä¿®æ­£ä¸ºï¼š</p><p><span class="math display">\[x_{k+1}=x_k-m\frac{f(x_k)}{f&#39;(x_k)}\]</span></p><h3 id="newtonè¿­ä»£çš„å˜å½¢">Newtonè¿­ä»£çš„å˜å½¢</h3><ol type="1"><li>Newtonä¸‹å±±æ³•ï¼š</li></ol><p><spanclass="math inline">\(x_{k+1}=x_k-\lambda\frac{f(x_k)}{f&#39;(x_k)}\)</span></p><ol start="2" type="1"><li>å‰²çº¿æ³•ï¼š</li></ol><p><span class="math inline">\(x_{k+1} =x_k-\frac{f(x_k)}{f(x_k)-f(x_{k-1})}(x_k-x_{k-1})\)</span></p><p>......ch2: 5 6 11 12</p></div>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ•°å€¼åˆ†æ ch 2 - éçº¿æ€§æ–¹ç¨‹æ±‚è§£&lt;/p&gt;</summary>
    
    
    
    <category term="æ•°å­¦" scheme="http://adversarr.github.io/categories/%E6%95%B0%E5%AD%A6/"/>
    
    
    <category term="æ•°å€¼åˆ†æ" scheme="http://adversarr.github.io/tags/%E6%95%B0%E5%80%BC%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>æ•°å€¼åˆ†æ-çº¿æ€§æ–¹ç¨‹ç»„çš„æ•°å€¼è§£</title>
    <link href="http://adversarr.github.io/2022/09/30/study/Math/NumericRecipies/Chapter%203%20%E7%BA%BF%E6%80%A7%E6%96%B9%E7%A8%8B%E7%BB%84%E7%9A%84%E6%95%B0%E5%80%BC%E8%A7%A3/"/>
    <id>http://adversarr.github.io/2022/09/30/study/Math/NumericRecipies/Chapter%203%20%E7%BA%BF%E6%80%A7%E6%96%B9%E7%A8%8B%E7%BB%84%E7%9A%84%E6%95%B0%E5%80%BC%E8%A7%A3/</id>
    <published>2022-09-30T01:16:33.353Z</published>
    <updated>2022-09-30T01:16:33.353Z</updated>
    
    <content type="html"><![CDATA[<p>æ•°å€¼åˆ†æ ch 3 - çº¿æ€§æ–¹ç¨‹ç»„çš„æ•°å€¼è§£</p><span id="more"></span><h1 id="chapter-3-çº¿æ€§æ–¹ç¨‹ç»„çš„æ•°å€¼è§£">Chapter 3 çº¿æ€§æ–¹ç¨‹ç»„çš„æ•°å€¼è§£</h1><p>Contentï¼š</p><ol type="1"><li><p>Gauss æ¶ˆå»æ³•ï¼ŒGaussåˆ—ä¸»å…ƒæ¶ˆå»æ³•</p></li><li><p>å‘é‡å’ŒçŸ©é˜µçš„èŒƒæ•°ã€æ–¹ç¨‹ç»„æ€§æ€å’Œè¯¯å·®ä¼°è®¡</p></li><li><p>Jacobiè¿­ä»£ï¼ŒGauss-Seidelè¿­ä»£æ ¼å¼ï¼Œæ”¶æ•›æ€§çš„åˆ¤åˆ«</p></li><li><p>å¹‚æ³•å’Œåå¹‚æ³•</p></li></ol><hr /><p>è¿­ä»£è§£æ³•æè¿°ï¼š</p><p><span class="math display">\[\begin{aligned}A\vec x=\vec b\iff\vec x&amp;=B\vec x+\vec c\\\vecx_{n+1}&amp;=B\vec x_n+\vec c\\if~x_n~converge,~\vec x_n&amp;\rightarrow \vec x^*\end{aligned}\]</span></p><p>Today's outline:</p><ol type="1"><li><p>è§£çº¿æ€§æ–¹ç¨‹ç»„çš„å¯æ“ä½œçš„è§£æ³•</p></li><li><p>ç›´æ¥æ³•ï¼šä¸è€ƒè™‘èˆå…¥è¯¯å·®ï¼Œé€šè¿‡æœ‰é™æ­¥è¿ç®—ä¸€å®šèƒ½å¾—åˆ°<strong>ç²¾ç¡®è§£</strong></p></li></ol><p>ä¾‹å¦‚ï¼šKramer's law</p><pre><code>- $A=(\vec a_1, \vec a_2,\cdots)$$A_i = (\vec a_1,\cdots,\vec a_&#123;i-1&#125;,\vec b,\vec a_&#123;i+1&#125;,\cdots,\vec a_n)$$x_i = |A_i|/|A|$</code></pre><ol start="2" type="1"><li><p>æ¶ˆå…ƒæ³•ï¼šGauss</p></li><li><p>é—´æ¥æ³•ï¼šé€šè¿‡æœ‰é™æ¬¡è¿ç®—å¾—åˆ°è¿‘ä¼¼è§£â†’å¦‚ä½•åˆ»ç”»</p></li><li><p>çŸ©é˜µ/å‘é‡çš„èŒƒæ•° è¯¯å·®ä¼°è®¡</p></li><li><p>è¿­ä»£æ³•æ±‚è§£ï¼ˆè¿‘ä¼¼è§£ï¼‰</p></li><li><p>æ’ç­‰å˜å½¢ï¼š</p></li></ol><p><span class="math display">\[Ax=b\iff x = Bx+f\]</span></p><ol start="2" type="1"><li>æ„é€ è¿­ä»£åºåˆ—ï¼šï¼ˆç”± <span class="math inline">\(B\)</span>å’Œ <spanclass="math inline">\(x_0\)</span>å®Œå…¨å†³å®šï¼‰</li></ol><p><span class="math display">\[x_{k+1}=Bx_k+f\]</span></p><ol start="3" type="1"><li>å¦‚æœåºåˆ—æ”¶æ•›ï¼Œåˆ™ï¼š</li></ol><p><span class="math display">\[x^*=Bx^*+f\]</span></p><ol start="4" type="1"><li><p>å¯¹äºå……åˆ†å¤§çš„<span class="math inline">\(k\)</span>ï¼Œæœ‰ <spanclass="math inline">\(x_k\approx x^*\)</span></p></li><li><p>è®¡ç®—çŸ©é˜µAçš„æœ€å¤§ï¼ˆå°ï¼‰ç‰¹å¾å€¼</p></li></ol><div class="story post-story"><h2 id="gauss-æ¶ˆå…ƒæ³•">Gauss æ¶ˆå…ƒæ³•</h2><blockquote><p>æ€æƒ³ï¼šåˆ©ç”¨çº¿æ€§ä»£æ•°ä¸­å­¦è¿‡çš„åˆç­‰è¡Œå˜æ¢ï¼Œå°†æ–¹ç¨‹ç»„åŒ–ä¸ºç­‰ä»·çš„ä¸‰è§’å½¢æ–¹ç¨‹ç»„</p></blockquote><h3 id="ä¸‰è§’å½¢æ–¹ç¨‹ç»„çš„å›ä»£æ³•">ä¸‰è§’å½¢æ–¹ç¨‹ç»„çš„å›ä»£æ³•</h3><p><span class="math display">\[\begin{aligned}u_{11}x_1+\cdots +u_{1n}x_n=y_1&amp;\\\cdots&amp;\\u_{nn}x_n=y_n&amp;\end{aligned}\]</span></p><p><span class="math display">\[\begin{cases}x_n=y_n/u _{nn}\\x_i = (y_{n-1}-\sum _{j=i+1}^n u_{ij}x_j)/u_{ii}\end{cases}\]</span></p><h3 id="gauss-æ¶ˆå»æ³•">Gauss æ¶ˆå»æ³•</h3><ol type="1"><li>å°† <span class="math inline">\(Ax=b\)</span>åŒ–ä¸ºå¢å¹¿çŸ©é˜µï¼š<spanclass="math inline">\(\overline A^{(1)}\)</span></li></ol><blockquote><p>åŒè§£å˜æ¢ï¼šéé›¶æ•°ä¹˜ä¸€ä¸ªæ–¹ç¨‹ä¸¤è¾¹ï¼Œäº’æ¢ä½ç½®ï¼Œä¸€ä¸ªæ–¹ç¨‹ä¹˜å¸¸æ•°+å¦ä¸€ä¸ªæ–¹ç¨‹</p></blockquote><ol start="2" type="1"><li>ä¸‹é¢ç”¨n-1æ­¥æ¶ˆå…ƒï¼Œå°†<span class="math inline">\(\overlineA^{(1)}\)</span>è½¬åŒ–ä¸ºä¸Šä¸‰è§’çŸ©é˜µ</li></ol><p><span class="math inline">\(\bar A^{(1)}\rightarrow \barA^{(2)}\rightarrow\cdots\rightarrow \bar A^{(n)}\)</span></p><ol start="3" type="1"><li>ä¸‰è§’å½¢æ–¹ç¨‹ç»„å›ä»£</li></ol><p>â†’<span class="math inline">\(O(n^3)\)</span></p><p><strong>Thm</strong>ï¼šï¼ˆå……åˆ†æ¡ä»¶ï¼‰è‹¥ Açš„å„é˜¶é¡ºåºä¸»å­å¼éé›¶ï¼Œåˆ™Gaussæ¶ˆå»æ³•ä¸­å„<strong>ä¸»å…ƒ</strong><spanclass="math inline">\(a_{kk}^{(k)}\)</span>å‡éé›¶ã€‚</p><h3 id="ä¸‰å¯¹è§’æ–¹ç¨‹ç»„çš„è¿½èµ¶æ³•">ä¸‰å¯¹è§’æ–¹ç¨‹ç»„çš„è¿½èµ¶æ³•</h3><p><span class="math display">\[\left[\begin{matrix}b_1&amp;c_1\\a_2&amp;b_2&amp;c_2\\&amp;a_3&amp;b_3&amp;c_3\\&amp;&amp;&amp;\cdots\end{matrix}\right]x = d\]</span></p><p>ä¸”å¯¹è§’å ä¼˜ï¼š<spanclass="math inline">\(|b_i|&gt;|a_i|+|c_i|\)</span></p><p>æ¶ˆå…ƒè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><span class="math inline">\(\beta_1=b_1,y_1=d_1,l_i=\frac {a_i}{\beta _{i-1}},\beta_i=b_i-l_ic_{i-1},y_i=d_i-l_iy_{i-1}\)</span></p><h3 id="åˆ—ä¸»å…ƒgaussæ¶ˆå…ƒ">åˆ—ä¸»å…ƒGaussæ¶ˆå…ƒ</h3><p>â†’ <span class="math inline">\(|a_{tk}^{(k)}|=\max_{k\le i\len}|a_{ik}^{(k)}|\)</span></p><h3 id="luåˆ†è§£æ³•">LUåˆ†è§£æ³•</h3><p>Gaussæ¶ˆå…ƒâ†’è¡Œå˜æ¢Lâ†’<spanclass="math inline">\(L=(L_k^{-1}L_{k-1}^{-1}\cdotsL_1^{-1})\)</span>â†’<span class="math inline">\(LUx=b\)</span>â†’<spanclass="math inline">\(Ly=b,Ux=y\)</span></p><p><strong>Thm</strong>Açš„å„é˜¶é¡ºåºä¸»å­å¼å‡ä¸ä¸º0ï¼Œåˆ™å¯¹Aå¯åšå”¯ä¸€çš„LUåˆ†è§£</p><p><strong>Thm</strong>è‹¥Aæ˜¯å¯¹ç§°çŸ©é˜µï¼Œä¸”å„é˜¶é¡ºåºä¸»å­å¼ä¸ä¸º0ï¼Œåˆ™Aå¯ä»¥åšLUåˆ†è§£ï¼Œä¸”</p><p><span class="math display">\[l_{ik}=\frac {u_{ki}}{u_{kk}}\]</span></p><h2 id="æ–¹ç¨‹ç»„çš„æ€§æ€å’Œè¯¯å·®åˆ†æ-important">æ–¹ç¨‹ç»„çš„æ€§æ€å’Œè¯¯å·®åˆ†æ#IMPORTANT</h2><p>å¦‚ä½•åˆ»ç”»ä¸€ä¸ªçŸ©é˜µAçš„æ€§æ€â†’çŸ©é˜µçš„æ¡ä»¶æ•°ï¼ˆä¸çŸ©é˜µçš„æ¨¡æœ‰å…³ï¼‰</p><h3 id="å‘é‡èŒƒæ•°">å‘é‡èŒƒæ•°</h3><p><strong>Def</strong>ï¼ˆèŒƒæ•°ï¼‰ä¸€ä¸ªå‡½æ•°ï¼Œæ»¡è¶³ï¼šéè´Ÿæ€§ã€é½æ¬¡æ€§ã€ä¸‰è§’ä¸ç­‰å¼</p><ul><li><p>å¸¸ç”¨çš„ï¼š</p><ol type="1"><li><p>1-èŒƒæ•°</p></li><li><p>âˆ-èŒƒæ•°</p></li><li><p>2-èŒƒæ•°â†å†…ç§¯</p></li></ol></li></ul><p><strong>Thm</strong>ï¼š<strong>æœ‰é™ç»´ç©ºé—´æ‰€æœ‰çš„æ¨¡éƒ½æ˜¯</strong>ç­‰ä»·<strong>çš„</strong>ï¼ˆ<spanclass="math inline">\(\exists c_1,c_2\forall x\in R^n,c_1||x||_p\le||x||_q\le c_2||x||_p\)</span>)</p><blockquote><p>å®šæ€§æè¿°ä¸ºï¼šä¸¤ä¸ªèŒƒæ•°ç­‰ä»·æ˜¯æŒ‡åœ¨ä¸€ä¸ªèŒƒæ•°é¡¶ä¸€ä¸‹çš„å‘é‡ï¼Œåœ¨å¦ä¸€ä¸ªèŒƒæ•°ä¸‹ä¹Ÿå°</p></blockquote><p>å€ŸåŠ©è¿™æ ·çš„ç†è®ºï¼šæˆ‘ä»¬ç ”ç©¶ ä¸¤ä¸ªå‘é‡ä¹‹é—´çš„ç»å¯¹è¯¯å·®å’Œç›¸å¯¹è¯¯å·®ï¼š</p><blockquote><p>è®¾<span class="math inline">\(x^*\)</span>å’Œ<spanclass="math inline">\(\tilde x\)</span>æ˜¯æ–¹ç¨‹ç»„<spanclass="math inline">\(Ax=b\)</span>çš„ç²¾ç¡®è§£å’Œè¿‘ä¼¼è§£ï¼Œåˆ™<spanclass="math inline">\(||x^*-\tilde x||, ||x^*-\tilde x||/||\tildex||\)</span>å¯ä»¥è¡¨ç¤ºå…¶è¯¯å·®</p></blockquote><h3 id="çŸ©é˜µèŒƒæ•°">çŸ©é˜µèŒƒæ•°</h3><p>å€ŸåŠ©å‘é‡æ¨¡å®šä¹‰çŸ©é˜µæ¨¡</p><p><strong>Def</strong>ï¼ˆçŸ©é˜µèŒƒæ•°ï¼‰ä¸€ä¸ªå‡½æ•°ï¼Œæ»¡è¶³</p><ol type="1"><li><p>éè´Ÿæ€§<span class="math inline">\(||A||\ge0 ä¸”||A||=0\iffA=0\)</span></p></li><li><p>é½æ¬¡æ€§<span class="math inline">\(||\alphaA||=|\alpha|||A||\)</span></p></li><li><p>ä¸‰è§’ä¸ç­‰å¼<span class="math inline">\(||A+B||\le||A||+||B||\)</span></p></li><li><p><span class="math inline">\(||AB||\le||A||~||B||\)</span></p></li><li><p>ç›¸å®¹æ€§<span class="math inline">\(||Ax||\le||A||~||x||\)</span></p></li></ol><blockquote><p>çŸ©é˜µçš„è¡Œåˆ—å¼<strong>ä¸å¯ä»¥</strong>ä½œä¸ºèŒƒæ•°</p></blockquote><p><strong>Def</strong>ï¼ˆå‘é‡èŒƒæ•°å¯¼å‡ºçš„ç®—å­èŒƒæ•°ï¼‰ è®¾ <spanclass="math inline">\(||\cdot||\)</span>æ˜¯ä¸€ä¸ªèŒƒæ•°ï¼Œç§°<spanclass="math inline">\(\max_{x\in R^n} \frac{||Ax||}{||x||}=\max_{x\inR^n,||x||=1}||Ax||\)</span>ä¸ºAçš„å‘é‡èŒƒæ•°å¯¼å‡ºçš„ç®—å­èŒƒæ•°<spanclass="math inline">\(|||A|||\)</span></p><p><strong>Def</strong>ï¼ˆè°±SpectrumåŠå¾„ï¼‰è®¾<spanclass="math inline">\(B\in R^{n\times n}\)</span>ï¼Œ<spanclass="math inline">\(\lambda_1,...,\lambda_n\)</span>ä¸ºç‰¹å¾å€¼ï¼Œè°±åŠå¾„ä¸ºï¼š</p><p><span class="math display">\[\rho(B)=\max \{\lambda_i\}\]</span></p><p><strong>Thm</strong>ï¼šå¸¸ç”¨çŸ©é˜µèŒƒæ•°è®¡ç®—</p><ol type="1"><li><p><span class="math inline">\(||A||_1=\max_{1\le j\len}\sum_{i=1}^n\)</span>=æœ€å¤§åˆ—ç»å¯¹å€¼å’Œ</p></li><li><p><spanclass="math inline">\(||A||_\infty\)</span>=æœ€å¤§è¡Œç»å¯¹å€¼å’Œ</p></li><li><p><spanclass="math inline">\(||A||_2=\sqrt{\rho(A^TA)}\)</span></p></li><li><p><spanclass="math inline">\(||A|_F=\sqrt{\sum_{i,j=1}^na_{ij}^2}\)</span>â†’æ³¨æ„ï¼ä¸æ˜¯ç®—å­èŒƒæ•°ï¼ä¾‹å¦‚ <span class="math inline">\(||I||\ne1\)</span></p></li></ol><p><strong>Thm</strong>ï¼šå¯¹äºå¯¹ç§°çŸ©é˜µï¼Œ<spanclass="math inline">\(\rho(A)=||A||_2\)</span></p><p><strong>Thm</strong>ï¼šå¯¹äº<strong>ä»»æ„</strong>èŒƒæ•°<spanclass="math inline">\(\rho(A)\le ||A||\)</span></p><blockquote><p>å¯ç”¨äºè¯æ˜è¿­ä»£æ³•æ”¶æ•›ï¼</p></blockquote><p><strong>Thm</strong>ï¼š <span class="math inline">\(R^{n\timesn}\)</span> ä¸­çš„ä»»æ„ä¸¤ä¸ªçŸ©é˜µèŒƒæ•°æ˜¯ç­‰ä»·çš„</p><blockquote><p>ã€æ¨å¹¿ã€‘æœ‰é™ç»´ç©ºé—´ä¸­çš„ä¸¤ä¸ªèŒƒæ•°æ˜¯ç­‰ä»·çš„ã€‚</p></blockquote><p><strong>Thm</strong>ï¼šå¯¹äºä¸¤ä¸ªçŸ©é˜µèŒƒæ•°ï¼Œå­˜åœ¨å¸¸æ•°<spanclass="math inline">\(d_1\)</span>å’Œ<spanclass="math inline">\(d_2\)</span>æ»¡è¶³ï¼š</p><p><span class="math display">\[d_1||A||_p\le ||A||_q\le d_2||A||_p\]</span></p><p><strong>Def</strong>ï¼ˆçŸ©é˜µä¹‹é—´çš„è·ç¦»ï¼‰<spanclass="math inline">\(||A-B||\)</span></p><p><strong>Def</strong>ï¼ˆçŸ©é˜µæ”¶æ•›ï¼‰<spanclass="math inline">\(\lim_{k\rightarrow \infty} ||A^{(k)}-A||=0\iff\lim_{k\rightarrow \infty} A^{(k)}=A\)</span></p><p><strong>Thm</strong>ï¼š<span class="math inline">\(\lim_{k\rightarrow\infty} B^k=0\iff \rho(B)&lt;1\)</span></p><p>ä¾‹å¦‚ï¼š</p><p><span class="math display">\[\begin{aligned}\frac 1{1-q}&amp;=1+q+q^2+\cdots\\(I-A)^{-1}&amp;=I+A+A^2+\cdots\end{aligned}\]</span></p><h3 id="æ–¹ç¨‹ç»„çš„æ€§æ€å’Œæ¡ä»¶æ•°">æ–¹ç¨‹ç»„çš„æ€§æ€å’Œæ¡ä»¶æ•°</h3><blockquote><p>çŸ©é˜µçš„è¡Œåˆ—å¼å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šçš„è¡¨ç¤ºè¯¯å·®å¤§å°ï¼Œè€Œç”¨æ¡ä»¶æ•°è¿›è¡Œç²¾ç¡®åˆ»ç”»ã€‚</p></blockquote><ol type="1"><li><p>è®¾<span class="math inline">\(b\)</span>æœ‰ä¸€ä¸ªå°çš„æ‰°åŠ¨<spanclass="math inline">\(\delta b\)</span>ï¼Œæ­¤æ—¶è§£å˜ä¸º<spanclass="math inline">\(x^*+\delta^*\)</span></p></li><li><p>åˆ™æœ‰<span class="math inline">\(A\delta x^*=\deltab\)</span>ï¼Œä¹Ÿå°±æ˜¯<span class="math inline">\(\delta x^*=A^{-1}\deltab\)</span></p></li><li><p>å–èŒƒæ•°ï¼š</p></li></ol><p><span class="math display">\[\frac{||\delta x^*||}{||x^*||}\le ||A^{-1}||~||A||\frac{||\deltab||}{||b||}\]</span></p><ol type="1"><li><p>è®¾<span class="math inline">\(A\)</span>æœ‰å¾®å°å˜åŒ–<spanclass="math inline">\(\delta A\)</span></p></li><li><p>åˆ™<span class="math inline">\(\delta x^*=-A^{-1} \deltaA(x^*+\delta x^*)\)</span></p></li><li><p>å–èŒƒæ•°ï¼š</p></li></ol><p><span class="math display">\[\frac{||\delta x^*||}{||x^*+\delta x^*||}\le ||A^{-1}||~||A||~\frac{||\delta A||}{||A||}\]</span></p><p><strong>Def</strong>ï¼ˆæ¡ä»¶æ•°<span class="math inline">\(\mathrm{cond}A\)</span>ï¼‰<spanclass="math inline">\(A\)</span>ä¸ºéå¥‡å¼‚çŸ©é˜µï¼Œåˆ™ç§° <spanclass="math inline">\(||A^{-1}||~||A||\)</span>ä¸ºæ¡ä»¶æ•°</p><p><strong>Def</strong>ï¼ˆå¥½çš„æ–¹ç¨‹ç»„ï¼‰å¯¹äºAx=bè€Œè¨€ï¼Œè‹¥</p><ol type="1"><li><p>Açš„æ¡ä»¶æ•°å¾ˆå¤§ï¼Œåˆ™ä¸º<strong>ç—…æ€æ–¹ç¨‹ç»„</strong>ï¼ˆè¯¯å·®ä¸ä¸€å®šå¤§ï¼‰</p></li><li><p>Açš„æ¡ä»¶æ•°å¾ˆå°ï¼Œåˆ™ä¸º<strong>è‰¯æ€æ–¹ç¨‹ç»„</strong>ï¼ˆè¯¯å·®ä¸€å®šå°ï¼‰</p></li></ol><p>å¸¸ç”¨çš„åˆ¤æ–­æ–¹æ³•ï¼š</p><ol type="1"><li><p>åˆ—ä¸»å…ƒGaussæ¶ˆå»æ³•å‡ºç°ç»å¯¹å€¼å¾ˆå°çš„pivot</p></li><li><p>ç³»æ•°çŸ©é˜µä¸­ï¼ŒæŸäº›è¡Œï¼ˆåˆ—ï¼‰è¿‘ä¼¼çº¿æ€§ç›¸å…³</p></li><li><p>ç³»æ•°çŸ©é˜µå…ƒç´ é—´ï¼Œæ•°é‡çº§å·®è·å¾ˆå¤§ï¼Œä¸”æ²¡æœ‰ä¸€å®šçš„è§„å¾‹</p></li></ol><p>ä¸€èˆ¬çš„è§£å†³æ–¹æ¡ˆï¼š</p><ol type="1"><li><p>æé«˜è®¡ç®—ç²¾åº¦</p></li><li><p><strong>é¢„å¤„ç†</strong>ï¼šé€‰æ‹©åˆç†çš„éå¥‡å¼‚çŸ©é˜µ<spanclass="math inline">\(D,C\)</span>ï¼Œå°†æ–¹ç¨‹ç»„åŒ–ä¸ºç­‰ä»·çš„æ–¹ç¨‹ç»„ï¼Œ<spanclass="math inline">\(DAC[C^{-1}]=Db\)</span>ä¸”ä½¿å¾—<spanclass="math inline">\(\mathrm{cond} DAC\)</span>è¾ƒå°</p></li></ol><p>ä¾‹å¦‚ï¼šæ­£åˆ™åŒ–æ–¹æ³•ï¼š<span class="math inline">\(Ax=b,|A|\approx0\)</span>â†’<span class="math inline">\(x=(\alphaI+A^TA)^{-1}A^Tb\)</span></p><h2id="è¿­ä»£æ³•jacobiè¿­ä»£gauss-seidelè¿­ä»£">è¿­ä»£æ³•ï¼ˆJacobiè¿­ä»£ï¼ŒGauss-Seidelè¿­ä»£ï¼‰</h2><h3 id="è¿­ä»£æ ¼å¼çš„æ„é€ ">è¿­ä»£æ ¼å¼çš„æ„é€ </h3><p>å°†æ–¹ç¨‹ç»„æ”¹å†™ä¸ºç­‰ä»·çš„æ–¹ç¨‹ï¼š</p><p><span class="math display">\[x=Bx+f\]</span></p><p>é€šè¿‡è¯¥æ ¼å¼è¿›è¡Œè¿­ä»£ï¼Œè‹¥è¿­ä»£æ ¼å¼å¯¹äºä»»æ„åˆå§‹å‘é‡äº§ç”Ÿçš„è¿­ä»£åºåˆ— <spanclass="math inline">\(\{x^{(k)}\}\)</span>éƒ½æ”¶æ•›ï¼Œåˆ™<strong>è¿­ä»£æ”¶æ•›</strong></p><blockquote><p>å¯¹äºçº¿æ€§æ–¹ç¨‹ç»„è€Œè¨€ï¼Œè¿­ä»£æ”¶æ•›åªä¸<spanclass="math inline">\(B\)</span>æœ‰å…³ï¼›å¯¹äºéçº¿æ€§æ–¹ç¨‹ç»„è€Œè¨€ï¼Œå’Œ <spanclass="math inline">\(B,x\)</span> éƒ½æœ‰å…³ã€‚</p></blockquote><h3 id="ä¸‰ç§å¸¸ç”¨çš„è¿­ä»£æ ¼å¼">ä¸‰ç§å¸¸ç”¨çš„è¿­ä»£æ ¼å¼</h3><h4 id="jacobiè¿­ä»£æ³•">Jacobiè¿­ä»£æ³•</h4><p>å‡è®¾å¯¹è§’çº¿å…ƒç´ éƒ½éé›¶ï¼Œåˆ™å¯ä»¥é€šè¿‡è¯¥å…¬å¼å¾—åˆ°ï¼š</p><p><span class="math display">\[\begin{aligned}x_1 = (b_1-a_{12}x_2-\cdots - a_{1n}x_n)/a_{11}\\\cdots\\x_n = (b_n - a _ {n1} x_1 - \cdots - a_{n,n-1}x_{n-1})/a_{nn}\end{aligned}\]</span></p><p>è‹¥å°†åŸçŸ©é˜µè¿›è¡Œé‡å†™ï¼š</p><p>$$ A=L+D+U</p><p>$$</p><ul><li><p><span class="math inline">\(J = -D^{-1}(L+U)\)</span></p></li><li><p><span class="math inline">\(f_J=D^{-1}b\)</span></p></li></ul><h4 id="gauss-seidelè¿­ä»£">Gauss-Seidelè¿­ä»£</h4><p>æˆ‘ä»¬ç”¨å·²ç»æ±‚å‡ºçš„ <spanclass="math inline">\(x^{(k)}_{i}\)</span>ä»£å…¥åç»­æ‰€æœ‰è®¡ç®—ï¼Œå³ä¸ºGauss-Seidelæ ¼å¼ï¼š</p><p><span class="math display">\[x^{(k+1)}=D^{-1}(b-Lx^{(k+1)}-Ux^{(k)})\]</span></p><p>æœ€ç»ˆçš„è¿­ä»£æ ¼å¼ä¸ºï¼š</p><p><span class="math display">\[x^{(k+1)}=Gx^{(k)}+f_G\]</span></p><ul><li><p><span class="math inline">\(G=-(D+L)^{-1}U\)</span></p></li><li><p><span class="math inline">\(f_G=(D+L)^{-1}b\)</span></p></li></ul><h4 id="soré€æ¬¡è¶…æ¾å¼›è¿­ä»£æ ¼å¼">SORï¼ˆé€æ¬¡è¶…æ¾å¼›ï¼‰è¿­ä»£æ ¼å¼</h4><p><span class="math display">\[x^{(k+1)}=(1-\omega )x^{(k)}+\omega D^{-1}(b-Lx^{(k+1)}-Ux^{(k)})\]</span></p><p><span class="math inline">\(\omega\)</span>ç§°ä¸ºæ¾å¼›å› å­ï¼Œå½“ <spanclass="math inline">\(\omega =1\)</span>æ—¶ï¼Œå³ä¸ºGauss-Seidelè¿­ä»£ã€‚</p><p>æœ€ç»ˆæ ¼å¼ä¸ºï¼š</p><p><span class="math display">\[x^{(k+1)}=S_\omega x^{(k)}+f_\omega\]</span></p><ul><li><p><span class="math inline">\(S_\omega =(D+\omegaL)^{-1}[(1-\omega)D-\omega U]\)</span></p></li><li><p><span class="math inline">\(f_\omega =\omega (D+\omegaL)^{-1}b\)</span></p></li></ul><h3 id="è¿­ä»£æ ¼å¼çš„æ”¶æ•›æ€§">è¿­ä»£æ ¼å¼çš„æ”¶æ•›æ€§</h3><h4 id="è¿­ä»£æ³•åŸºæœ¬å®šç†">è¿­ä»£æ³•åŸºæœ¬å®šç†</h4><p><strong>Thm</strong>ï¼šè¿­ä»£æ ¼å¼ <spanclass="math inline">\(x^{(k+1)}=Bx^{(k)}+f\)</span>æ”¶æ•›çš„å……åˆ†å¿…è¦æ¡ä»¶æ˜¯<span class="math inline">\(\rho(B)&lt;1\)</span></p><p><strong>Thm</strong>ï¼šè‹¥è¿­ä»£æ ¼å¼ <spanclass="math inline">\(||B||&lt;1\)</span>ï¼Œåˆ™<spanclass="math inline">\(x^{(k+1)}=Bx^{(k)}+f\)</span>æ”¶æ•›ã€‚ã€Œ<ahref="https://www.wolai.com/4bZTUKfKuKiHhhaEUmhhDC">Thmï¼šå¯¹äºä»»æ„èŒƒæ•°(A)||A||</a>ã€åŒæ—¶ï¼šï¼ˆè¯¯å·®çš„å…ˆéªŒä¼°è®¡å’ŒåéªŒä¼°è®¡ï¼‰</p><ol type="1"><li><p><span class="math inline">\(||x^*-x^{(k+1)}||\le||B||~||x^*-x^{(k)}||\)</span></p></li><li><p><span class="math inline">\(||x^*-x^{(k)}||\le \frac{||B||}{1-||B||} ||x^{(k)} - x^{(k-1)}||\)</span></p></li><li><p><span class="math inline">\(||x^*-x^{(k)}||\le \frac{||B||^k}{1-||B||} ||x^{(1)} - x^{(0)}||\)</span></p></li></ol><h4id="jacobiè¿­ä»£å’Œgauss-seidelè¿­ä»£çš„æ”¶æ•›æ€§">Jacobiè¿­ä»£å’ŒGauss-Seidelè¿­ä»£çš„æ”¶æ•›æ€§</h4><ol type="1"><li><p>Jacobiè¿­ä»£æ³•æ”¶æ•›<spanclass="math inline">\(\iff\rho(J)&lt;1\)</span></p></li><li><p>Gauss-Seidelè¿­ä»£æ³•æ”¶æ•›<span class="math inline">\(\iff\rho(G)&lt;1\)</span></p></li></ol><blockquote><p>ä¸¥æ ¼è¡Œå¯¹è§’å ä¼˜ï¼š <span class="math inline">\(|a_{ii}|\ge\sum_{j,i\nej}|a_{ij}|\)</span></p></blockquote><blockquote><p>ä¸¥æ ¼åˆ—å¯¹è§’å ä¼˜ï¼š<span class="math inline">\(|a_{jj}|\ge\sum_{i,i\nej}|a_{ij}|\)</span></p></blockquote><p><strong>å¼•ç†</strong> è‹¥Aæ˜¯ä¸¥æ ¼å¯¹è§’å ä¼˜çš„ï¼Œåˆ™ <spanclass="math inline">\(|A|\ne0\)</span></p><p><strong>Thm</strong> å¦‚æœå¯¹äºçŸ©é˜µ <spanclass="math inline">\(Ax=b\)</span>æ˜¯ä¸¥æ ¼å¯¹è§’å ä¼˜çš„ï¼Œåˆ™Jacobiè¿­ä»£å’ŒGauss-Seidelè¿­ä»£æ”¶æ•›ã€‚</p><h4 id="sorè¿­ä»£æ³•çš„æ”¶æ•›æ€§">SORè¿­ä»£æ³•çš„æ”¶æ•›æ€§</h4><p><strong>Thm</strong> SORè¿­ä»£æ”¶æ•›çš„å¿…è¦æ¡ä»¶æ˜¯ <spanclass="math inline">\(0&lt;\omega&lt;2\)</span></p><p><strong>Thm</strong> è‹¥Aå¯¹ç§°æ­£å®šï¼Œä¸” <spanclass="math inline">\(0&lt;\omega&lt;2\)</span>åˆ™SORè¿­ä»£æ³•æ”¶æ•›</p><blockquote><p><strong>Thm</strong> è‹¥Aå¯¹ç§°æ­£å®šï¼Œåˆ™Gauss-Seidelè¿­ä»£æ³•æ”¶æ•›</p></blockquote><blockquote><p>Homework ï¼šP124:28 30 32(1,2) 34</p></blockquote></div><div class="story post-story"><h2 id="å¹‚æ³•å’Œåå¹‚æ³•">å¹‚æ³•å’Œåå¹‚æ³•</h2><h3 id="æ±‚ä¸»ç‰¹å¾å€¼çš„æ–¹æ³•">æ±‚ä¸»ç‰¹å¾å€¼çš„æ–¹æ³•</h3><p><strong>Def</strong>ï¼ˆä¸»ç‰¹å¾å€¼ï¼‰è‹¥å°†<spanclass="math inline">\(A\)</span>çº¿æ€§æ— å…³çš„ç‰¹å¾å‘é‡å¯¹åº”çš„ç‰¹å¾å€¼<spanclass="math inline">\(\lambda_j\)</span>æŒ‰æ¨¡å¤§å°æ’åˆ—ï¼Œæœ‰<spanclass="math inline">\(\max{|\lambda_j|}=|\lambda_1|\)</span>ä¸ºä¸»ç‰¹å¾å€¼ã€‚</p><p><strong>Thm</strong> å¹‚æ³•ï¼š</p><p><span class="math display">\[\begin{cases} u_0=v_0\\v_k=Au_{k-1}\\m_k=\max(v_k)\\u_k=v_k/m_k\end{cases}\]</span></p><p><strong>Thm</strong> è‹¥æ»¡è¶³<spanclass="math inline">\(|\lambda_1|&gt;|\lambda_2|\ge\cdots\)</span>ï¼Œåˆ™é€šè¿‡å¹‚æ³•å¾—åˆ°çš„åºåˆ—æœ‰å¦‚ä¸‹æé™ï¼š</p><p><span class="math display">\[\begin{cases} m_k\rightarrow \lambda_1\\u_k\rightarrow \frac{x_1}{\maxx_1} \end{cases}\]</span></p><h3 id="åå¹‚æ³•">åå¹‚æ³•</h3><p>æ±‚æœ€å°ç‰¹å¾å€¼ï¼šç”¨<span class="math inline">\(A^{-1}\)</span>ä»£æ›¿<spanclass="math inline">\(A\)</span>è®¡ç®—</p></div>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ•°å€¼åˆ†æ ch 3 - çº¿æ€§æ–¹ç¨‹ç»„çš„æ•°å€¼è§£&lt;/p&gt;</summary>
    
    
    
    <category term="æ•°å­¦" scheme="http://adversarr.github.io/categories/%E6%95%B0%E5%AD%A6/"/>
    
    
    <category term="æ•°å€¼åˆ†æ" scheme="http://adversarr.github.io/tags/%E6%95%B0%E5%80%BC%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>æ•°å€¼åˆ†æ-æ•°å€¼ç§¯åˆ†å’Œæ•°å€¼å¾®åˆ†</title>
    <link href="http://adversarr.github.io/2022/09/30/study/Math/NumericRecipies/Chapter%205%20%E6%95%B0%E5%80%BC%E7%A7%AF%E5%88%86%E5%92%8C%E6%95%B0%E5%80%BC%E5%BE%AE%E5%88%86/"/>
    <id>http://adversarr.github.io/2022/09/30/study/Math/NumericRecipies/Chapter%205%20%E6%95%B0%E5%80%BC%E7%A7%AF%E5%88%86%E5%92%8C%E6%95%B0%E5%80%BC%E5%BE%AE%E5%88%86/</id>
    <published>2022-09-30T01:16:33.353Z</published>
    <updated>2022-09-30T01:16:33.353Z</updated>
    
    <content type="html"><![CDATA[<p>æ•°å€¼åˆ†æ ch 5 - æ•°å€¼ç§¯åˆ†å’Œæ•°å€¼å¾®åˆ†</p><span id="more"></span><h1 id="chapter-5-æ•°å€¼ç§¯åˆ†å’Œæ•°å€¼å¾®åˆ†">Chapter 5 æ•°å€¼ç§¯åˆ†å’Œæ•°å€¼å¾®åˆ†</h1><ol type="1"><li><p>æ’å€¼å‹æ±‚ç§¯å…¬å¼</p></li><li><p>å¤åŒ–æ±‚ç§¯å…¬å¼</p></li><li><p>Rombergæ±‚ç§¯æ³•</p></li><li><p>Gaussæ±‚ç§¯å…¬å¼</p></li><li><p>æ•°å€¼å¾®åˆ†</p></li></ol><hr /><div class="story post-story"><h2 id="æ•°å€¼ç§¯åˆ†çš„åŸºæœ¬æ¦‚å¿µ">æ•°å€¼ç§¯åˆ†çš„åŸºæœ¬æ¦‚å¿µ</h2><p><span class="math display">\[\int_{a}^bf(x) \mathrm dx\approx \sum_{k=0}^n A_k f(x_k\]</span></p><p>å…¶ä¸­ï¼š</p><ol type="1"><li><p><span class="math inline">\(x_k\)</span>ç§°ä¸ºæ’å€¼èŠ‚ç‚¹</p></li><li><p><span class="math inline">\(A_k\)</span>ä¸ºæ±‚ç§¯ç³»æ•°</p></li></ol></div><div class="story post-story"><h2 id="æ’å€¼å‹æ±‚ç§¯å…¬å¼">æ’å€¼å‹æ±‚ç§¯å…¬å¼</h2><p>è®° <span class="math inline">\(I(f) = \int_a^bf(x)\mathrmdx\)</span>ï¼Œåˆ™<span class="math inline">\(f\)</span>çš„ä¸€ä¸ªæ’å€¼å¤šé¡¹å¼ä¸º<span class="math inline">\(L_n(x)\)</span>ï¼Œå…¶ä¸­ <spanclass="math inline">\(l_k(x)\)</span> æ˜¯æ’å€¼åŸºå‡½æ•°ã€‚åˆ™ç”¨ <spanclass="math inline">\(L_n(x)\)</span> æ›¿ä»£è¢«ç§¯å‡½æ•°ï¼Œä¸€ä¸ªæ±‚ç§¯å…¬å¼ä¸ºï¼š</p><p><span class="math display">\[I_n(f) = \sum_k A_kf(x_k)\\A_k = \int _a^b l_k(x)\mathrm dx\]</span></p><h3 id="æ’å€¼å‹æ±‚ç§¯å…¬å¼-1">æ’å€¼å‹æ±‚ç§¯å…¬å¼</h3><dl><dt>æ’å€¼å‹æ±‚ç§¯å…¬å¼</dt><dd>è®¾æœ‰è®¡ç®—<span class="math inline">\(I(f)\)</span>çš„æ±‚ç§¯å…¬å¼</dd></dl><p><span class="math display">\[I _ n(f)=\sum _ {k=0}^nA _ k f(x _ k)\]</span></p><p>è‹¥å…¶æ±‚ç§¯ç³»æ•°<span class="math inline">\(A _ k=\int _ a ^ bl _ k(x)\mathrm dx\)</span>ï¼Œåˆ™ç§°è¯¥æ±‚ç§¯å…¬å¼ä¸ºæ’å€¼å‹æ±‚ç§¯å…¬å¼ã€‚</p><p>æˆªæ–­è¯¯å·®ä¸ºï¼š</p><p><span class="math display">\[R(f) = \int_a^b \frac{f^{(n+1)}(x_0)}{(n+1)!} \prod_k(x-x_k)\mathrm dx\]</span></p><dl><dt>Newton-Coteså…¬å¼</dt><dd>è‹¥æ±‚ç§¯èŠ‚ç‚¹æ˜¯ç­‰é—´è·çš„ï¼Œå³ <span class="math inline">\(x_k =a+kh\)</span>ï¼Œåˆ™è¯¥æ’å€¼å‹æ±‚ç§¯å…¬å¼ç§°ä¸º Newton-Cotes å…¬å¼ã€‚</dd></dl><p>è®°ï¼š <span class="math display">\[C_{n,k} = \frac{(-1)^{n-k} h}{k!(n-k)!} \int _ {0} ^ n\prod _ {j=0\\j\nek}^n(t-j)\mathrm dt\]</span> N-Cå…¬å¼å¯è½¬åŒ–ä¸ºï¼š <span class="math display">\[I _ n(f) = \sum _ {k=0} ^ n C _{n, k} f(x_k)\]</span> å¸¸ç”¨çš„ä¸‰ç§æ’å€¼æ±‚ç§¯å…¬å¼ï¼š</p><ol type="1"><li>æ¢¯å½¢å…¬å¼ï¼š<span class="math inline">\(T(f) = \frac{b-a} 2 [f(a) +f(b)]\)</span></li><li>Simpsonå…¬å¼ï¼š<span class="math inline">\(S(f) =\frac{b-a}{6}[f(a)+4f(\frac{a+b} 2)] + f(b)]\)</span></li><li>Coteså…¬å¼ï¼š<span class="math inline">\(C(f) = \frac{b-a}{90} [7f(a)+32f(\frac{3a+b} 4) + 12 f(\frac{a+b} 2) +32f(\frac{a+3b}4)+7f(b)]\)</span></li></ol><h3 id="ä»£æ•°ç²¾åº¦">ä»£æ•°ç²¾åº¦</h3><p>å½“<span class="math inline">\(f(x)\)</span>ä¸ºå¤šé¡¹å¼æ—¶ï¼Œè€ƒè™‘æˆªæ–­è¯¯å·®ï¼š<span class="math display">\[R(f) = \int _ a ^ b \frac{f^{(n+1)}(\xi)}{(n+1)!} \prod _ {k=0} ^ n (x-x_ k) \mathrm dx = 0\]</span> åˆ™ <span class="math inline">\(I _ n(f) =I(f)\)</span>ï¼Œæ±‚ç§¯å…¬å¼æ˜¯ç²¾ç¡®çš„</p><dl><dt>ä»£æ•°ç²¾åº¦</dt><dd>è®¡ç®— <span class="math inline">\(I_n(f)\)</span>çš„æ±‚ç§¯å…¬å¼ï¼Œè‹¥å¯¹äºæ‰€æœ‰<spanclass="math inline">\(m\)</span>æ¬¡å¤šé¡¹å¼æ˜¯ç²¾ç¡®çš„ï¼Œä½†è‡³å°‘å¯¹ä¸€ä¸ª<spanclass="math inline">\((m+1)\)</span>æ¬¡æ•°çš„å¤šé¡¹å¼æ˜¯ä¸ç²¾ç¡®çš„ï¼Œåˆ™ç§°è¯¥æ±‚ç§¯å…¬å¼å…·æœ‰<spanclass="math inline">\(m\)</span>æ¬¡ä»£æ•°ç²¾åº¦ã€‚</dd></dl><p class='p blue'>Theorem</p><p>æ±‚ç§¯å…¬å¼ <span class="math inline">\(I_n(f)\)</span> è‡³å°‘æœ‰<spanclass="math inline">\(n\)</span>æ¬¡ä»£æ•°ç²¾åº¦çš„å……åˆ†å¿…è¦æ¡ä»¶æ˜¯è¯¥å…¬å¼æ˜¯æ’å€¼å‹çš„ã€‚</p><p class='p blue'>Theorem</p><p>æ±‚ç§¯å…¬å¼ <span class="math inline">\(I_n(f)\)</span> è‡³å°‘æœ‰<spanclass="math inline">\(m\)</span>æ¬¡ä»£æ•°ç²¾åº¦çš„å……åˆ†å¿…è¦æ¡ä»¶æ˜¯è¯¥å…¬å¼å¯¹<spanclass="math inline">\(f(x)=x^i,~i=0, 1,...,m\)</span>éƒ½ç²¾ç¡®æˆç«‹ï¼Œä½†å¯¹<spanclass="math inline">\(f(x)=x^{m+1}\)</span>ä¸ç²¾ç¡®æˆç«‹</p><p>å¸¸ç”¨ä¸‰ç§æ’å€¼æ±‚ç§¯å…¬å¼çš„ä»£æ•°ç²¾åº¦ï¼š</p><ol type="1"><li>æ¢¯å½¢å…¬å¼ï¼šæˆªæ–­è¯¯å·®ä¸º<span class="math inline">\(-\frac{(b-a)^3}{12}f&#39;&#39;(\eta)\)</span>ï¼Œä»£æ•°ç²¾åº¦ä¸º 1</li><li>Simpsonå…¬å¼ï¼šæˆªæ–­è¯¯å·®ä¸º<spanclass="math inline">\(-\frac{(b-a)^5}{2880}f^{(4)}(\eta)\)</span>ï¼Œä»£æ•°ç²¾åº¦ä¸º3</li><li>Coteså…¬å¼ï¼šä»£æ•°ç²¾åº¦ä¸º5</li></ol><h3id="æ¢¯å½¢å…¬å¼simpsonå…¬å¼å’Œcoteså…¬å¼çš„æˆªæ–­è¯¯å·®">æ¢¯å½¢å…¬å¼ã€Simpsonå…¬å¼å’ŒCoteså…¬å¼çš„æˆªæ–­è¯¯å·®</h3><p><span class="math display">\[R_T(f) = -\frac{(b-a)^3}{12}f&#39;&#39;(\eta),\quad \eta\in (a,b)\]</span></p><p><span class="math display">\[R_S(f) = -\frac{(b-a)^4}{2880}f^{(4)}(\eta),\quad\eta\in (a,b)\]</span></p><p><span class="math display">\[R_C(f) = -\frac{2(b-a)}{945}(\frac{(b-a)}4)^6f^{(6)}(\eta),\quad\eta\in(a,b)\]</span></p></div><div class="story post-story"><h2 id="å¤åŒ–æ±‚ç§¯å…¬å¼">å¤åŒ–æ±‚ç§¯å…¬å¼</h2><h3 id="å¤åŒ–æ¢¯å½¢æ±‚ç§¯å…¬å¼">å¤åŒ–æ¢¯å½¢æ±‚ç§¯å…¬å¼</h3><p>å¯¹æ¯ä¸ªå°åŒºé—´ä¸Šçš„ç§¯åˆ† <span class="math inline">\(\int _ {x _ k} ^{x _{k+1} }f(x)\mathrm dx\)</span> éƒ½åº”ç”¨æ¢¯å½¢å…¬å¼ï¼š <spanclass="math display">\[T _ n(f) = \sum _ {k=0}^{n-1} \frac h 2 [f(x _ k) + f(x _ { k + 1 })]\]</span> æˆªæ–­è¯¯å·®ä¸ºï¼š <span class="math display">\[I(f) - T_n (f) = - \frac {h^3} {12} \sum _ {k = 0} ^{ n - 1}f&#39;&#39;(\eta _ k )\]</span> å…¶<strong>å…ˆéªŒè¯¯å·®ä¼°è®¡</strong>ä¸ºï¼š <spanclass="math display">\[I(f) - T _ n (f) = \frac{b - a} {12} h^ 2|f&#39;&#39;(\eta) | \le\frac{b - a} {12} M_2 h^2\le \varepsilon\\M_2=\max_{a\le x \le b} |f&#39;&#39;(x)||\]</span> å…¶<strong>åéªŒè¯¯å·®ä¼°è®¡</strong>ä¸ºï¼š <spanclass="math display">\[|I(f) - T _ {2n} (f) | \approx \frac 1 3 |T _ {2n} - T _ n (f)|&lt;\varepsilon\]</span></p><h3 id="å¤åŒ–simpsonå…¬å¼">å¤åŒ–Simpsonå…¬å¼</h3><p>å¯¹æ¯ä¸ªå°åŒºé—´ä¸Šçš„ç§¯åˆ† <span class="math inline">\(\int _ {x _ k} ^{x _{k+1} }f(x)\mathrm dx\)</span> éƒ½åº”ç”¨Simpsonå…¬å¼ï¼š <spanclass="math display">\[S _ n(f) = \sum _ {h=0} ^ { n - 1} \frac h 6 [f(x _ k) + 4 f(x _ {k +1/2}) + f( x _ {k+1})]\\x _ {k + 1/ 2} = \frac 1 2(x_k + x _ { k + 1})\]</span> å…¶æˆªæ–­è¯¯å·®ä¸ºï¼š<spanclass="math inline">\(-\frac{b-a}{180}(\frac{h}2)^4\sum_{k = 0} ^ {n-1}f^{(4)}(\eta_k)\)</span></p><p>å…ˆéªŒè¯¯å·®ä¼°è®¡ä¸ºï¼š</p><p><span class="math display">\[I(f) - S_n(f) = - \frac{b-a}{180}\left( \frac h 2 \right)^4f^{(4)}(\eta)\\|I(f) - S_n (f)| \le \varepsilon\]</span></p><p>åéªŒè¯¯å·®ä¼°è®¡ä¸ºï¼š</p><p><span class="math display">\[I(f) - S_{2n}(f) \approx \frac 1 {15} (S_{2n}(f) - S_n (f))\\|I(f) - S _ {2n} (f)|\approx \frac 1 {15} |S_{2n}(f) - S_j(f)|\]</span></p><h3 id="å¤åŒ–-cotes-å…¬å¼">å¤åŒ– Cotes å…¬å¼</h3><p>è®°</p><p><span class="math display">\[x_{k+\frac14} = x_k +\frac14 h,\quad  x_{k+\frac12}= x_k + \frac 12h,\quad \cdots\]</span></p><p>å¯¹äºç§¯åˆ†<span class="math inline">\(\int_{x_k} ^{x_{k+1}}f(x)\mathrmdx\)</span>åº”ç”¨Coteså…¬å¼ï¼Œå¾—åˆ°å¤åŒ–Coteså…¬å¼</p><p><span class="math display">\[C_n(f) = \sum_{k=0}^{n-1} \frac h{90}[7f(x_k) + 32 f(x_{k+\frac 14}) +12 f(x_{k+\frac12}) + 32 f(x_{k+\frac34}) + 7f(x_{k+1})]\]</span></p><p>å…¶æˆªæ–­è¯¯å·®ä¸º</p><p><span class="math display">\[I(f) - C_n(f) = -\frac{2(b-a)}{945}\left( \frac h2\right)^6f^{(6)}(\eta), \quad \eta\in (a,b)\]</span></p><p>åéªŒè¯¯å·®ä¼°è®¡ä¸ºï¼š</p><p><span class="math display">\[I(f) - C_{2n}(f)\approx \frac1{63} [C_{2n}(f) - C_n(f)]\]</span></p><h3 id="æ±‚ç§¯å…¬å¼çš„é˜¶æ•°">æ±‚ç§¯å…¬å¼çš„é˜¶æ•°</h3><dl><dt>æ±‚ç§¯å…¬å¼çš„é˜¶æ•°</dt><dd>å¦‚æœè®¡ç®—ç§¯åˆ†<span class="math inline">\(I(f)\)</span>çš„å¤åŒ–æ±‚ç§¯å…¬å¼<spanclass="math inline">\(I_n(f)\)</span>ï¼Œå­˜åœ¨æ­£æ•´æ•°<spanclass="math inline">\(p\)</span>å’Œéé›¶å¸¸æ•°<spanclass="math inline">\(C\)</span>ä½¿å¾—ï¼š <span class="math display">\[\lim_{h\rightarrow 0} \frac{I(f)-I_n(f)}{h^p} = C\]</span> åˆ™ç§°å…¬å¼<span class="math inline">\(I_n(f)\)</span>æ˜¯<spanclass="math inline">\(p\)</span>é˜¶çš„ã€‚</dd></dl><p class='p blue'>Theorem å¤åŒ–å…¬å¼çš„é˜¶æ•°</p><ol type="1"><li>å¤åŒ–æ¢¯å½¢å…¬å¼ â€”â€” 2é˜¶</li><li>å¤åŒ–Simpsonå…¬å¼ â€”â€” 4é˜¶</li><li>å¤åŒ–Coteså…¬å¼ â€”â€” 6é˜¶</li></ol></div><div class="story post-story"><h2 id="romberg-ç§¯åˆ†æ³•">Romberg ç§¯åˆ†æ³•</h2><p>æ³¨æ„åˆ°ï¼š</p><p><span class="math display">\[I(f) \approx \frac 43 T_{2n}(f) - \frac13 T_n(f)\]</span></p><p>å®é™…ä¸Šï¼š</p><p><span class="math display">\[S_n(f) = \frac43 T_{2n}(f) - \frac13 T_n(f)\]</span></p><p><span class="math display">\[C_n(f) = \frac{16}{15} S_{2n}(f) - \frac 1{15} S_n(f)\]</span></p><p>åˆ™ï¼š</p><dl><dt>Rombergå…¬å¼</dt><dd>ç§°</dd></dl><p><span class="math display">\[R_n(f) = \frac{64}{63} C_{2n}(f) - \frac{1}{63}C_n(f)\]</span></p><p>ä¸ºRombergå…¬å¼ï¼Œä¸”å…¶å…·æœ‰7æ¬¡ä»£æ•°ç²¾åº¦ã€‚</p><p>Rombergæ±‚ç§¯æ³•å¯ä»¥é€šè¿‡åˆ—è¡¨è®¡ç®—</p><table><thead><tr class="header"><th>n</th><th>T</th><th>S</th><th>C</th><th>R</th></tr></thead><tbody><tr class="odd"><td>1</td><td><span class="math inline">\(T_1\)</span></td><td><span class="math inline">\(S_1\)</span></td><td><span class="math inline">\(C_1\)</span></td><td><span class="math inline">\(R_1\)</span></td></tr><tr class="even"><td>2</td><td><span class="math inline">\(T_2\)</span></td><td><span class="math inline">\(S_2\)</span></td><td><span class="math inline">\(C_2\)</span></td><td><span class="math inline">\(R_2\)</span></td></tr><tr class="odd"><td>4</td><td><span class="math inline">\(T_4\)</span></td><td><span class="math inline">\(S_4\)</span></td><td><span class="math inline">\(C_4\)</span></td><td><span class="math inline">\(R_4\)</span></td></tr><tr class="even"><td>8</td><td><span class="math inline">\(T_8\)</span></td><td><span class="math inline">\(S_8\)</span></td><td><span class="math inline">\(C_8\)</span></td><td><span class="math inline">\(R_8\)</span></td></tr><tr class="odd"><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr></tbody></table><p>æ¯ä¸€æ¬¡é€‰æ‹©ä¸€ä¸ªnï¼Œå‘å³ä¸Šæ–¹è®¡ç®—ã€‚</p></div><div class="story post-story"><h2 id="gaussæ±‚ç§¯å…¬å¼">Gaussæ±‚ç§¯å…¬å¼</h2><dl><dt>Gauss-Legendre å…¬å¼</dt><dd>è®¾ <span class="math inline">\(I_n(f)\)</span> æ˜¯æ±‚ç§¯åˆ†<spanclass="math inline">\(I(f)\)</span>çš„æ±‚ç§¯å…¬å¼ï¼Œå…¶ä»£æ•°ç²¾åº¦ä¸º<spanclass="math inline">\((2n+1)\)</span>åˆ™ç§°å…¶ä¸º <strong>Gauss-Legendreå…¬å¼</strong>ï¼Œå¯¹åº”çš„èŠ‚ç‚¹ä¸º<strong>Gaussç‚¹</strong>ã€‚</dd></dl><p class='p blue'>Theorem</p><p>è‹¥æœ‰æ’å€¼å‹æ±‚ç§¯å…¬å¼ <span class="math inline">\(I_n(f)\)</span>ï¼Œ<spanclass="math inline">\(I_n(f)\)</span>æ˜¯Gaussæ±‚ç§¯å…¬å¼ å½“ä¸”ä»…å½“ <spanclass="math inline">\(W_{n+1}(x)\)</span> å’Œè®©ä»»ä½•ä¸€ä¸ªæ¬¡æ•°ä¸è¶…è¿‡ <spanclass="math inline">\(n\)</span> çš„å¤šé¡¹å¼æ­£äº¤ã€‚</p><h3 id="æ­£äº¤å¤šé¡¹å¼">æ­£äº¤å¤šé¡¹å¼</h3><dl><dt>æ­£äº¤å¤šé¡¹å¼åºåˆ—</dt><dd>è®¾ <span class="math inline">\(g_n(x) = a_{n,0} x^n +a_{n,1}x^{n-1}+\cdots + a_{n,n}\)</span> å¯¹äºä»»æ„ <spanclass="math inline">\(i,j\)</span> æœ‰ <span class="math inline">\((g_i,g_j)=0\)</span> åˆ™ç§° <span class="math inline">\(\{g_ k(x)\}_{k=0}^\infty\)</span> æ˜¯<spanclass="math inline">\([a,b]\)</span>ä¸Šçš„<strong>æ­£äº¤å¤šé¡¹å¼åºåˆ—</strong>ã€‚</dd></dl><p class='p blue'>Theorem</p><p>æ­£äº¤å¤šé¡¹å¼åºåˆ—æ˜¯çº¿æ€§æ— å…³çš„</p><p class='p blue'>Theorem</p><p>æ­£äº¤å¤šé¡¹å¼åºåˆ—ä¸­<span class="math inline">\(g_n(x)\)</span>åœ¨<spanclass="math inline">\([a,b]\)</span>ä¸Šæœ‰<spanclass="math inline">\(n\)</span>ä¸ªé›¶ç‚¹</p><dl><dt>næ¬¡Legendreå¤šé¡¹å¼</dt><dd>ç§°</dd></dl><p><span class="math display">\[P_n(t) = \frac 1 {2^nn!} \frac{\mathrm d^n(t^2-1)^n}{\mathrm dt^n},\quadn = 0,1,2,\cdots\]</span></p><p>ä¸ºLegendreå¤šé¡¹å¼</p><p class='p blue'>Theorem Lerandreå¤šé¡¹å¼</p><p><span class="math inline">\(\{P_k(t)\}\)</span> åœ¨ <spanclass="math inline">\([-1,1]\)</span> ä¸Šæ­£äº¤ã€‚</p><h3 id="åŒºé—´--1-1-ä¸Šçš„gausså…¬å¼">åŒºé—´ [-1, 1] ä¸Šçš„Gausså…¬å¼</h3><p><span class="math inline">\(n+1\)</span> æ¬¡Legendreå¤šé¡¹å¼çš„é›¶ç‚¹å°±æ˜¯Gausså…¬å¼çš„èŠ‚ç‚¹ï¼Œæ±‚ç§¯ç³»æ•°ä¸ºï¼š</p><p><span class="math display">\[\tilde A_k = \int _{-1} ^1 \prod_{j=0,j\ne k} ^n\frac{t-t_j}{t_k-t_j}\mathrm dt\]</span></p><h3 id="åŒºé—´-a-b-ä¸Šçš„gausså…¬å¼">åŒºé—´ [a, b] ä¸Šçš„Gausså…¬å¼</h3><p>è½¬åŒ–ä¸º <span class="math inline">\([-1,1]\)</span>çš„Gausså…¬å¼æ±‚è§£ã€‚</p><h3 id="gauss-å…¬å¼çš„æˆªæ–­è¯¯å·®">Gauss å…¬å¼çš„æˆªæ–­è¯¯å·®</h3><p>æˆªæ–­è¯¯å·®ä¸ºï¼š</p><p><span class="math display">\[R(f) = \frac{f^{(2n+2)}(\xi)}{(2n+2)!}\int_a^b W_{n+1}^2(x)\mathrm dx\]</span></p><h3 id="gauss-å…¬å¼çš„ç¨³å®šæ€§å’Œæ”¶æ•›æ€§">Gauss å…¬å¼çš„ç¨³å®šæ€§å’Œæ”¶æ•›æ€§</h3><p class='p blue'>Theorem</p><p>Gausså…¬å¼çš„æ±‚ç§¯ç³»æ•°éƒ½æ˜¯æ­£çš„</p><dl><dt>æ±‚ç§¯å…¬å¼çš„ç¨³å®šæ€§</dt><dd>è‹¥å¯¹äºä»»æ„ <span class="math inline">\(\varepsilon&gt;0\)</span> å­˜åœ¨<span class="math inline">\(\delta &gt; 0\)</span> å½“ <spanclass="math inline">\(\max_{0\le k \le n}|f(x_k) - \tilde f_k| &lt;\delta\)</span> æ—¶ï¼Œ æœ‰<span class="math inline">\(|I_n(f) -I_n(\tilde{f})|&lt;\varepsilon\)</span> åˆ™è¯¥å…¬å¼æ˜¯ç¨³å®šçš„ã€‚</dd></dl><p class='p blue'>Theorem</p><p>Gausså…¬å¼æ˜¯ç¨³å®šçš„</p><dl><dt>æ±‚ç§¯å…¬å¼çš„æ”¶æ•›æ€§</dt><dd>è‹¥å¯¹äºä»»æ„ <span class="math inline">\(\varepsilon&gt;0\)</span>å­˜åœ¨<span class="math inline">\(N\)</span>ï¼Œå½“<spanclass="math inline">\(n&gt;N\)</span>æ—¶ï¼Œæœ‰<spanclass="math inline">\(|I(f) -I_n(f)|&lt;\varepsilon\)</span>åˆ™ç§°è¯¥æ±‚ç§¯å…¬å¼æ”¶æ•›ã€‚</dd></dl><p class='p blue'>Theorem Gausså…¬å¼çš„æ”¶æ•›æ€§</p><p>è‹¥ <span class="math inline">\(f\in C[a,b]\)</span> åˆ™Gausså…¬å¼æ”¶æ•›ã€‚</p></div>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ•°å€¼åˆ†æ ch 5 - æ•°å€¼ç§¯åˆ†å’Œæ•°å€¼å¾®åˆ†&lt;/p&gt;</summary>
    
    
    
    <category term="æ•°å­¦" scheme="http://adversarr.github.io/categories/%E6%95%B0%E5%AD%A6/"/>
    
    
    <category term="æ•°å€¼åˆ†æ" scheme="http://adversarr.github.io/tags/%E6%95%B0%E5%80%BC%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>æ•°å€¼åˆ†æ-å¤šé¡¹å¼æ’å€¼å’Œå‡½æ•°æœ€ä½³é€¼è¿‘</title>
    <link href="http://adversarr.github.io/2022/09/30/study/Math/NumericRecipies/Chapter%204%20%E5%A4%9A%E9%A1%B9%E5%BC%8F%E6%8F%92%E5%80%BC%E5%92%8C%E5%87%BD%E6%95%B0%E6%9C%80%E4%BD%B3%E9%80%BC%E8%BF%91/"/>
    <id>http://adversarr.github.io/2022/09/30/study/Math/NumericRecipies/Chapter%204%20%E5%A4%9A%E9%A1%B9%E5%BC%8F%E6%8F%92%E5%80%BC%E5%92%8C%E5%87%BD%E6%95%B0%E6%9C%80%E4%BD%B3%E9%80%BC%E8%BF%91/</id>
    <published>2022-09-30T01:16:33.353Z</published>
    <updated>2022-09-30T01:16:33.353Z</updated>
    
    <content type="html"><![CDATA[<p>æ•°å€¼åˆ†æ ch 4 å¤šé¡¹å¼æ’å€¼å’Œå‡½æ•°æœ€ä½³é€¼è¿‘</p><span id="more"></span><h1 id="chapter-4-å¤šé¡¹å¼æ’å€¼å’Œå‡½æ•°æœ€ä½³é€¼è¿‘">Chapter 4å¤šé¡¹å¼æ’å€¼å’Œå‡½æ•°æœ€ä½³é€¼è¿‘</h1><ol type="1"><li>ç»™å®šä¸€ä¸ªå‡½æ•°ï¼š <spanclass="math inline">\(f(x)\in[a,b]\)</span></li></ol><p>åœ¨ç¦»æ•£ç‚¹å¤„çš„å€¼ï¼Œèƒ½å¦ç»™å‡ºä¸€ä¸ªè¿‘ä¼¼ï¼Ÿ</p><div class="story post-story"><h2 id="å‡½æ•°è¿‘ä¼¼å’Œå‡½æ•°é€¼è¿‘">å‡½æ•°è¿‘ä¼¼å’Œå‡½æ•°é€¼è¿‘</h2><h3 id="å‡½æ•°è¿‘ä¼¼è¡¨ç¤ºå¯èƒ½æ€§">å‡½æ•°è¿‘ä¼¼è¡¨ç¤ºï¼šå¯èƒ½æ€§</h3><p><strong>Def</strong>ï¼ˆæ’å€¼å‡½æ•°ï¼‰è®¾å‡½æ•° <spanclass="math inline">\(y=f(x)\)</span>åœ¨åŒºé—´<spanclass="math inline">\([a,b]\)</span>ä¸Šæœ‰å®šä¹‰ï¼Œä¸”å·²çŸ¥åœ¨<spanclass="math inline">\(a\le x_0&lt;\cdots&lt;x_n\leb\)</span>ä¸Šçš„å€¼ï¼Œè‹¥å­˜åœ¨ä¸€ä¸ªç®€å•å‡½æ•°<spanclass="math inline">\(P(x)\)</span>ä½¿</p><p><span class="math display">\[P(x_i)=f(x_i)\quad (i=0,1,\dots,n)\]</span></p><p>æˆç«‹ï¼Œåˆ™ç§°<span class="math inline">\(P(x)\)</span>ä¸º<spanclass="math inline">\(f(x)\)</span>çš„<strong>æ’å€¼å‡½æ•°</strong>ï¼Œä¸Šå¼ç§°ä¸º<strong>æ’å€¼æ¡ä»¶</strong>ï¼Œç‚¹<spanclass="math inline">\(x_0,x_1,\dots,x_n\)</span>ç§°ä¸ºæ’å€¼èŠ‚ç‚¹ï¼Œ<spanclass="math inline">\([a,b]\)</span>ç§°ä¸º<strong>æ’å€¼åŒºé—´</strong>ã€‚æ±‚<spanclass="math inline">\(P(x)\)</span>çš„æ–¹æ³•ç§°ä¸ºå·®å€¼æ³•ã€‚</p><p><strong>Thm</strong>ï¼ˆå­˜åœ¨næ¬¡å¤šé¡¹å¼æ’å€¼ï¼‰æ»¡è¶³æ’å€¼æ¡ä»¶çš„næ¬¡å¤šé¡¹å¼<spanclass="math inline">\(p_n(x)\)</span>å­˜åœ¨ä¸”å”¯ä¸€ã€‚</p><blockquote><p>å­˜åœ¨æ€§ï¼šå¯ä»¥æ„é€ å‡ºLagrangeè¡¨ç¤º å”¯ä¸€æ€§ï¼šä»£æ•°åŸºæœ¬å®šç†</p></blockquote><p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å­˜åœ¨æ€§ï¼š</span><br><span class="line"><span class="bullet">-</span> æ„é€ èŒƒå¾·è’™çŸ©é˜µ</span><br><span class="line"><span class="bullet">-</span> èŒƒå¾·è’™çŸ©é˜µçš„è¡Œåˆ—å¼ |X| â‰  0</span><br></pre></td></tr></table></figure></p><p>èŒƒå¾·è’™è¡Œåˆ—å¼ï¼š</p><p><span class="math display">\[|X| = \prod_{0\le i&lt;j\le n} (x_i-x_j)\]</span></p><h3 id="åŸºæœ¬æ’å€¼å¤šé¡¹å¼">åŸºæœ¬æ’å€¼<strong>å¤šé¡¹å¼</strong></h3><p>æ±‚næ¬¡å¤šé¡¹<span class="math inline">\(l_k(x)\)</span>æ»¡è¶³ï¼š</p><p><span class="math display">\[l_k(x_j)= \mathbb 1_{j=k}\]</span></p><p>ç”±æ¡ä»¶4çŸ¥é“<spanclass="math inline">\(x_0,x_1...,x_{k-1},x_{k+1},...,x_n\)</span>æ˜¯<spanclass="math inline">\(l_k(x)\)</span>çš„é›¶ç‚¹ã€‚æ‰€ä»¥<spanclass="math inline">\(l_k(x)\)</span>æœ‰nä¸ªå› å­ï¼š<spanclass="math inline">\(x-x_0,...x-x_{k-1},...,x_{k+1},...,x-x_n\)</span>ï¼Œæ‰€ä»¥</p><p><span class="math display">\[l_k=A_k \prod _{i\ne k} (x-x_i)\]</span></p><p>å…¶ä¸­ï¼š</p><p><span class="math display">\[A_k=\cfrac{1}{\prod_{i\ne k}(x_i-x_k)}\]</span></p><p>åˆ™<span class="math inline">\(l_k(x)\)</span>ç§°ä¸ºnæ¬¡ï¼ˆç¬¬<spanclass="math inline">\(k\)</span>ä¸ªï¼‰<strong>åŸºæœ¬æ’å€¼å¤šé¡¹å¼</strong>ï¼ˆä¹Ÿå°±æ˜¯<strong>Lagrangeæ’å€¼åŸºå‡½æ•°</strong>ï¼‰</p><h3 id="lagrangeæ’å€¼å¤šé¡¹å¼">Lagrangeæ’å€¼å¤šé¡¹å¼</h3><p><strong>Thm</strong>ï¼šè®¾<span class="math inline">\(x_0, x_1,\cdots,x_n\)</span>æ˜¯äº’å¼‚èŠ‚ç‚¹ï¼Œåˆ™å­˜åœ¨å”¯ä¸€çš„æ¬¡æ•°ä¸è¶…è¿‡<spanclass="math inline">\(n\)</span>æ¬¡çš„å¤šé¡¹å¼<spanclass="math inline">\(L_n(x)\)</span>ï¼Œä½¿å¾—<spanclass="math inline">\(L_n(x_i)=f(x_i)\)</span></p><p>ç”¨Lagrangeï¼ˆé€‰æ‹©<spanclass="math inline">\(l_k(x)\)</span>ä¸ºåŸºå‡½æ•°ï¼‰ï¼Œç»„åˆåçš„ç³»æ•°å³ä¸º<spanclass="math inline">\(f(x_i)\)</span>ï¼š</p><p><span class="math display">\[L_n(x)=\sum_{k=0}^nf(x_k)l_k(x)=\sum _{k=0} ^ nf(x_k)\prod_{i\nek,i=0}\frac{x-x_i}{x_k-x_i}\]</span></p><p>ç§°ä¸º<strong>næ¬¡Lagrangeæ’å€¼å¤šé¡¹å¼</strong></p><h3 id="æ’å€¼ä½™é¡¹å’Œè¯¯å·®ä¼°è®¡">æ’å€¼ä½™é¡¹å’Œè¯¯å·®ä¼°è®¡</h3><p><strong>Def</strong>ï¼ˆä½™é¡¹ï¼‰<spanclass="math inline">\(R_n(x)=f(x)-L_n(x)\)</span>ä¸ºæ’å€¼å¤šé¡¹å¼çš„<strong>ä½™é¡¹</strong>ï¼ˆä¸€èˆ¬çš„ä¸º<spanclass="math inline">\(R_n(x)=f(x)-p_n(x)\)</span>ï¼‰</p><p><strong>Thm</strong>ï¼šè®¾<spanclass="math inline">\(f(x)\)</span>åœ¨<spanclass="math inline">\((a,b)\)</span>å†…æœ‰<spanclass="math inline">\(f^{(n+1)}(x)\)</span>å­˜åœ¨ï¼Œ<spanclass="math inline">\(L_n(x)\)</span>ä¸ºLagrangeæ’å€¼å¤šé¡¹å¼ï¼Œåˆ™å¯¹äºä»»æ„<spanclass="math inline">\(x\in [a,b]\)</span>ï¼Œ<spanclass="math inline">\(\exists \xi\in (a,b),s.t.R_n(x)=\frac{f^{(n+1)}(\xi)}{(n+1)!}W_{n+1}(x)\)</span>ï¼Œå…¶ä¸­<spanclass="math inline">\(W_{n+1} (x) = \prod_{i=0}^n(x-x_i)\)</span></p><p>æ³¨ï¼š</p><ol type="1"><li><p><span class="math inline">\(\xi\)</span>ä¾èµ–äº<spanclass="math inline">\(x\)</span></p></li><li><p>ä¸€èˆ¬ä¸èƒ½æ±‚å‡ºï¼Œåªèƒ½ä¼°è®¡è¯¯å·®</p></li></ol></div><div class="story post-story"><h2 id="å·®å•†å’Œç‰›é¡¿æ’å€¼">å·®å•†å’Œç‰›é¡¿æ’å€¼</h2><p>Lagrangeæ’å€¼çš„ç¼ºç‚¹ï¼šèŠ‚ç‚¹å¢åŠ æˆ–å‡å°‘æ—¶ï¼Œæ‰€æœ‰æ’å€¼åŸºå‡½æ•°çš„ç³»æ•°éƒ½å¯èƒ½å˜åŒ–ï¼ˆè®¡ç®—ä¸å˜ï¼‰</p><p>è®¾<span class="math inline">\(L_{k}(x)\)</span>æ—¶ä»¥<spanclass="math inline">\(x_0,x_1,...,x_{k}\)</span>ä¸ºæ’å€¼èŠ‚ç‚¹çš„å¤šé¡¹å¼ï¼Œè€ƒå¯Ÿ<spanclass="math inline">\(L_k\)</span>å’Œ<spanclass="math inline">\(L_{k-1}\)</span>çš„å…³ç³»ï¼š</p><p><span class="math display">\[let\quad g(x)=L_k(x) - L_{k-1} (x)\]</span></p><p>ä»è€Œï¼š<span class="math inline">\(g\)</span>æ—¶ä¸€ä¸ªæ¬¡æ•°ä¸è¶…è¿‡<spanclass="math inline">\(k\)</span>çš„å¤šé¡¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<spanclass="math inline">\(L\)</span>å¯ä»¥å†™æˆ</p><p><span class="math display">\[L_k(x) = a_0+a_1(x-x_0) + \cdots + a_k(x-x_0)(x-x_1)\cdots(x-x_{k-1})\]</span></p><p>æ±‚å‡º <span class="math inline">\(a_k\)</span>ï¼š</p><p><span class="math display">\[a_k = \sum_{m=0}^k\frac{f(x_m)}{\prod\limits_{i\ne m,i=0}^k(x-x_i)}\]</span></p><h3 id="å·®å•†å’Œnewtonæ’å€¼å…¬å¼">å·®å•†å’ŒNewtonæ’å€¼å…¬å¼</h3><p><strong>Def</strong>ï¼šè®¾å·²çŸ¥å‡½æ•°<spanclass="math inline">\(f(x)\)</span>åœ¨<spanclass="math inline">\(n+1\)</span>ä¸ªäº’å¼‚èŠ‚ç‚¹ä¸Šçš„å€¼ä¸º<spanclass="math inline">\(f(x_0),...,f(x_n)\)</span>ç§°ï¼š</p><p><span class="math display">\[f[x_i,x_j] =\frac{f(x_j)-f(x_i)}{x_j-x_i}\]</span></p><p>ä¸ºèŠ‚ç‚¹<spanclass="math inline">\(x_i,x_j\)</span>çš„ä¸€é˜¶å·®å•†ï¼Œå…¶ä¸€é˜¶å·®å•†çš„å·®å•†ï¼š</p><p><span class="math display">\[f[x_i,x_j,x_k]=\frac{f[x_j,x_k] - f[x_i,x_j]}{x_k-x_i}\]</span></p><p>ä¸ºäºŒé˜¶å·®å•†ï¼Œä»¥æ­¤ç±»æ¨ã€‚çº¦å®šé›¶é˜¶å·®å•†ä¸ºå‡½æ•°å€¼ã€‚</p><p><strong>Thm</strong>ï¼šké˜¶å·®å•†å¯ä»¥è¡¨ç¤ºæˆ<spanclass="math inline">\(f(x_0),f(x_1),...,f(x_k)\)</span>çš„çº¿æ€§ç»„åˆã€‚</p><p><span class="math display">\[f[x_0,x_1,\cdots,x_k] = \sum_{m=0}^k \frac{f(x_m)}{\prod_{i=0,i\nem}^k(x_m-x_i)} =a_k\]</span></p><p>åˆ™ï¼š</p><p><span class="math display">\[L_n(x) = f(x_0) + f[x_0,x_1](x-x_0) +...+f[x_0,x_1,...,x_n](x-x_0)(x-x_1)...(x-x_{n-1})\]</span></p><p><strong>Thm</strong>ï¼šké˜¶å·®å•†ä¸èŠ‚ç‚¹çš„æ¬¡åºæ— å…³ã€‚</p><p><strong>Thm</strong>ï¼šké˜¶å·®å•†å’Œké˜¶å¯¼æ•°æœ‰å¦‚ä¸‹å…³ç³»<spanclass="math inline">\(f[x_0,...,x_k]=\frac{f^{(k)}(\eta)}{k!}\quad \eta\in (\min\{x_0,...,x_k\}, \max\{x_0,...,x_k\} )\)</span></p><h3id="å·®åˆ†å’Œç­‰è·èŠ‚ç‚¹çš„newtonæ’å€¼å¤šé¡¹å¼">å·®åˆ†å’Œç­‰è·èŠ‚ç‚¹çš„Newtonæ’å€¼å¤šé¡¹å¼</h3><p><strong>Def</strong>ï¼šè‹¥å·²çŸ¥å‡½æ•°<spanclass="math inline">\(f(x)\)</span>åœ¨ç­‰è·èŠ‚ç‚¹<spanclass="math inline">\(x_i\)</span>ä¸Šçš„å‡½æ•°å€¼ä¸º<spanclass="math inline">\(f(x_i) = f_i(i = 0, 1, ...,n)\)</span>åˆ™ç§° <spanclass="math inline">\(f_{i+1} - f_i\)</span>ä¸º<spanclass="math inline">\(f(x)\)</span>åœ¨<spanclass="math inline">\(x_i\)</span>å¤„ä»¥<spanclass="math inline">\(h\)</span>ä¸ºæ­¥é•¿çš„1é˜¶<strong>å‘å‰</strong>å·®åˆ†<spanclass="math inline">\(\Delta f_i\)</span>ã€‚<spanclass="math inline">\(\Delta^k f_i = \Delta^{k-1} f_{i+1} -\Delta^{k-1}f_{i}\)</span>ä¸ºké˜¶å·®åˆ†ã€‚</p><p>å¯ä»¥è¯æ˜ï¼Œå·®åˆ†å’Œå·®å•†æœ‰å¦‚ä¸‹å…³ç³» ï¼š</p><p><span class="math display">\[f[x_i,x_{i+1},\cdots,x_{i+k}]=\frac{\Delta^k f_i}{k!h^k}\]</span></p><p>ä»è€Œå¯ä»¥å¾—åˆ°Newtonæ’å€¼å¤šé¡¹å¼ï¼š</p>$$<span class="math display">\[\begin{aligned}N_n(x)&amp;=\sum_{k=0}^n f[x_0, x_1,\cdots,x_k]\prod_{j=0}^{k-1}(x-x_j)\\N_n(x_0+th)&amp;=\sum_{k=0}^n \frac{\Delta^kf_0}{k!} \prod_{j=0}^{k-1}(t-j)\end{aligned}\]</span><p>$$</p><p>ç¬¬äºŒä¸ªå¼å­ç§°ä¸ºnæ¬¡Newtonå‰æ’å…¬å¼ã€‚</p></div><div class="story post-story"><h2 id="é«˜æ¬¡æ’å€¼çš„ç¼ºç‚¹åˆ†æ®µä½æ¬¡æ’å€¼">é«˜æ¬¡æ’å€¼çš„ç¼ºç‚¹ã€åˆ†æ®µä½æ¬¡æ’å€¼</h2><h3 id="åŸƒå°”ç±³ç‰¹æ’å€¼hermite">åŸƒå°”ç±³ç‰¹æ’å€¼(Hermite)</h3><p><strong>Def</strong>ï¼šç»™å®š<spanclass="math inline">\([a,b]\)</span>ä¸­çš„<spanclass="math inline">\(n+1\)</span>ä¸ªäº’å¼‚çš„èŠ‚ç‚¹åŠå…¶å‡½æ•°å€¼å’Œç›´åˆ°<spanclass="math inline">\(m_i\)</span>é˜¶å¯¼æ•°<spanclass="math inline">\(f(x_i),f&#39;(x_i),...,f^{(m_i)}(x_i)\)</span>ï¼Œä»¤<spanclass="math inline">\(m=\sum_{i=0}^n(m_i+1)-1\)</span>è‹¥å­˜åœ¨ä¸€ä¸ªæ¬¡æ•°ä¸è¶…è¿‡<spanclass="math inline">\(m\)</span>æ¬¡çš„å¤šé¡¹å¼<spanclass="math inline">\(H_m(x)\)</span>ï¼Œæ»¡è¶³æ‰€æœ‰æ¡ä»¶ï¼Œåˆ™ç§°<spanclass="math inline">\(H_m(x)\)</span>ä¸º<spanclass="math inline">\(f(x)\)</span>çš„<spanclass="math inline">\(m\)</span>æ¬¡Hermiteæ’å€¼å¤šé¡¹å¼ã€‚</p><p><strong>Thm</strong>ï¼šæ»¡è¶³è¯¥æ’å€¼æ¡ä»¶çš„<spanclass="math inline">\(m\)</span>æ¬¡å¤šé¡¹å¼<spanclass="math inline">\(H_m(x)\)</span>æ˜¯å­˜åœ¨ä¸”å”¯ä¸€çš„ã€‚</p><p><strong>Thm</strong>ï¼šè®¾<spanclass="math inline">\(H_m(x)\)</span>æ˜¯æ»¡è¶³æ¡ä»¶çš„mæ¬¡æ’å€¼å¤šé¡¹å¼ï¼Œ<spanclass="math inline">\(f(x)\)</span>åœ¨åŒ…å«<spanclass="math inline">\(n+1\)</span>ä¸ªäº’å¼‚èŠ‚ç‚¹<spanclass="math inline">\(x_0,x_1,\dots,x_n\)</span>çš„åŒºé—´<spanclass="math inline">\([a,b]\)</span>ä¸Šæœ‰mé˜¶è¿ç»­å¯¼æ•°ï¼Œä¸”åœ¨<spanclass="math inline">\((a,b)\)</span>ä¸Šæœ‰<spanclass="math inline">\(m+1\)</span>é˜¶å¯¼æ•°ï¼Œåˆ™å¯¹äºå…¶ä¸­æ¯ä¸€ä¸ªç‚¹ï¼Œä¸€å®šå­˜åœ¨<spanclass="math inline">\(\xi\)</span>ä½¿å¾—ï¼š</p><p><span class="math display">\[R_m(x) = \frac{f^{(m+1)}(\xi)}{(m+1)!}\prod _{i=0}^n (x-x_i)^{m_i+1}\]</span></p><p><strong>Thm</strong>ï¼šï¼ˆHermite-Gennochiï¼‰è‹¥ <spanclass="math inline">\(f\in C^n[a,b],x_i\in [a,b],i = 0, 1,...,n\)</span>ä¸”äº’å¼‚ï¼Œåˆ™ï¼š</p><p><span class="math display">\[f[x_0,\dots,x_n]=\int\mathop\cdots\limits_{\tau_n}\int f^{(n)}(t_0x_0+t_1x_1+\cdots + t_nx_n)\mathrm dt_1\cdots\mathrm dt_n\]</span></p><p>å…¶ä¸­ <span class="math inline">\(\\tau _ n = \left\{ { (t _ 1,\dots,t_ n) |t_i\ge 0, \sum t _ i \le 1 }\right\}\)</span>ä¸ºnç»´å•çº¯å½¢ï¼Œè€Œ<spanclass="math inline">\(t _ 0 = 1- \sum_{i=1} ^n t _ i\)</span> .</p><p>æ‰©å±•å·®å•†çš„å®šä¹‰ï¼ˆ<strong>é‡èŠ‚ç‚¹æ’å€¼</strong>ï¼‰ï¼š</p><p><span class="math display">\[f[x_0,x_0] = \lim _{x\rightarrow x_0} f[x_0, x] =f&#39;(x_0)\\f[x_0,...,x_0] = \frac{f^{(k)}(x_0) }{k!}\]</span></p><p>ä»è€Œï¼š</p><p><span class="math display">\[\begin{aligned}H_m(x) = &amp;f(x_0) + f[x_0,x_0](x-x0) + \cdots + f[x_0,\cdots,x_0](x-x_0)^{m_0}\\&amp;+f[x_0,\cdots,x_0,x_1] (x-x_0)^{m_0+1} + \cdots +\\&amp;f[x_0,\cdots, x_0, x_1\cdots x_1](x-x_0)^{m_0+1}(x-x_1)^{m_1}+\cdots\\&amp;+f[x_0,\cdots,x_n](x-x_0)^{m_0+1}\cdots(x-x_{n-1})^{m_{n-1}+1}(x-x_n)^{m_n}\end{aligned}\]</span></p><p>æ’å€¼ä½™é¡¹ä¸ºï¼š</p><p><span class="math display">\[f(x)-H_m(x)=\frac{f^{(m+1)}(\xi)}{(m+1)!}\prod_{i=0}^n(x-x_i)^{m_i+1}\]</span></p></div><div class="story post-story"><h2 id="é«˜æ¬¡æ’å€¼çš„ç¼ºç‚¹å’Œåˆ†æ®µçº¿æ€§æ’å€¼">é«˜æ¬¡æ’å€¼çš„ç¼ºç‚¹å’Œåˆ†æ®µçº¿æ€§æ’å€¼</h2><p>å¸¸è§çš„é—®é¢˜ï¼šä¸ªæ•°å¤šâ†’è¯¯å·®å¤§</p><blockquote><p>åœ¨<ahref="https://www.wanweibaike.com/wiki-æ•°å€¼åˆ†æ">æ•°å€¼åˆ†æ</a>é¢†åŸŸä¸­ï¼Œ<strong>é¾™æ ¼ç°è±¡</strong>æ˜¯åœ¨ä¸€ç»„ç­‰é—´æ’å€¼ç‚¹ä¸Šä½¿ç”¨å…·æœ‰é«˜æ¬¡å¤šé¡¹å¼çš„å¤šé¡¹å¼æ’å€¼æ—¶å‡ºç°çš„åŒºé—´è¾¹ç¼˜å¤„çš„æŒ¯è¡é—®é¢˜ã€‚å®ƒæ˜¯ç”±<ahref="https://www.wanweibaike.com/wiki-å¡çˆ¾Â·é¾æ ¼">å¡å°”Â·é¾™æ ¼</a>ï¼ˆRungeï¼‰åœ¨æ¢ç´¢ä½¿ç”¨å¤šé¡¹å¼æ’å€¼é€¼è¿‘æŸäº›å‡½æ•°æ—¶çš„é”™è¯¯è¡Œä¸ºæ—¶å‘ç°çš„ã€‚<ahref="https://www.wanweibaike.com/wiki-é¾™æ ¼ç°è±¡#cite_note-1">[1]</a>è¿™ä¸€å‘ç°éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒè¡¨æ˜ä½¿ç”¨é«˜æ¬¡å¤šé¡¹å¼æ’å€¼å¹¶ä¸æ€»èƒ½æé«˜å‡†ç¡®æ€§ã€‚è¯¥ç°è±¡ä¸å‚…é‡Œå¶çº§æ•°è¿‘ä¼¼ä¸­çš„å‰å¸ƒæ–¯ç°è±¡ç›¸ä¼¼ã€‚â€”â€”Wikipedia</p></blockquote><h3 id="åˆ†æ®µçº¿æ€§æ’å€¼">åˆ†æ®µçº¿æ€§æ’å€¼</h3><blockquote><p>åœ¨<ahref="https://www.wanweibaike.com/wiki-æ•°å€¼åˆ†æ">æ•°å€¼åˆ†æ</a>è¿™ä¸ªæ•°å­¦åˆ†æ”¯ä¸­ï¼Œ<strong>æ ·æ¡æ’å€¼</strong>æ˜¯ä½¿ç”¨ä¸€ç§åä¸º<ahref="https://www.wanweibaike.com/wiki-æ ·æ¡">æ ·æ¡</a>çš„ç‰¹æ®Š<ahref="https://www.wanweibaike.com/wiki-åˆ†æ®µ">åˆ†æ®µ</a><ahref="https://www.wanweibaike.com/wiki-å¤šé¡¹å¼">å¤šé¡¹å¼</a>è¿›è¡Œæ’å€¼çš„å½¢å¼ã€‚</p></blockquote><p>åœ¨<a href="https://www.wanweibaike.com/wiki-æ•°å­¦">æ•°å­¦</a>å­¦ç§‘<ahref="https://www.wanweibaike.com/wiki-æ•°å€¼åˆ†æ">æ•°å€¼åˆ†æ</a>ä¸­ï¼Œ<strong>æ ·æ¡</strong>ï¼ˆSplineï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„<ahref="https://www.wanweibaike.com/wiki-å‡½æ•°">å‡½æ•°</a>ï¼Œç”±<ahref="https://www.wanweibaike.com/wiki-å¤šé¡¹å¼">å¤šé¡¹å¼</a>åˆ†æ®µå®šä¹‰ã€‚</p><p>è‹¥ç»™å‡º<spanclass="math inline">\(f(x)\)</span>åœ¨n+1ä¸ªèŠ‚ç‚¹ä¸Šçš„æ•°æ®è¡¨ï¼Œåˆ™çº¿æ€§æ’å€¼ï¼š</p><p><span class="math display">\[L_{1,i} (x) = f(x_i) + f[x_i, x_{i+1}](x-x_i)\\\tilde L_1(x) = \begin{cases}L_{1,0}(x),&amp;x\in[x_0,x_1)\\L_{1,1}(x),&amp;x\in[x_1,x_2)\\\vdots\\L_{1,n-1}(x),&amp;x\in [x_{n-1},x_n]\end{cases}\]</span></p><p>å…¶æ’å€¼è¯¯å·®ä¸ºï¼š</p><p><span class="math display">\[\max_{a\le x\le b}|f(x) - \tilde L_1(x)| \le \frac 1 8 h^2 \max_{a\lex\le b}|f&#39;&#39;(x)|\]</span></p><p>â†’äº§ç”Ÿäº†<strong>å°–ç‚¹</strong>ï¼ˆä¸å…‰æ»‘ï¼‰</p><p>éœ€è¦çš„ï¼š</p><ol type="1"><li><p>å°åŒºé—´ä¸Šæ˜¯å¤šé¡¹å¼</p></li><li><p>ä¸¤ä¸ªç›¸é‚»åŒºé—´å†…å…‰æ»‘è¿æ¥</p></li></ol><p>â†’ ä¸‰æ¬¡æ ·æ¡æ’å€¼</p></div><div class="story post-story"><h2 id="ä¸‰æ¬¡æ ·æ¡æ’å€¼">ä¸‰æ¬¡æ ·æ¡æ’å€¼</h2><p><strong>Def</strong>ï¼šè®¾åœ¨åŒºé—´<spanclass="math inline">\([a,b]\)</span>ä¸Šçš„n+1ä¸ªæ’å€¼èŠ‚ç‚¹</p><p><span class="math display">\[a=x_0&lt;x_1&lt;\cdots&lt;x_n=b\]</span></p><p>åŠå…¶å‡½æ•°åœ¨èŠ‚ç‚¹ä¸Šçš„å€¼<spanclass="math inline">\(y_i\)</span>ï¼Œè‹¥å­˜åœ¨å‡½æ•°<spanclass="math inline">\(S(x)\)</span>æ»¡è¶³ï¼š</p><ol type="1"><li><p><span class="math inline">\(S(x_j)=y_j\)</span></p></li><li><p><spanclass="math inline">\(S(x)\)</span>åœ¨æ¯ä¸ªå°åŒºé—´ä¸Šéƒ½æ˜¯ä¸‰æ¬¡å¤šé¡¹å¼</p></li><li><p><span class="math inline">\(S\in C^2[a,b]\)</span></p></li></ol><p>åˆ™ç§°ä¸ºä¸‰æ¬¡æ ·æ¡æ’å€¼å‡½æ•°</p><p>ç”±äºåœ¨è¾¹ç•Œä¸Šç¼ºå°‘è¾¹ç•Œæ¡ä»¶ï¼Œé€šå¸¸åœ¨ç«¯ç‚¹ä¸Š2ä¸ªé™„åŠ æ¡ä»¶ï¼ˆ<strong>è¾¹ç•Œæ¡ä»¶</strong>ï¼‰ï¼š</p><ol type="1"><li><p>ï¼ˆç¬¬ä¸€å‹ï¼‰å·²çŸ¥ä¸€é˜¶å¯¼æ•°</p></li><li><p>ï¼ˆç¬¬äºŒå‹ï¼‰å·²çŸ¥äºŒé˜¶å¯¼æ•°</p></li><li><p>ï¼ˆç¬¬ä¸‰å‹ï¼‰å‘¨æœŸè¾¹ç•Œæ¡ä»¶</p></li></ol><h3 id="ä¸‰æ¬¡æ ·æ¡æ’å€¼å‡½æ•°çš„æ±‚æ³•">ä¸‰æ¬¡æ ·æ¡æ’å€¼å‡½æ•°çš„æ±‚æ³•</h3><p>ä»äºŒé˜¶å¯¼æ•°å…¥æ‰‹ï¼š</p><p><span class="math display">\[S&#39;&#39;(x_j)=M_j, S&#39;&#39;(x_{j+1})=M_{j+1}\]</span></p><p>ä»¤<span class="math inline">\(h_j = x_{j+1}-x_j\)</span>åˆ™ï¼š</p><p><span class="math display">\[S(x) =y_j+c_j(x-x_j)+\frac 1 2 M_j(x-x_j)^2+ \frac 1 {6h_j}(M_{j+1} -M_j)(x-x_j)^3,x\in [x_j,x_{j+1}]\]</span></p><p>ä»£å…¥ä¸€æ¬¡å¯¼æ•°è¿ç»­ï¼š</p><p><span class="math display">\[S&#39;(x_j)=S&#39;(x_{j+1})\]</span></p><p>åˆ™</p><p><span class="math display">\[\mu_j M_{j-1} +2M_j+\lambda _jM_{j+1}=d_j\\\mu_j = \frac{h_{j-1}}{h_{j-1}+h_j},\quad\lambda_j = 1 - \mu_j,\quadd_j=6f[x_{j-1}, x_j,x_{j+1}]\]</span></p><p>å³å¯æ„é€ å‡ºä¸‰å¯¹è§’çŸ©é˜µï¼Œè‹¥ç»™å‡ºç¬¬ä¸€å‹æ¡ä»¶<span class="math inline">\(d_0= 6f[x_0,x_0,x_1]\)</span>, <span class="math inline">\(d_1 =6f[x_{n-1}, x_n,x_n]\)</span>ï¼š</p><p><span class="math display">\[\left[\begin{matrix}2&amp;1\\\mu_1&amp;2&amp;\lambda_1\\&amp;\mu_2&amp;2&amp;\lambda_2\\&amp;&amp;\ddots&amp;\ddots&amp;\ddots\\&amp;&amp;&amp;\mu_{n-1}&amp; 2&amp; \lambda_{n-1}\\&amp;&amp;&amp;&amp;1 &amp;2\end{matrix}\right]\left[\begin{matrix}M_0\\M_1\\M_2\\\vdots\\M_{n-1}\\M_n\end{matrix}\right] =\left[\begin{matrix}d_0\\d_1\\d_2\\\vdots\\d_{n-1}\\d_n\end{matrix}\right]  \]</span></p><h3 id="ä¸‰æ¬¡æ ·æ¡æ’å€¼å‡½æ•°çš„æ”¶æ•›æ€§">ä¸‰æ¬¡æ ·æ¡æ’å€¼å‡½æ•°çš„æ”¶æ•›æ€§</h3><p><strong>Thm</strong>ï¼šè®¾è¢«æ’å€¼å‡½æ•°å››é˜¶è¿ç»­ï¼Œåˆ™åœ¨æ’å€¼åŒºé—´ä¸Šæœ‰</p><p><span class="math display">\[||f^{(k)}-S^{(k)}||_\infty \le c_kh^{4-k}||f^{(4)}||_\infty,\quad k = 0,1, 2\\h = \max_{0\le j\le n-1}h_j,c_0 = 1/16, c_1=c_2=1/2\]</span></p></div><div class="story post-story"><h2 id="æœ€ä½³ä¸€è‡´é€¼è¿‘">æœ€ä½³ä¸€è‡´é€¼è¿‘</h2><h3 id="çº¿æ€§èµ‹èŒƒç©ºé—´">çº¿æ€§èµ‹èŒƒç©ºé—´</h3><p><strong>Def</strong>ï¼ˆçº¿æ€§ç©ºé—´ï¼‰è‹¥<span class="math inline">\(\forallx,y\in X, \lambda x\in R,\lambda x\in X, x+y\in X\)</span>åˆ™ç§°<spanclass="math inline">\(X\)</span>ä¸ºçº¿æ€§ç©ºé—´ã€‚</p><p><strong>Def</strong>ï¼ˆçº¿æ€§èµ‹èŒƒç©ºé—´ï¼‰å¯¹åº”çš„ç©ºé—´ç§°çº¿æ€§èµ‹èŒƒç©ºé—´</p><p><strong>Def</strong>ï¼ˆè·ç¦»ï¼‰<spanclass="math inline">\(X\)</span>æ˜¯çº¿æ€§èµ‹èŒƒç©ºé—´ï¼Œ<spanclass="math inline">\(x,y\in X\)</span>åˆ™ç§°<spanclass="math inline">\(||x-y||\)</span>ä¸º<spanclass="math inline">\(x\)</span><spanclass="math inline">\(y\)</span>ä¹‹é—´çš„è·ç¦»</p><p><strong>Def</strong>ï¼ˆæœ€ä½³é€¼è¿‘å…ƒï¼‰<spanclass="math inline">\(X\)</span>æ˜¯çº¿æ€§èµ‹èŒƒç©ºé—´ï¼Œ<spanclass="math inline">\(M\sube X\)</span>è‹¥å­˜åœ¨<spanclass="math inline">\(\varphi \in M\)</span>ä½¿å¾—<spanclass="math inline">\(\forall \psi\in M\)</span>æœ‰</p><p><span class="math display">\[||f-\varphi||\le ||f-\psi||\]</span></p><p>åˆ™ç§°<span class="math inline">\(\varphi\)</span>æ˜¯<spanclass="math inline">\(f\)</span>åœ¨<spanclass="math inline">\(M\)</span>ä¸­çš„æœ€ä½³é€¼è¿‘å…ƒ</p><h3 id="æœ€ä½³ä¸€è‡´é€¼è¿‘å¤šé¡¹å¼">æœ€ä½³ä¸€è‡´é€¼è¿‘å¤šé¡¹å¼</h3><p><strong>Def</strong>ï¼ˆæœ€ä½³ä¸€è‡´é€¼è¿‘å¤šé¡¹å¼ï¼‰è‹¥<spanclass="math inline">\(\exist p_n\in M_n\)</span>ä½¿å¾—<spanclass="math inline">\(\forall q_n\in M_n\)</span></p><p><span class="math display">\[||f-p_n||_\infty \le ||f-q_n||_\infty\]</span></p><p><strong>Thm</strong>ï¼šnæ¬¡æœ€ä½³ä¸€è‡´é€¼è¿‘å¤šé¡¹å¼æ˜¯å­˜åœ¨ä¸”å”¯ä¸€çš„</p><p><strong>Def</strong>ï¼ˆåå·®ç‚¹ï¼‰<spanclass="math inline">\(|g(x_0)|=||g||_\infty = \max_{a\le x\leb}|g(x)|\)</span>ï¼ˆåˆåˆ†æ­£åå·®ç‚¹ã€è´Ÿåå·®ç‚¹ï¼‰</p><p><strong>å¼•ç†1</strong>ï¼šå¯¹äºæœ€ä½³ä¸€è‡´é€¼è¿‘å¤šé¡¹å¼ï¼Œ<spanclass="math inline">\(f-p_n\)</span>å¿…å­˜åœ¨æ­£è´Ÿè¯¯å·®ç‚¹ã€‚</p><p><strong>Thm</strong>ï¼šè®¾<span class="math inline">\(f\inC[a,b]\)</span>ï¼Œ<spanclass="math inline">\(p_n(x)\)</span>æ˜¯næ¬¡å¤šé¡¹å¼ï¼Œåˆ™<spanclass="math inline">\(p_n(x)\)</span>æ˜¯<spanclass="math inline">\(f(x)\)</span>çš„<spanclass="math inline">\(n\)</span>æ¬¡æœ€ä½³ä¸€è‡´é€¼è¿‘å¤šé¡¹å¼<spanclass="math inline">\(\iff\)</span><spanclass="math inline">\(f(x)-p_n(x)\)</span>åœ¨<spanclass="math inline">\([a,b]\)</span>ä¸Šè‡³å°‘æœ‰n+2ä¸ªäº¤é”™åå·®ç‚¹ã€‚<spanclass="math inline">\(a\le x_0 &lt; x_1 &lt; \cdots &lt; x_{n + 1} \leb\)</span></p><p><span class="math display">\[f(x_i)-p_n(x_i)=(-1)^i\sigma ||f-p_n || _\infty\]</span></p><p><strong>æ¨è®º1</strong>ï¼šè‹¥$f^{(n+1)} <spanclass="math inline">\(åœ¨\)</span>(a,b)<spanclass="math inline">\(ä¸Šå­˜åœ¨ä¸”ä¿å·ï¼Œåˆ™\)</span>f(x)-p_n(x)<spanclass="math inline">\(åœ¨\)</span>[a,b]<spanclass="math inline">\(å†…æ°å¥½æœ‰\)</span>n+2$ä¸ªäº¤é”™åå·®ç‚¹ï¼Œä¸”ä¸¤ç«¯ç‚¹éƒ½æ˜¯åå·®ç‚¹ã€‚</p><p><strong>æ¨è®º2</strong>ï¼š<spanclass="math inline">\(p_n(x)\)</span>æ˜¯<spanclass="math inline">\(f(x)\)</span>çš„æŸä¸€ä¸ªnæ¬¡æ’å€¼å¤šé¡¹å¼</p></div><div class="story post-story"><h2 id="æœ€ä½³å¹³æ–¹é€¼è¿‘">æœ€ä½³å¹³æ–¹é€¼è¿‘</h2><h3 id="å†…ç§¯ç©ºé—´">å†…ç§¯ç©ºé—´</h3><p><strong>Def</strong>ï¼ˆå†…ç§¯ç©ºé—´å’Œå†…ç§¯ï¼‰ï¼šè‹¥<spanclass="math inline">\(X\)</span>æ˜¯ä¸€ä¸ªçº¿æ€§ç©ºé—´ï¼Œè‹¥<spanclass="math inline">\(\forall x,y\)</span>æœ‰å®æ•°ä¸ä¹‹å¯¹åº”<spanclass="math inline">\((x,y)\)</span>ï¼Œä¸”</p><ol type="1"><li><p><span class="math inline">\(\forall x,y \inX,~(x,y)=(y,x)\)</span></p></li><li><p><span class="math inline">\(\forall x,y \in X,\lambda\inR,~(\lambda x,y)=\lambda(x,y)\)</span></p></li><li><p><span class="math inline">\(\forall x,y,z\inX,(x,y+z)=(x,y)+(y,z)\)</span></p></li><li><p><span class="math inline">\(\forall x\in X, (x,x)\ge 0,(x,x)=0\iff x=0\)</span></p></li></ol><p><strong>Def</strong>ï¼ˆæ­£äº¤ï¼‰ï¼š<spanclass="math inline">\((x,y)=0\)</span></p><p><strong>Thm</strong>ï¼šæŸ¯è¥¿-æ–½ç“¦èŒ¨ä¸ç­‰å¼</p><h3 id="æœ€ä½³å¹³æ–¹é€¼è¿‘-1">æœ€ä½³å¹³æ–¹é€¼è¿‘</h3><p>è®¾<span class="math inline">\(X\)</span>æ˜¯å†…ç§¯ç©ºé—´ï¼Œ<spanclass="math inline">\((\cdot,\cdot)\)</span>æ˜¯å†…ç§¯ï¼ŒMæ˜¯Xçš„æœ‰é™ç»´å­ç©ºé—´ï¼Œ<spanclass="math inline">\(\varphi_0,...,\varphi_m\)</span>æ˜¯Mçš„ä¸€ç»„åŸºã€‚æ±‚<spanclass="math inline">\(\varphi\in M\)</span>ä½¿å¾—ï¼š<spanclass="math inline">\(\varphi = \arg\min_{\psi\in M}||f-\psi||\)</span>ï¼Œåˆ™ç§°<spanclass="math inline">\(\varphi\)</span>ä¸º<spanclass="math inline">\(f\)</span>åœ¨<spanclass="math inline">\(M\)</span>ä¸­çš„æœ€ä½³å¹³æ–¹é€¼è¿‘å…ƒ</p><p>è®°ï¼š<span class="math inline">\(\varphi = \sum c_i \varphi_i,\quad\psi = \sum a_i\varphi _i\)</span>ï¼Œé—®é¢˜å˜ä¸ºæ±‚è§£<spanclass="math inline">\(c\)</span></p><p><span class="math display">\[\left[(\varphi_i, \varphi_j)\right][c_0,c_1,...,c_m]^T = [(f, \varphi_0),(f,\varphi_1),...,(f,\varphi_m)]\]</span></p><p>ä¸Šè¿°æ–¹ç¨‹ç»„ç§°ä¸ºæ­£è§„æ–¹ç¨‹ç»„ã€‚</p><p><strong>å¼•ç†</strong>ï¼šæ­£è§„æ–¹ç¨‹ç»„æ˜¯å¯¹ç§°æ­£å®šçš„ã€‚</p><p><strong>Thm</strong>ï¼šæ­£è§„æ–¹ç¨‹ç»„å­˜åœ¨å”¯ä¸€è§£ï¼Œä¸”ä¸º<spanclass="math inline">\(||f-\sum a_i\varphi_i||^2\)</span>çš„æœ€å°ç‚¹ã€‚</p><h3 id="è¶…å®šçº¿æ€§æ–¹ç¨‹ç»„çš„æœ€å°äºŒä¹˜è§£">è¶…å®šçº¿æ€§æ–¹ç¨‹ç»„çš„æœ€å°äºŒä¹˜è§£</h3><p><span class="math display">\[\left[a_{i,j}\right] [x_1,x_2,\dots,x_n]^T = [b_1,b_2,\dots,b_m]^T\]</span></p><p>å…¶ä¸­ï¼š<span class="math inline">\(m&gt;n\)</span></p><p><span class="math display">\[A^TAx=A^Tb\]</span></p></div>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ•°å€¼åˆ†æ ch 4 å¤šé¡¹å¼æ’å€¼å’Œå‡½æ•°æœ€ä½³é€¼è¿‘&lt;/p&gt;</summary>
    
    
    
    <category term="æ•°å­¦" scheme="http://adversarr.github.io/categories/%E6%95%B0%E5%AD%A6/"/>
    
    
    <category term="æ•°å€¼åˆ†æ" scheme="http://adversarr.github.io/tags/%E6%95%B0%E5%80%BC%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>æ•°å€¼åˆ†æ-å¸¸å¾®åˆ†æ–¹ç¨‹çš„æ•°å€¼è§£</title>
    <link href="http://adversarr.github.io/2022/09/30/study/Math/NumericRecipies/Chapter%206%20%E5%B8%B8%E5%BE%AE%E5%88%86%E6%96%B9%E7%A8%8B%E6%95%B0%E5%80%BC%E8%A7%A3/"/>
    <id>http://adversarr.github.io/2022/09/30/study/Math/NumericRecipies/Chapter%206%20%E5%B8%B8%E5%BE%AE%E5%88%86%E6%96%B9%E7%A8%8B%E6%95%B0%E5%80%BC%E8%A7%A3/</id>
    <published>2022-09-30T01:16:33.353Z</published>
    <updated>2022-09-30T01:16:33.354Z</updated>
    
    <content type="html"><![CDATA[<p>æ•°å€¼åˆ†æ Chapter 6 å¸¸å¾®åˆ†æ–¹ç¨‹çš„æ•°å€¼è§£</p><span id="more"></span><p>ä¸»è¦å†…å®¹ï¼š</p><ol type="1"><li>Eulerå…¬å¼ã€åå‘Eulerå…¬å¼ã€æ¢¯å½¢å…¬å¼ã€æ”¹è¿›çš„Eulerå…¬å¼ã€å±€éƒ¨æˆªæ–­è¯¯å·®å’Œé˜¶æ•°</li><li>R-Kæ–¹æ³•</li><li>å•æ­¥çš„æ”¶æ•›æ€§å’Œç¨³å®šæ€§</li><li>çº¿æ€§å¤šæ­¥æ³•ï¼ˆAdamsæ˜¾å¼ã€éšå¼å…¬å¼ï¼ŒåŸºäºTaylorå±•å¼€çš„çº¿æ€§å¤šæ­¥æ³•çš„æ„é€ ï¼‰</li></ol><p>ä¸»è¦è®¨è®ºä¸€é˜¶å¸¸å¾®åˆ†æ–¹ç¨‹åˆå€¼é—®é¢˜çš„æ•°å€¼è§£ï¼š</p><p><span class="math display">\[\begin{cases}    y&#39; = f(x,y),&amp; a\le x \le b\\    y(a) = \eta.\end{cases}\]</span></p><p>å‡è®¾å…¶å­˜åœ¨å”¯ä¸€è§£ï¼Œä¸”å……åˆ†å…‰æ»‘ï¼Œåœ¨è§£çš„é‚»åŸŸå†… <spanclass="math inline">\(f(x, y)\)</span> å’Œ <spanclass="math inline">\(\displaystyle \frac{\partial f(x,y)}{\partialy}\)</span> è¿ç»­ã€‚</p><p>å°†<span class="math inline">\([a,b]\)</span>ä½œ<spanclass="math inline">\(n\)</span>ç­‰åˆ†ï¼Œä½œ<spanclass="math inline">\(h=(b-a)/n\)</span>å’Œ<spanclass="math inline">\(x_i=a+ih\)</span></p><p>åœ¨è®¡ç®—<span class="math inline">\(y_i\)</span>æ—¶ï¼Œ</p><ol type="1"><li>å¦‚æœåªç”¨åˆ°å‰ä¸€æ­¥çš„å€¼<spanclass="math inline">\(y_{i-1}\)</span>ï¼š<strong>å•æ­¥æ³•</strong></li><li>å¦‚æœç”¨åˆ°å‰<span class="math inline">\(r\)</span>æ­¥çš„å€¼ï¼š<spanclass="math inline">\(r\)</span>æ­¥æ–¹æ³•ã€‚</li></ol><hr /><div class="story post-story"><h2 id="euleræ–¹æ³•">Euleræ–¹æ³•</h2><h3 id="eulerå…¬å¼çš„æ„é€ ">Eulerå…¬å¼çš„æ„é€ </h3><p>å°†ä¸¤è¾¹ç§¯åˆ†ï¼š <span class="math display">\[\int_{x_i}^{x_{i+1}} y&#39;(x) \mathrm dx = \int _{x_i} ^{x_{i+1}} f(x,y(x))\mathrm dx\\\Rightarrow y(x_{i+1}) = y(x_i)+\int _{x_i} ^{x_{i+1}} f(x, y(x))\mathrm dx\]</span> ä»è€Œåº”ç”¨<strong>å·¦çŸ©å½¢å…¬å¼</strong>åšè¿‘ä¼¼ï¼š <spanclass="math display">\[y(x_{i+1}) = y(x_i) +h\cdot f(x_i, y (x _ i)) +R_{i+1}^{(1)}\]</span> å…¶ä¸­ï¼š <span class="math display">\[R_{i+1}^{(1)}=\frac 1 2 y&#39;&#39;(\xi_i) h ^ 2,\quad \xi _i \in (x_i,x_{i+1})\]</span> å¦‚æœå¿½ç•¥<spanclass="math inline">\(R_{i+1}^{(1)}\)</span>å¯ä»¥å¾—åˆ°Eulerå…¬å¼ã€‚</p><dl><dt>Euler å…¬å¼</dt><dd>ç§°ä¸‹å…¬å¼ä¸ºæ±‚è§£åˆå€¼é—®é¢˜çš„Euleræ–¹æ³• <span class="math display">\[\begin{cases}y_0 = \eta \\y_{i+1} = y_{i} + h f(x_i, y_i)\end{cases}\]</span></dd></dl><p>Eulerå…¬å¼åœ¨è®¡ç®—å¼åªç”¨åˆ°äº†å‰ä¸€æ­¥çš„å€¼æ¥è®¡ç®—ï¼Œå¦å¤–ï¼ŒEulerå…¬å¼ç»™å‡ºäº†<spanclass="math inline">\(y_{i+1}\)</span>å’Œ<spanclass="math inline">\(y_i\)</span>çš„æ˜¾å¼ä¾èµ–å…³ç³»ï¼Œç›´æ¥ä»£å…¥å³å¯å¾—åˆ°<spanclass="math inline">\(y_{i+1}\)</span>ã€‚å› è€Œç§°ä¸º<strong>å•æ­¥æ˜¾å¼å…¬å¼</strong></p><dl><dt>å•æ­¥æ˜¾å¼å…¬å¼</dt><dd>ä¸€èˆ¬å½¢å¼ä¸ºï¼Œå…¶ä¸­<spanclass="math inline">\(\varphi(x,y,h)\)</span>ç§°ä¸º<strong>å¢é‡å‡½æ•°</strong><span class="math display">\[\begin{cases}y_{i+1} = y_i + h\varphi(x_i, y_i, h)\\y_0 = \eta\end{cases}\]</span></dd><dt>å•æ­¥æ˜¾å¼å…¬å¼çš„å±€éƒ¨æˆªæ–­è¯¯å·®</dt><dd>ä¸€ä¸ªå•æ­¥æ˜¾ç¤ºå…¬å¼åœ¨<spanclass="math inline">\(x_{i+1}\)</span>å¤„çš„å±€éƒ¨æˆªæ–­è¯¯å·®ä¸º <spanclass="math display">\[R_{i+1} = y(x_{i+1}) - [y(x_i) + h\varphi(x_i,y(x_i), h)]\]</span></dd></dl><h3 id="åé€€eulerå…¬å¼">åé€€Eulerå…¬å¼</h3><dl><dt>å•æ­¥éšå¼å…¬å¼</dt><dd>ä¸€èˆ¬å½¢å¼å¦‚ä¸‹ï¼Œå…¶ä¸­<spanclass="math inline">\(\psi\)</span>ä¸ºå¢é‡å‡½æ•°ï¼Œåé€€Eulerå…¬å¼çš„å¢é‡å‡½æ•°ä¸º<spanclass="math inline">\(\psi(x_i, y_i, y_{i+1}, h)=f(x_i+h,y_{i+1})\)</span> <span class="math display">\[\begin{cases}  y_{i+1} = y_i + h \psi(x_i, y_i, y_{i+1}, h)\\  y_0 = \eta\end{cases}\]</span></dd><dt>å•æ­¥éšå¼å…¬å¼çš„å±€éƒ¨æˆªæ–­è¯¯å·®</dt><dd>åé€€Eulerå…¬å¼çš„å±€éƒ¨æˆªæ–­è¯¯å·®ä¸º</dd></dl><p><span class="math display">\[R_{i+1} = -\frac12 y&#39;&#39;(\xi_i)h^2\]</span></p><h3 id="æ¢¯å½¢å…¬å¼">æ¢¯å½¢å…¬å¼</h3><p>åº”ç”¨æ¢¯å½¢å…¬å¼è¿‘ä¼¼ï¼š</p><p><span class="math display">\[y(x_{i+1})=y(x_i) +\frac h2\left[ f(x_i, y_i) +f(x_{i+1},y_{i+1})\right]+R_{i+1}^{(3)}\]</span></p><p>å…¶ä¸­ï¼š</p><p><span class="math display">\[R_{i+1}^{(3)} = - \frac{1}{12} y&#39;&#39;&#39;(\xi_i) h^3\]</span></p><h3id="é¢„æµ‹æ ¡æ­£ç³»ç»Ÿå’Œæ”¹è¿›çš„eulerå…¬å¼">é¢„æµ‹æ ¡æ­£ç³»ç»Ÿå’Œæ”¹è¿›çš„Eulerå…¬å¼</h3><dl><dt>é¢„æµ‹æ ¡æ­£å…¬å¼</dt><dd>ç§°ä¾ å£«ä¸ºæ”¹è¿›çš„Eulerå…¬å¼ï¼Œä¸ºå•æ­¥æ˜¾å¼å…¬å¼</dd></dl><p><span class="math display">\[\begin{cases}  y_{i+1}^{(p)}=y_i+hf(x_i, y_i) &amp;é¢„æµ‹å…¬å¼\\  y_{i+1} = y_i + \frac{h}{2}[f(x_i, y_i) + f(x_{i+1}, y_{i+1}^{(p)})]&amp; æ ¡æ­£å…¬å¼\end{cases}\]</span></p><p>ä¹Ÿå¯ä»¥æ”¹å†™ä¸ºï¼š</p><p><span class="math display">\[\begin{cases}  y_{i+1}^{(p)} = y_i + h f(x_i , y_i)\\  y_{i+1}^{(c)} = y_i + hf(x_{i+1}, y_{i+1}^{(p)})\\  y_{i+1} = (y_{i+1}^{(p)}+ y_{i+1}^{(c)})/2\end{cases}\]</span></p><p>å±€éƒ¨æˆªæ–­è¯¯å·®ä¸ºï¼š</p><p><span class="math display">\[R_{i+1} = y(x_{i+1}) - \left\{ y(x_i) + \frac h2 [f(x_i, y(x_i)) +f(x_{i+1}, y(x_i) + hf(x_i, y(x_i)))] \right\}\]</span></p><dl><dt>æ±‚è§£å…¬å¼çš„é˜¶æ•°</dt><dd>å¦‚æœä¸€ä¸ªæ±‚è§£å…¬å¼çš„å±€éƒ¨æˆªæ–­è¯¯å·®ä¸º<spanclass="math inline">\(R_{i+1}=O(h^{p+1})\)</span>åˆ™ç§°è¯¥æ±‚è§£å…¬å¼æ˜¯<spanclass="math inline">\(p\)</span>é˜¶çš„ã€‚</dd></dl></div><div class="story post-story"><h2 id="r-kæ–¹æ³•">R-Kæ–¹æ³•</h2><h3 id="r-kæ–¹æ³•çš„åŸºæœ¬æ€æƒ³">R-Kæ–¹æ³•çš„åŸºæœ¬æ€æƒ³</h3><p>åˆ©ç”¨ç§¯åˆ†ä¸­å€¼å®šç†ï¼š</p><p><span class="math display">\[y(x_{i+1}) = y(x_i) + hf(x_i+\theta h, y(x_i + \theta h))\]</span></p><p>ç§°<span class="math inline">\(f(x_i+\theta h, y(x_i + \thetah))\)</span>ä¸ºå¹³å‡æ–œç‡</p><p>è®°ï¼š</p><p><span class="math display">\[\begin{aligned}  &amp;k_1 = f(x_i, y_i)\\  &amp;k_2 = f(x_{i+1}, y_i + hk_1)\end{aligned}\]</span></p><p>è‹¥ç”¨<span class="math inline">\(k_1\)</span>è¿‘ä¼¼<spanclass="math inline">\(k^*\)</span>ï¼Œåˆ™å¾—åˆ°ä¸€é˜¶Eulerå…¬å¼ï¼Œè‹¥ç”¨<spanclass="math inline">\(\frac{k_1+k_2}{2}\)</span>æ¥è¿‘ä¼¼<spanclass="math inline">\(k^*\)</span>ï¼Œåˆ™å¾—åˆ°äºŒé˜¶æ”¹è¿›çš„Eulerå…¬å¼ã€‚</p><dl><dt>R-Kæ–¹æ³•</dt><dd>ä¸€èˆ¬çš„æ˜¾å¼r-çº§Runge-Kuttaæ–¹æ³•ä¸º</dd></dl><p><span class="math display">\[\begin{cases}   y_{i+1} = y_i + h\sum_{j=1}^r \alpha_j k_j\\   k_1=f(x_i , y_i)\\   k_j = f(x_i + \lambda_j h, h_i + h\sum_{l=1}^{j-1} \mu_{jl}k_l),&amp;j=2,3,...,r\end{cases}\]</span></p><p>ä¾‹å¦‚ï¼š<span class="math inline">\(r=\alpha_1=1\)</span>å¯å¾—Euleræ–¹æ³•ã€‚</p><h3 id="é˜¶r-kå…¬å¼">2é˜¶R-Kå…¬å¼</h3><p><span class="math display">\[\begin{cases}  y_{i+1} = y_i + h(\alpha_1k_1+\alpha_2k_2)\\  k_1 = f(x_i, y_i)\\  k_2 = f(x_i + \lambda_2h, y_i + h\mu_{21}k_1)\end{cases}\]</span></p><p>è¦ä½¿å¾—å…¶å…·æœ‰äºŒé˜¶ç²¾åº¦ï¼Œiffå‚æ•° <spanclass="math inline">\(\alpha_1,\alpha_2,\lambda_2\)</span> å’Œ <spanclass="math inline">\(\mu_{21}\)</span>æ»¡è¶³ï¼š</p><p><span class="math display">\[\begin{cases}1-\alpha_1 - \alpha_2 =0\\\frac 12 - \alpha_2\lambda_2 = 0\\\frac{1}{2}-\alpha_2\mu_{21} = 0\end{cases}\]</span></p><p>è‹¥å– <span class="math inline">\(\alpha_2=1/2\)</span>åˆ™å¾—åˆ°<strong>äºŒé˜¶æ”¹è¿›çš„Eulerå…¬å¼</strong>ã€‚</p><p>è‹¥å– <span class="math inline">\(\alpha_2=1\)</span>åˆ™å¾—åˆ°<strong>å˜å½¢çš„Eulerå…¬å¼</strong></p></div><div class="story post-story"><h2 id="å•æ­¥æ³•çš„æ”¶æ•›æ€§å’Œç¨³å®šæ€§">å•æ­¥æ³•çš„æ”¶æ•›æ€§å’Œç¨³å®šæ€§</h2><h3 id="æ”¶æ•›æ€§">æ”¶æ•›æ€§</h3><dl><dt>æ•´ä½“æˆªæ–­è¯¯å·®</dt><dd>è®¾ <span class="math inline">\(\{y(x_i)\}\)</span> æ˜¯å¾®åˆ†æ–¹ç¨‹çš„è§£ï¼Œ<spanclass="math inline">\(\{y_i^{[h]}\}\)</span>æ˜¯é€šè¿‡æŸä¸ªæ•°å€¼æ–¹æ³•è¿‘ä¼¼è§£ã€‚åˆ™ç§° <span class="math inline">\(E(h) =\max|y(x_i) -y_i^{[h]}|\)</span> ä¸ºè¯¥æ–¹æ³•çš„æ•´ä½“æˆªæ–­è¯¯å·®ï¼Œè‹¥</dd></dl><p><span class="math display">\[\lim_{h\rightarrow 0} E(h) = 0\]</span></p><p>åˆ™ç§°è¯¥æ–¹æ³•æ”¶æ•›ã€‚</p><p class='p blue'>Theorem</p><p>è‹¥<span class="math inline">\(y(x)\)</span>æ˜¯å¾®åˆ†æ–¹ç¨‹çš„è§£ï¼Œ<spanclass="math inline">\(\{y_i\}\)</span>æ˜¯å•æ­¥æ˜¾å¼å…¬å¼çš„è§£ï¼Œå¦‚æœå­˜åœ¨ï¼š</p><ol type="1"><li><span class="math inline">\(c_0&gt;0\)</span> ä½¿å¾— <spanclass="math inline">\(|R_{i+1}|\le c_0h^{p+1}\)</span></li><li><span class="math inline">\(h_0&gt;0,L&gt;0\)</span> ä½¿å¾— <spanclass="math inline">\(\max|\frac{\partial\varphi}{\partial y}|\leL\)</span></li></ol><p>åˆ™å½“ <span class="math inline">\(h&lt;\min\{h_0,(\delta/c)^{1/p}\}\)</span> æœ‰ï¼š</p><p><span class="math display">\[E(h) \le ch^p\]</span></p><h3 id="ç¨³å®šæ€§">ç¨³å®šæ€§</h3><p>å¯¹äºåˆå€¼é—®é¢˜<spanclass="math inline">\(\{y_i\}_{i=0}^n\)</span>æ˜¯ç”±å•æ­¥æ³•åˆ°çš„çš„è¿‘ä¼¼è§£,<span class="math inline">\(\{z_i\}_{i=0}^n\)</span>æ˜¯æ‰°åŠ¨åçš„è§£,å³æ»¡è¶³</p><p><span class="math display">\[\left\{\begin{array}{l}z_{i+1}=z_i+h[\varphi(x_i,z_i,h)+\delta_{i+1}],\quad i=0,1,\cdotsn-1,\\  z_0=\eta+\delta_0,\end{array}\right.\]</span></p><p>å¦‚æœå­˜åœ¨æ­£å¸¸æ•° <span class="math inline">\(C, \varepsilon_0,h_0\)</span>, ä½¿å¾—å¯¹æ‰€æœ‰ <spanclass="math inline">\(\varepsilon\in(0,\varepsilon_0]\)</span>, <spanclass="math inline">\(h\in(0,h_0]\)</span>, å½“ <spanclass="math inline">\(\max\limits_{0\le i\len}|\delta_i|\le\varepsilon\)</span> æ—¶, æœ‰</p><p><span class="math display">\[\max_{0\le i\le n}|y_i-z_i|\le C\varepsilon,\]</span></p><p>åˆ™ç§°å•æ­¥æ³•ç¨³å®š.</p><p class='p blue'>Theorem åœ¨å®šç†1çš„æ¡ä»¶ä¸‹ï¼Œå•æ­¥å…¬å¼æ˜¯ç¨³å®šçš„</p></div>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ•°å€¼åˆ†æ Chapter 6 å¸¸å¾®åˆ†æ–¹ç¨‹çš„æ•°å€¼è§£&lt;/p&gt;</summary>
    
    
    
    <category term="æ•°å­¦" scheme="http://adversarr.github.io/categories/%E6%95%B0%E5%AD%A6/"/>
    
    
    <category term="æ•°å€¼åˆ†æ" scheme="http://adversarr.github.io/tags/%E6%95%B0%E5%80%BC%E5%88%86%E6%9E%90/"/>
    
    <category term="å¸¸å¾®åˆ†æ–¹ç¨‹" scheme="http://adversarr.github.io/tags/%E5%B8%B8%E5%BE%AE%E5%88%86%E6%96%B9%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>C++ ç¼–ç¨‹è§„èŒƒ</title>
    <link href="http://adversarr.github.io/2022/09/30/study/ComputerScience/fragments/Google_C_programming_specification/"/>
    <id>http://adversarr.github.io/2022/09/30/study/ComputerScience/fragments/Google_C_programming_specification/</id>
    <published>2022-09-30T01:16:33.301Z</published>
    <updated>2022-09-30T01:16:33.301Z</updated>
    
    <content type="html"><![CDATA[<p>Google C/C++ è§„èŒƒæ–‡æ¡£ã€‚</p><span id="more"></span><h1 id="cç¼–ç¨‹è§„èŒƒ">c++ç¼–ç¨‹è§„èŒƒ</h1><div class="story post-story"><h2 id="æ‰‰é¡µ">0. æ‰‰é¡µ</h2><table><colgroup><col style="width: 13%" /><col style="width: 86%" /></colgroup><thead><tr class="header"><th>ç‰ˆæœ¬:</th><th>4.45</th></tr></thead><tbody><tr class="odd"><td>åŸä½œè€…:</td><td>Benjy WeinbergerCraig SilversteinGregory EitzmannMarkMentovaiTashana Landray</td></tr><tr class="even"><td>ç¿»è¯‘:</td><td><a href="http://www.yulefox.com/">YuleFox</a><ahref="https://github.com/yangyubo">Yang.Y</a><ahref="http://acgtyrant.com/">acgtyrant</a><ahref="http://github.com/lilinsanity">lilinsanity</a></td></tr><tr class="odd"><td>é¡¹ç›®ä¸»é¡µ:</td><td><a href="http://google-styleguide.googlecode.com/">Google StyleGuide</a><ahref="http://github.com/zh-google-styleguide/zh-google-styleguide">Googleå¼€æºé¡¹ç›®é£æ ¼æŒ‡å— - ä¸­æ–‡ç‰ˆ</a></td></tr></tbody></table><h3 id="è¯‘è€…å‰è¨€">0.1 è¯‘è€…å‰è¨€</h3><p>Google ç»å¸¸ä¼šå‘å¸ƒä¸€äº›å¼€æºé¡¹ç›®, æ„å‘³ç€ä¼šæ¥å—æ¥è‡ªå…¶ä»–ä»£ç è´¡çŒ®è€…çš„ä»£ç .ä½†æ˜¯å¦‚æœä»£ç è´¡çŒ®è€…çš„ç¼–ç¨‹é£æ ¼ä¸ Google çš„ä¸ä¸€è‡´,ä¼šç»™ä»£ç é˜…è¯»è€…å’Œå…¶ä»–ä»£ç æäº¤è€…é€ æˆä¸å°çš„å›°æ‰°. Googleå› æ­¤å‘å¸ƒäº†è¿™ä»½è‡ªå·±çš„ç¼–ç¨‹é£æ ¼æŒ‡å—, ä½¿æ‰€æœ‰æäº¤ä»£ç çš„äººéƒ½èƒ½è·çŸ¥ Googleçš„ç¼–ç¨‹é£æ ¼.</p><p>ç¿»è¯‘åˆè¡·:</p><blockquote><p>è§„åˆ™çš„ä½œç”¨å°±æ˜¯é¿å…æ··ä¹±. ä½†è§„åˆ™æœ¬èº«ä¸€å®šè¦æƒå¨, æœ‰è¯´æœåŠ›, å¹¶ä¸”æ˜¯ç†æ€§çš„.æˆ‘ä»¬æ‰€è§è¿‡çš„å¤§éƒ¨åˆ†ç¼–ç¨‹è§„èŒƒ, å…¶å†…å®¹æˆ–ä¸å¤Ÿä¸¥è°¨, æˆ–é˜è¿°è¿‡äºç®€å•,æˆ–å¸¦æœ‰ä¸€å®šçš„æ­¦æ–­æ€§.</p><p>Google ä¿æŒå…¶ä¸€è´¯çš„ä¸¥è°¨ç²¾ç¥, 5 ä¸‡æ±‰å­—çš„æŒ‡å—æ¶‰åŠå¹¿æ³›, è®ºè¯ä¸¥å¯†.æˆ‘ä»¬ç¿»è¯‘è¯¥ç³»åˆ—æŒ‡å—çš„ä¸»å› ä¹Ÿæ­£æ˜¯å…¶ä¸¥è°¨æ€§.ä¸¥è°¨æ„å‘³ç€æŒ‡å—çš„ä»·å€¼ä¸ä»…ä»…å±€é™äºå®ƒç½—åˆ—å‡ºçš„è§„èŒƒ,æ›´å…·å‚è€ƒæ„ä¹‰çš„æ˜¯å®ƒä¸ºäº†åˆ—å‡ºè§„èŒƒè€Œåšçš„è°¨æ…æƒè¡¡è¿‡ç¨‹.</p><p>æŒ‡å—ä¸ä»…åˆ—å‡ºä½ è¦æ€ä¹ˆåš, è¿˜å‘Šè¯‰ä½ ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåš,å“ªäº›æƒ…å†µä¸‹å¯ä»¥ä¸è¿™ä¹ˆåš, ä»¥åŠå¦‚ä½•æƒè¡¡å…¶åˆ©å¼Š.å…¶ä»–å›¢é˜Ÿæœªå¿…è¦å®Œå…¨éµç…§æŒ‡å—äº¦æ­¥äº¦è¶‹, å¦‚å‰é¢æ‰€è¯´, è¿™ä»½æŒ‡å—æ˜¯ Googleæ ¹æ®è‡ªèº«å®é™…æƒ…å†µæ‰“é€ çš„, é€‚ç”¨äºå…¶ä¸»å¯¼çš„å¼€æºé¡¹ç›®. å…¶ä»–å›¢é˜Ÿå¯ä»¥å‚ç…§è¯¥æŒ‡å—,æˆ–ä»ä¸­æ±²å–çµæ„Ÿ, å»ºç«‹é€‚åˆè‡ªèº«å®é™…æƒ…å†µçš„è§„èŒƒ.</p><p>æˆ‘ä»¬åœ¨ç¿»è¯‘çš„è¿‡ç¨‹ä¸­, æ”¶è·é¢‡å¤š.å¸Œæœ›æœ¬ç³»åˆ—æŒ‡å—ä¸­æ–‡ç‰ˆå¯¹ä½ åŒæ ·èƒ½æœ‰æ‰€å¸®åŠ©.</p></blockquote><p>æˆ‘ä»¬ç¿»è¯‘æ—¶ä¹Ÿæ˜¯å°½åŠ›ä¿æŒä¸¥è°¨, ä½†æ°´å¹³æ‰€é™, bug åœ¨æ‰€éš¾å….æœ‰ä»»ä½•æ„è§æˆ–å»ºè®®, å¯ä¸æˆ‘ä»¬å–å¾—è”ç³».</p><p>ä¸­æ–‡ç‰ˆå’Œè‹±æ–‡ç‰ˆä¸€æ ·, ä½¿ç”¨ <code>Artistic License/GPL</code>å¼€æºè®¸å¯.</p><p>ä¸­æ–‡ç‰ˆä¿®è®¢å†å²:</p><blockquote><ul><li><p>2015-08 : çƒ­å¿ƒçš„æ¸…åå¤§å­¦åŒå­¦ <span class="citation"data-cites="lilinsanity">@lilinsanity</span>å®Œå–„äº†ã€Œç±»ã€ç« èŠ‚ä»¥åŠå…¶å®ƒä¸€äº›å°ç« èŠ‚ã€‚è‡³æ­¤ï¼Œå¯¹ Google CPP Style Guide 4.45çš„ç¿»è¯‘æ­£å¼ç«£å·¥ã€‚</p></li><li><p>2015-07 4.45 : acgtyrant ä¸ºäº†å­¦ä¹  C++ çš„è§„èŒƒï¼Œé¡ºä¾¿é‡æ–°ç¿»è¯‘äº†æœ¬C++ é£æ ¼æŒ‡å—ï¼Œç‰¹åˆ«æ˜¯ C++11çš„å…¨æ–°å†…å®¹ã€‚æ’ç‰ˆå¤§å¹…åº¦ä¼˜åŒ–ï¼Œç¿»è¯‘æªè¾æ›´åœ°é“ï¼Œæ·»åŠ äº†æ–°è¯‘è€…ç¬”è®°ã€‚Googleæ€»éƒ¨ C++ å·¥ç¨‹å¸ˆ innocentim,æ¸…åå¤§å­¦ä¸æ„¿æ„é€éœ²å§“åçš„å”é©¬å„’å…ˆç”Ÿï¼Œå¤§é˜ªå¤§å­¦å¤§å­¦é™¢æƒ…æŠ¥ç§‘å­¦ç ”ç©¶ç§‘è®¡ç®—æœºç§‘å­¦ä¸“æ”»åšå£«farseerfc å’Œå…¶å®ƒ Arch Linux ä¸­æ–‡ç¤¾åŒºä¼—å¸®äº†è¯‘è€…ä¸å°‘å¿™ï¼Œè°¢è°¢ä»–ä»¬ã€‚å› ä¸º C++Primer å°šæœªå®Œå…¨å…¥é—¨ï¼Œæš‚æ—¶æ²¡æœ‰ç¿»è¯‘ã€Œç±»ã€ç« èŠ‚å’Œå…¶å®ƒä¸€äº›å°ç« èŠ‚ã€‚</p></li><li><p>2009-06 3.133 : YuleFox çš„ 1.0 ç‰ˆå·²ç»ç›¸å½“å®Œå–„,ä½†åŸç‰ˆåœ¨è¿‘ä¸€å¹´çš„æ—¶é—´é‡Œ, å…¶è§„èŒƒä¹Ÿå‘ç”Ÿäº†ä¸€äº›å˜åŒ–.</p></li></ul><blockquote><p>Yang.Y ä¸ YuleFox ä¸€æ‹å³åˆ, ä»¥é¡¹ç›®çš„å½¢å¼æ¥å»¶ç»­ä¸­æ–‡ç‰ˆ : <ahref="http://github.com/yangyubo/zh-google-styleguide">Googleå¼€æºé¡¹ç›®é£æ ¼æŒ‡å— - ä¸­æ–‡ç‰ˆé¡¹ç›®</a>.</p><p>ä¸»è¦å˜åŒ–æ˜¯åŒæ­¥åˆ° 3.133 æœ€æ–°è‹±æ–‡ç‰ˆæœ¬,åšéƒ¨åˆ†å‹˜è¯¯å’Œæ”¹å–„å¯è¯»æ€§æ–¹é¢çš„ä¿®æ”¹, å¹¶æ”¹è¿›æ’ç‰ˆæ•ˆæœ. Yang.Y é‡æ–°ç¿»ä¿®,YuleFox åšåç»­è¯„å®¡.</p></blockquote><ul><li>2008-07 1.0 : å‡ºè‡ª <a href="http://www.yulefox.com/?p=207">YuleFoxçš„ Blog</a>, å¾ˆå¤šåœ°æ–¹æ‘˜å½•çš„ä¹Ÿæ˜¯è¯¥ç‰ˆæœ¬.</li></ul></blockquote><h3 id="èƒŒæ™¯">0.2 èƒŒæ™¯</h3><p>C++ æ˜¯ Google å¤§éƒ¨åˆ†å¼€æºé¡¹ç›®çš„ä¸»è¦ç¼–ç¨‹è¯­è¨€. æ­£å¦‚æ¯ä¸ª C++ç¨‹åºå‘˜éƒ½çŸ¥é“çš„, C++ æœ‰å¾ˆå¤šå¼ºå¤§çš„ç‰¹æ€§,ä½†è¿™ç§å¼ºå¤§ä¸å¯é¿å…çš„å¯¼è‡´å®ƒèµ°å‘å¤æ‚ï¼Œä½¿ä»£ç æ›´å®¹æ˜“äº§ç”Ÿ bug,éš¾ä»¥é˜…è¯»å’Œç»´æŠ¤.</p><p>æœ¬æŒ‡å—çš„ç›®çš„æ˜¯é€šè¿‡è¯¦ç»†é˜è¿° C++ æ³¨æ„äº‹é¡¹æ¥é©¾é©­å…¶å¤æ‚æ€§.è¿™äº›è§„åˆ™åœ¨ä¿è¯ä»£ç æ˜“äºç®¡ç†çš„åŒæ—¶, ä¹Ÿèƒ½é«˜æ•ˆä½¿ç”¨ C++ çš„è¯­è¨€ç‰¹æ€§.</p><p><em>é£æ ¼</em>, äº¦è¢«ç§°ä½œå¯è¯»æ€§, ä¹Ÿå°±æ˜¯æŒ‡å¯¼ C++ ç¼–ç¨‹çš„çº¦å®š. ä½¿ç”¨æœ¯è¯­"é£æ ¼" æœ‰äº›ç”¨è¯ä¸å½“, å› ä¸ºè¿™äº›ä¹ æƒ¯è¿œä¸æ­¢æºä»£ç æ–‡ä»¶æ ¼å¼åŒ–è¿™ä¹ˆç®€å•.</p><p>ä½¿ä»£ç æ˜“äºç®¡ç†çš„æ–¹æ³•ä¹‹ä¸€æ˜¯åŠ å¼ºä»£ç ä¸€è‡´æ€§.è®©ä»»ä½•ç¨‹åºå‘˜éƒ½å¯ä»¥å¿«é€Ÿè¯»æ‡‚ä½ çš„ä»£ç è¿™ç‚¹éå¸¸é‡è¦.ä¿æŒç»Ÿä¸€ç¼–ç¨‹é£æ ¼å¹¶éµå®ˆçº¦å®šæ„å‘³ç€å¯ä»¥å¾ˆå®¹æ˜“æ ¹æ® "æ¨¡å¼åŒ¹é…"è§„åˆ™æ¥æ¨æ–­å„ç§æ ‡è¯†ç¬¦çš„å«ä¹‰. åˆ›å»ºé€šç”¨,å¿…éœ€çš„ä¹ æƒ¯ç”¨è¯­å’Œæ¨¡å¼å¯ä»¥ä½¿ä»£ç æ›´å®¹æ˜“ç†è§£.åœ¨ä¸€äº›æƒ…å†µä¸‹å¯èƒ½æœ‰å……åˆ†çš„ç†ç”±æ”¹å˜æŸäº›ç¼–ç¨‹é£æ ¼,ä½†æˆ‘ä»¬è¿˜æ˜¯åº”è¯¥éµå¾ªä¸€è‡´æ€§åŸåˆ™ï¼Œå°½é‡ä¸è¿™ä¹ˆåš.</p><p>æœ¬æŒ‡å—çš„å¦ä¸€ä¸ªè§‚ç‚¹æ˜¯ C++ ç‰¹æ€§çš„è‡ƒè‚¿. C++æ˜¯ä¸€é—¨åŒ…å«å¤§é‡é«˜çº§ç‰¹æ€§çš„åºå¤§è¯­è¨€. æŸäº›æƒ…å†µä¸‹,æˆ‘ä»¬ä¼šé™åˆ¶ç”šè‡³ç¦æ­¢ä½¿ç”¨æŸäº›ç‰¹æ€§. è¿™ä¹ˆåšæ˜¯ä¸ºäº†ä¿æŒä»£ç æ¸…çˆ½,é¿å…è¿™äº›ç‰¹æ€§å¯èƒ½å¯¼è‡´çš„å„ç§é—®é¢˜. æŒ‡å—ä¸­åˆ—ä¸¾äº†è¿™ç±»ç‰¹æ€§,å¹¶è§£é‡Šä¸ºä»€ä¹ˆè¿™äº›ç‰¹æ€§è¢«é™åˆ¶ä½¿ç”¨.</p><p>Google ä¸»å¯¼çš„å¼€æºé¡¹ç›®å‡ç¬¦åˆæœ¬æŒ‡å—çš„è§„å®š.</p><p>æ³¨æ„: æœ¬æŒ‡å—å¹¶é C++ æ•™ç¨‹, æˆ‘ä»¬å‡å®šè¯»è€…å·²ç»å¯¹ C++ éå¸¸ç†Ÿæ‚‰.</p></div><div class="story post-story"><h2 id="å¤´æ–‡ä»¶">1. å¤´æ–‡ä»¶</h2><p>é€šå¸¸æ¯ä¸€ä¸ª <code>.cc</code> æ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ <code>.h</code> æ–‡ä»¶.ä¹Ÿæœ‰ä¸€äº›å¸¸è§ä¾‹å¤–, å¦‚å•å…ƒæµ‹è¯•ä»£ç å’ŒåªåŒ…å« <code>main()</code> å‡½æ•°çš„<code>.cc</code> æ–‡ä»¶.</p><p>æ­£ç¡®ä½¿ç”¨å¤´æ–‡ä»¶å¯ä»¤ä»£ç åœ¨å¯è¯»æ€§ã€æ–‡ä»¶å¤§å°å’Œæ€§èƒ½ä¸Šå¤§ä¸ºæ”¹è§‚.</p><p>ä¸‹é¢çš„è§„åˆ™å°†å¼•å¯¼ä½ è§„é¿ä½¿ç”¨å¤´æ–‡ä»¶æ—¶çš„å„ç§é™·é˜±.</p><h3 id="self-contained-å¤´æ–‡ä»¶">1.1. Self-contained å¤´æ–‡ä»¶</h3><p>Tip</p><p>å¤´æ–‡ä»¶åº”è¯¥èƒ½å¤Ÿè‡ªç»™è‡ªè¶³ï¼ˆself-contained,ä¹Ÿå°±æ˜¯å¯ä»¥ä½œä¸ºç¬¬ä¸€ä¸ªå¤´æ–‡ä»¶è¢«å¼•å…¥ï¼‰ï¼Œä»¥<code>.h</code>ç»“å°¾ã€‚è‡³äºç”¨æ¥æ’å…¥æ–‡æœ¬çš„æ–‡ä»¶ï¼Œè¯´åˆ°åº•å®ƒä»¬å¹¶ä¸æ˜¯å¤´æ–‡ä»¶ï¼Œæ‰€ä»¥åº”ä»¥<code>.inc</code> ç»“å°¾ã€‚ä¸å…è®¸åˆ†ç¦»å‡º <code>-inl.h</code>å¤´æ–‡ä»¶çš„åšæ³•.</p><p>æ‰€æœ‰å¤´æ–‡ä»¶è¦èƒ½å¤Ÿè‡ªç»™è‡ªè¶³ã€‚æ¢è¨€ä¹‹ï¼Œç”¨æˆ·å’Œé‡æ„å·¥å…·ä¸éœ€è¦ä¸ºç‰¹åˆ«åœºåˆè€ŒåŒ…å«é¢å¤–çš„å¤´æ–‡ä»¶ã€‚è¯¦è¨€ä¹‹ï¼Œä¸€ä¸ªå¤´æ–‡ä»¶è¦æœ‰<ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/headers/##define-guard">1.2.##define ä¿æŠ¤</a>ï¼Œç»Ÿç»ŸåŒ…å«å®ƒæ‰€éœ€è¦çš„å…¶å®ƒå¤´æ–‡ä»¶ï¼Œä¹Ÿä¸è¦æ±‚å®šä¹‰ä»»ä½•ç‰¹åˆ«symbols.</p><p>ä¸è¿‡æœ‰ä¸€ä¸ªä¾‹å¤–ï¼Œå³ä¸€ä¸ªæ–‡ä»¶å¹¶ä¸æ˜¯ self-containedçš„ï¼Œè€Œæ˜¯ä½œä¸ºæ–‡æœ¬æ’å…¥åˆ°ä»£ç æŸå¤„ã€‚æˆ–è€…ï¼Œæ–‡ä»¶å†…å®¹å®é™…ä¸Šæ˜¯å…¶å®ƒå¤´æ–‡ä»¶çš„ç‰¹å®šå¹³å°ï¼ˆplatform-specificï¼‰æ‰©å±•éƒ¨åˆ†ã€‚è¿™äº›æ–‡ä»¶å°±è¦ç”¨<code>.inc</code> æ–‡ä»¶æ‰©å±•åã€‚</p><p>å¦‚æœ <code>.h</code>æ–‡ä»¶å£°æ˜äº†ä¸€ä¸ªæ¨¡æ¿æˆ–å†…è”å‡½æ•°ï¼ŒåŒæ—¶ä¹Ÿåœ¨è¯¥æ–‡ä»¶åŠ ä»¥å®šä¹‰ã€‚å‡¡æ˜¯æœ‰ç”¨åˆ°è¿™äº›çš„<code>.cc</code>æ–‡ä»¶ï¼Œå°±å¾—ç»Ÿç»ŸåŒ…å«è¯¥å¤´æ–‡ä»¶ï¼Œå¦åˆ™ç¨‹åºå¯èƒ½ä¼šåœ¨æ„å»ºä¸­é“¾æ¥å¤±è´¥ã€‚ä¸è¦æŠŠè¿™äº›å®šä¹‰æ”¾åˆ°åˆ†ç¦»çš„<code>-inl.h</code> æ–‡ä»¶é‡Œï¼ˆè¯‘è€…æ³¨ï¼šè¿‡å»è¯¥è§„èŒƒæ›¾æå€¡æŠŠå®šä¹‰æ”¾åˆ° -inl.hé‡Œè¿‡ï¼‰ã€‚</p><p>æœ‰ä¸ªä¾‹å¤–ï¼šå¦‚æœæŸå‡½æ•°æ¨¡æ¿ä¸ºæ‰€æœ‰ç›¸å…³æ¨¡æ¿å‚æ•°æ˜¾å¼å®ä¾‹åŒ–ï¼Œæˆ–æœ¬èº«å°±æ˜¯æŸç±»çš„ä¸€ä¸ªç§æœ‰æˆå‘˜ï¼Œé‚£ä¹ˆå®ƒå°±åªèƒ½å®šä¹‰åœ¨å®ä¾‹åŒ–è¯¥æ¨¡æ¿çš„<code>.cc</code> æ–‡ä»¶é‡Œã€‚</p><h3 id="define-ä¿æŠ¤">1.2. ##define ä¿æŠ¤</h3><blockquote><p>[!TIP]</p><p>1</p></blockquote><p>æ‰€æœ‰å¤´æ–‡ä»¶éƒ½åº”è¯¥ä½¿ç”¨ <code>##define</code> æ¥é˜²æ­¢å¤´æ–‡ä»¶è¢«å¤šé‡åŒ…å«,å‘½åæ ¼å¼å½“æ˜¯: <code>___H_</code> .</p><p>ä¸ºä¿è¯å”¯ä¸€æ€§, å¤´æ–‡ä»¶çš„å‘½ååº”è¯¥åŸºäºæ‰€åœ¨é¡¹ç›®æºä»£ç æ ‘çš„å…¨è·¯å¾„. ä¾‹å¦‚,é¡¹ç›® <code>foo</code> ä¸­çš„å¤´æ–‡ä»¶ <code>foo/src/bar/baz.h</code>å¯æŒ‰å¦‚ä¸‹æ–¹å¼ä¿æŠ¤:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> FOO_BAR_BAZ_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FOO_BAR_BAZ_H_</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// FOO_BAR_BAZ_H_</span></span></span><br></pre></td></tr></table></figure><h3 id="å‰ç½®å£°æ˜">1.3. å‰ç½®å£°æ˜</h3><p>å°½å¯èƒ½åœ°é¿å…ä½¿ç”¨å‰ç½®å£°æ˜ã€‚ä½¿ç”¨ <code>#include</code>åŒ…å«éœ€è¦çš„å¤´æ–‡ä»¶å³å¯ã€‚</p><p><strong>å®šä¹‰ï¼š</strong></p><blockquote><p>æ‰€è°“ã€Œå‰ç½®å£°æ˜ã€ï¼ˆforwarddeclarationï¼‰æ˜¯ç±»ã€å‡½æ•°å’Œæ¨¡æ¿çš„çº¯ç²¹å£°æ˜ï¼Œæ²¡ä¼´éšç€å…¶å®šä¹‰.</p></blockquote><p><strong>ä¼˜ç‚¹ï¼š</strong></p><blockquote><ul><li>å‰ç½®å£°æ˜èƒ½å¤ŸèŠ‚çœç¼–è¯‘æ—¶é—´ï¼Œå¤šä½™çš„ <code>#include</code>ä¼šè¿«ä½¿ç¼–è¯‘å™¨å±•å¼€æ›´å¤šçš„æ–‡ä»¶ï¼Œå¤„ç†æ›´å¤šçš„è¾“å…¥ã€‚</li><li>å‰ç½®å£°æ˜èƒ½å¤ŸèŠ‚çœä¸å¿…è¦çš„é‡æ–°ç¼–è¯‘çš„æ—¶é—´ã€‚ <code>#include</code>ä½¿ä»£ç å› ä¸ºå¤´æ–‡ä»¶ä¸­æ— å…³çš„æ”¹åŠ¨è€Œè¢«é‡æ–°ç¼–è¯‘å¤šæ¬¡ã€‚</li></ul></blockquote><p><strong>ç¼ºç‚¹ï¼š</strong></p><blockquote><ul><li><p>å‰ç½®å£°æ˜éšè—äº†ä¾èµ–å…³ç³»ï¼Œå¤´æ–‡ä»¶æ”¹åŠ¨æ—¶ï¼Œç”¨æˆ·çš„ä»£ç ä¼šè·³è¿‡å¿…è¦çš„é‡æ–°ç¼–è¯‘è¿‡ç¨‹ã€‚</p></li><li><p>å‰ç½®å£°æ˜å¯èƒ½ä¼šè¢«åº“çš„åç»­æ›´æ”¹æ‰€ç ´åã€‚å‰ç½®å£°æ˜å‡½æ•°æˆ–æ¨¡æ¿æœ‰æ—¶ä¼šå¦¨ç¢å¤´æ–‡ä»¶å¼€å‘è€…å˜åŠ¨å…¶API. ä¾‹å¦‚æ‰©å¤§å½¢å‚ç±»å‹ï¼ŒåŠ ä¸ªè‡ªå¸¦é»˜è®¤å‚æ•°çš„æ¨¡æ¿å½¢å‚ç­‰ç­‰ã€‚</p></li><li><p>å‰ç½®å£°æ˜æ¥è‡ªå‘½åç©ºé—´ <code>std::</code> çš„ symbolæ—¶ï¼Œå…¶è¡Œä¸ºæœªå®šä¹‰ã€‚</p></li><li><p>å¾ˆéš¾åˆ¤æ–­ä»€ä¹ˆæ—¶å€™è¯¥ç”¨å‰ç½®å£°æ˜ï¼Œä»€ä¹ˆæ—¶å€™è¯¥ç”¨ <code>#include</code>ã€‚æç«¯æƒ…å†µä¸‹ï¼Œç”¨å‰ç½®å£°æ˜ä»£æ›¿ <code>includes</code>ç”šè‡³éƒ½ä¼šæš—æš—åœ°æ”¹å˜ä»£ç çš„å«ä¹‰ï¼š</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// b.h:</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">B</span> &#123;&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">D</span> : B &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// good_user.cc:</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;b.h&quot;</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">(B*)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">(<span class="type">void</span>*)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">(D* x)</span> </span>&#123; <span class="built_in">f</span>(x); &#125;  <span class="comment">// calls f(B*)</span></span><br></pre></td></tr></table></figure></blockquote></li></ul><blockquote><p>å¦‚æœ <code>#include</code> è¢« <code>B</code> å’Œ <code>D</code>çš„å‰ç½®å£°æ˜æ›¿ä»£ï¼Œ <code>test()</code> å°±ä¼šè°ƒç”¨ <code>f(void*)</code>.</p></blockquote><ul><li>å‰ç½®å£°æ˜äº†ä¸å°‘æ¥è‡ªå¤´æ–‡ä»¶çš„ symbol æ—¶ï¼Œå°±ä¼šæ¯”å•å•ä¸€è¡Œçš„<code>include</code> å†—é•¿ã€‚</li><li>ä»…ä»…ä¸ºäº†èƒ½å‰ç½®å£°æ˜è€Œé‡æ„ä»£ç ï¼ˆæ¯”å¦‚ç”¨æŒ‡é’ˆæˆå‘˜ä»£æ›¿å¯¹è±¡æˆå‘˜ï¼‰ä¼šä½¿ä»£ç å˜å¾—æ›´æ…¢æ›´å¤æ‚.</li></ul></blockquote><p><strong>ç»“è®ºï¼š</strong></p><blockquote><ul><li>å°½é‡é¿å…å‰ç½®å£°æ˜é‚£äº›å®šä¹‰åœ¨å…¶ä»–é¡¹ç›®ä¸­çš„å®ä½“.</li><li>å‡½æ•°ï¼šæ€»æ˜¯ä½¿ç”¨ <code>#include</code>.</li><li>ç±»æ¨¡æ¿ï¼šä¼˜å…ˆä½¿ç”¨ <code>#include</code>.</li></ul></blockquote><p>è‡³äºä»€ä¹ˆæ—¶å€™åŒ…å«å¤´æ–‡ä»¶ï¼Œå‚è§ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/headers/##name-and-order-of-includes">1.5.<code>#include</code> çš„è·¯å¾„åŠé¡ºåº</a> ã€‚</p><h3 id="å†…è”å‡½æ•°">1.4. å†…è”å‡½æ•°</h3><p>Tip</p><p>åªæœ‰å½“å‡½æ•°åªæœ‰ 10 è¡Œç”šè‡³æ›´å°‘æ—¶æ‰å°†å…¶å®šä¹‰ä¸ºå†…è”å‡½æ•°.</p><p><strong>å®šä¹‰:</strong></p><blockquote><p>å½“å‡½æ•°è¢«å£°æ˜ä¸ºå†…è”å‡½æ•°ä¹‹å, ç¼–è¯‘å™¨ä¼šå°†å…¶å†…è”å±•å¼€,è€Œä¸æ˜¯æŒ‰é€šå¸¸çš„å‡½æ•°è°ƒç”¨æœºåˆ¶è¿›è¡Œè°ƒç”¨.</p></blockquote><p><strong>ä¼˜ç‚¹:</strong></p><blockquote><p>åªè¦å†…è”çš„å‡½æ•°ä½“è¾ƒå°, å†…è”è¯¥å‡½æ•°å¯ä»¥ä»¤ç›®æ ‡ä»£ç æ›´åŠ é«˜æ•ˆ.å¯¹äºå­˜å–å‡½æ•°ä»¥åŠå…¶å®ƒå‡½æ•°ä½“æ¯”è¾ƒçŸ­, æ€§èƒ½å…³é”®çš„å‡½æ•°, é¼“åŠ±ä½¿ç”¨å†…è”.</p></blockquote><p><strong>ç¼ºç‚¹:</strong></p><blockquote><p>æ»¥ç”¨å†…è”å°†å¯¼è‡´ç¨‹åºå˜å¾—æ›´æ…¢. å†…è”å¯èƒ½ä½¿ç›®æ ‡ä»£ç é‡æˆ–å¢æˆ–å‡,è¿™å–å†³äºå†…è”å‡½æ•°çš„å¤§å°. å†…è”éå¸¸çŸ­å°çš„å­˜å–å‡½æ•°é€šå¸¸ä¼šå‡å°‘ä»£ç å¤§å°,ä½†å†…è”ä¸€ä¸ªç›¸å½“å¤§çš„å‡½æ•°å°†æˆå‰§æ€§çš„å¢åŠ ä»£ç å¤§å°.ç°ä»£å¤„ç†å™¨ç”±äºæ›´å¥½çš„åˆ©ç”¨äº†æŒ‡ä»¤ç¼“å­˜, å°å·§çš„ä»£ç å¾€å¾€æ‰§è¡Œæ›´å¿«ã€‚</p></blockquote><p><strong>ç»“è®º:</strong></p><blockquote><p>ä¸€ä¸ªè¾ƒä¸ºåˆç†çš„ç»éªŒå‡†åˆ™æ˜¯, ä¸è¦å†…è”è¶…è¿‡ 10 è¡Œçš„å‡½æ•°. è°¨æ…å¯¹å¾…ææ„å‡½æ•°,ææ„å‡½æ•°å¾€å¾€æ¯”å…¶è¡¨é¢çœ‹èµ·æ¥è¦æ›´é•¿,å› ä¸ºæœ‰éšå«çš„æˆå‘˜å’ŒåŸºç±»ææ„å‡½æ•°è¢«è°ƒç”¨!</p><p>å¦ä¸€ä¸ªå®ç”¨çš„ç»éªŒå‡†åˆ™: å†…è”é‚£äº›åŒ…å«å¾ªç¯æˆ– <code>switch</code>è¯­å¥çš„å‡½æ•°å¸¸å¸¸æ˜¯å¾—ä¸å¿å¤± (é™¤éåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹, è¿™äº›å¾ªç¯æˆ–<code>switch</code> è¯­å¥ä»ä¸è¢«æ‰§è¡Œ).</p><p>æœ‰äº›å‡½æ•°å³ä½¿å£°æ˜ä¸ºå†…è”çš„ä¹Ÿä¸ä¸€å®šä¼šè¢«ç¼–è¯‘å™¨å†…è”, è¿™ç‚¹å¾ˆé‡è¦;æ¯”å¦‚è™šå‡½æ•°å’Œé€’å½’å‡½æ•°å°±ä¸ä¼šè¢«æ­£å¸¸å†…è”. é€šå¸¸,é€’å½’å‡½æ•°ä¸åº”è¯¥å£°æ˜æˆå†…è”å‡½æ•°.ï¼ˆYuleFox æ³¨:é€’å½’è°ƒç”¨å †æ ˆçš„å±•å¼€å¹¶ä¸åƒå¾ªç¯é‚£ä¹ˆç®€å•, æ¯”å¦‚é€’å½’å±‚æ•°åœ¨ç¼–è¯‘æ—¶å¯èƒ½æ˜¯æœªçŸ¥çš„,å¤§å¤šæ•°ç¼–è¯‘å™¨éƒ½ä¸æ”¯æŒå†…è”é€’å½’å‡½æ•°).è™šå‡½æ•°å†…è”çš„ä¸»è¦åŸå› åˆ™æ˜¯æƒ³æŠŠå®ƒçš„å‡½æ•°ä½“æ”¾åœ¨ç±»å®šä¹‰å†…, ä¸ºäº†å›¾ä¸ªæ–¹ä¾¿,æŠ‘æˆ–æ˜¯å½“ä½œæ–‡æ¡£æè¿°å…¶è¡Œä¸º, æ¯”å¦‚ç²¾çŸ­çš„å­˜å–å‡½æ•°.</p></blockquote><h3 id="include-çš„è·¯å¾„åŠé¡ºåº">1.5. <code>#include</code>çš„è·¯å¾„åŠé¡ºåº</h3><p>Tip</p><p>ä½¿ç”¨æ ‡å‡†çš„å¤´æ–‡ä»¶åŒ…å«é¡ºåºå¯å¢å¼ºå¯è¯»æ€§, é¿å…éšè—ä¾èµ–: ç›¸å…³å¤´æ–‡ä»¶, C åº“,C++ åº“, å…¶ä»–åº“çš„ .h, æœ¬é¡¹ç›®å†…çš„ .h.</p><p>é¡¹ç›®å†…å¤´æ–‡ä»¶åº”æŒ‰ç…§é¡¹ç›®æºä»£ç ç›®å½•æ ‘ç»“æ„æ’åˆ—, é¿å…ä½¿ç”¨ UNIXç‰¹æ®Šçš„å¿«æ·ç›®å½• <code>.</code> (å½“å‰ç›®å½•) æˆ– <code>..</code> (ä¸Šçº§ç›®å½•).ä¾‹å¦‚, <code>google-awesome-project/src/base/logging.h</code>åº”è¯¥æŒ‰å¦‚ä¸‹æ–¹å¼åŒ…å«:</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;base/logging.h&quot;</span></span></span><br></pre></td></tr></table></figure><p>åˆå¦‚, <code>dir/foo.cc</code> æˆ– <code>dir/foo_test.cc</code>çš„ä¸»è¦ä½œç”¨æ˜¯å®ç°æˆ–æµ‹è¯• <code>dir2/foo2.h</code> çš„åŠŸèƒ½,<code>foo.cc</code> ä¸­åŒ…å«å¤´æ–‡ä»¶çš„æ¬¡åºå¦‚ä¸‹:</p><blockquote><ol type="1"><li><code>dir2/foo2.h</code> (ä¼˜å…ˆä½ç½®, è¯¦æƒ…å¦‚ä¸‹)</li><li>C ç³»ç»Ÿæ–‡ä»¶</li><li>C++ ç³»ç»Ÿæ–‡ä»¶</li><li>å…¶ä»–åº“çš„ <code>.h</code> æ–‡ä»¶</li><li>æœ¬é¡¹ç›®å†… <code>.h</code> æ–‡ä»¶</li></ol></blockquote><p>è¿™ç§ä¼˜å…ˆçš„é¡ºåºæ’åºä¿è¯å½“ <code>dir2/foo2.h</code>é—æ¼æŸäº›å¿…è¦çš„åº“æ—¶ï¼Œ <code>dir/foo.cc</code> æˆ–<code>dir/foo_test.cc</code>çš„æ„å»ºä¼šç«‹åˆ»ä¸­æ­¢ã€‚å› æ­¤è¿™ä¸€æ¡è§„åˆ™ä¿è¯ç»´æŠ¤è¿™äº›æ–‡ä»¶çš„äººä»¬é¦–å…ˆçœ‹åˆ°æ„å»ºä¸­æ­¢çš„æ¶ˆæ¯è€Œä¸æ˜¯ç»´æŠ¤å…¶ä»–åŒ…çš„äººä»¬ã€‚</p><p><code>dir/foo.cc</code> å’Œ <code>dir2/foo2.h</code>é€šå¸¸ä½äºåŒä¸€ç›®å½•ä¸‹ (å¦‚ <code>base/basictypes_unittest.cc</code> å’Œ<code>base/basictypes.h</code>), ä½†ä¹Ÿå¯ä»¥æ”¾åœ¨ä¸åŒç›®å½•ä¸‹.</p><p>æŒ‰å­—æ¯é¡ºåºåˆ†åˆ«å¯¹æ¯ç§ç±»å‹çš„å¤´æ–‡ä»¶è¿›è¡ŒäºŒæ¬¡æ’åºæ˜¯ä¸é”™çš„ä¸»æ„ã€‚æ³¨æ„è¾ƒè€çš„ä»£ç å¯ä¸ç¬¦åˆè¿™æ¡è§„åˆ™ï¼Œè¦åœ¨æ–¹ä¾¿çš„æ—¶å€™æ”¹æ­£å®ƒä»¬ã€‚</p><p>æ‚¨æ‰€ä¾èµ–çš„ç¬¦å· (symbols)è¢«å“ªäº›å¤´æ–‡ä»¶æ‰€å®šä¹‰ï¼Œæ‚¨å°±åº”è¯¥åŒ…å«ï¼ˆincludeï¼‰å“ªäº›å¤´æ–‡ä»¶ï¼Œ<ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/headers/##forward-declarations">å‰ç½®å£°æ˜</a>(forward declarations) æƒ…å†µé™¤å¤–ã€‚æ¯”å¦‚æ‚¨è¦ç”¨åˆ° <code>bar.h</code>ä¸­çš„æŸä¸ªç¬¦å·, å“ªæ€•æ‚¨æ‰€åŒ…å«çš„ <code>foo.h</code> å·²ç»åŒ…å«äº†<code>bar.h</code>, ä¹Ÿç…§æ ·å¾—åŒ…å« <code>bar.h</code>, é™¤é<code>foo.h</code> æœ‰æ˜ç¡®è¯´æ˜å®ƒä¼šè‡ªåŠ¨å‘æ‚¨æä¾› <code>bar.h</code> ä¸­çš„symbol. ä¸è¿‡ï¼Œå‡¡æ˜¯ ccæ–‡ä»¶æ‰€å¯¹åº”çš„ã€Œç›¸å…³å¤´æ–‡ä»¶ã€å·²ç»åŒ…å«çš„ï¼Œå°±ä¸ç”¨å†é‡å¤åŒ…å«è¿›å…¶ ccæ–‡ä»¶é‡Œé¢äº†ï¼Œå°±åƒ <code>foo.cc</code> åªåŒ…å« <code>foo.h</code>å°±å¤Ÿäº†ï¼Œä¸ç”¨å†ç®¡åè€…æ‰€åŒ…å«çš„å…¶å®ƒå†…å®¹ã€‚</p><p>ä¸¾ä¾‹æ¥è¯´,<code>google-awesome-project/src/foo/internal/fooserver.cc</code>çš„åŒ…å«æ¬¡åºå¦‚ä¸‹:</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;foo/public/fooserver.h&quot;</span> <span class="comment">// ä¼˜å…ˆä½ç½®</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;hash_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;base/basictypes.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;base/commandlineflags.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;foo/public/bar.h&quot;</span></span></span><br></pre></td></tr></table></figure></blockquote><p><strong>ä¾‹å¤–ï¼š</strong></p><p>æœ‰æ—¶ï¼Œå¹³å°ç‰¹å®šï¼ˆsystem-specificï¼‰ä»£ç éœ€è¦æ¡ä»¶ç¼–è¯‘ï¼ˆconditionalincludesï¼‰ï¼Œè¿™äº›ä»£ç å¯ä»¥æ”¾åˆ°å…¶å®ƒ includesä¹‹åã€‚å½“ç„¶ï¼Œæ‚¨çš„å¹³å°ç‰¹å®šä»£ç ä¹Ÿè¦å¤Ÿç®€ç»ƒä¸”ç‹¬ç«‹ï¼Œæ¯”å¦‚ï¼š</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;foo/public/fooserver.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;base/port.h&quot;</span>  <span class="comment">// For LANG_CXX11.</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> LANG_CXX11</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;initializer_list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span>  <span class="comment">// LANG_CXX11</span></span></span><br></pre></td></tr></table></figure></blockquote><h3 id="è¯‘è€…-yulefox-ç¬”è®°">è¯‘è€… (YuleFox) ç¬”è®°</h3><ol type="1"><li>é¿å…å¤šé‡åŒ…å«æ˜¯å­¦ç¼–ç¨‹æ—¶æœ€åŸºæœ¬çš„è¦æ±‚;</li><li>å‰ç½®å£°æ˜æ˜¯ä¸ºäº†é™ä½ç¼–è¯‘ä¾èµ–ï¼Œé˜²æ­¢ä¿®æ”¹ä¸€ä¸ªå¤´æ–‡ä»¶å¼•å‘å¤šç±³è¯ºæ•ˆåº”;</li><li>å†…è”å‡½æ•°çš„åˆç†ä½¿ç”¨å¯æé«˜ä»£ç æ‰§è¡Œæ•ˆç‡;</li><li><code>-inl.h</code> å¯æé«˜ä»£ç å¯è¯»æ€§ (ä¸€èˆ¬ç”¨ä¸åˆ°å§:D);</li><li>æ ‡å‡†åŒ–å‡½æ•°å‚æ•°é¡ºåºå¯ä»¥æé«˜å¯è¯»æ€§å’Œæ˜“ç»´æŠ¤æ€§(å¯¹å‡½æ•°å‚æ•°çš„å †æ ˆç©ºé—´æœ‰è½»å¾®å½±å“, æˆ‘ä»¥å‰å¤§å¤šæ˜¯ç›¸åŒç±»å‹æ”¾åœ¨ä¸€èµ·);</li><li>åŒ…å«æ–‡ä»¶çš„åç§°ä½¿ç”¨ <code>.</code> å’Œ <code>..</code>è™½ç„¶æ–¹ä¾¿å´æ˜“æ··ä¹±, ä½¿ç”¨æ¯”è¾ƒå®Œæ•´çš„é¡¹ç›®è·¯å¾„çœ‹ä¸Šå»å¾ˆæ¸…æ™°, å¾ˆæ¡ç†,åŒ…å«æ–‡ä»¶çš„æ¬¡åºé™¤äº†ç¾è§‚ä¹‹å¤–, æœ€é‡è¦çš„æ˜¯å¯ä»¥å‡å°‘éšè—ä¾èµ–, ä½¿æ¯ä¸ªå¤´æ–‡ä»¶åœ¨â€œæœ€éœ€è¦ç¼–è¯‘â€ (å¯¹åº”æºæ–‡ä»¶å¤„ :D) çš„åœ°æ–¹ç¼–è¯‘, æœ‰äººæå‡ºåº“æ–‡ä»¶æ”¾åœ¨æœ€å,è¿™æ ·å‡ºé”™å…ˆæ˜¯é¡¹ç›®å†…çš„æ–‡ä»¶, å¤´æ–‡ä»¶éƒ½æ”¾åœ¨å¯¹åº”æºæ–‡ä»¶çš„æœ€å‰é¢,è¿™ä¸€ç‚¹è¶³ä»¥ä¿è¯å†…éƒ¨é”™è¯¯çš„åŠæ—¶å‘ç°äº†.</li></ol><h3 id="è¯‘è€…acgtyrantç¬”è®°">è¯‘è€…ï¼ˆacgtyrantï¼‰ç¬”è®°</h3><ol type="1"><li>åŸæ¥è¿˜çœŸæœ‰é¡¹ç›®ç”¨ <code>##includes</code> æ¥æ’å…¥æ–‡æœ¬ï¼Œä¸”å…¶æ–‡ä»¶æ‰©å±•å<code>.inc</code> çœ‹ä¸Šå»ä¹Ÿå¾ˆç§‘å­¦ã€‚</li><li>Google å·²ç»ä¸å†æå€¡ <code>-inl.h</code> ç”¨æ³•ã€‚</li><li>æ³¨æ„ï¼Œå‰ç½®å£°æ˜çš„ç±»æ˜¯ä¸å®Œå…¨ç±»å‹ï¼ˆincompletetypeï¼‰ï¼Œæˆ‘ä»¬åªèƒ½å®šä¹‰æŒ‡å‘è¯¥ç±»å‹çš„æŒ‡é’ˆæˆ–å¼•ç”¨ï¼Œæˆ–è€…å£°æ˜ï¼ˆä½†ä¸èƒ½å®šä¹‰ï¼‰ä»¥ä¸å®Œå…¨ç±»å‹ä½œä¸ºå‚æ•°æˆ–è€…è¿”å›ç±»å‹çš„å‡½æ•°ã€‚æ¯•ç«Ÿç¼–è¯‘å™¨ä¸çŸ¥é“ä¸å®Œå…¨ç±»å‹çš„å®šä¹‰ï¼Œæˆ‘ä»¬ä¸èƒ½åˆ›å»ºå…¶ç±»çš„ä»»ä½•å¯¹è±¡ï¼Œä¹Ÿä¸èƒ½å£°æ˜æˆç±»å†…éƒ¨çš„æ•°æ®æˆå‘˜ã€‚</li><li>ç±»å†…éƒ¨çš„å‡½æ•°ä¸€èˆ¬ä¼šè‡ªåŠ¨å†…è”ã€‚æ‰€ä»¥æŸå‡½æ•°ä¸€æ—¦ä¸éœ€è¦å†…è”ï¼Œå…¶å®šä¹‰å°±ä¸è¦å†æ”¾åœ¨å¤´æ–‡ä»¶é‡Œï¼Œè€Œæ˜¯æ”¾åˆ°å¯¹åº”çš„<code>.cc</code>æ–‡ä»¶é‡Œã€‚è¿™æ ·å¯ä»¥ä¿æŒå¤´æ–‡ä»¶çš„ç±»ç›¸å½“ç²¾ç‚¼ï¼Œä¹Ÿå¾ˆå¥½åœ°è´¯å½»äº†å£°æ˜ä¸å®šä¹‰åˆ†ç¦»çš„åŸåˆ™ã€‚</li><li>åœ¨ <code>#include</code> ä¸­æ’å…¥ç©ºè¡Œä»¥åˆ†å‰²ç›¸å…³å¤´æ–‡ä»¶, C åº“, C++ åº“,å…¶ä»–åº“çš„ <code>.h</code> å’Œæœ¬é¡¹ç›®å†…çš„ <code>.h</code> æ˜¯ä¸ªå¥½ä¹ æƒ¯ã€‚</li></ol></div><div class="story post-story"><h2 id="ä½œç”¨åŸŸ">2. ä½œç”¨åŸŸ</h2><h3 id="å‘½åç©ºé—´">2.1. å‘½åç©ºé—´</h3><p>Tip</p><p>é¼“åŠ±åœ¨ <code>.cc</code> æ–‡ä»¶å†…ä½¿ç”¨åŒ¿åå‘½åç©ºé—´æˆ– <code>static</code>å£°æ˜. ä½¿ç”¨å…·åçš„å‘½åç©ºé—´æ—¶, å…¶åç§°å¯åŸºäºé¡¹ç›®åæˆ–ç›¸å¯¹è·¯å¾„. ç¦æ­¢ä½¿ç”¨ usingæŒ‡ç¤ºï¼ˆusing-directiveï¼‰ã€‚ç¦æ­¢ä½¿ç”¨å†…è”å‘½åç©ºé—´ï¼ˆinline namespaceï¼‰ã€‚</p><p><strong>å®šä¹‰:</strong></p><blockquote><p>å‘½åç©ºé—´å°†å…¨å±€ä½œç”¨åŸŸç»†åˆ†ä¸ºç‹¬ç«‹çš„, å…·åçš„ä½œç”¨åŸŸ,å¯æœ‰æ•ˆé˜²æ­¢å…¨å±€ä½œç”¨åŸŸçš„å‘½åå†²çª.</p></blockquote><p><strong>ä¼˜ç‚¹:</strong></p><blockquote><p>è™½ç„¶ç±»å·²ç»æä¾›äº†ï¼ˆå¯åµŒå¥—çš„ï¼‰å‘½åè½´çº¿ (YuleFox æ³¨:å°†å‘½ååˆ†å‰²åœ¨ä¸åŒç±»çš„ä½œç”¨åŸŸå†…), å‘½åç©ºé—´åœ¨è¿™åŸºç¡€ä¸Šåˆå°è£…äº†ä¸€å±‚.</p><p>ä¸¾ä¾‹æ¥è¯´, ä¸¤ä¸ªä¸åŒé¡¹ç›®çš„å…¨å±€ä½œç”¨åŸŸéƒ½æœ‰ä¸€ä¸ªç±» <code>Foo</code>,è¿™æ ·åœ¨ç¼–è¯‘æˆ–è¿è¡Œæ—¶é€ æˆå†²çª. å¦‚æœæ¯ä¸ªé¡¹ç›®å°†ä»£ç ç½®äºä¸åŒå‘½åç©ºé—´ä¸­,<code>project1::Foo</code> å’Œ <code>project2::Foo</code>ä½œä¸ºä¸åŒç¬¦å·è‡ªç„¶ä¸ä¼šå†²çª.</p><p>å†…è”å‘½åç©ºé—´ä¼šè‡ªåŠ¨æŠŠå†…éƒ¨çš„æ ‡è¯†ç¬¦æ”¾åˆ°å¤–å±‚ä½œç”¨åŸŸï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> X &#123;</span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">namespace</span> Y &#123;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">()</span></span>;</span><br><span class="line">&#125;  <span class="comment">// namespace Y</span></span><br><span class="line">&#125;  <span class="comment">// namespace X</span></span><br></pre></td></tr></table></figure><p><code>X::Y::foo()</code> ä¸ <code>X::foo()</code>å½¼æ­¤å¯ä»£æ›¿ã€‚å†…è”å‘½åç©ºé—´ä¸»è¦ç”¨æ¥ä¿æŒè·¨ç‰ˆæœ¬çš„ ABI å…¼å®¹æ€§ã€‚</p></blockquote><p><strong>ç¼ºç‚¹:</strong></p><blockquote><p>å‘½åç©ºé—´å…·æœ‰è¿·æƒ‘æ€§,å› ä¸ºå®ƒä»¬ä½¿å¾—åŒºåˆ†ä¸¤ä¸ªç›¸åŒå‘½åæ‰€æŒ‡ä»£çš„å®šä¹‰æ›´åŠ å›°éš¾ã€‚</p><p>å†…è”å‘½åç©ºé—´å¾ˆå®¹æ˜“ä»¤äººè¿·æƒ‘ï¼Œæ¯•ç«Ÿå…¶å†…éƒ¨çš„æˆå‘˜ä¸å†å—å…¶å£°æ˜æ‰€åœ¨å‘½åç©ºé—´çš„é™åˆ¶ã€‚å†…è”å‘½åç©ºé—´åªåœ¨å¤§å‹ç‰ˆæœ¬æ§åˆ¶é‡Œæœ‰ç”¨ã€‚</p><p>æœ‰æ—¶å€™ä¸å¾—ä¸å¤šæ¬¡å¼•ç”¨æŸä¸ªå®šä¹‰åœ¨è®¸å¤šåµŒå¥—å‘½åç©ºé—´é‡Œçš„å®ä½“ï¼Œä½¿ç”¨å®Œæ•´çš„å‘½åç©ºé—´ä¼šå¯¼è‡´ä»£ç çš„å†—é•¿ã€‚</p><p>åœ¨å¤´æ–‡ä»¶ä¸­ä½¿ç”¨åŒ¿åç©ºé—´å¯¼è‡´è¿èƒŒ C++ çš„å”¯ä¸€å®šä¹‰åŸåˆ™ (One DefinitionRule (ODR)).</p></blockquote><p><strong>ç»“è®º:</strong></p><blockquote><p>æ ¹æ®ä¸‹æ–‡å°†è¦æåˆ°çš„ç­–ç•¥åˆç†ä½¿ç”¨å‘½åç©ºé—´.</p><ul><li><p>éµå®ˆ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/scoping/naming.html##namespace-names">å‘½åç©ºé—´å‘½å</a>ä¸­çš„è§„åˆ™ã€‚</p></li><li><p>åƒä¹‹å‰çš„å‡ ä¸ªä¾‹å­ä¸­ä¸€æ ·ï¼Œåœ¨å‘½åç©ºé—´çš„æœ€åæ³¨é‡Šå‡ºå‘½åç©ºé—´çš„åå­—ã€‚</p></li><li><p>ç”¨å‘½åç©ºé—´æŠŠæ–‡ä»¶åŒ…å«, <ahref="https://gflags.github.io/gflags/">gflags</a> çš„å£°æ˜/å®šä¹‰,ä»¥åŠç±»çš„å‰ç½®å£°æ˜ä»¥å¤–çš„æ•´ä¸ªæºæ–‡ä»¶å°è£…èµ·æ¥, ä»¥åŒºåˆ«äºå…¶å®ƒå‘½åç©ºé—´:</p><blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .h æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">namespace</span> mynamespace &#123;</span><br><span class="line"><span class="comment">// æ‰€æœ‰å£°æ˜éƒ½ç½®äºå‘½åç©ºé—´ä¸­</span></span><br><span class="line"><span class="comment">// æ³¨æ„ä¸è¦ä½¿ç”¨ç¼©è¿›</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Foo</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line">&#125; <span class="comment">// namespace mynamespace</span></span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .cc æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">namespace</span> mynamespace &#123;</span><br><span class="line"><span class="comment">// å‡½æ•°å®šä¹‰éƒ½ç½®äºå‘½åç©ºé—´ä¸­</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyClass::Foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="comment">// namespace mynamespace</span></span><br></pre></td></tr></table></figure><p>æ›´å¤æ‚çš„ <code>.cc</code> æ–‡ä»¶åŒ…å«æ›´å¤š, æ›´å¤æ‚çš„ç»†èŠ‚, æ¯”å¦‚ gflags æˆ–using å£°æ˜ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;a.h&quot;</span></span></span><br><span class="line"><span class="built_in">DEFINE_FLAG</span>(<span class="type">bool</span>, someflag, <span class="literal">false</span>, <span class="string">&quot;dummy flag&quot;</span>);</span><br><span class="line"><span class="keyword">namespace</span> a &#123;</span><br><span class="line"></span><br><span class="line">...code <span class="keyword">for</span> a...                <span class="comment">// å·¦å¯¹é½</span></span><br><span class="line"></span><br><span class="line">&#125; <span class="comment">// namespace a</span></span><br></pre></td></tr></table></figure></blockquote></li><li><p>ä¸è¦åœ¨å‘½åç©ºé—´ <code>std</code> å†…å£°æ˜ä»»ä½•ä¸œè¥¿,åŒ…æ‹¬æ ‡å‡†åº“çš„ç±»å‰ç½®å£°æ˜. åœ¨ <code>std</code>å‘½åç©ºé—´å£°æ˜å®ä½“æ˜¯æœªå®šä¹‰çš„è¡Œä¸º, ä¼šå¯¼è‡´å¦‚ä¸å¯ç§»æ¤. å£°æ˜æ ‡å‡†åº“ä¸‹çš„å®ä½“,éœ€è¦åŒ…å«å¯¹åº”çš„å¤´æ–‡ä»¶.</p></li><li><p>ä¸åº”è¯¥ä½¿ç”¨ <em>using æŒ‡ç¤º</em> å¼•å…¥æ•´ä¸ªå‘½åç©ºé—´çš„æ ‡è¯†ç¬¦å·ã€‚</p><blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¦æ­¢ â€”â€” æ±¡æŸ“å‘½åç©ºé—´</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> foo;</span><br></pre></td></tr></table></figure></blockquote></li><li><p>ä¸è¦åœ¨å¤´æ–‡ä»¶ä¸­ä½¿ç”¨ <em>å‘½åç©ºé—´åˆ«å</em>é™¤éæ˜¾å¼æ ‡è®°å†…éƒ¨å‘½åç©ºé—´ä½¿ç”¨ã€‚å› ä¸ºä»»ä½•åœ¨å¤´æ–‡ä»¶ä¸­å¼•å…¥çš„å‘½åç©ºé—´éƒ½ä¼šæˆä¸ºå…¬å¼€APIçš„ä¸€éƒ¨åˆ†ã€‚</p><blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨ .cc ä¸­ä½¿ç”¨åˆ«åç¼©çŸ­å¸¸ç”¨çš„å‘½åç©ºé—´</span></span><br><span class="line"><span class="keyword">namespace</span> baz = ::foo::bar::baz;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨ .h ä¸­ä½¿ç”¨åˆ«åç¼©çŸ­å¸¸ç”¨çš„å‘½åç©ºé—´</span></span><br><span class="line"><span class="keyword">namespace</span> librarian &#123;</span><br><span class="line"><span class="keyword">namespace</span> impl &#123;  <span class="comment">// ä»…é™å†…éƒ¨ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">namespace</span> sidetable = ::pipeline_diagnostics::sidetable;</span><br><span class="line">&#125;  <span class="comment">// namespace impl</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">my_inline_function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// é™åˆ¶åœ¨ä¸€ä¸ªå‡½æ•°ä¸­çš„å‘½åç©ºé—´åˆ«å</span></span><br><span class="line">  <span class="keyword">namespace</span> baz = ::foo::bar::baz;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line">&#125;  <span class="comment">// namespace librarian</span></span><br></pre></td></tr></table></figure></blockquote></li><li><p>ç¦æ­¢ç”¨å†…è”å‘½åç©ºé—´</p></li></ul></blockquote><h3 id="åŒ¿åå‘½åç©ºé—´å’Œé™æ€å˜é‡">2.2. åŒ¿åå‘½åç©ºé—´å’Œé™æ€å˜é‡</h3><p>Tip</p><p>åœ¨ <code>.cc</code>æ–‡ä»¶ä¸­å®šä¹‰ä¸€ä¸ªä¸éœ€è¦è¢«å¤–éƒ¨å¼•ç”¨çš„å˜é‡æ—¶ï¼Œå¯ä»¥å°†å®ƒä»¬æ”¾åœ¨åŒ¿åå‘½åç©ºé—´æˆ–å£°æ˜ä¸º<code>static</code> ã€‚ä½†æ˜¯ä¸è¦åœ¨ <code>.h</code> æ–‡ä»¶ä¸­è¿™ä¹ˆåšã€‚</p><p><strong>å®šä¹‰:</strong></p><blockquote><p>æ‰€æœ‰ç½®äºåŒ¿åå‘½åç©ºé—´çš„å£°æ˜éƒ½å…·æœ‰å†…éƒ¨é“¾æ¥æ€§ï¼Œå‡½æ•°å’Œå˜é‡å¯ä»¥ç»ç”±å£°æ˜ä¸º<code>static</code>æ‹¥æœ‰å†…éƒ¨é“¾æ¥æ€§ï¼Œè¿™æ„å‘³ç€ä½ åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­å£°æ˜çš„è¿™äº›æ ‡è¯†ç¬¦éƒ½ä¸èƒ½åœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­è¢«è®¿é—®ã€‚å³ä½¿ä¸¤ä¸ªæ–‡ä»¶å£°æ˜äº†å®Œå…¨ä¸€æ ·åå­—çš„æ ‡è¯†ç¬¦ï¼Œå®ƒä»¬æ‰€æŒ‡å‘çš„å®ä½“å®é™…ä¸Šæ˜¯å®Œå…¨ä¸åŒçš„ã€‚</p></blockquote><p><strong>ç»“è®º:</strong></p><blockquote><p>æ¨èã€é¼“åŠ±åœ¨ <code>.cc</code>ä¸­å¯¹äºä¸éœ€è¦åœ¨å…¶ä»–åœ°æ–¹å¼•ç”¨çš„æ ‡è¯†ç¬¦ä½¿ç”¨å†…éƒ¨é“¾æ¥æ€§å£°æ˜ï¼Œä½†æ˜¯ä¸è¦åœ¨<code>.h</code> ä¸­ä½¿ç”¨ã€‚</p><p>åŒ¿åå‘½åç©ºé—´çš„å£°æ˜å’Œå…·åçš„æ ¼å¼ç›¸åŒï¼Œåœ¨æœ€åæ³¨é‡Šä¸Š<code>namespace</code> :</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">...</span><br><span class="line">&#125;  <span class="comment">// namespace</span></span><br></pre></td></tr></table></figure></blockquote><h3 id="éæˆå‘˜å‡½æ•°é™æ€æˆå‘˜å‡½æ•°å’Œå…¨å±€å‡½æ•°">2.3.éæˆå‘˜å‡½æ•°ã€é™æ€æˆå‘˜å‡½æ•°å’Œå…¨å±€å‡½æ•°</h3><p>Tip</p><p>ä½¿ç”¨é™æ€æˆå‘˜å‡½æ•°æˆ–å‘½åç©ºé—´å†…çš„éæˆå‘˜å‡½æ•°, å°½é‡ä¸è¦ç”¨è£¸çš„å…¨å±€å‡½æ•°.å°†ä¸€ç³»åˆ—å‡½æ•°ç›´æ¥ç½®äºå‘½åç©ºé—´ä¸­ï¼Œä¸è¦ç”¨ç±»çš„é™æ€æ–¹æ³•æ¨¡æ‹Ÿå‡ºå‘½åç©ºé—´çš„æ•ˆæœï¼Œç±»çš„é™æ€æ–¹æ³•åº”å½“å’Œç±»çš„å®ä¾‹æˆ–é™æ€æ•°æ®ç´§å¯†ç›¸å…³.</p><p><strong>ä¼˜ç‚¹:</strong></p><blockquote><p>æŸäº›æƒ…å†µä¸‹, éæˆå‘˜å‡½æ•°å’Œé™æ€æˆå‘˜å‡½æ•°æ˜¯éå¸¸æœ‰ç”¨çš„,å°†éæˆå‘˜å‡½æ•°æ”¾åœ¨å‘½åç©ºé—´å†…å¯é¿å…æ±¡æŸ“å…¨å±€ä½œç”¨åŸŸ.</p></blockquote><p><strong>ç¼ºç‚¹:</strong></p><blockquote><p>å°†éæˆå‘˜å‡½æ•°å’Œé™æ€æˆå‘˜å‡½æ•°ä½œä¸ºæ–°ç±»çš„æˆå‘˜æˆ–è®¸æ›´æœ‰æ„ä¹‰,å½“å®ƒä»¬éœ€è¦è®¿é—®å¤–éƒ¨èµ„æºæˆ–å…·æœ‰é‡è¦çš„ä¾èµ–å…³ç³»æ—¶æ›´æ˜¯å¦‚æ­¤.</p></blockquote><p><strong>ç»“è®º:</strong></p><blockquote><p>æœ‰æ—¶, æŠŠå‡½æ•°çš„å®šä¹‰åŒç±»çš„å®ä¾‹è„±é’©æ˜¯æœ‰ç›Šçš„, ç”šè‡³æ˜¯å¿…è¦çš„.è¿™æ ·çš„å‡½æ•°å¯ä»¥è¢«å®šä¹‰æˆé™æ€æˆå‘˜, æˆ–æ˜¯éæˆå‘˜å‡½æ•°.éæˆå‘˜å‡½æ•°ä¸åº”ä¾èµ–äºå¤–éƒ¨å˜é‡, åº”å°½é‡ç½®äºæŸä¸ªå‘½åç©ºé—´å†….ç›¸æ¯”å•çº¯ä¸ºäº†å°è£…è‹¥å¹²ä¸å…±äº«ä»»ä½•é™æ€æ•°æ®çš„é™æ€æˆå‘˜å‡½æ•°è€Œåˆ›å»ºç±», ä¸å¦‚ä½¿ç”¨<ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/scoping/##namespaces">2.1.å‘½åç©ºé—´</a> ã€‚ä¸¾ä¾‹è€Œè¨€ï¼Œå¯¹äºå¤´æ–‡ä»¶ <code>myproject/foo_bar.h</code> ,åº”å½“ä½¿ç”¨</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> myproject &#123;</span><br><span class="line"><span class="keyword">namespace</span> foo_bar &#123;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Function1</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Function2</span><span class="params">()</span></span>;</span><br><span class="line">&#125;  <span class="comment">// namespace foo_bar</span></span><br><span class="line">&#125;  <span class="comment">// namespace myproject</span></span><br></pre></td></tr></table></figure><p>è€Œé</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> myproject &#123;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FooBar</span> &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">Function1</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">Function2</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;  <span class="comment">// namespace myproject</span></span><br></pre></td></tr></table></figure><p>å®šä¹‰åœ¨åŒä¸€ç¼–è¯‘å•å…ƒçš„å‡½æ•°,è¢«å…¶ä»–ç¼–è¯‘å•å…ƒç›´æ¥è°ƒç”¨å¯èƒ½ä¼šå¼•å…¥ä¸å¿…è¦çš„è€¦åˆå’Œé“¾æ¥æ—¶ä¾èµ–;é™æ€æˆå‘˜å‡½æ•°å¯¹æ­¤å°¤å…¶æ•æ„Ÿ. å¯ä»¥è€ƒè™‘æå–åˆ°æ–°ç±»ä¸­,æˆ–è€…å°†å‡½æ•°ç½®äºç‹¬ç«‹åº“çš„å‘½åç©ºé—´å†….</p><p>å¦‚æœä½ å¿…é¡»å®šä¹‰éæˆå‘˜å‡½æ•°, åˆåªæ˜¯åœ¨ <code>.cc</code> æ–‡ä»¶ä¸­ä½¿ç”¨å®ƒ,å¯ä½¿ç”¨åŒ¿å <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/scoping/##namespaces">2.1.å‘½åç©ºé—´</a> æˆ– <code>static</code> é“¾æ¥å…³é”®å­— (å¦‚<code>static int Foo() &#123;...&#125;</code>) é™å®šå…¶ä½œç”¨åŸŸ.</p></blockquote><h3 id="å±€éƒ¨å˜é‡">2.4. å±€éƒ¨å˜é‡</h3><p>Tip</p><p>å°†å‡½æ•°å˜é‡å°½å¯èƒ½ç½®äºæœ€å°ä½œç”¨åŸŸå†…, å¹¶åœ¨å˜é‡å£°æ˜æ—¶è¿›è¡Œåˆå§‹åŒ–.</p><p>C++ å…è®¸åœ¨å‡½æ•°çš„ä»»ä½•ä½ç½®å£°æ˜å˜é‡.æˆ‘ä»¬æå€¡åœ¨å°½å¯èƒ½å°çš„ä½œç”¨åŸŸä¸­å£°æ˜å˜é‡, ç¦»ç¬¬ä¸€æ¬¡ä½¿ç”¨è¶Šè¿‘è¶Šå¥½.è¿™ä½¿å¾—ä»£ç æµè§ˆè€…æ›´å®¹æ˜“å®šä½å˜é‡å£°æ˜çš„ä½ç½®, äº†è§£å˜é‡çš„ç±»å‹å’Œåˆå§‹å€¼.ç‰¹åˆ«æ˜¯ï¼Œåº”ä½¿ç”¨åˆå§‹åŒ–çš„æ–¹å¼æ›¿ä»£å£°æ˜å†èµ‹å€¼, æ¯”å¦‚:</p><blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> i;</span><br><span class="line">i = <span class="built_in">f</span>(); <span class="comment">// åâ€”â€”åˆå§‹åŒ–å’Œå£°æ˜åˆ†ç¦»</span></span><br><span class="line"><span class="type">int</span> j = <span class="built_in">g</span>(); <span class="comment">// å¥½â€”â€”åˆå§‹åŒ–æ—¶å£°æ˜</span></span><br><span class="line">vector&lt;<span class="type">int</span>&gt; v;</span><br><span class="line">v.<span class="built_in">push_back</span>(<span class="number">1</span>); <span class="comment">// ç”¨èŠ±æ‹¬å·åˆå§‹åŒ–æ›´å¥½</span></span><br><span class="line">v.<span class="built_in">push_back</span>(<span class="number">2</span>);</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; v = &#123;<span class="number">1</span>, <span class="number">2</span>&#125;; <span class="comment">// å¥½â€”â€”v ä¸€å¼€å§‹å°±åˆå§‹åŒ–</span></span><br></pre></td></tr></table></figure></blockquote><p>å±äº <code>if</code>, <code>while</code> å’Œ <code>for</code>è¯­å¥çš„å˜é‡åº”å½“åœ¨è¿™äº›è¯­å¥ä¸­æ­£å¸¸åœ°å£°æ˜ï¼Œè¿™æ ·å­è¿™äº›å˜é‡çš„ä½œç”¨åŸŸå°±è¢«é™åˆ¶åœ¨è¿™äº›è¯­å¥ä¸­äº†ï¼Œä¸¾ä¾‹è€Œè¨€:</p><blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="type">const</span> <span class="type">char</span>* p = <span class="built_in">strchr</span>(str, <span class="string">&#x27;/&#x27;</span>)) str = p + <span class="number">1</span>;</span><br></pre></td></tr></table></figure></blockquote><p>Warning</p><p>æœ‰ä¸€ä¸ªä¾‹å¤–, å¦‚æœå˜é‡æ˜¯ä¸€ä¸ªå¯¹è±¡, æ¯æ¬¡è¿›å…¥ä½œç”¨åŸŸéƒ½è¦è°ƒç”¨å…¶æ„é€ å‡½æ•°,æ¯æ¬¡é€€å‡ºä½œç”¨åŸŸéƒ½è¦è°ƒç”¨å…¶ææ„å‡½æ•°. è¿™ä¼šå¯¼è‡´æ•ˆç‡é™ä½.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½æ•ˆçš„å®ç°</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000000</span>; ++i) &#123;</span><br><span class="line">    Foo f;                  <span class="comment">// æ„é€ å‡½æ•°å’Œææ„å‡½æ•°åˆ†åˆ«è°ƒç”¨ 1000000 æ¬¡!</span></span><br><span class="line">    f.<span class="built_in">DoSomething</span>(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å¾ªç¯ä½œç”¨åŸŸå¤–é¢å£°æ˜è¿™ç±»å˜é‡è¦é«˜æ•ˆçš„å¤š:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Foo f;                      <span class="comment">// æ„é€ å‡½æ•°å’Œææ„å‡½æ•°åªè°ƒç”¨ 1 æ¬¡</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000000</span>; ++i) &#123;</span><br><span class="line">    f.<span class="built_in">DoSomething</span>(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é™æ€å’Œå…¨å±€å˜é‡">2.5. é™æ€å’Œå…¨å±€å˜é‡</h3><p>Tip</p><p>ç¦æ­¢å®šä¹‰é™æ€å‚¨å­˜å‘¨æœŸéPODå˜é‡ï¼Œç¦æ­¢ä½¿ç”¨å«æœ‰å‰¯ä½œç”¨çš„å‡½æ•°åˆå§‹åŒ–PODå…¨å±€å˜é‡ï¼Œå› ä¸ºå¤šç¼–è¯‘å•å…ƒä¸­çš„é™æ€å˜é‡æ‰§è¡Œæ—¶çš„æ„é€ å’Œææ„é¡ºåºæ˜¯æœªæ˜ç¡®çš„ï¼Œè¿™å°†å¯¼è‡´ä»£ç çš„ä¸å¯ç§»æ¤ã€‚</p><p>ç¦æ­¢ä½¿ç”¨ç±»çš„ <ahref="http://zh.cppreference.com/w/cpp/language/storage_duration##.E5.AD.98.E5.82.A8.E6.9C.9F">é™æ€å‚¨å­˜å‘¨æœŸ</a>å˜é‡ï¼šç”±äºæ„é€ å’Œææ„å‡½æ•°è°ƒç”¨é¡ºåºçš„ä¸ç¡®å®šæ€§ï¼Œå®ƒä»¬ä¼šå¯¼è‡´éš¾ä»¥å‘ç°çš„ bugã€‚ä¸è¿‡ <code>constexpr</code>å˜é‡é™¤å¤–ï¼Œæ¯•ç«Ÿå®ƒä»¬åˆä¸æ¶‰åŠåŠ¨æ€åˆå§‹åŒ–æˆ–ææ„ã€‚</p><p>é™æ€ç”Ÿå­˜å‘¨æœŸçš„å¯¹è±¡ï¼Œå³åŒ…æ‹¬äº†å…¨å±€å˜é‡ï¼Œé™æ€å˜é‡ï¼Œé™æ€ç±»æˆå‘˜å˜é‡å’Œå‡½æ•°é™æ€å˜é‡ï¼Œéƒ½å¿…é¡»æ˜¯åŸç”Ÿæ•°æ®ç±»å‹(POD : Plain Old Data): å³ int, char å’Œ float, ä»¥åŠ PODç±»å‹çš„æŒ‡é’ˆã€æ•°ç»„å’Œç»“æ„ä½“ã€‚</p><p>é™æ€å˜é‡çš„æ„é€ å‡½æ•°ã€ææ„å‡½æ•°å’Œåˆå§‹åŒ–çš„é¡ºåºåœ¨ C++ä¸­æ˜¯åªæœ‰éƒ¨åˆ†æ˜ç¡®çš„ï¼Œç”šè‡³éšç€æ„å»ºå˜åŒ–è€Œå˜åŒ–ï¼Œå¯¼è‡´éš¾ä»¥å‘ç°çš„ bug.æ‰€ä»¥é™¤äº†ç¦ç”¨ç±»ç±»å‹çš„å…¨å±€å˜é‡ï¼Œæˆ‘ä»¬ä¹Ÿä¸å…è®¸ç”¨å‡½æ•°è¿”å›å€¼æ¥åˆå§‹åŒ– PODå˜é‡ï¼Œé™¤éè¯¥å‡½æ•°ï¼ˆæ¯”å¦‚ <code>getenv()</code> æˆ– <code>getpid()</code>ï¼‰ä¸æ¶‰åŠä»»ä½•å…¨å±€å˜é‡ã€‚å‡½æ•°ä½œç”¨åŸŸé‡Œçš„é™æ€å˜é‡é™¤å¤–ï¼Œæ¯•ç«Ÿå®ƒçš„åˆå§‹åŒ–é¡ºåºæ˜¯æœ‰æ˜ç¡®å®šä¹‰çš„ï¼Œè€Œä¸”åªä¼šåœ¨æŒ‡ä»¤æ‰§è¡Œåˆ°å®ƒçš„å£°æ˜é‚£é‡Œæ‰ä¼šå‘ç”Ÿã€‚</p><p>Note</p><p>Xris è¯‘æ³¨:</p><p>åŒä¸€ä¸ªç¼–è¯‘å•å…ƒå†…æ˜¯æ˜ç¡®çš„ï¼Œé™æ€åˆå§‹åŒ–ä¼˜å…ˆäºåŠ¨æ€åˆå§‹åŒ–ï¼Œåˆå§‹åŒ–é¡ºåºæŒ‰ç…§å£°æ˜é¡ºåºè¿›è¡Œï¼Œé”€æ¯åˆ™é€†åºã€‚ä¸åŒçš„ç¼–è¯‘å•å…ƒä¹‹é—´åˆå§‹åŒ–å’Œé”€æ¯é¡ºåºå±äºæœªæ˜ç¡®è¡Œä¸º(unspecified behaviour)ã€‚</p><p>åŒç†ï¼Œå…¨å±€å’Œé™æ€å˜é‡åœ¨ç¨‹åºä¸­æ–­æ—¶ä¼šè¢«ææ„ï¼Œæ— è®ºæ‰€è°“ä¸­æ–­æ˜¯ä»<code>main()</code> è¿”å›è¿˜æ˜¯å¯¹ <code>exit()</code>çš„è°ƒç”¨ã€‚ææ„é¡ºåºæ­£å¥½ä¸æ„é€ å‡½æ•°è°ƒç”¨çš„é¡ºåºç›¸åã€‚ä½†æ—¢ç„¶æ„é€ é¡ºåºæœªå®šä¹‰ï¼Œé‚£ä¹ˆææ„é¡ºåºå½“ç„¶ä¹Ÿå°±ä¸å®šäº†ã€‚æ¯”å¦‚ï¼Œåœ¨ç¨‹åºç»“æŸæ—¶æŸé™æ€å˜é‡å·²ç»è¢«ææ„äº†ï¼Œä½†ä»£ç è¿˜åœ¨è·‘â€”â€”æ¯”å¦‚å…¶å®ƒçº¿ç¨‹â€”â€”å¹¶è¯•å›¾è®¿é—®å®ƒä¸”å¤±è´¥ï¼›å†æ¯”å¦‚ï¼Œä¸€ä¸ªé™æ€string å˜é‡ä¹Ÿè®¸ä¼šåœ¨ä¸€ä¸ªå¼•ç”¨äº†å‰è€…çš„å…¶å®ƒå˜é‡ææ„ä¹‹å‰è¢«ææ„æ‰ã€‚</p><p>æ”¹å–„ä»¥ä¸Šææ„é—®é¢˜çš„åŠæ³•ä¹‹ä¸€æ˜¯ç”¨ <code>quick_exit()</code> æ¥ä»£æ›¿<code>exit()</code>å¹¶ä¸­æ–­ç¨‹åºã€‚å®ƒä»¬çš„ä¸åŒä¹‹å¤„æ˜¯å‰è€…ä¸ä¼šæ‰§è¡Œä»»ä½•ææ„ï¼Œä¹Ÿä¸ä¼šæ‰§è¡Œ<code>atexit()</code> æ‰€ç»‘å®šçš„ä»»ä½• handlers. å¦‚æœæ‚¨æƒ³åœ¨æ‰§è¡Œ<code>quick_exit()</code> æ¥ä¸­æ–­æ—¶æ‰§è¡ŒæŸ handlerï¼ˆæ¯”å¦‚åˆ·æ–°logï¼‰ï¼Œæ‚¨å¯ä»¥æŠŠå®ƒç»‘å®šåˆ° <code>_at_quick_exit()</code>. å¦‚æœæ‚¨æƒ³åœ¨<code>exit()</code> å’Œ <code>quick_exit()</code> éƒ½ç”¨ä¸Šè¯¥ handler,éƒ½ç»‘å®šä¸Šå»ã€‚</p><p>ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬åªå…è®¸ POD ç±»å‹çš„é™æ€å˜é‡ï¼Œå³å®Œå…¨ç¦ç”¨<code>vector</code> (ä½¿ç”¨ C æ•°ç»„æ›¿ä»£) å’Œ <code>string</code> (ä½¿ç”¨<code>const char []</code>)ã€‚</p><p>å¦‚æœæ‚¨ç¡®å®éœ€è¦ä¸€ä¸ª <code>class</code>ç±»å‹çš„é™æ€æˆ–å…¨å±€å˜é‡ï¼Œå¯ä»¥è€ƒè™‘åœ¨ <code>main()</code> å‡½æ•°æˆ–<code>pthread_once()</code> å†…åˆå§‹åŒ–ä¸€ä¸ªæŒ‡é’ˆä¸”æ°¸ä¸å›æ”¶ã€‚æ³¨æ„åªèƒ½ç”¨ rawæŒ‡é’ˆï¼Œåˆ«ç”¨æ™ºèƒ½æŒ‡é’ˆï¼Œæ¯•ç«Ÿåè€…çš„ææ„å‡½æ•°æ¶‰åŠåˆ°ä¸Šæ–‡æŒ‡å‡ºçš„ä¸å®šé¡ºåºé—®é¢˜ã€‚</p><p>Note</p><p>Yang.Y è¯‘æ³¨:</p><p>ä¸Šæ–‡æåŠçš„é™æ€å˜é‡æ³›æŒ‡é™æ€ç”Ÿå­˜å‘¨æœŸçš„å¯¹è±¡, åŒ…æ‹¬: å…¨å±€å˜é‡, é™æ€å˜é‡,é™æ€ç±»æˆå‘˜å˜é‡, ä»¥åŠå‡½æ•°é™æ€å˜é‡.</p><h3 id="è¯‘è€…-yulefox-ç¬”è®°-1">è¯‘è€… (YuleFox) ç¬”è®°</h3><ol type="1"><li><code>cc</code> ä¸­çš„åŒ¿åå‘½åç©ºé—´å¯é¿å…å‘½åå†²çª, é™å®šä½œç”¨åŸŸ,é¿å…ç›´æ¥ä½¿ç”¨ <code>using</code> å…³é”®å­—æ±¡æŸ“å‘½åç©ºé—´;</li><li>åµŒå¥—ç±»ç¬¦åˆå±€éƒ¨ä½¿ç”¨åŸåˆ™, åªæ˜¯ä¸èƒ½åœ¨å…¶ä»–å¤´æ–‡ä»¶ä¸­å‰ç½®å£°æ˜, å°½é‡ä¸è¦<code>public</code>;</li><li>å°½é‡ä¸ç”¨å…¨å±€å‡½æ•°å’Œå…¨å±€å˜é‡, è€ƒè™‘ä½œç”¨åŸŸå’Œå‘½åç©ºé—´é™åˆ¶,å°½é‡å•ç‹¬å½¢æˆç¼–è¯‘å•å…ƒ;</li><li>å¤šçº¿ç¨‹ä¸­çš„å…¨å±€å˜é‡ (å«é™æ€æˆå‘˜å˜é‡) ä¸è¦ä½¿ç”¨ <code>class</code> ç±»å‹(å« STL å®¹å™¨), é¿å…ä¸æ˜ç¡®è¡Œä¸ºå¯¼è‡´çš„ bug.</li><li>ä½œç”¨åŸŸçš„ä½¿ç”¨, é™¤äº†è€ƒè™‘åç§°æ±¡æŸ“, å¯è¯»æ€§ä¹‹å¤–, ä¸»è¦æ˜¯ä¸ºé™ä½è€¦åˆ,æé«˜ç¼–è¯‘/æ‰§è¡Œæ•ˆç‡.</li></ol><h3 id="è¯‘è€…acgtyrantç¬”è®°-1">è¯‘è€…ï¼ˆacgtyrantï¼‰ç¬”è®°</h3><ol type="1"><li>æ³¨æ„ã€Œusing æŒ‡ç¤ºï¼ˆusing-directiveï¼‰ã€å’Œã€Œusingå£°æ˜ï¼ˆusing-declarationï¼‰ã€çš„åŒºåˆ«ã€‚</li><li>åŒ¿åå‘½åç©ºé—´è¯´ç™½äº†å°±æ˜¯æ–‡ä»¶ä½œç”¨åŸŸï¼Œå°±åƒ C staticå£°æ˜çš„ä½œç”¨åŸŸä¸€æ ·ï¼Œåè€…å·²ç»è¢« C++ æ ‡å‡†æå€¡å¼ƒç”¨ã€‚</li><li>å±€éƒ¨å˜é‡åœ¨å£°æ˜çš„åŒæ—¶è¿›è¡Œæ˜¾å¼å€¼åˆå§‹åŒ–ï¼Œæ¯”èµ·éšå¼åˆå§‹åŒ–å†èµ‹å€¼çš„ä¸¤æ­¥è¿‡ç¨‹è¦é«˜æ•ˆï¼ŒåŒæ—¶ä¹Ÿè´¯å½»äº†è®¡ç®—æœºä½“ç³»ç»“æ„é‡è¦çš„æ¦‚å¿µã€Œå±€éƒ¨æ€§ï¼ˆlocalityï¼‰ã€ã€‚</li><li>æ³¨æ„åˆ«åœ¨å¾ªç¯çŠ¯å¤§é‡æ„é€ å’Œææ„çš„ä½çº§é”™è¯¯ã€‚</li></ol></div><div class="story post-story"><h2 id="ç±»">3. ç±»</h2><p>ç±»æ˜¯ C++ ä¸­ä»£ç çš„åŸºæœ¬å•å…ƒ. æ˜¾ç„¶, å®ƒä»¬è¢«å¹¿æ³›ä½¿ç”¨.æœ¬èŠ‚åˆ—ä¸¾äº†åœ¨å†™ä¸€ä¸ªç±»æ—¶çš„ä¸»è¦æ³¨æ„äº‹é¡¹.</p><h3 id="æ„é€ å‡½æ•°çš„èŒè´£">3.1. æ„é€ å‡½æ•°çš„èŒè´£</h3><p><strong>æ€»è¿°</strong></p><p>ä¸è¦åœ¨æ„é€ å‡½æ•°ä¸­è°ƒç”¨è™šå‡½æ•°,ä¹Ÿä¸è¦åœ¨æ— æ³•æŠ¥å‡ºé”™è¯¯æ—¶è¿›è¡Œå¯èƒ½å¤±è´¥çš„åˆå§‹åŒ–.</p><p><strong>å®šä¹‰</strong></p><p>åœ¨æ„é€ å‡½æ•°ä¸­å¯ä»¥è¿›è¡Œå„ç§åˆå§‹åŒ–æ“ä½œ.</p><p><strong>ä¼˜ç‚¹</strong></p><ul><li>æ— éœ€è€ƒè™‘ç±»æ˜¯å¦è¢«åˆå§‹åŒ–.</li><li>ç»è¿‡æ„é€ å‡½æ•°å®Œå…¨åˆå§‹åŒ–åçš„å¯¹è±¡å¯ä»¥ä¸º <code>const</code> ç±»å‹,ä¹Ÿèƒ½æ›´æ–¹ä¾¿åœ°è¢«æ ‡å‡†å®¹å™¨æˆ–ç®—æ³•ä½¿ç”¨.</li></ul><p><strong>ç¼ºç‚¹</strong></p><ul><li>å¦‚æœåœ¨æ„é€ å‡½æ•°å†…è°ƒç”¨äº†è‡ªèº«çš„è™šå‡½æ•°,è¿™ç±»è°ƒç”¨æ˜¯ä¸ä¼šé‡å®šå‘åˆ°å­ç±»çš„è™šå‡½æ•°å®ç°. å³ä½¿å½“å‰æ²¡æœ‰å­ç±»åŒ–å®ç°,å°†æ¥ä»æ˜¯éšæ‚£.</li><li>åœ¨æ²¡æœ‰ä½¿ç¨‹åºå´©æºƒ (å› ä¸ºå¹¶ä¸æ˜¯ä¸€ä¸ªå§‹ç»ˆåˆé€‚çš„æ–¹æ³•) æˆ–è€…ä½¿ç”¨å¼‚å¸¸(å› ä¸ºå·²ç»è¢« <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/others/##exceptions">ç¦ç”¨</a>äº†) ç­‰æ–¹æ³•çš„æ¡ä»¶ä¸‹, æ„é€ å‡½æ•°å¾ˆéš¾ä¸ŠæŠ¥é”™è¯¯</li><li>å¦‚æœæ‰§è¡Œå¤±è´¥, ä¼šå¾—åˆ°ä¸€ä¸ªåˆå§‹åŒ–å¤±è´¥çš„å¯¹è±¡,è¿™ä¸ªå¯¹è±¡æœ‰å¯èƒ½è¿›å…¥ä¸æ­£å¸¸çš„çŠ¶æ€, å¿…é¡»ä½¿ç”¨ <code>bool IsValid()</code>æˆ–ç±»ä¼¼è¿™æ ·çš„æœºåˆ¶æ‰èƒ½æ£€æŸ¥å‡ºæ¥, ç„¶è€Œè¿™æ˜¯ä¸€ä¸ªååˆ†å®¹æ˜“è¢«ç–å¿½çš„æ–¹æ³•.</li><li>æ„é€ å‡½æ•°çš„åœ°å€æ˜¯æ— æ³•è¢«å–å¾—çš„, å› æ­¤, ä¸¾ä¾‹æ¥è¯´,ç”±æ„é€ å‡½æ•°å®Œæˆçš„å·¥ä½œæ˜¯æ— æ³•ä»¥ç®€å•çš„æ–¹å¼äº¤ç»™å…¶ä»–çº¿ç¨‹çš„.</li></ul><p><strong>ç»“è®º</strong></p><p>æ„é€ å‡½æ•°ä¸å…è®¸è°ƒç”¨è™šå‡½æ•°. å¦‚æœä»£ç å…è®¸,ç›´æ¥ç»ˆæ­¢ç¨‹åºæ˜¯ä¸€ä¸ªåˆé€‚çš„å¤„ç†é”™è¯¯çš„æ–¹å¼. å¦åˆ™, è€ƒè™‘ç”¨ <code>Init()</code>æ–¹æ³•æˆ–å·¥å‚å‡½æ•°.</p><p>æ„é€ å‡½æ•°ä¸å¾—è°ƒç”¨è™šå‡½æ•°, æˆ–å°è¯•æŠ¥å‘Šä¸€ä¸ªéè‡´å‘½é”™è¯¯.å¦‚æœå¯¹è±¡éœ€è¦è¿›è¡Œæœ‰æ„ä¹‰çš„ (non-trivial) åˆå§‹åŒ–, è€ƒè™‘ä½¿ç”¨æ˜ç¡®çš„ Init()æ–¹æ³•æˆ–ä½¿ç”¨å·¥å‚æ¨¡å¼. Avoid <code>Init()</code> methods on objects with noother states that affect which public methods may be called(æ­¤ç±»å½¢å¼çš„åŠæ„é€ å¯¹è±¡æœ‰æ—¶æ— æ³•æ­£ç¡®å·¥ä½œ).</p><h3 id="éšå¼ç±»å‹è½¬æ¢">3.2. éšå¼ç±»å‹è½¬æ¢</h3><p><strong>æ€»è¿°</strong></p><p>ä¸è¦å®šä¹‰éšå¼ç±»å‹è½¬æ¢. å¯¹äºè½¬æ¢è¿ç®—ç¬¦å’Œå•å‚æ•°æ„é€ å‡½æ•°, è¯·ä½¿ç”¨<code>explicit</code> å…³é”®å­—.</p><p><strong>å®šä¹‰</strong></p><p>éšå¼ç±»å‹è½¬æ¢å…è®¸ä¸€ä¸ªæŸç§ç±»å‹ (ç§°ä½œ <em>æºç±»å‹</em>)çš„å¯¹è±¡è¢«ç”¨äºéœ€è¦å¦ä¸€ç§ç±»å‹ (ç§°ä½œ <em>ç›®çš„ç±»å‹</em>) çš„ä½ç½®, ä¾‹å¦‚, å°†ä¸€ä¸ª<code>int</code> ç±»å‹çš„å‚æ•°ä¼ é€’ç»™éœ€è¦ <code>double</code>ç±»å‹çš„å‡½æ•°.</p><p>é™¤äº†è¯­è¨€æ‰€å®šä¹‰çš„éšå¼ç±»å‹è½¬æ¢,ç”¨æˆ·è¿˜å¯ä»¥é€šè¿‡åœ¨ç±»å®šä¹‰ä¸­æ·»åŠ åˆé€‚çš„æˆå‘˜å®šä¹‰è‡ªå·±éœ€è¦çš„è½¬æ¢.åœ¨æºç±»å‹ä¸­å®šä¹‰éšå¼ç±»å‹è½¬æ¢, å¯ä»¥é€šè¿‡ç›®çš„ç±»å‹åçš„ç±»å‹è½¬æ¢è¿ç®—ç¬¦å®ç° (ä¾‹å¦‚<code>operator bool()</code>). åœ¨ç›®çš„ç±»å‹ä¸­å®šä¹‰éšå¼ç±»å‹è½¬æ¢,åˆ™é€šè¿‡ä»¥æºç±»å‹ä½œä¸ºå…¶å”¯ä¸€å‚æ•° (æˆ–å”¯ä¸€æ— é»˜è®¤å€¼çš„å‚æ•°) çš„æ„é€ å‡½æ•°å®ç°.</p><p><code>explicit</code> å…³é”®å­—å¯ä»¥ç”¨äºæ„é€ å‡½æ•°æˆ– (åœ¨ C++11 å¼•å…¥)ç±»å‹è½¬æ¢è¿ç®—ç¬¦,ä»¥ä¿è¯åªæœ‰å½“ç›®çš„ç±»å‹åœ¨è°ƒç”¨ç‚¹è¢«æ˜¾å¼å†™æ˜æ—¶æ‰èƒ½è¿›è¡Œç±»å‹è½¬æ¢, ä¾‹å¦‚ä½¿ç”¨<code>cast</code>. è¿™ä¸ä»…ä½œç”¨äºéšå¼ç±»å‹è½¬æ¢, è¿˜èƒ½ä½œç”¨äº C++11çš„åˆ—è¡¨åˆå§‹åŒ–è¯­æ³•:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span> &#123;</span><br><span class="line">  <span class="function"><span class="keyword">explicit</span> <span class="title">Foo</span><span class="params">(<span class="type">int</span> x, <span class="type">double</span> y)</span></span>;</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Func</span><span class="params">(Foo f)</span></span>;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ä¸‹é¢çš„ä»£ç æ˜¯ä¸å…è®¸çš„:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Func</span>(&#123;<span class="number">42</span>, <span class="number">3.14</span>&#125;);  <span class="comment">// Error</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸€ä»£ç ä»æŠ€æœ¯ä¸Šè¯´å¹¶ééšå¼ç±»å‹è½¬æ¢, ä½†æ˜¯è¯­è¨€æ ‡å‡†è®¤ä¸ºè¿™æ˜¯<code>explicit</code> åº”å½“é™åˆ¶çš„è¡Œä¸º.</p><p><strong>ä¼˜ç‚¹</strong></p><ul><li>æœ‰æ—¶ç›®çš„ç±»å‹åæ˜¯ä¸€ç›®äº†ç„¶çš„, é€šè¿‡é¿å…æ˜¾å¼åœ°å†™å‡ºç±»å‹å,éšå¼ç±»å‹è½¬æ¢å¯ä»¥è®©ä¸€ä¸ªç±»å‹çš„å¯ç”¨æ€§å’Œè¡¨è¾¾æ€§æ›´å¼º.</li><li>éšå¼ç±»å‹è½¬æ¢å¯ä»¥ç®€å•åœ°å–ä»£å‡½æ•°é‡è½½.</li><li>åœ¨åˆå§‹åŒ–å¯¹è±¡æ—¶, åˆ—è¡¨åˆå§‹åŒ–è¯­æ³•æ˜¯ä¸€ç§ç®€æ´æ˜äº†çš„å†™æ³•.</li></ul><p><strong>ç¼ºç‚¹</strong></p><ul><li>éšå¼ç±»å‹è½¬æ¢ä¼šéšè—ç±»å‹ä¸åŒ¹é…çš„é”™è¯¯. æœ‰æ—¶,ç›®çš„ç±»å‹å¹¶ä¸ç¬¦åˆç”¨æˆ·çš„æœŸæœ›, ç”šè‡³ç”¨æˆ·æ ¹æœ¬æ²¡æœ‰æ„è¯†åˆ°å‘ç”Ÿäº†ç±»å‹è½¬æ¢.</li><li>éšå¼ç±»å‹è½¬æ¢ä¼šè®©ä»£ç éš¾ä»¥é˜…è¯», å°¤å…¶æ˜¯åœ¨æœ‰å‡½æ•°é‡è½½çš„æ—¶å€™,å› ä¸ºè¿™æ—¶å¾ˆéš¾åˆ¤æ–­åˆ°åº•æ˜¯å“ªä¸ªå‡½æ•°è¢«è°ƒç”¨.</li><li>å•å‚æ•°æ„é€ å‡½æ•°æœ‰å¯èƒ½ä¼šè¢«æ— æ„åœ°ç”¨ä½œéšå¼ç±»å‹è½¬æ¢.</li><li>å¦‚æœå•å‚æ•°æ„é€ å‡½æ•°æ²¡æœ‰åŠ ä¸Š <code>explicit</code> å…³é”®å­—,è¯»è€…æ— æ³•åˆ¤æ–­è¿™ä¸€å‡½æ•°ç©¶ç«Ÿæ˜¯è¦ä½œä¸ºéšå¼ç±»å‹è½¬æ¢, è¿˜æ˜¯ä½œè€…å¿˜äº†åŠ ä¸Š<code>explicit</code> æ ‡è®°.</li><li>å¹¶æ²¡æœ‰æ˜ç¡®çš„æ–¹æ³•ç”¨æ¥åˆ¤æ–­å“ªä¸ªç±»åº”è¯¥æä¾›ç±»å‹è½¬æ¢,è¿™ä¼šä½¿å¾—ä»£ç å˜å¾—å«ç³Šä¸æ¸….</li><li>å¦‚æœç›®çš„ç±»å‹æ˜¯éšå¼æŒ‡å®šçš„,é‚£ä¹ˆåˆ—è¡¨åˆå§‹åŒ–ä¼šå‡ºç°å’Œéšå¼ç±»å‹è½¬æ¢ä¸€æ ·çš„é—®é¢˜,å°¤å…¶æ˜¯åœ¨åˆ—è¡¨ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™.</li></ul><p><strong>ç»“è®º</strong></p><p>åœ¨ç±»å‹å®šä¹‰ä¸­, ç±»å‹è½¬æ¢è¿ç®—ç¬¦å’Œå•å‚æ•°æ„é€ å‡½æ•°éƒ½åº”å½“ç”¨<code>explicit</code> è¿›è¡Œæ ‡è®°. ä¸€ä¸ªä¾‹å¤–æ˜¯,æ‹·è´å’Œç§»åŠ¨æ„é€ å‡½æ•°ä¸åº”å½“è¢«æ ‡è®°ä¸º <code>explicit</code>,å› ä¸ºå®ƒä»¬å¹¶ä¸æ‰§è¡Œç±»å‹è½¬æ¢.å¯¹äºè®¾è®¡ç›®çš„å°±æ˜¯ç”¨äºå¯¹å…¶ä»–ç±»å‹è¿›è¡Œé€æ˜åŒ…è£…çš„ç±»æ¥è¯´,éšå¼ç±»å‹è½¬æ¢æœ‰æ—¶æ˜¯å¿…è¦ä¸”åˆé€‚çš„. è¿™æ—¶åº”å½“è”ç³»é¡¹ç›®ç»„é•¿å¹¶è¯´æ˜ç‰¹æ®Šæƒ…å†µ.</p><p>ä¸èƒ½ä»¥ä¸€ä¸ªå‚æ•°è¿›è¡Œè°ƒç”¨çš„æ„é€ å‡½æ•°ä¸åº”å½“åŠ ä¸Š <code>explicit</code>.æ¥å—ä¸€ä¸ª <code>std::initializer_list</code> ä½œä¸ºå‚æ•°çš„æ„é€ å‡½æ•°ä¹Ÿåº”å½“çœç•¥<code>explicit</code>, ä»¥ä¾¿æ”¯æŒæ‹·è´åˆå§‹åŒ– (ä¾‹å¦‚<code>MyType m = &#123;1, 2&#125;;)</code> .</p><h3 id="å¯æ‹·è´ç±»å‹å’Œå¯ç§»åŠ¨ç±»å‹">3.3. å¯æ‹·è´ç±»å‹å’Œå¯ç§»åŠ¨ç±»å‹</h3><p><strong>æ€»è¿°</strong></p><p>å¦‚æœä½ çš„ç±»å‹éœ€è¦, å°±è®©å®ƒä»¬æ”¯æŒæ‹·è´ / ç§»åŠ¨. å¦åˆ™,å°±æŠŠéšå¼äº§ç”Ÿçš„æ‹·è´å’Œç§»åŠ¨å‡½æ•°ç¦ç”¨.</p><p><strong>å®šä¹‰</strong></p><p>å¯æ‹·è´ç±»å‹å…è®¸å¯¹è±¡åœ¨åˆå§‹åŒ–æ—¶å¾—åˆ°æ¥è‡ªç›¸åŒç±»å‹çš„å¦ä¸€å¯¹è±¡çš„å€¼,æˆ–åœ¨èµ‹å€¼æ—¶è¢«èµ‹äºˆç›¸åŒç±»å‹çš„å¦ä¸€å¯¹è±¡çš„å€¼, åŒæ—¶ä¸æ”¹å˜æºå¯¹è±¡çš„å€¼.å¯¹äºç”¨æˆ·å®šä¹‰çš„ç±»å‹, æ‹·è´æ“ä½œä¸€èˆ¬é€šè¿‡æ‹·è´æ„é€ å‡½æ•°ä¸æ‹·è´èµ‹å€¼æ“ä½œç¬¦å®šä¹‰.<code>string</code> ç±»å‹å°±æ˜¯ä¸€ä¸ªå¯æ‹·è´ç±»å‹çš„ä¾‹å­.</p><p>å¯ç§»åŠ¨ç±»å‹å…è®¸å¯¹è±¡åœ¨åˆå§‹åŒ–æ—¶å¾—åˆ°æ¥è‡ªç›¸åŒç±»å‹çš„ä¸´æ—¶å¯¹è±¡çš„å€¼,æˆ–åœ¨èµ‹å€¼æ—¶è¢«èµ‹äºˆç›¸åŒç±»å‹çš„ä¸´æ—¶å¯¹è±¡çš„å€¼ (å› æ­¤æ‰€æœ‰å¯æ‹·è´å¯¹è±¡ä¹Ÿæ˜¯å¯ç§»åŠ¨çš„).<code>std::unique_ptr</code> å°±æ˜¯ä¸€ä¸ªå¯ç§»åŠ¨ä½†ä¸å¯å¤åˆ¶çš„å¯¹è±¡çš„ä¾‹å­.å¯¹äºç”¨æˆ·å®šä¹‰çš„ç±»å‹,ç§»åŠ¨æ“ä½œä¸€èˆ¬æ˜¯é€šè¿‡ç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼æ“ä½œç¬¦å®ç°çš„.</p><p>æ‹·è´ / ç§»åŠ¨æ„é€ å‡½æ•°åœ¨æŸäº›æƒ…å†µä¸‹ä¼šè¢«ç¼–è¯‘å™¨éšå¼è°ƒç”¨. ä¾‹å¦‚,é€šè¿‡ä¼ å€¼çš„æ–¹å¼ä¼ é€’å¯¹è±¡.</p><p><strong>ä¼˜ç‚¹</strong></p><p>å¯ç§»åŠ¨åŠå¯æ‹·è´ç±»å‹çš„å¯¹è±¡å¯ä»¥é€šè¿‡ä¼ å€¼çš„æ–¹å¼è¿›è¡Œä¼ é€’æˆ–è€…è¿”å›, è¿™ä½¿å¾—API æ›´ç®€å•, æ›´å®‰å…¨ä¹Ÿæ›´é€šç”¨. ä¸ä¼ æŒ‡é’ˆå’Œå¼•ç”¨ä¸åŒ,è¿™æ ·çš„ä¼ é€’ä¸ä¼šé€ æˆæ‰€æœ‰æƒ, ç”Ÿå‘½å‘¨æœŸ, å¯å˜æ€§ç­‰æ–¹é¢çš„æ··ä¹±,ä¹Ÿå°±æ²¡å¿…è¦åœ¨åè®®ä¸­äºˆä»¥æ˜ç¡®.è¿™åŒæ—¶ä¹Ÿé˜²æ­¢äº†å®¢æˆ·ç«¯ä¸å®ç°åœ¨éä½œç”¨åŸŸå†…çš„äº¤äº’,ä½¿å¾—å®ƒä»¬æ›´å®¹æ˜“è¢«ç†è§£ä¸ç»´æŠ¤. è¿™æ ·çš„å¯¹è±¡å¯ä»¥å’Œéœ€è¦ä¼ å€¼æ“ä½œçš„é€šç”¨ APIä¸€èµ·ä½¿ç”¨, ä¾‹å¦‚å¤§å¤šæ•°å®¹å™¨.</p><p>æ‹·è´ / ç§»åŠ¨æ„é€ å‡½æ•°ä¸èµ‹å€¼æ“ä½œä¸€èˆ¬æ¥è¯´è¦æ¯”å®ƒä»¬çš„å„ç§æ›¿ä»£æ–¹æ¡ˆ, æ¯”å¦‚<code>Clone()</code>, <code>CopyFrom()</code> or <code>Swap()</code>,æ›´å®¹æ˜“å®šä¹‰, å› ä¸ºå®ƒä»¬èƒ½é€šè¿‡ç¼–è¯‘å™¨äº§ç”Ÿ, æ— è®ºæ˜¯éšå¼çš„è¿˜æ˜¯é€šè¿‡<code>= default</code>. è¿™ç§æ–¹å¼å¾ˆç®€æ´, ä¹Ÿä¿è¯æ‰€æœ‰æ•°æ®æˆå‘˜éƒ½ä¼šè¢«å¤åˆ¶.æ‹·è´ä¸ç§»åŠ¨æ„é€ å‡½æ•°ä¸€èˆ¬ä¹Ÿæ›´é«˜æ•ˆ,å› ä¸ºå®ƒä»¬ä¸éœ€è¦å †çš„åˆ†é…æˆ–è€…æ˜¯å•ç‹¬çš„åˆå§‹åŒ–å’Œèµ‹å€¼æ­¥éª¤, åŒæ—¶, å¯¹äºç±»ä¼¼ <ahref="http://en.cppreference.com/w/cpp/language/copy_elision">çœç•¥ä¸å¿…è¦çš„æ‹·è´</a>è¿™æ ·çš„ä¼˜åŒ–å®ƒä»¬ä¹Ÿæ›´åŠ åˆé€‚.</p><p>ç§»åŠ¨æ“ä½œå…è®¸éšå¼ä¸”é«˜æ•ˆåœ°å°†æºæ•°æ®è½¬ç§»å‡ºå³å€¼å¯¹è±¡.è¿™æœ‰æ—¶èƒ½è®©ä»£ç é£æ ¼æ›´åŠ æ¸…æ™°.</p><p><strong>ç¼ºç‚¹</strong></p><p>è®¸å¤šç±»å‹éƒ½ä¸éœ€è¦æ‹·è´, ä¸ºå®ƒä»¬æä¾›æ‹·è´æ“ä½œä¼šè®©äººè¿·æƒ‘,ä¹Ÿæ˜¾å¾—è’è°¬è€Œä¸åˆç†. å•ä»¶ç±»å‹ (<code>Registerer</code>),ä¸ç‰¹å®šçš„ä½œç”¨åŸŸç›¸å…³çš„ç±»å‹ (<code>Cleanup</code>),ä¸å…¶ä»–å¯¹è±¡å®ä½“ç´§è€¦åˆçš„ç±»å‹ (<code>Mutex</code>)ä»é€»è¾‘ä¸Šæ¥è¯´éƒ½ä¸åº”è¯¥æä¾›æ‹·è´æ“ä½œ. ä¸ºåŸºç±»æä¾›æ‹·è´ / èµ‹å€¼æ“ä½œæ˜¯æœ‰å®³çš„,å› ä¸ºåœ¨ä½¿ç”¨å®ƒä»¬æ—¶ä¼šé€ æˆ <ahref="https://en.wikipedia.org/wiki/Object_slicing">å¯¹è±¡åˆ‡å‰²</a> .é»˜è®¤çš„æˆ–è€…éšæ„çš„æ‹·è´æ“ä½œå®ç°å¯èƒ½æ˜¯ä¸æ­£ç¡®çš„,è¿™å¾€å¾€å¯¼è‡´ä»¤äººå›°æƒ‘å¹¶ä¸”éš¾ä»¥è¯Šæ–­å‡ºçš„é”™è¯¯.</p><p>æ‹·è´æ„é€ å‡½æ•°æ˜¯éšå¼è°ƒç”¨çš„, ä¹Ÿå°±æ˜¯è¯´, è¿™äº›è°ƒç”¨å¾ˆå®¹æ˜“è¢«å¿½ç•¥.è¿™ä¼šè®©äººè¿·æƒ‘,å°¤å…¶æ˜¯å¯¹é‚£äº›æ‰€ç”¨çš„è¯­è¨€çº¦å®šæˆ–å¼ºåˆ¶è¦æ±‚ä¼ å¼•ç”¨çš„ç¨‹åºå‘˜æ¥è¯´æ›´æ˜¯å¦‚æ­¤. åŒæ—¶,è¿™ä»ä¸€å®šç¨‹åº¦ä¸Šè¯´ä¼šé¼“åŠ±è¿‡åº¦æ‹·è´, ä»è€Œå¯¼è‡´æ€§èƒ½ä¸Šçš„é—®é¢˜.</p><p><strong>ç»“è®º</strong></p><p>å¦‚æœéœ€è¦å°±è®©ä½ çš„ç±»å‹å¯æ‹·è´ / å¯ç§»åŠ¨. ä½œä¸ºä¸€ä¸ªç»éªŒæ³•åˆ™,å¦‚æœå¯¹äºä½ çš„ç”¨æˆ·æ¥è¯´è¿™ä¸ªæ‹·è´æ“ä½œä¸æ˜¯ä¸€çœ¼å°±èƒ½çœ‹å‡ºæ¥çš„,é‚£å°±ä¸è¦æŠŠç±»å‹è®¾ç½®ä¸ºå¯æ‹·è´. å¦‚æœè®©ç±»å‹å¯æ‹·è´,ä¸€å®šè¦åŒæ—¶ç»™å‡ºæ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼æ“ä½œçš„å®šä¹‰, åä¹‹äº¦ç„¶. å¦‚æœè®©ç±»å‹å¯æ‹·è´,åŒæ—¶ç§»åŠ¨æ“ä½œçš„æ•ˆç‡é«˜äºæ‹·è´æ“ä½œ, é‚£ä¹ˆå°±æŠŠç§»åŠ¨çš„ä¸¤ä¸ªæ“ä½œ(ç§»åŠ¨æ„é€ å‡½æ•°å’Œèµ‹å€¼æ“ä½œ) ä¹Ÿç»™å‡ºå®šä¹‰. å¦‚æœç±»å‹ä¸å¯æ‹·è´,ä½†æ˜¯ç§»åŠ¨æ“ä½œçš„æ­£ç¡®æ€§å¯¹ç”¨æˆ·æ˜¾ç„¶å¯è§,é‚£ä¹ˆæŠŠè¿™ä¸ªç±»å‹è®¾ç½®ä¸ºåªå¯ç§»åŠ¨å¹¶å®šä¹‰ç§»åŠ¨çš„ä¸¤ä¸ªæ“ä½œ.</p><p>å¦‚æœå®šä¹‰äº†æ‹·è´/ç§»åŠ¨æ“ä½œ, åˆ™è¦ä¿è¯è¿™äº›æ“ä½œçš„é»˜è®¤å®ç°æ˜¯æ­£ç¡®çš„.è®°å¾—æ—¶åˆ»æ£€æŸ¥é»˜è®¤æ“ä½œçš„æ­£ç¡®æ€§,å¹¶ä¸”åœ¨æ–‡æ¡£ä¸­è¯´æ˜ç±»æ˜¯å¯æ‹·è´çš„ä¸”/æˆ–å¯ç§»åŠ¨çš„.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span> &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Foo</span>(Foo&amp;&amp; other) : <span class="built_in">field_</span>(other.field) &#123;&#125;</span><br><span class="line">  <span class="comment">// å·®, åªå®šä¹‰äº†ç§»åŠ¨æ„é€ å‡½æ•°, è€Œæ²¡æœ‰å®šä¹‰å¯¹åº”çš„èµ‹å€¼è¿ç®—ç¬¦.</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  Field field_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç”±äºå­˜åœ¨å¯¹è±¡åˆ‡å‰²çš„é£é™©,ä¸è¦ä¸ºä»»ä½•æœ‰å¯èƒ½æœ‰æ´¾ç”Ÿç±»çš„å¯¹è±¡æä¾›èµ‹å€¼æ“ä½œæˆ–è€…æ‹·è´ / ç§»åŠ¨æ„é€ å‡½æ•°(å½“ç„¶ä¹Ÿä¸è¦ç»§æ‰¿æœ‰è¿™æ ·çš„æˆå‘˜å‡½æ•°çš„ç±»). å¦‚æœä½ çš„åŸºç±»éœ€è¦å¯å¤åˆ¶å±æ€§,è¯·æä¾›ä¸€ä¸ª <code>public virtual Clone()</code> å’Œä¸€ä¸ª<code>protected</code> çš„æ‹·è´æ„é€ å‡½æ•°ä»¥ä¾›æ´¾ç”Ÿç±»å®ç°.</p><p>å¦‚æœä½ çš„ç±»ä¸éœ€è¦æ‹·è´ / ç§»åŠ¨æ“ä½œ, è¯·æ˜¾å¼åœ°é€šè¿‡åœ¨ <code>public</code>åŸŸä¸­ä½¿ç”¨ <code>= delete</code> æˆ–å…¶ä»–æ‰‹æ®µç¦ç”¨ä¹‹.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MyClass is neither copyable nor movable.</span></span><br><span class="line"><span class="built_in">MyClass</span>(<span class="type">const</span> MyClass&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">MyClass&amp; <span class="keyword">operator</span>=(<span class="type">const</span> MyClass&amp;) = delee;</span><br></pre></td></tr></table></figure><h3 id="ç»“æ„ä½“-vs.-ç±»">3.4. ç»“æ„ä½“ VS. ç±»</h3><p><strong>æ€»è¿°</strong></p><p>ä»…å½“åªæœ‰æ•°æ®æˆå‘˜æ—¶ä½¿ç”¨ <code>struct</code>, å…¶å®ƒä¸€æ¦‚ä½¿ç”¨<code>class</code>.</p><p><strong>è¯´æ˜</strong></p><p>åœ¨ C++ ä¸­ <code>struct</code> å’Œ <code>class</code>å…³é”®å­—å‡ ä¹å«ä¹‰ä¸€æ ·. æˆ‘ä»¬ä¸ºè¿™ä¸¤ä¸ªå…³é”®å­—æ·»åŠ æˆ‘ä»¬è‡ªå·±çš„è¯­ä¹‰ç†è§£,ä»¥ä¾¿ä¸ºå®šä¹‰çš„æ•°æ®ç±»å‹é€‰æ‹©åˆé€‚çš„å…³é”®å­—.</p><p><code>struct</code> ç”¨æ¥å®šä¹‰åŒ…å«æ•°æ®çš„è¢«åŠ¨å¼å¯¹è±¡,ä¹Ÿå¯ä»¥åŒ…å«ç›¸å…³çš„å¸¸é‡, ä½†é™¤äº†å­˜å–æ•°æ®æˆå‘˜ä¹‹å¤–, æ²¡æœ‰åˆ«çš„å‡½æ•°åŠŸèƒ½.å¹¶ä¸”å­˜å–åŠŸèƒ½æ˜¯é€šè¿‡ç›´æ¥è®¿é—®ä½åŸŸ, è€Œéå‡½æ•°è°ƒç”¨. é™¤äº†æ„é€ å‡½æ•°, ææ„å‡½æ•°,<code>Initialize()</code>, <code>Reset()</code>, <code>Validate()</code>ç­‰ç±»ä¼¼çš„ç”¨äºè®¾å®šæ•°æ®æˆå‘˜çš„å‡½æ•°å¤–, ä¸èƒ½æä¾›å…¶å®ƒåŠŸèƒ½çš„å‡½æ•°.</p><p>å¦‚æœéœ€è¦æ›´å¤šçš„å‡½æ•°åŠŸèƒ½, <code>class</code> æ›´é€‚åˆ. å¦‚æœæ‹¿ä¸å‡†, å°±ç”¨<code>class</code>.</p><p>ä¸ºäº†å’Œ STL ä¿æŒä¸€è‡´, å¯¹äºä»¿å‡½æ•°ç­‰ç‰¹æ€§å¯ä»¥ä¸ç”¨ <code>class</code>è€Œæ˜¯ä½¿ç”¨ <code>struct</code>.</p><p>æ³¨æ„: ç±»å’Œç»“æ„ä½“çš„æˆå‘˜å˜é‡ä½¿ç”¨ä¸åŒçš„ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/naming/##variable-names">å‘½åè§„åˆ™</a>.</p><h3 id="ç»§æ‰¿">3.5. ç»§æ‰¿</h3><p><strong>æ€»è¿°</strong></p><p>ä½¿ç”¨ç»„åˆ (YuleFox æ³¨: è¿™ä¸€ç‚¹ä¹Ÿæ˜¯ GoF åœ¨ &lt;<Design Patterns>&gt;é‡Œåå¤å¼ºè°ƒçš„) å¸¸å¸¸æ¯”ä½¿ç”¨ç»§æ‰¿æ›´åˆç†. å¦‚æœä½¿ç”¨ç»§æ‰¿çš„è¯, å®šä¹‰ä¸º<code>public</code> ç»§æ‰¿.</p><p><strong>å®šä¹‰</strong></p><p>å½“å­ç±»ç»§æ‰¿åŸºç±»æ—¶, å­ç±»åŒ…å«äº†çˆ¶åŸºç±»æ‰€æœ‰æ•°æ®åŠæ“ä½œçš„å®šä¹‰. C++ å®è·µä¸­,ç»§æ‰¿ä¸»è¦ç”¨äºä¸¤ç§åœºåˆ: å®ç°ç»§æ‰¿, å­ç±»ç»§æ‰¿çˆ¶ç±»çš„å®ç°ä»£ç ; <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/classes/##interface">æ¥å£ç»§æ‰¿</a>,å­ç±»ä»…ç»§æ‰¿çˆ¶ç±»çš„æ–¹æ³•åç§°.</p><p><strong>ä¼˜ç‚¹</strong></p><p>å®ç°ç»§æ‰¿é€šè¿‡åŸå°ä¸åŠ¨çš„å¤ç”¨åŸºç±»ä»£ç å‡å°‘äº†ä»£ç é‡.ç”±äºç»§æ‰¿æ˜¯åœ¨ç¼–è¯‘æ—¶å£°æ˜, ç¨‹åºå‘˜å’Œç¼–è¯‘å™¨éƒ½å¯ä»¥ç†è§£ç›¸åº”æ“ä½œå¹¶å‘ç°é”™è¯¯.ä»ç¼–ç¨‹è§’åº¦è€Œè¨€, æ¥å£ç»§æ‰¿æ˜¯ç”¨æ¥å¼ºåˆ¶ç±»è¾“å‡ºç‰¹å®šçš„ API. åœ¨ç±»æ²¡æœ‰å®ç° APIä¸­æŸä¸ªå¿…é¡»çš„æ–¹æ³•æ—¶, ç¼–è¯‘å™¨åŒæ ·ä¼šå‘ç°å¹¶æŠ¥å‘Šé”™è¯¯.</p><p><strong>ç¼ºç‚¹</strong></p><p>å¯¹äºå®ç°ç»§æ‰¿, ç”±äºå­ç±»çš„å®ç°ä»£ç æ•£å¸ƒåœ¨çˆ¶ç±»å’Œå­ç±»é—´ä¹‹é—´,è¦ç†è§£å…¶å®ç°å˜å¾—æ›´åŠ å›°éš¾. å­ç±»ä¸èƒ½é‡å†™çˆ¶ç±»çš„éè™šå‡½æ•°,å½“ç„¶ä¹Ÿå°±ä¸èƒ½ä¿®æ”¹å…¶å®ç°. åŸºç±»ä¹Ÿå¯èƒ½å®šä¹‰äº†ä¸€äº›æ•°æ®æˆå‘˜,å› æ­¤è¿˜å¿…é¡»åŒºåˆ†åŸºç±»çš„å®é™…å¸ƒå±€.</p><p><strong>ç»“è®º</strong></p><p>æ‰€æœ‰ç»§æ‰¿å¿…é¡»æ˜¯ <code>public</code> çš„. å¦‚æœä½ æƒ³ä½¿ç”¨ç§æœ‰ç»§æ‰¿,ä½ åº”è¯¥æ›¿æ¢æˆæŠŠåŸºç±»çš„å®ä¾‹ä½œä¸ºæˆå‘˜å¯¹è±¡çš„æ–¹å¼.</p><p>ä¸è¦è¿‡åº¦ä½¿ç”¨å®ç°ç»§æ‰¿. ç»„åˆå¸¸å¸¸æ›´åˆé€‚ä¸€äº›. å°½é‡åšåˆ°åªåœ¨ â€œæ˜¯ä¸€ä¸ªâ€(â€œis-aâ€, YuleFox æ³¨: å…¶ä»– â€œhas-aâ€ æƒ…å†µä¸‹è¯·ä½¿ç”¨ç»„åˆ) çš„æƒ…å†µä¸‹ä½¿ç”¨ç»§æ‰¿:å¦‚æœ <code>Bar</code> çš„ç¡® â€œæ˜¯ä¸€ç§â€ <code>Foo</code>, <code>Bar</code>æ‰èƒ½ç»§æ‰¿ <code>Foo</code>.</p><p>å¿…è¦çš„è¯, ææ„å‡½æ•°å£°æ˜ä¸º <code>virtual</code>. å¦‚æœä½ çš„ç±»æœ‰è™šå‡½æ•°,åˆ™ææ„å‡½æ•°ä¹Ÿåº”è¯¥ä¸ºè™šå‡½æ•°.</p><p>å¯¹äºå¯èƒ½è¢«å­ç±»è®¿é—®çš„æˆå‘˜å‡½æ•°, ä¸è¦è¿‡åº¦ä½¿ç”¨ <code>protected</code>å…³é”®å­—. æ³¨æ„, æ•°æ®æˆå‘˜éƒ½å¿…é¡»æ˜¯ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/classes/##access-control">ç§æœ‰çš„</a>.</p><p>å¯¹äºé‡è½½çš„è™šå‡½æ•°æˆ–è™šææ„å‡½æ•°, ä½¿ç”¨ <code>override</code>, æˆ–(è¾ƒä¸å¸¸ç”¨çš„) <code>final</code> å…³é”®å­—æ˜¾å¼åœ°è¿›è¡Œæ ‡è®°. è¾ƒæ—© (æ—©äº C++11)çš„ä»£ç å¯èƒ½ä¼šä½¿ç”¨ <code>virtual</code> å…³é”®å­—ä½œä¸ºä¸å¾—å·²çš„é€‰é¡¹. å› æ­¤,åœ¨å£°æ˜é‡è½½æ—¶, è¯·ä½¿ç”¨ <code>override</code>, <code>final</code> æˆ–<code>virtual</code> çš„å…¶ä¸­ä¹‹ä¸€è¿›è¡Œæ ‡è®°. æ ‡è®°ä¸º <code>override</code> æˆ–<code>final</code> çš„ææ„å‡½æ•°å¦‚æœä¸æ˜¯å¯¹åŸºç±»è™šå‡½æ•°çš„é‡è½½çš„è¯, ç¼–è¯‘ä¼šæŠ¥é”™,è¿™æœ‰åŠ©äºæ•è·å¸¸è§çš„é”™è¯¯. è¿™äº›æ ‡è®°èµ·åˆ°äº†æ–‡æ¡£çš„ä½œç”¨,å› ä¸ºå¦‚æœçœç•¥è¿™äº›å…³é”®å­—, ä»£ç é˜…è¯»è€…ä¸å¾—ä¸æ£€æŸ¥æ‰€æœ‰çˆ¶ç±»,ä»¥åˆ¤æ–­è¯¥å‡½æ•°æ˜¯å¦æ˜¯è™šå‡½æ•°.</p><h3 id="å¤šé‡ç»§æ‰¿">3.6. å¤šé‡ç»§æ‰¿</h3><p><strong>æ€»è¿°</strong></p><p>çœŸæ­£éœ€è¦ç”¨åˆ°å¤šé‡å®ç°ç»§æ‰¿çš„æƒ…å†µå°‘ä¹‹åˆå°‘.åªåœ¨ä»¥ä¸‹æƒ…å†µæˆ‘ä»¬æ‰å…è®¸å¤šé‡ç»§æ‰¿: æœ€å¤šåªæœ‰ä¸€ä¸ªåŸºç±»æ˜¯éæŠ½è±¡ç±»;å…¶å®ƒåŸºç±»éƒ½æ˜¯ä»¥ <code>Interface</code> ä¸ºåç¼€çš„ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/classes/##interface">çº¯æ¥å£ç±»</a>.</p><p><strong>å®šä¹‰</strong></p><p>å¤šé‡ç»§æ‰¿å…è®¸å­ç±»æ‹¥æœ‰å¤šä¸ªåŸºç±». è¦å°†ä½œä¸º <em>çº¯æ¥å£</em> çš„åŸºç±»å’Œå…·æœ‰<em>å®ç°</em> çš„åŸºç±»åŒºåˆ«å¼€æ¥.</p><p><strong>ä¼˜ç‚¹</strong></p><p>ç›¸æ¯”å•ç»§æ‰¿ (è§ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/classes/##inheritance">ç»§æ‰¿</a>),å¤šé‡å®ç°ç»§æ‰¿å¯ä»¥å¤ç”¨æ›´å¤šçš„ä»£ç .</p><p><strong>ç¼ºç‚¹</strong></p><p>çœŸæ­£éœ€è¦ç”¨åˆ°å¤šé‡ <em>å®ç°</em> ç»§æ‰¿çš„æƒ…å†µå°‘ä¹‹åˆå°‘.æœ‰æ—¶å¤šé‡å®ç°ç»§æ‰¿çœ‹ä¸Šå»æ˜¯ä¸é”™çš„è§£å†³æ–¹æ¡ˆ,ä½†è¿™æ—¶ä½ é€šå¸¸ä¹Ÿå¯ä»¥æ‰¾åˆ°ä¸€ä¸ªæ›´æ˜ç¡®, æ›´æ¸…æ™°çš„ä¸åŒè§£å†³æ–¹æ¡ˆ.</p><p><strong>ç»“è®º</strong></p><p>åªæœ‰å½“æ‰€æœ‰çˆ¶ç±»é™¤ç¬¬ä¸€ä¸ªå¤–éƒ½æ˜¯ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/classes/##interface">çº¯æ¥å£ç±»</a>æ—¶, æ‰å…è®¸ä½¿ç”¨å¤šé‡ç»§æ‰¿. ä¸ºç¡®ä¿å®ƒä»¬æ˜¯çº¯æ¥å£, è¿™äº›ç±»å¿…é¡»ä»¥<code>Interface</code> ä¸ºåç¼€.</p><p><strong>æ³¨æ„</strong></p><p>å…³äºè¯¥è§„åˆ™, Windows ä¸‹æœ‰ä¸ª <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/exceptions/##windows-code">ç‰¹ä¾‹</a>.</p><h3 id="æ¥å£">3.7. æ¥å£</h3><p><strong>æ€»è¿°</strong></p><p>æ¥å£æ˜¯æŒ‡æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„ç±», è¿™äº›ç±»ä»¥ <code>Interface</code> ä¸ºåç¼€(ä¸å¼ºåˆ¶).</p><p><strong>å®šä¹‰</strong></p><p>å½“ä¸€ä¸ªç±»æ»¡è¶³ä»¥ä¸‹è¦æ±‚æ—¶, ç§°ä¹‹ä¸ºçº¯æ¥å£:</p><ul><li>åªæœ‰çº¯è™šå‡½æ•° (â€œ<code>=0</code>â€) å’Œé™æ€å‡½æ•°(é™¤äº†ä¸‹æ–‡æåˆ°çš„ææ„å‡½æ•°).</li><li>æ²¡æœ‰éé™æ€æ•°æ®æˆå‘˜.</li><li>æ²¡æœ‰å®šä¹‰ä»»ä½•æ„é€ å‡½æ•°. å¦‚æœæœ‰, ä¹Ÿä¸èƒ½å¸¦æœ‰å‚æ•°, å¹¶ä¸”å¿…é¡»ä¸º<code>protected</code>.</li><li>å¦‚æœå®ƒæ˜¯ä¸€ä¸ªå­ç±», ä¹Ÿåªèƒ½ä»æ»¡è¶³ä¸Šè¿°æ¡ä»¶å¹¶ä»¥ <code>Interface</code>ä¸ºåç¼€çš„ç±»ç»§æ‰¿.</li></ul><p>æ¥å£ç±»ä¸èƒ½è¢«ç›´æ¥å®ä¾‹åŒ–, å› ä¸ºå®ƒå£°æ˜äº†çº¯è™šå‡½æ•°.ä¸ºç¡®ä¿æ¥å£ç±»çš„æ‰€æœ‰å®ç°å¯è¢«æ­£ç¡®é”€æ¯, å¿…é¡»ä¸ºä¹‹å£°æ˜è™šææ„å‡½æ•° (ä½œä¸ºä¸Šè¿°ç¬¬ 1æ¡è§„åˆ™çš„ç‰¹ä¾‹, ææ„å‡½æ•°ä¸èƒ½æ˜¯çº¯è™šå‡½æ•°). å…·ä½“ç»†èŠ‚å¯å‚è€ƒ Stroustrup çš„<em>The C++ Programming Language, 3rd edition</em> ç¬¬ 12.4 èŠ‚.</p><p><strong>ä¼˜ç‚¹</strong></p><p>ä»¥ <code>Interface</code>ä¸ºåç¼€å¯ä»¥æé†’å…¶ä»–äººä¸è¦ä¸ºè¯¥æ¥å£ç±»å¢åŠ å‡½æ•°å®ç°æˆ–éé™æ€æ•°æ®æˆå‘˜.è¿™ä¸€ç‚¹å¯¹äº <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/classes/##multiple-inheritance">å¤šé‡ç»§æ‰¿</a>å°¤å…¶é‡è¦. å¦å¤–, å¯¹äº Java ç¨‹åºå‘˜æ¥è¯´, æ¥å£çš„æ¦‚å¿µå·²æ˜¯æ·±å…¥äººå¿ƒ.</p><p><strong>ç¼ºç‚¹</strong></p><p><code>Interface</code> åç¼€å¢åŠ äº†ç±»åé•¿åº¦, ä¸ºé˜…è¯»å’Œç†è§£å¸¦æ¥ä¸ä¾¿.åŒæ—¶, æ¥å£å±æ€§ä½œä¸ºå®ç°ç»†èŠ‚ä¸åº”æš´éœ²ç»™ç”¨æˆ·.</p><p><strong>ç»“è®º</strong></p><p>åªæœ‰åœ¨æ»¡è¶³ä¸Šè¿°æ¡ä»¶æ—¶, ç±»æ‰ä»¥ <code>Interface</code> ç»“å°¾, ä½†åè¿‡æ¥,æ»¡è¶³ä¸Šè¿°éœ€è¦çš„ç±»æœªå¿…ä¸€å®šä»¥ <code>Interface</code> ç»“å°¾.</p><h3 id="è¿ç®—ç¬¦é‡è½½">3.8. è¿ç®—ç¬¦é‡è½½</h3><p><strong>æ€»è¿°</strong></p><p>é™¤å°‘æ•°ç‰¹å®šç¯å¢ƒå¤–, ä¸è¦é‡è½½è¿ç®—ç¬¦. ä¹Ÿä¸è¦åˆ›å»ºç”¨æˆ·å®šä¹‰å­—é¢é‡.</p><p><strong>å®šä¹‰</strong></p><p>C++ å…è®¸ç”¨æˆ·é€šè¿‡ä½¿ç”¨ <code>operator</code> å…³é”®å­— <ahref="http://en.cppreference.com/w/cpp/language/operators">å¯¹å†…å»ºè¿ç®—ç¬¦è¿›è¡Œé‡è½½å®šä¹‰</a>, åªè¦å…¶ä¸­ä¸€ä¸ªå‚æ•°æ˜¯ç”¨æˆ·å®šä¹‰çš„ç±»å‹. <code>operator</code>å…³é”®å­—è¿˜å…è®¸ç”¨æˆ·ä½¿ç”¨ <code>operator""</code> å®šä¹‰æ–°çš„å­—é¢è¿ç®—ç¬¦,å¹¶ä¸”å®šä¹‰ç±»å‹è½¬æ¢å‡½æ•°, ä¾‹å¦‚ <code>operator bool()</code>.</p><p><strong>ä¼˜ç‚¹</strong></p><p>é‡è½½è¿ç®—ç¬¦å¯ä»¥è®©ä»£ç æ›´ç®€æ´æ˜“æ‡‚,ä¹Ÿä½¿å¾—ç”¨æˆ·å®šä¹‰çš„ç±»å‹å’Œå†…å»ºç±»å‹æ‹¥æœ‰ç›¸ä¼¼çš„è¡Œä¸º.é‡è½½è¿ç®—ç¬¦å¯¹äºæŸäº›è¿ç®—æ¥è¯´æ˜¯ç¬¦åˆç¬¦åˆè¯­è¨€ä¹ æƒ¯çš„åç§° (ä¾‹å¦‚<code>==</code>, <code>&lt;</code>, <code>=</code>,<code>&lt;&lt;</code>), éµå¾ªè¿™äº›è¯­è¨€çº¦å®šå¯ä»¥è®©ç”¨æˆ·å®šä¹‰çš„ç±»å‹æ›´æ˜“è¯»,ä¹Ÿèƒ½æ›´å¥½åœ°å’Œéœ€è¦è¿™äº›é‡è½½è¿ç®—ç¬¦çš„å‡½æ•°åº“è¿›è¡Œäº¤äº’æ“ä½œ.</p><p>å¯¹äºåˆ›å»ºç”¨æˆ·å®šä¹‰çš„ç±»å‹çš„å¯¹è±¡æ¥è¯´,ç”¨æˆ·å®šä¹‰å­—é¢é‡æ˜¯ä¸€ç§éå¸¸ç®€æ´çš„æ ‡è®°.</p><p><strong>ç¼ºç‚¹</strong></p><ul><li>è¦æä¾›æ­£ç¡®, ä¸€è‡´, ä¸å‡ºç°å¼‚å¸¸è¡Œä¸ºçš„æ“ä½œç¬¦è¿ç®—éœ€è¦èŠ±è´¹ä¸å°‘ç²¾åŠ›,è€Œä¸”å¦‚æœè¾¾ä¸åˆ°è¿™äº›è¦æ±‚çš„è¯, ä¼šå¯¼è‡´ä»¤äººè¿·æƒ‘çš„ Bug.</li><li>è¿‡åº¦ä½¿ç”¨è¿ç®—ç¬¦ä¼šå¸¦æ¥éš¾ä»¥ç†è§£çš„ä»£ç ,å°¤å…¶æ˜¯åœ¨é‡è½½çš„æ“ä½œç¬¦çš„è¯­ä¹‰ä¸é€šå¸¸çš„çº¦å®šä¸ç¬¦åˆæ—¶.</li><li>å‡½æ•°é‡è½½æœ‰å¤šå°‘å¼Šç«¯, è¿ç®—ç¬¦é‡è½½å°±è‡³å°‘æœ‰å¤šå°‘.</li><li>è¿ç®—ç¬¦é‡è½½ä¼šæ··æ·†è§†å¬,è®©ä½ è¯¯ä»¥ä¸ºä¸€äº›è€—æ—¶çš„æ“ä½œå’Œæ“ä½œå†…å»ºç±»å‹ä¸€æ ·è½»å·§.</li><li>å¯¹é‡è½½è¿ç®—ç¬¦çš„è°ƒç”¨ç‚¹çš„æŸ¥æ‰¾éœ€è¦çš„å¯å°±ä¸ä»…ä»…æ˜¯åƒ grep é‚£æ ·çš„ç¨‹åºäº†,è¿™æ—¶éœ€è¦èƒ½å¤Ÿç†è§£ C++ è¯­æ³•çš„æœç´¢å·¥å…·.</li><li>å¦‚æœé‡è½½è¿ç®—ç¬¦çš„å‚æ•°å†™é”™,æ­¤æ—¶å¾—åˆ°çš„å¯èƒ½æ˜¯ä¸€ä¸ªå®Œå…¨ä¸åŒçš„é‡è½½è€Œéç¼–è¯‘é”™è¯¯. ä¾‹å¦‚:<code>foo &lt; bar</code> æ‰§è¡Œçš„æ˜¯ä¸€ä¸ªè¡Œä¸º, è€Œ<code>&amp;foo &lt; &amp;bar</code>æ‰§è¡Œçš„å°±æ˜¯å®Œå…¨ä¸åŒçš„å¦ä¸€ä¸ªè¡Œä¸ºäº†.</li><li>é‡è½½æŸäº›è¿ç®—ç¬¦æœ¬èº«å°±æ˜¯æœ‰å®³çš„. ä¾‹å¦‚, é‡è½½ä¸€å…ƒè¿ç®—ç¬¦<code>&amp;</code> ä¼šå¯¼è‡´åŒæ ·çš„ä»£ç æœ‰å®Œå…¨ä¸åŒçš„å«ä¹‰,è¿™å–å†³äºé‡è½½çš„å£°æ˜å¯¹æŸæ®µä»£ç è€Œè¨€æ˜¯å¦æ˜¯å¯è§çš„. é‡è½½è¯¸å¦‚<code>&amp;&amp;</code>, <code>||</code> å’Œ <code>,</code>ä¼šå¯¼è‡´è¿ç®—é¡ºåºå’Œå†…å»ºè¿ç®—çš„é¡ºåºä¸ä¸€è‡´.</li><li>è¿ç®—ç¬¦ä»é€šå¸¸å®šä¹‰åœ¨ç±»çš„å¤–éƒ¨, æ‰€ä»¥å¯¹äºåŒä¸€è¿ç®—,å¯èƒ½å‡ºç°ä¸åŒçš„æ–‡ä»¶å¼•å…¥äº†ä¸åŒçš„å®šä¹‰çš„é£é™©.å¦‚æœä¸¤ç§å®šä¹‰éƒ½é“¾æ¥åˆ°åŒä¸€äºŒè¿›åˆ¶æ–‡ä»¶, å°±ä¼šå¯¼è‡´æœªå®šä¹‰çš„è¡Œä¸º,æœ‰å¯èƒ½è¡¨ç°ä¸ºéš¾ä»¥å‘ç°çš„è¿è¡Œæ—¶é”™è¯¯.</li><li>ç”¨æˆ·å®šä¹‰å­—é¢é‡æ‰€åˆ›å»ºçš„è¯­ä¹‰å½¢å¼å¯¹äºæŸäº›æœ‰ç»éªŒçš„ C++ç¨‹åºå‘˜æ¥è¯´éƒ½æ˜¯å¾ˆé™Œç”Ÿçš„.</li></ul><p><strong>ç»“è®º</strong></p><p>åªæœ‰åœ¨æ„ä¹‰æ˜æ˜¾,ä¸ä¼šå‡ºç°å¥‡æ€ªçš„è¡Œä¸ºå¹¶ä¸”ä¸å¯¹åº”çš„å†…å»ºè¿ç®—ç¬¦çš„è¡Œä¸ºä¸€è‡´æ—¶æ‰å®šä¹‰é‡è½½è¿ç®—ç¬¦.ä¾‹å¦‚, <code>|</code> è¦ä½œä¸ºä½æˆ–æˆ–é€»è¾‘æˆ–æ¥ä½¿ç”¨, è€Œä¸æ˜¯ä½œä¸º shellä¸­çš„ç®¡é“.</p><p>åªæœ‰å¯¹ç”¨æˆ·è‡ªå·±å®šä¹‰çš„ç±»å‹é‡è½½è¿ç®—ç¬¦. æ›´å‡†ç¡®åœ°è¯´,å°†å®ƒä»¬å’Œå®ƒä»¬æ‰€æ“ä½œçš„ç±»å‹å®šä¹‰åœ¨åŒä¸€ä¸ªå¤´æ–‡ä»¶ä¸­, <code>.cc</code>ä¸­å’Œå‘½åç©ºé—´ä¸­. è¿™æ ·åšæ— è®ºç±»å‹åœ¨å“ªé‡Œéƒ½èƒ½å¤Ÿä½¿ç”¨å®šä¹‰çš„è¿ç®—ç¬¦,å¹¶ä¸”æœ€å¤§ç¨‹åº¦ä¸Šé¿å…äº†å¤šé‡å®šä¹‰çš„é£é™©. å¦‚æœå¯èƒ½çš„è¯,è¯·é¿å…å°†è¿ç®—ç¬¦å®šä¹‰ä¸ºæ¨¡æ¿, å› ä¸ºæ­¤æ—¶å®ƒä»¬å¿…é¡»å¯¹ä»»ä½•æ¨¡æ¿å‚æ•°éƒ½èƒ½å¤Ÿä½œç”¨.å¦‚æœä½ å®šä¹‰äº†ä¸€ä¸ªè¿ç®—ç¬¦, è¯·å°†å…¶ç›¸å…³ä¸”æœ‰æ„ä¹‰çš„è¿ç®—ç¬¦éƒ½è¿›è¡Œå®šä¹‰,å¹¶ä¸”ä¿è¯è¿™äº›å®šä¹‰çš„è¯­ä¹‰æ˜¯ä¸€è‡´çš„. ä¾‹å¦‚, å¦‚æœä½ é‡è½½äº† <code>&lt;</code>,é‚£ä¹ˆè¯·å°†æ‰€æœ‰çš„æ¯”è¾ƒè¿ç®—ç¬¦éƒ½è¿›è¡Œé‡è½½, å¹¶ä¸”ä¿è¯å¯¹äºåŒä¸€ç»„å‚æ•°,<code>&lt;</code> å’Œ <code>&gt;</code> ä¸ä¼šåŒæ—¶è¿”å›<code>true</code>.</p><p>å»ºè®®ä¸è¦å°†ä¸è¿›è¡Œä¿®æ”¹çš„äºŒå…ƒè¿ç®—ç¬¦å®šä¹‰ä¸ºæˆå‘˜å‡½æ•°.å¦‚æœä¸€ä¸ªäºŒå…ƒè¿ç®—ç¬¦è¢«å®šä¹‰ä¸ºç±»æˆå‘˜,è¿™æ—¶éšå¼è½¬æ¢ä¼šä½œç”¨åŸŸå³ä¾§çš„å‚æ•°å´ä¸ä¼šä½œç”¨äºå·¦ä¾§. è¿™æ—¶ä¼šå‡ºç°<code>a &lt; b</code> èƒ½å¤Ÿé€šè¿‡ç¼–è¯‘è€Œ <code>b &lt; a</code> ä¸èƒ½çš„æƒ…å†µ,è¿™æ˜¯å¾ˆè®©äººè¿·æƒ‘çš„.</p><p>ä¸è¦ä¸ºäº†é¿å…é‡è½½æ“ä½œç¬¦è€Œèµ°æç«¯. æ¯”å¦‚è¯´, åº”å½“å®šä¹‰ <code>==</code>,<code>=</code>, å’Œ <code>&lt;&lt;</code> è€Œä¸æ˜¯ <code>Equals()</code>,<code>CopyFrom()</code> å’Œ <code>PrintTo()</code>. åè¿‡æ¥è¯´,ä¸è¦åªæ˜¯ä¸ºäº†æ»¡è¶³å‡½æ•°åº“éœ€è¦è€Œå»å®šä¹‰è¿ç®—ç¬¦é‡è½½. æ¯”å¦‚è¯´,å¦‚æœä½ çš„ç±»å‹æ²¡æœ‰è‡ªç„¶é¡ºåº, è€Œä½ è¦å°†å®ƒä»¬å­˜å…¥ <code>std::set</code> ä¸­,æœ€å¥½è¿˜æ˜¯å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰çš„æ¯”è¾ƒè¿ç®—ç¬¦è€Œä¸æ˜¯é‡è½½ <code>&lt;</code>.</p><p>ä¸è¦é‡è½½ <code>&amp;&amp;</code>, <code>||</code>, <code>,</code>æˆ–ä¸€å…ƒè¿ç®—ç¬¦ <code>&amp;</code>. ä¸è¦é‡è½½ <code>operator""</code>,ä¹Ÿå°±æ˜¯è¯´, ä¸è¦å¼•å…¥ç”¨æˆ·å®šä¹‰å­—é¢é‡.</p><p>ç±»å‹è½¬æ¢è¿ç®—ç¬¦åœ¨ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/classes/##implicit-conversions">éšå¼ç±»å‹è½¬æ¢</a>ä¸€èŠ‚æœ‰æåŠ. <code>=</code> è¿ç®—ç¬¦åœ¨ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/classes/##copyable-and-movable-types">å¯æ‹·è´ç±»å‹å’Œå¯ç§»åŠ¨ç±»å‹</a>ä¸€èŠ‚æœ‰æåŠ. è¿ç®—ç¬¦ <code>&lt;&lt;</code> åœ¨ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/others/##streams">æµ</a>ä¸€èŠ‚æœ‰æåŠ. åŒæ—¶è¯·å‚è§ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/others/##function-overloading">å‡½æ•°é‡è½½</a>ä¸€èŠ‚, å…¶ä¸­æåˆ°çš„çš„è§„åˆ™å¯¹è¿ç®—ç¬¦é‡è½½åŒæ ·é€‚ç”¨.</p><h3 id="å­˜å–æ§åˆ¶">3.9. å­˜å–æ§åˆ¶</h3><p><strong>æ€»è¿°</strong></p><p>å°† <em>æ‰€æœ‰</em> æ•°æ®æˆå‘˜å£°æ˜ä¸º <code>private</code>, é™¤éæ˜¯<code>static const</code> ç±»å‹æˆå‘˜ (éµå¾ª <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/naming/##constant-names">å¸¸é‡å‘½åè§„åˆ™</a>).å¤„äºæŠ€æœ¯ä¸Šçš„åŸå› , åœ¨ä½¿ç”¨ <ahref="https://github.com/google/googletest">Google Test</a>æ—¶æˆ‘ä»¬å…è®¸æµ‹è¯•å›ºä»¶ç±»ä¸­çš„æ•°æ®æˆå‘˜ä¸º <code>protected</code>.</p><h3 id="å£°æ˜é¡ºåº">3.10. å£°æ˜é¡ºåº</h3><p><strong>æ€»è¿°</strong></p><p>å°†ç›¸ä¼¼çš„å£°æ˜æ”¾åœ¨ä¸€èµ·, å°† <code>public</code> éƒ¨åˆ†æ”¾åœ¨æœ€å‰.</p><p><strong>è¯´æ˜</strong></p><p>ç±»å®šä¹‰ä¸€èˆ¬åº”ä»¥ <code>public:</code> å¼€å§‹, åè·Ÿ<code>protected:</code>, æœ€åæ˜¯ <code>private:</code>. çœç•¥ç©ºéƒ¨åˆ†.</p><p>åœ¨å„ä¸ªéƒ¨åˆ†ä¸­, å»ºè®®å°†ç±»ä¼¼çš„å£°æ˜æ”¾åœ¨ä¸€èµ·, å¹¶ä¸”å»ºè®®ä»¥å¦‚ä¸‹çš„é¡ºåº: ç±»å‹(åŒ…æ‹¬ <code>typedef</code>, <code>using</code> å’ŒåµŒå¥—çš„ç»“æ„ä½“ä¸ç±»),å¸¸é‡, å·¥å‚å‡½æ•°, æ„é€ å‡½æ•°, èµ‹å€¼è¿ç®—ç¬¦, ææ„å‡½æ•°, å…¶å®ƒå‡½æ•°, æ•°æ®æˆå‘˜.</p><p>ä¸è¦å°†å¤§æ®µçš„å‡½æ•°å®šä¹‰å†…è”åœ¨ç±»å®šä¹‰ä¸­. é€šå¸¸ï¼Œåªæœ‰é‚£äº›æ™®é€šçš„,æˆ–æ€§èƒ½å…³é”®ä¸”çŸ­å°çš„å‡½æ•°å¯ä»¥å†…è”åœ¨ç±»å®šä¹‰ä¸­. å‚è§ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/headers/##inline-functions">å†…è”å‡½æ•°</a>ä¸€èŠ‚.</p><h3 id="è¯‘è€…-yulefox-ç¬”è®°-2">è¯‘è€… (YuleFox) ç¬”è®°</h3><ol type="1"><li>ä¸åœ¨æ„é€ å‡½æ•°ä¸­åšå¤ªå¤šé€»è¾‘ç›¸å…³çš„åˆå§‹åŒ–;</li><li>ç¼–è¯‘å™¨æä¾›çš„é»˜è®¤æ„é€ å‡½æ•°ä¸ä¼šå¯¹å˜é‡è¿›è¡Œåˆå§‹åŒ–,å¦‚æœå®šä¹‰äº†å…¶ä»–æ„é€ å‡½æ•°, ç¼–è¯‘å™¨ä¸å†æä¾›,éœ€è¦ç¼–ç è€…è‡ªè¡Œæä¾›é»˜è®¤æ„é€ å‡½æ•°;</li><li>ä¸ºé¿å…éšå¼è½¬æ¢, éœ€å°†å•å‚æ•°æ„é€ å‡½æ•°å£°æ˜ä¸º <code>explicit</code>;</li><li>ä¸ºé¿å…æ‹·è´æ„é€ å‡½æ•°, èµ‹å€¼æ“ä½œçš„æ»¥ç”¨å’Œç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆ, å¯å°†å…¶å£°æ˜ä¸º<code>private</code> ä¸”æ— éœ€å®ç°;</li><li>ä»…åœ¨ä½œä¸ºæ•°æ®é›†åˆæ—¶ä½¿ç”¨ <code>struct</code>;</li><li>ç»„åˆ &gt; å®ç°ç»§æ‰¿ &gt; æ¥å£ç»§æ‰¿ &gt; ç§æœ‰ç»§æ‰¿,å­ç±»é‡è½½çš„è™šå‡½æ•°ä¹Ÿè¦å£°æ˜ <code>virtual</code> å…³é”®å­—,è™½ç„¶ç¼–è¯‘å™¨å…è®¸ä¸è¿™æ ·åš;</li><li>é¿å…ä½¿ç”¨å¤šé‡ç»§æ‰¿, ä½¿ç”¨æ—¶, é™¤ä¸€ä¸ªåŸºç±»å«æœ‰å®ç°å¤–,å…¶ä»–åŸºç±»å‡ä¸ºçº¯æ¥å£;</li><li>æ¥å£ç±»ç±»åä»¥ <code>Interface</code> ä¸ºåç¼€,é™¤æä¾›å¸¦å®ç°çš„è™šææ„å‡½æ•°, é™æ€æˆå‘˜å‡½æ•°å¤–, å…¶ä»–å‡ä¸ºçº¯è™šå‡½æ•°,ä¸å®šä¹‰éé™æ€æ•°æ®æˆå‘˜, ä¸æä¾›æ„é€ å‡½æ•°, æä¾›çš„è¯, å£°æ˜ä¸º<code>protected</code>;</li><li>ä¸ºé™ä½å¤æ‚æ€§, å°½é‡ä¸é‡è½½æ“ä½œç¬¦, æ¨¡æ¿,æ ‡å‡†ç±»ä¸­ä½¿ç”¨æ—¶æä¾›æ–‡æ¡£è¯´æ˜;</li><li>å­˜å–å‡½æ•°ä¸€èˆ¬å†…è”åœ¨å¤´æ–‡ä»¶ä¸­;</li><li>å£°æ˜æ¬¡åº: <code>public</code> -&gt; <code>protected</code> -&gt;<code>private</code>;</li><li>å‡½æ•°ä½“å°½é‡çŸ­å°, ç´§å‡‘, åŠŸèƒ½å•ä¸€;</li></ol></div><div class="story post-story"><h2 id="å‡½æ•°">4. å‡½æ•°</h2><h3 id="å‚æ•°é¡ºåº">4.1. å‚æ•°é¡ºåº</h3><p><strong>æ€»è¿°</strong></p><p>å‡½æ•°çš„å‚æ•°é¡ºåºä¸º: è¾“å…¥å‚æ•°åœ¨å…ˆ, åè·Ÿè¾“å‡ºå‚æ•°.</p><p><strong>è¯´æ˜</strong></p><p>C/C++ ä¸­çš„å‡½æ•°å‚æ•°æˆ–è€…æ˜¯å‡½æ•°çš„è¾“å…¥, æˆ–è€…æ˜¯å‡½æ•°çš„è¾“å‡º, æˆ–å…¼è€Œæœ‰ä¹‹.è¾“å…¥å‚æ•°é€šå¸¸æ˜¯å€¼å‚æˆ– <code>const</code> å¼•ç”¨,è¾“å‡ºå‚æ•°æˆ–è¾“å…¥/è¾“å‡ºå‚æ•°åˆ™ä¸€èˆ¬ä¸ºé <code>const</code> æŒ‡é’ˆ.åœ¨æ’åˆ—å‚æ•°é¡ºåºæ—¶, å°†æ‰€æœ‰çš„è¾“å…¥å‚æ•°ç½®äºè¾“å‡ºå‚æ•°ä¹‹å‰. ç‰¹åˆ«è¦æ³¨æ„,åœ¨åŠ å…¥æ–°å‚æ•°æ—¶ä¸è¦å› ä¸ºå®ƒä»¬æ˜¯æ–°å‚æ•°å°±ç½®äºå‚æ•°åˆ—è¡¨æœ€å,è€Œæ˜¯ä»ç„¶è¦æŒ‰ç…§å‰è¿°çš„è§„åˆ™, å³å°†æ–°çš„è¾“å…¥å‚æ•°ä¹Ÿç½®äºè¾“å‡ºå‚æ•°ä¹‹å‰.</p><p>è¿™å¹¶éä¸€ä¸ªç¡¬æ€§è§„å®š. è¾“å…¥/è¾“å‡ºå‚æ•° (é€šå¸¸æ˜¯ç±»æˆ–ç»“æ„ä½“)è®©è¿™ä¸ªé—®é¢˜å˜å¾—å¤æ‚. å¹¶ä¸”, æœ‰æ—¶å€™ä¸ºäº†å…¶ä»–å‡½æ•°ä¿æŒä¸€è‡´,ä½ å¯èƒ½ä¸å¾—ä¸æœ‰æ‰€å˜é€š.</p><h3 id="ç¼–å†™ç®€çŸ­å‡½æ•°">4.2. ç¼–å†™ç®€çŸ­å‡½æ•°</h3><p><strong>æ€»è¿°</strong></p><p>æˆ‘ä»¬å€¾å‘äºç¼–å†™ç®€çŸ­, å‡ç»ƒçš„å‡½æ•°.</p><p><strong>è¯´æ˜</strong></p><p>æˆ‘ä»¬æ‰¿è®¤é•¿å‡½æ•°æœ‰æ—¶æ˜¯åˆç†çš„, å› æ­¤å¹¶ä¸ç¡¬æ€§é™åˆ¶å‡½æ•°çš„é•¿åº¦. å¦‚æœå‡½æ•°è¶…è¿‡40 è¡Œ, å¯ä»¥æ€ç´¢ä¸€ä¸‹èƒ½ä¸èƒ½åœ¨ä¸å½±å“ç¨‹åºç»“æ„çš„å‰æä¸‹å¯¹å…¶è¿›è¡Œåˆ†å‰².</p><p>å³ä½¿ä¸€ä¸ªé•¿å‡½æ•°ç°åœ¨å·¥ä½œçš„éå¸¸å¥½, ä¸€æ—¦æœ‰äººå¯¹å…¶ä¿®æ”¹, æœ‰å¯èƒ½å‡ºç°æ–°çš„é—®é¢˜,ç”šè‡³å¯¼è‡´éš¾ä»¥å‘ç°çš„ bug. ä½¿å‡½æ•°å°½é‡ç®€çŸ­, ä»¥ä¾¿äºä»–äººé˜…è¯»å’Œä¿®æ”¹ä»£ç .</p><p>åœ¨å¤„ç†ä»£ç æ—¶, ä½ å¯èƒ½ä¼šå‘ç°å¤æ‚çš„é•¿å‡½æ•°. ä¸è¦å®³æ€•ä¿®æ”¹ç°æœ‰ä»£ç :å¦‚æœè¯å®è¿™äº›ä»£ç ä½¿ç”¨ / è°ƒè¯•èµ·æ¥å¾ˆå›°éš¾, æˆ–è€…ä½ åªéœ€è¦ä½¿ç”¨å…¶ä¸­çš„ä¸€å°æ®µä»£ç ,è€ƒè™‘å°†å…¶åˆ†å‰²ä¸ºæ›´åŠ ç®€çŸ­å¹¶æ˜“äºç®¡ç†çš„è‹¥å¹²å‡½æ•°.</p><h3 id="å¼•ç”¨å‚æ•°">4.3. å¼•ç”¨å‚æ•°</h3><p><strong>æ€»è¿°</strong></p><p>æ‰€æœ‰æŒ‰å¼•ç”¨ä¼ é€’çš„å‚æ•°å¿…é¡»åŠ ä¸Š <code>const</code>.</p><p><strong>å®šä¹‰</strong></p><p>åœ¨ C è¯­è¨€ä¸­, å¦‚æœå‡½æ•°éœ€è¦ä¿®æ”¹å˜é‡çš„å€¼, å‚æ•°å¿…é¡»ä¸ºæŒ‡é’ˆ, å¦‚<code>int foo(int *pval)</code>. åœ¨ C++ ä¸­, å‡½æ•°è¿˜å¯ä»¥å£°æ˜ä¸ºå¼•ç”¨å‚æ•°:<code>int foo(int &amp;val)</code>.</p><p><strong>ä¼˜ç‚¹</strong></p><p>å®šä¹‰å¼•ç”¨å‚æ•°å¯ä»¥é˜²æ­¢å‡ºç° <code>(*pval)++</code> è¿™æ ·ä¸‘é™‹çš„ä»£ç .å¼•ç”¨å‚æ•°å¯¹äºæ‹·è´æ„é€ å‡½æ•°è¿™æ ·çš„åº”ç”¨ä¹Ÿæ˜¯å¿…éœ€çš„.åŒæ—¶ä¹Ÿæ›´æ˜ç¡®åœ°ä¸æ¥å—ç©ºæŒ‡é’ˆ.</p><p><strong>ç¼ºç‚¹</strong></p><p>å®¹æ˜“å¼•èµ·è¯¯è§£, å› ä¸ºå¼•ç”¨åœ¨è¯­æ³•ä¸Šæ˜¯å€¼å˜é‡å´æ‹¥æœ‰æŒ‡é’ˆçš„è¯­ä¹‰.</p><p><strong>ç»“è®º</strong></p><p>å‡½æ•°å‚æ•°åˆ—è¡¨ä¸­, æ‰€æœ‰å¼•ç”¨å‚æ•°éƒ½å¿…é¡»æ˜¯ <code>const</code>:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Foo</span>(<span class="params"><span class="keyword">const</span> <span class="built_in">string</span> &amp;<span class="keyword">in</span>, <span class="built_in">string</span> *<span class="keyword">out</span></span>)</span>;</span><br></pre></td></tr></table></figure><p>äº‹å®ä¸Šè¿™åœ¨ Google Code æ˜¯ä¸€ä¸ªç¡¬æ€§çº¦å®š: è¾“å…¥å‚æ•°æ˜¯å€¼å‚æˆ–<code>const</code> å¼•ç”¨, è¾“å‡ºå‚æ•°ä¸ºæŒ‡é’ˆ. è¾“å…¥å‚æ•°å¯ä»¥æ˜¯<code>const</code> æŒ‡é’ˆ, ä½†å†³ä¸èƒ½æ˜¯é <code>const</code> çš„å¼•ç”¨å‚æ•°,é™¤éç‰¹æ®Šè¦æ±‚, æ¯”å¦‚ <code>swap()</code>.</p><p>æœ‰æ—¶å€™, åœ¨è¾“å…¥å½¢å‚ä¸­ç”¨ <code>const T*</code> æŒ‡é’ˆæ¯”<code>const T&amp;</code> æ›´æ˜æ™º. æ¯”å¦‚:</p><ul><li>å¯èƒ½ä¼šä¼ é€’ç©ºæŒ‡é’ˆ.</li><li>å‡½æ•°è¦æŠŠæŒ‡é’ˆæˆ–å¯¹åœ°å€çš„å¼•ç”¨èµ‹å€¼ç»™è¾“å…¥å½¢å‚.</li></ul><p>æ€»è€Œè¨€ä¹‹, å¤§å¤šæ—¶å€™è¾“å…¥å½¢å‚å¾€å¾€æ˜¯ <code>const T&amp;</code>. è‹¥ç”¨<code>const T*</code> åˆ™è¯´æ˜è¾“å…¥å¦æœ‰å¤„ç†. æ‰€ä»¥è‹¥è¦ä½¿ç”¨<code>const T*</code>, åˆ™åº”ç»™å‡ºç›¸åº”çš„ç†ç”±, å¦åˆ™ä¼šä½¿å¾—è¯»è€…æ„Ÿåˆ°è¿·æƒ‘.</p><h3 id="å‡½æ•°é‡è½½">4.4. å‡½æ•°é‡è½½</h3><p><strong>æ€»è¿°</strong></p><p>è‹¥è¦ä½¿ç”¨å‡½æ•°é‡è½½, åˆ™å¿…é¡»èƒ½è®©è¯»è€…ä¸€çœ‹è°ƒç”¨ç‚¹å°±èƒ¸æœ‰æˆç«¹,è€Œä¸ç”¨èŠ±å¿ƒæ€çŒœæµ‹è°ƒç”¨çš„é‡è½½å‡½æ•°åˆ°åº•æ˜¯å“ªä¸€ç§.è¿™ä¸€è§„åˆ™ä¹Ÿé€‚ç”¨äºæ„é€ å‡½æ•°.</p><p><strong>å®šä¹‰</strong></p><p>ä½ å¯ä»¥ç¼–å†™ä¸€ä¸ªå‚æ•°ç±»å‹ä¸º <code>const string&amp;</code> çš„å‡½æ•°,ç„¶åç”¨å¦ä¸€ä¸ªå‚æ•°ç±»å‹ä¸º <code>const char*</code> çš„å‡½æ•°å¯¹å…¶è¿›è¡Œé‡è½½:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Analyze</span><span class="params">(<span class="type">const</span> string &amp;text)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Analyze</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *text, <span class="type">size_t</span> textlen)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>ä¼˜ç‚¹</strong></p><p>é€šè¿‡é‡è½½å‚æ•°ä¸åŒçš„åŒåå‡½æ•°, å¯ä»¥ä»¤ä»£ç æ›´åŠ ç›´è§‚. æ¨¡æ¿åŒ–ä»£ç éœ€è¦é‡è½½,è¿™åŒæ—¶ä¹Ÿèƒ½ä¸ºä½¿ç”¨è€…å¸¦æ¥ä¾¿åˆ©.</p><p><strong>ç¼ºç‚¹</strong></p><p>å¦‚æœå‡½æ•°å•é ä¸åŒçš„å‚æ•°ç±»å‹è€Œé‡è½½ (acgtyrantæ³¨ï¼šè¿™æ„å‘³ç€å‚æ•°æ•°é‡ä¸å˜), è¯»è€…å°±å¾—ååˆ†ç†Ÿæ‚‰ C++ äº”èŠ±å…«é—¨çš„åŒ¹é…è§„åˆ™,ä»¥äº†è§£åŒ¹é…è¿‡ç¨‹å…·ä½“åˆ°åº•å¦‚ä½•. å¦å¤–, å¦‚æœæ´¾ç”Ÿç±»åªé‡è½½äº†æŸä¸ªå‡½æ•°çš„éƒ¨åˆ†å˜ä½“,ç»§æ‰¿è¯­ä¹‰å°±å®¹æ˜“ä»¤äººå›°æƒ‘.</p><p><strong>ç»“è®º</strong></p><p>å¦‚æœæ‰“ç®—é‡è½½ä¸€ä¸ªå‡½æ•°, å¯ä»¥è¯•è¯•æ”¹åœ¨å‡½æ•°åé‡ŒåŠ ä¸Šå‚æ•°ä¿¡æ¯. ä¾‹å¦‚, ç”¨<code>AppendString()</code> å’Œ <code>AppendInt()</code> ç­‰,è€Œä¸æ˜¯ä¸€å£æ°”é‡è½½å¤šä¸ª <code>Append()</code>.å¦‚æœé‡è½½å‡½æ•°çš„ç›®çš„æ˜¯ä¸ºäº†æ”¯æŒä¸åŒæ•°é‡çš„åŒä¸€ç±»å‹å‚æ•°, åˆ™ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨<code>std::vector</code> ä»¥ä¾¿ä½¿ç”¨è€…å¯ä»¥ç”¨ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/others/##braced-initializer-list">åˆ—è¡¨åˆå§‹åŒ–</a>æŒ‡å®šå‚æ•°.</p><h3 id="ç¼ºçœå‚æ•°">4.5. ç¼ºçœå‚æ•°</h3><p><strong>æ€»è¿°</strong></p><p>åªå…è®¸åœ¨éè™šå‡½æ•°ä¸­ä½¿ç”¨ç¼ºçœå‚æ•°, ä¸”å¿…é¡»ä¿è¯ç¼ºçœå‚æ•°çš„å€¼å§‹ç»ˆä¸€è‡´.ç¼ºçœå‚æ•°ä¸ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/others/##function-overloading">å‡½æ•°é‡è½½</a>éµå¾ªåŒæ ·çš„è§„åˆ™. ä¸€èˆ¬æƒ…å†µä¸‹å»ºè®®ä½¿ç”¨å‡½æ•°é‡è½½,å°¤å…¶æ˜¯åœ¨ç¼ºçœå‡½æ•°å¸¦æ¥çš„å¯è¯»æ€§æå‡ä¸èƒ½å¼¥è¡¥ä¸‹æ–‡ä¸­æ‰€æåˆ°çš„ç¼ºç‚¹çš„æƒ…å†µä¸‹.</p><p><strong>ä¼˜ç‚¹</strong></p><p>æœ‰äº›å‡½æ•°ä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨é»˜è®¤å‚æ•°, ä½†æœ‰æ—¶éœ€è¦åˆä½¿ç”¨éé»˜è®¤çš„å‚æ•°.ç¼ºçœå‚æ•°ä¸ºè¿™æ ·çš„æƒ…å½¢æä¾›äº†ä¾¿åˆ©,ä½¿ç¨‹åºå‘˜ä¸éœ€è¦ä¸ºäº†æå°‘çš„ä¾‹å¤–æƒ…å†µç¼–å†™å¤§é‡çš„å‡½æ•°. å’Œå‡½æ•°é‡è½½ç›¸æ¯”,ç¼ºçœå‚æ•°çš„è¯­æ³•æ›´ç®€æ´æ˜äº†, å‡å°‘äº†å¤§é‡çš„æ ·æ¿ä»£ç , ä¹Ÿæ›´å¥½åœ°åŒºåˆ«äº†â€œå¿…è¦å‚æ•°â€ å’Œ â€œå¯é€‰å‚æ•°â€.</p><p><strong>ç¼ºç‚¹</strong></p><p>ç¼ºçœå‚æ•°å®é™…ä¸Šæ˜¯å‡½æ•°é‡è½½è¯­ä¹‰çš„å¦ä¸€ç§å®ç°æ–¹å¼, å› æ­¤æ‰€æœ‰ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/others/##function-overloading">ä¸åº”å½“ä½¿ç”¨å‡½æ•°é‡è½½çš„ç†ç”±</a>ä¹Ÿéƒ½é€‚ç”¨äºç¼ºçœå‚æ•°.</p><p>è™šå‡½æ•°è°ƒç”¨çš„ç¼ºçœå‚æ•°å–å†³äºç›®æ ‡å¯¹è±¡çš„é™æ€ç±»å‹,æ­¤æ—¶æ— æ³•ä¿è¯ç»™å®šå‡½æ•°çš„æ‰€æœ‰é‡è½½å£°æ˜çš„éƒ½æ˜¯åŒæ ·çš„ç¼ºçœå‚æ•°.</p><p>ç¼ºçœå‚æ•°æ˜¯åœ¨æ¯ä¸ªè°ƒç”¨ç‚¹éƒ½è¦è¿›è¡Œé‡æ–°æ±‚å€¼çš„, è¿™ä¼šé€ æˆç”Ÿæˆçš„ä»£ç è¿…é€Ÿè†¨èƒ€.ä½œä¸ºè¯»è€…, ä¸€èˆ¬æ¥è¯´ä¹Ÿæ›´å¸Œæœ›ç¼ºçœçš„å‚æ•°åœ¨å£°æ˜æ—¶å°±å·²ç»è¢«å›ºå®šäº†,è€Œä¸æ˜¯åœ¨æ¯æ¬¡è°ƒç”¨æ—¶éƒ½å¯èƒ½ä¼šæœ‰ä¸åŒçš„å–å€¼.</p><p>ç¼ºçœå‚æ•°ä¼šå¹²æ‰°å‡½æ•°æŒ‡é’ˆ, å¯¼è‡´å‡½æ•°ç­¾åä¸è°ƒç”¨ç‚¹çš„ç­¾åä¸ä¸€è‡´.è€Œå‡½æ•°é‡è½½ä¸ä¼šå¯¼è‡´è¿™æ ·çš„é—®é¢˜.</p><p><strong>ç»“è®º</strong></p><p>å¯¹äºè™šå‡½æ•°, ä¸å…è®¸ä½¿ç”¨ç¼ºçœå‚æ•°,å› ä¸ºåœ¨è™šå‡½æ•°ä¸­ç¼ºçœå‚æ•°ä¸ä¸€å®šèƒ½æ­£å¸¸å·¥ä½œ.å¦‚æœåœ¨æ¯ä¸ªè°ƒç”¨ç‚¹ç¼ºçœå‚æ•°çš„å€¼éƒ½æœ‰å¯èƒ½ä¸åŒ,åœ¨è¿™ç§æƒ…å†µä¸‹ç¼ºçœå‡½æ•°ä¹Ÿä¸å…è®¸ä½¿ç”¨. (ä¾‹å¦‚, ä¸è¦å†™åƒ<code>void f(int n = counter++);</code> è¿™æ ·çš„ä»£ç .)</p><p>åœ¨å…¶ä»–æƒ…å†µä¸‹, å¦‚æœç¼ºçœå‚æ•°å¯¹å¯è¯»æ€§çš„æå‡è¿œè¿œè¶…è¿‡äº†ä»¥ä¸ŠæåŠçš„ç¼ºç‚¹çš„è¯,å¯ä»¥ä½¿ç”¨ç¼ºçœå‚æ•°. å¦‚æœä»æœ‰ç–‘æƒ‘, å°±ä½¿ç”¨å‡½æ•°é‡è½½.</p><h3 id="å‡½æ•°è¿”å›ç±»å‹åç½®è¯­æ³•">4.6. å‡½æ•°è¿”å›ç±»å‹åç½®è¯­æ³•</h3><p><strong>æ€»è¿°</strong></p><p>åªæœ‰åœ¨å¸¸è§„å†™æ³• (è¿”å›ç±»å‹å‰ç½®)ä¸ä¾¿äºä¹¦å†™æˆ–ä¸ä¾¿äºé˜…è¯»æ—¶ä½¿ç”¨è¿”å›ç±»å‹åç½®è¯­æ³•.</p><p><strong>å®šä¹‰</strong></p><p>C++ ç°åœ¨å…è®¸ä¸¤ç§ä¸åŒçš„å‡½æ•°å£°æ˜æ–¹å¼.ä»¥å¾€çš„å†™æ³•æ˜¯å°†è¿”å›ç±»å‹ç½®äºå‡½æ•°åä¹‹å‰. ä¾‹å¦‚:</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">foo</span><span class="params">(<span class="type">int</span> x)</span></span>;</span><br></pre></td></tr></table></figure><p>C++11 å¼•å…¥äº†è¿™ä¸€æ–°çš„å½¢å¼. ç°åœ¨å¯ä»¥åœ¨å‡½æ•°åå‰ä½¿ç”¨ <code>auto</code>å…³é”®å­—, åœ¨å‚æ•°åˆ—è¡¨ä¹‹ååç½®è¿”å›ç±»å‹. ä¾‹å¦‚:</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">auto</span> foo(<span class="built_in">int</span> x) -&gt; <span class="built_in">int</span>;</span><br></pre></td></tr></table></figure><p>åç½®è¿”å›ç±»å‹ä¸ºå‡½æ•°ä½œç”¨åŸŸ. å¯¹äºåƒ <code>int</code> è¿™æ ·ç®€å•çš„ç±»å‹,ä¸¤ç§å†™æ³•æ²¡æœ‰åŒºåˆ«. ä½†å¯¹äºå¤æ‚çš„æƒ…å†µ,ä¾‹å¦‚ç±»åŸŸä¸­çš„ç±»å‹å£°æ˜æˆ–è€…ä»¥å‡½æ•°å‚æ•°çš„å½¢å¼ä¹¦å†™çš„ç±»å‹,å†™æ³•çš„ä¸åŒä¼šé€ æˆåŒºåˆ«.</p><p><strong>ä¼˜ç‚¹</strong></p><p>åç½®è¿”å›ç±»å‹æ˜¯æ˜¾å¼åœ°æŒ‡å®š <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/others/##lambda-expressions">Lambdaè¡¨è¾¾å¼</a> çš„è¿”å›å€¼çš„å”¯ä¸€æ–¹å¼. æŸäº›æƒ…å†µä¸‹, ç¼–è¯‘å™¨å¯ä»¥è‡ªåŠ¨æ¨å¯¼å‡º Lambdaè¡¨è¾¾å¼çš„è¿”å›ç±»å‹, ä½†å¹¶ä¸æ˜¯åœ¨æ‰€æœ‰çš„æƒ…å†µä¸‹éƒ½èƒ½å®ç°.å³ä½¿ç¼–è¯‘å™¨èƒ½å¤Ÿè‡ªåŠ¨æ¨å¯¼, æ˜¾å¼åœ°æŒ‡å®šè¿”å›ç±»å‹ä¹Ÿèƒ½è®©è¯»è€…æ›´æ˜äº†.</p><p>æœ‰æ—¶åœ¨å·²ç»å‡ºç°äº†çš„å‡½æ•°å‚æ•°åˆ—è¡¨ä¹‹åæŒ‡å®šè¿”å›ç±»å‹, èƒ½å¤Ÿè®©ä¹¦å†™æ›´ç®€å•,ä¹Ÿæ›´æ˜“è¯», å°¤å…¶æ˜¯åœ¨è¿”å›ç±»å‹ä¾èµ–äºæ¨¡æ¿å‚æ•°æ—¶. ä¾‹å¦‚:</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">template &lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">U</span>&gt; auto add<span class="function"><span class="params">(T t, U u)</span> -&gt;</span> decltype(t + u);</span><br></pre></td></tr></table></figure><p>å¯¹æ¯”ä¸‹é¢çš„ä¾‹å­:</p><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">template</span> &lt;class <span class="type">T</span>, class <span class="type">U</span>&gt; decl<span class="keyword">type</span>(declval&lt;<span class="type">T</span>&amp;&gt;() + declval&lt;<span class="type">U</span>&amp;&gt;()) add(<span class="type">T</span> t, <span class="type">U</span> u);</span><br></pre></td></tr></table></figure><p><strong>ç¼ºç‚¹</strong></p><p>åç½®è¿”å›ç±»å‹ç›¸å¯¹æ¥è¯´æ˜¯éå¸¸æ–°çš„è¯­æ³•, è€Œä¸”åœ¨ C å’Œ Javaä¸­éƒ½æ²¡æœ‰ç›¸ä¼¼çš„å†™æ³•, å› æ­¤å¯èƒ½å¯¹è¯»è€…æ¥è¯´æ¯”è¾ƒé™Œç”Ÿ.</p><p>åœ¨å·²æœ‰çš„ä»£ç ä¸­æœ‰å¤§é‡çš„å‡½æ•°å£°æ˜, ä½ ä¸å¯èƒ½æŠŠå®ƒä»¬éƒ½ç”¨æ–°çš„è¯­æ³•é‡å†™ä¸€é.å› æ­¤å®é™…çš„åšæ³•åªèƒ½æ˜¯ä½¿ç”¨æ—§çš„è¯­æ³•æˆ–è€…æ–°æ—§æ··ç”¨. åœ¨è¿™ç§æƒ…å†µä¸‹,åªä½¿ç”¨ä¸€ç§ç‰ˆæœ¬æ˜¯ç›¸å¯¹æ¥è¯´æ›´è§„æ•´çš„å½¢å¼.</p><p><strong>ç»“è®º</strong></p><p>åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹, åº”å½“ç»§ç»­ä½¿ç”¨ä»¥å¾€çš„å‡½æ•°å£°æ˜å†™æ³•,å³å°†è¿”å›ç±»å‹ç½®äºå‡½æ•°åå‰. åªæœ‰åœ¨å¿…éœ€çš„æ—¶å€™ (å¦‚ Lambda è¡¨è¾¾å¼)æˆ–è€…ä½¿ç”¨åç½®è¯­æ³•èƒ½å¤Ÿç®€åŒ–ä¹¦å†™å¹¶ä¸”æé«˜æ˜“è¯»æ€§çš„æ—¶å€™æ‰ä½¿ç”¨æ–°çš„è¿”å›ç±»å‹åç½®è¯­æ³•.ä½†æ˜¯åä¸€ç§æƒ…å†µä¸€èˆ¬æ¥è¯´æ˜¯å¾ˆå°‘è§çš„,å¤§éƒ¨åˆ†æ—¶å€™éƒ½å‡ºç°åœ¨ç›¸å½“å¤æ‚çš„æ¨¡æ¿ä»£ç ä¸­, è€Œå¤šæ•°æƒ…å†µä¸‹ä¸é¼“åŠ±å†™è¿™æ · <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/others/##template-metaprogramming">å¤æ‚çš„æ¨¡æ¿ä»£ç </a>.</p></div><div class="story post-story"><h2 id="æ¥è‡ª-google-çš„å¥‡æŠ€">5. æ¥è‡ª Google çš„å¥‡æŠ€</h2><p>Google ç”¨äº†å¾ˆå¤šè‡ªå·±å®ç°çš„æŠ€å·§ / å·¥å…·ä½¿ C++ ä»£ç æ›´åŠ å¥å£®, æˆ‘ä»¬ä½¿ç”¨ C++çš„æ–¹å¼å¯èƒ½å’Œä½ åœ¨å…¶å®ƒåœ°æ–¹è§åˆ°çš„æœ‰æ‰€ä¸åŒ.</p><h3 id="æ‰€æœ‰æƒä¸æ™ºèƒ½æŒ‡é’ˆ">5.1. æ‰€æœ‰æƒä¸æ™ºèƒ½æŒ‡é’ˆ</h3><p>==æ€»è¿°==</p><p>åŠ¨æ€åˆ†é…å‡ºçš„å¯¹è±¡æœ€å¥½æœ‰å•ä¸€ä¸”å›ºå®šçš„æ‰€æœ‰ä¸»,å¹¶é€šè¿‡æ™ºèƒ½æŒ‡é’ˆä¼ é€’æ‰€æœ‰æƒ.</p><p>==å®šä¹‰==</p><p>æ‰€æœ‰æƒæ˜¯ä¸€ç§ç™»è®°ï¼ç®¡ç†åŠ¨æ€å†…å­˜å’Œå…¶å®ƒèµ„æºçš„æŠ€æœ¯.åŠ¨æ€åˆ†é…å¯¹è±¡çš„æ‰€æœ‰ä¸»æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–å‡½æ•°,åè€…è´Ÿè´£ç¡®ä¿å½“å‰è€…æ— ç”¨æ—¶å°±è‡ªåŠ¨é”€æ¯å‰è€…. æ‰€æœ‰æƒæœ‰æ—¶å¯ä»¥å…±äº«,æ­¤æ—¶å°±ç”±æœ€åä¸€ä¸ªæ‰€æœ‰ä¸»æ¥è´Ÿè´£é”€æ¯å®ƒ. ç”šè‡³ä¹Ÿå¯ä»¥ä¸ç”¨å…±äº«,åœ¨ä»£ç ä¸­ç›´æ¥æŠŠæ‰€æœ‰æƒä¼ é€’ç»™å…¶å®ƒå¯¹è±¡.</p><p>æ™ºèƒ½æŒ‡é’ˆæ˜¯ä¸€ä¸ªé€šè¿‡é‡è½½ <code>*</code> å’Œ <code>-&gt;</code>è¿ç®—ç¬¦ä»¥è¡¨ç°å¾—å¦‚æŒ‡é’ˆä¸€æ ·çš„ç±». æ™ºèƒ½æŒ‡é’ˆç±»å‹è¢«ç”¨æ¥è‡ªåŠ¨åŒ–æ‰€æœ‰æƒçš„ç™»è®°å·¥ä½œ,æ¥ç¡®ä¿æ‰§è¡Œé”€æ¯ä¹‰åŠ¡åˆ°ä½. <ahref="http://en.cppreference.com/w/cpp/memory/unique_ptr">std::unique_ptr</a>æ˜¯ C++11 æ–°æ¨å‡ºçš„ä¸€ç§æ™ºèƒ½æŒ‡é’ˆç±»å‹,ç”¨æ¥è¡¨ç¤ºåŠ¨æ€åˆ†é…å‡ºçš„å¯¹è±¡çš„ç‹¬ä¸€æ— äºŒçš„æ‰€æœ‰æƒ; å½“<code>std::unique_ptr</code> ç¦»å¼€ä½œç”¨åŸŸæ—¶, å¯¹è±¡å°±ä¼šè¢«é”€æ¯.<code>std::unique_ptr</code> ä¸èƒ½è¢«å¤åˆ¶,ä½†å¯ä»¥æŠŠå®ƒç§»åŠ¨ï¼ˆmoveï¼‰ç»™æ–°æ‰€æœ‰ä¸». <ahref="http://en.cppreference.com/w/cpp/memory/shared_ptr">std::shared_ptr</a>åŒæ ·è¡¨ç¤ºåŠ¨æ€åˆ†é…å¯¹è±¡çš„æ‰€æœ‰æƒ, ä½†å¯ä»¥è¢«å…±äº«, ä¹Ÿå¯ä»¥è¢«å¤åˆ¶;å¯¹è±¡çš„æ‰€æœ‰æƒç”±æ‰€æœ‰å¤åˆ¶è€…å…±åŒæ‹¥æœ‰, æœ€åä¸€ä¸ªå¤åˆ¶è€…è¢«é”€æ¯æ—¶,å¯¹è±¡ä¹Ÿä¼šéšç€è¢«é”€æ¯.</p><p>==ä¼˜ç‚¹==</p><ul><li>å¦‚æœæ²¡æœ‰æ¸…æ™°ã€é€»è¾‘æ¡ç†çš„æ‰€æœ‰æƒå®‰æ’, ä¸å¯èƒ½ç®¡ç†å¥½åŠ¨æ€åˆ†é…çš„å†…å­˜.</li><li>ä¼ é€’å¯¹è±¡çš„æ‰€æœ‰æƒ, å¼€é”€æ¯”å¤åˆ¶æ¥å¾—å°, å¦‚æœå¯ä»¥å¤åˆ¶çš„è¯.</li><li>ä¼ é€’æ‰€æœ‰æƒä¹Ÿæ¯”â€å€Ÿç”¨â€æŒ‡é’ˆæˆ–å¼•ç”¨æ¥å¾—ç®€å•,æ¯•ç«Ÿå®ƒå¤§å¤§çœå»äº†ä¸¤ä¸ªç”¨æˆ·ä¸€èµ·åè°ƒå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„å·¥ä½œ.</li><li>å¦‚æœæ‰€æœ‰æƒé€»è¾‘æ¡ç†, æœ‰æ–‡æ¡£ä¸”ä¸ç´Šä¹±çš„è¯, å¯è¯»æ€§ä¼šæœ‰å¾ˆå¤§æå‡.</li><li>å¯ä»¥ä¸ç”¨æ‰‹åŠ¨å®Œæˆæ‰€æœ‰æƒçš„ç™»è®°å·¥ä½œ, å¤§å¤§ç®€åŒ–äº†ä»£ç ,ä¹Ÿå…å»äº†ä¸€å¤§æ³¢é”™è¯¯ä¹‹æ¼.</li><li>å¯¹äº const å¯¹è±¡æ¥è¯´, æ™ºèƒ½æŒ‡é’ˆç®€å•æ˜“ç”¨, ä¹Ÿæ¯”æ·±åº¦å¤åˆ¶é«˜æ•ˆ.</li></ul><p>==ç¼ºç‚¹==</p><ul><li>ä¸å¾—ä¸ç”¨æŒ‡é’ˆï¼ˆä¸ç®¡æ˜¯æ™ºèƒ½çš„è¿˜æ˜¯åŸç”Ÿçš„ï¼‰æ¥è¡¨ç¤ºå’Œä¼ é€’æ‰€æœ‰æƒ.æŒ‡é’ˆè¯­ä¹‰å¯è¦æ¯”å€¼è¯­ä¹‰å¤æ‚å¾—è®¸å¤šäº†, ç‰¹åˆ«æ˜¯åœ¨ API é‡Œï¼šè¿™æ—¶ä¸å…‰è¦æ“å¿ƒæ‰€æœ‰æƒ,è¿˜è¦é¡¾åŠåˆ«å, ç”Ÿå‘½å‘¨æœŸ, å¯å˜æ€§ä»¥åŠå…¶å®ƒå¤§å¤§å°å°çš„é—®é¢˜.</li><li>å…¶å®å€¼è¯­ä¹‰çš„å¼€é”€ç»å¸¸è¢«é«˜ä¼°,æ‰€ä»¥æ‰€æœ‰æƒä¼ é€’å¸¦æ¥çš„æ€§èƒ½æå‡ä¸ä¸€å®šèƒ½å¼¥è¡¥å¯è¯»æ€§å’Œå¤æ‚åº¦çš„æŸå¤±.</li><li>å¦‚æœ API ä¾èµ–æ‰€æœ‰æƒçš„ä¼ é€’,å°±ä¼šå®³å¾—å®¢æˆ·ç«¯ä¸å¾—ä¸ç”¨å•ä¸€çš„å†…å­˜ç®¡ç†æ¨¡å‹.</li><li>å¦‚æœä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆ, é‚£ä¹ˆèµ„æºé‡Šæ”¾å‘ç”Ÿçš„ä½ç½®å°±ä¼šå˜å¾—ä¸é‚£ä¹ˆæ˜æ˜¾.</li><li><code>std::unique_ptr</code> çš„æ‰€æœ‰æƒä¼ é€’åŸç†æ˜¯ C++11 çš„ move è¯­æ³•,åè€…æ¯•ç«Ÿæ˜¯åˆšåˆšæ¨å‡ºçš„, å®¹æ˜“è¿·æƒ‘ç¨‹åºå‘˜.</li><li>å¦‚æœåŸæœ¬çš„æ‰€æœ‰æƒè®¾è®¡å·²ç»å¤Ÿå®Œå–„äº†, é‚£ä¹ˆè‹¥è¦å¼•å…¥æ‰€æœ‰æƒå…±äº«æœºåˆ¶,å¯èƒ½ä¸å¾—ä¸é‡æ„æ•´ä¸ªç³»ç»Ÿ.</li><li>æ‰€æœ‰æƒå…±äº«æœºåˆ¶çš„ç™»è®°å·¥ä½œåœ¨è¿è¡Œæ—¶è¿›è¡Œ, å¼€é”€å¯èƒ½ç›¸å½“å¤§.</li><li>æŸäº›æç«¯æƒ…å†µä¸‹ (ä¾‹å¦‚å¾ªç¯å¼•ç”¨),æ‰€æœ‰æƒè¢«å…±äº«çš„å¯¹è±¡æ°¸è¿œä¸ä¼šè¢«é”€æ¯.</li><li>æ™ºèƒ½æŒ‡é’ˆå¹¶ä¸èƒ½å¤Ÿå®Œå…¨ä»£æ›¿åŸç”ŸæŒ‡é’ˆ.</li></ul><p>==ç»“è®º==</p><p>å¦‚æœå¿…é¡»ä½¿ç”¨åŠ¨æ€åˆ†é…, é‚£ä¹ˆæ›´å€¾å‘äºå°†æ‰€æœ‰æƒä¿æŒåœ¨åˆ†é…è€…æ‰‹ä¸­.å¦‚æœå…¶ä»–åœ°æ–¹è¦ä½¿ç”¨è¿™ä¸ªå¯¹è±¡, æœ€å¥½ä¼ é€’å®ƒçš„æ‹·è´,æˆ–è€…ä¼ é€’ä¸€ä¸ªä¸ç”¨æ”¹å˜æ‰€æœ‰æƒçš„æŒ‡é’ˆæˆ–å¼•ç”¨. å€¾å‘äºä½¿ç”¨<code>std::unique_ptr</code> æ¥æ˜ç¡®æ‰€æœ‰æƒä¼ é€’, ä¾‹å¦‚ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::unique_ptr&lt;Foo&gt; <span class="title">FooFactory</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FooConsumer</span><span class="params">(std::unique_ptr&lt;Foo&gt; ptr)</span></span>;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰å¾ˆå¥½çš„ç†ç”±, åˆ™ä¸è¦ä½¿ç”¨å…±äº«æ‰€æœ‰æƒ.è¿™é‡Œçš„ç†ç”±å¯ä»¥æ˜¯ä¸ºäº†é¿å…å¼€é”€æ˜‚è´µçš„æ‹·è´æ“ä½œ, ä½†æ˜¯åªæœ‰å½“æ€§èƒ½æå‡éå¸¸æ˜æ˜¾,å¹¶ä¸”æ“ä½œçš„å¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼ˆæ¯”å¦‚è¯´ <code>std::shared_ptr</code> ï¼‰æ—¶å€™,æ‰èƒ½è¿™ä¹ˆåš. å¦‚æœç¡®å®è¦ä½¿ç”¨å…±äº«æ‰€æœ‰æƒ, å»ºè®®äºä½¿ç”¨<code>std::shared_ptr</code> .</p><p>ä¸è¦ä½¿ç”¨ <code>std::auto_ptr</code>, ä½¿ç”¨<code>std::unique_ptr</code> ä»£æ›¿å®ƒ.</p><h3 id="cpplint">5.2. Cpplint</h3><p><strong>&gt; æ€»è¿°</strong></p><p>ä½¿ç”¨ <code>cpplint.py</code> æ£€æŸ¥é£æ ¼é”™è¯¯.</p><p><strong>&gt; è¯´æ˜</strong></p><p><code>cpplint.py</code> æ˜¯ä¸€ä¸ªç”¨æ¥åˆ†ææºæ–‡ä»¶,èƒ½æ£€æŸ¥å‡ºå¤šç§é£æ ¼é”™è¯¯çš„å·¥å…·. å®ƒä¸å¹¶å®Œç¾, ç”šè‡³è¿˜ä¼šæ¼æŠ¥å’Œè¯¯æŠ¥,ä½†å®ƒä»ç„¶æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å·¥å…·. åœ¨è¡Œå°¾åŠ  <code>// NOLINT</code>,æˆ–åœ¨ä¸Šä¸€è¡ŒåŠ  <code>// NOLINTNEXTLINE</code>, å¯ä»¥å¿½ç•¥æŠ¥é”™.</p><p>æŸäº›é¡¹ç›®ä¼šæŒ‡å¯¼ä½ å¦‚ä½•ä½¿ç”¨ä»–ä»¬çš„é¡¹ç›®å·¥å…·è¿è¡Œ <code>cpplint.py</code>.å¦‚æœä½ å‚ä¸çš„é¡¹ç›®æ²¡æœ‰æä¾›, ä½ å¯ä»¥å•ç‹¬ä¸‹è½½ <ahref="http://github.com/google/styleguide/blob/gh-pages/cpplint/cpplint.py">cpplint.py</a>.</p><h3 id="è¯‘è€…acgtyrantç¬”è®°-2">è¯‘è€…ï¼ˆacgtyrantï¼‰ç¬”è®°</h3><ol type="1"><li>æŠŠæ™ºèƒ½æŒ‡é’ˆå½“æˆå¯¹è±¡æ¥çœ‹å¾…çš„è¯,å°±å¾ˆå¥½é¢†ä¼šå®ƒä¸æ‰€æŒ‡å¯¹è±¡ä¹‹é—´çš„å…³ç³»äº†.</li><li>åŸæ¥ Rust çš„ Ownership æ€æƒ³æ˜¯å—åˆ°äº† C++ æ™ºèƒ½æŒ‡é’ˆçš„å¾ˆå¤§å¯å‘å•Š.</li><li><code>scoped_ptr</code> å’Œ <code>auto_ptr</code> å·²è¿‡æ—¶. ç°åœ¨æ˜¯<code>shared_ptr</code> å’Œ <code>uniqued_ptr</code> çš„å¤©ä¸‹äº†.</li><li>æŒ‰æœ¬æ–‡æ¥è¯´, ä¼¼ä¹é™¤äº†æ™ºèƒ½æŒ‡é’ˆ, è¿˜æœ‰å…¶å®ƒæ‰€æœ‰æƒæœºåˆ¶, å€¼å¾—ç•™æ„.</li><li>Arch Linux ç”¨æˆ·æ³¨æ„äº†, AUR æœ‰å¯¹ cpplint æ‰“åŒ….</li></ol></div><div class="story post-story"><h2 id="å…¶ä»–-c-ç‰¹æ€§">6. å…¶ä»– C++ ç‰¹æ€§</h2><h3 id="å¼•ç”¨å‚æ•°-1">6.1. å¼•ç”¨å‚æ•°</h3><p>==Tip==</p><p>æ‰€æœ‰æŒ‰å¼•ç”¨ä¼ é€’çš„å‚æ•°å¿…é¡»åŠ ä¸Š <code>const</code>.</p><p>==å®šä¹‰:==</p><blockquote><p>åœ¨ C è¯­è¨€ä¸­, å¦‚æœå‡½æ•°éœ€è¦ä¿®æ”¹å˜é‡çš„å€¼, å‚æ•°å¿…é¡»ä¸ºæŒ‡é’ˆ, å¦‚<code>int foo(int *pval)</code>. åœ¨ C++ ä¸­, å‡½æ•°è¿˜å¯ä»¥å£°æ˜å¼•ç”¨å‚æ•°:<code>int foo(int &amp;val)</code>.</p></blockquote><p>==ä¼˜ç‚¹:==</p><blockquote><p>å®šä¹‰å¼•ç”¨å‚æ•°é˜²æ­¢å‡ºç° <code>(*pval)++</code> è¿™æ ·ä¸‘é™‹çš„ä»£ç .åƒæ‹·è´æ„é€ å‡½æ•°è¿™æ ·çš„åº”ç”¨ä¹Ÿæ˜¯å¿…éœ€çš„. è€Œä¸”æ›´æ˜ç¡®, ä¸æ¥å— <code>NULL</code>æŒ‡é’ˆ.</p></blockquote><p>==ç¼ºç‚¹:==</p><blockquote><p>å®¹æ˜“å¼•èµ·è¯¯è§£, å› ä¸ºå¼•ç”¨åœ¨è¯­æ³•ä¸Šæ˜¯å€¼å˜é‡å´æ‹¥æœ‰æŒ‡é’ˆçš„è¯­ä¹‰.</p></blockquote><p>==ç»“è®º:==</p><blockquote><p>å‡½æ•°å‚æ•°åˆ—è¡¨ä¸­, æ‰€æœ‰å¼•ç”¨å‚æ•°éƒ½å¿…é¡»æ˜¯ <code>const</code>:</p><blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Foo</span><span class="params">(<span class="type">const</span> string &amp;in, string *out)</span></span>;</span><br></pre></td></tr></table></figure></blockquote><p>äº‹å®ä¸Šè¿™åœ¨ Google Code æ˜¯ä¸€ä¸ªç¡¬æ€§çº¦å®š: è¾“å…¥å‚æ•°æ˜¯å€¼å‚æˆ–<code>const</code> å¼•ç”¨, è¾“å‡ºå‚æ•°ä¸ºæŒ‡é’ˆ. è¾“å…¥å‚æ•°å¯ä»¥æ˜¯<code>const</code> æŒ‡é’ˆ, ä½†å†³ä¸èƒ½æ˜¯é <code>const</code>çš„å¼•ç”¨å‚æ•°ï¼Œé™¤éç”¨äºäº¤æ¢ï¼Œæ¯”å¦‚ <code>swap()</code>.</p><p>æœ‰æ—¶å€™ï¼Œåœ¨è¾“å…¥å½¢å‚ä¸­ç”¨ <code>const T*</code> æŒ‡é’ˆæ¯”<code>const T&amp;</code> æ›´æ˜æ™ºã€‚æ¯”å¦‚ï¼š</p><ul><li>æ‚¨ä¼šä¼  null æŒ‡é’ˆã€‚</li><li>å‡½æ•°è¦æŠŠæŒ‡é’ˆæˆ–å¯¹åœ°å€çš„å¼•ç”¨èµ‹å€¼ç»™è¾“å…¥å½¢å‚ã€‚</li></ul><p>æ€»ä¹‹å¤§å¤šæ—¶å€™è¾“å…¥å½¢å‚å¾€å¾€æ˜¯ <code>const T&amp;</code>. è‹¥ç”¨<code>const T*</code> è¯´æ˜è¾“å…¥å¦æœ‰å¤„ç†ã€‚æ‰€ä»¥è‹¥æ‚¨è¦ç”¨<code>const T*</code>, åˆ™åº”æœ‰ç†æœ‰æ®ï¼Œå¦åˆ™ä¼šå®³å¾—è¯»è€…è¯¯è§£ã€‚</p></blockquote><h3 id="å³å€¼å¼•ç”¨">6.2. å³å€¼å¼•ç”¨</h3><p>==Tip==</p><p>åªåœ¨å®šä¹‰ç§»åŠ¨æ„é€ å‡½æ•°ä¸ç§»åŠ¨èµ‹å€¼æ“ä½œæ—¶ä½¿ç”¨å³å€¼å¼•ç”¨. ä¸è¦ä½¿ç”¨<code>std::forward</code>.</p><p>==å®šä¹‰:==</p><blockquote><p>å³å€¼å¼•ç”¨æ˜¯ä¸€ç§åªèƒ½ç»‘å®šåˆ°ä¸´æ—¶å¯¹è±¡çš„å¼•ç”¨çš„ä¸€ç§,å…¶è¯­æ³•ä¸ä¼ ç»Ÿçš„å¼•ç”¨è¯­æ³•ç›¸ä¼¼. ä¾‹å¦‚,<code>void f(string&amp;&amp; s)</code>;å£°æ˜äº†ä¸€ä¸ªå…¶å‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²çš„å³å€¼å¼•ç”¨çš„å‡½æ•°.</p></blockquote><p>==ä¼˜ç‚¹:==</p><blockquote><p>ç”¨äºå®šä¹‰ç§»åŠ¨æ„é€ å‡½æ•° (ä½¿ç”¨ç±»çš„å³å€¼å¼•ç”¨è¿›è¡Œæ„é€ çš„å‡½æ•°)ä½¿å¾—ç§»åŠ¨ä¸€ä¸ªå€¼è€Œéæ‹·è´ä¹‹æˆä¸ºå¯èƒ½. ä¾‹å¦‚, å¦‚æœ <code>v1</code> æ˜¯ä¸€ä¸ª<code>vector</code>, åˆ™ <code>auto v2(std::move(v1))</code>å°†å¾ˆå¯èƒ½ä¸å†è¿›è¡Œå¤§é‡çš„æ•°æ®å¤åˆ¶è€Œåªæ˜¯ç®€å•åœ°è¿›è¡ŒæŒ‡é’ˆæ“ä½œ,åœ¨æŸäº›æƒ…å†µä¸‹è¿™å°†å¸¦æ¥å¤§å¹…åº¦çš„æ€§èƒ½æå‡.</p><p>å³å€¼å¼•ç”¨ä½¿å¾—ç¼–å†™é€šç”¨çš„å‡½æ•°å°è£…æ¥è½¬å‘å…¶å‚æ•°åˆ°å¦å¤–ä¸€ä¸ªå‡½æ•°æˆä¸ºå¯èƒ½,æ— è®ºå…¶å‚æ•°æ˜¯å¦æ˜¯ä¸´æ—¶å¯¹è±¡éƒ½èƒ½æ­£å¸¸å·¥ä½œ.</p><p>å³å€¼å¼•ç”¨èƒ½å®ç°å¯ç§»åŠ¨ä½†ä¸å¯æ‹·è´çš„ç±»å‹,è¿™ä¸€ç‰¹æ€§å¯¹é‚£äº›åœ¨æ‹·è´æ–¹é¢æ²¡æœ‰å®é™…éœ€æ±‚,ä½†æœ‰æ—¶åˆéœ€è¦å°†å®ƒä»¬ä½œä¸ºå‡½æ•°å‚æ•°ä¼ é€’æˆ–å¡å…¥å®¹å™¨çš„ç±»å‹å¾ˆæœ‰ç”¨.</p><p>è¦é«˜æ•ˆç‡åœ°ä½¿ç”¨æŸäº›æ ‡å‡†åº“ç±»å‹, ä¾‹å¦‚ <code>std::unique_ptr</code>,<code>std::move</code> æ˜¯å¿…éœ€çš„.</p></blockquote><p>==ç¼ºç‚¹:==</p><blockquote><p>å³å€¼å¼•ç”¨æ˜¯ä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒæ–°çš„ç‰¹æ€§ (ç”± C++11 å¼•å…¥), å®ƒå°šæœªè¢«å¹¿æ³›ç†è§£.ç±»ä¼¼å¼•ç”¨å´©æºƒ, ç§»åŠ¨æ„é€ å‡½æ•°çš„è‡ªåŠ¨æ¨å¯¼è¿™æ ·çš„è§„åˆ™éƒ½æ˜¯å¾ˆå¤æ‚çš„.</p></blockquote><p>==ç»“è®º:==</p><blockquote><p>åªåœ¨å®šä¹‰ç§»åŠ¨æ„é€ å‡½æ•°ä¸ç§»åŠ¨èµ‹å€¼æ“ä½œæ—¶ä½¿ç”¨å³å€¼å¼•ç”¨, ä¸è¦ä½¿ç”¨<code>std::forward</code> åŠŸèƒ½å‡½æ•°. ä½ å¯èƒ½ä¼šä½¿ç”¨ <code>std::move</code>æ¥è¡¨ç¤ºå°†å€¼ä»ä¸€ä¸ªå¯¹è±¡ç§»åŠ¨è€Œä¸æ˜¯å¤åˆ¶åˆ°å¦ä¸€ä¸ªå¯¹è±¡.</p></blockquote><h3 id="å‡½æ•°é‡è½½-1">6.3. å‡½æ•°é‡è½½</h3><p>==Tip==</p><p>è‹¥è¦ç”¨å¥½å‡½æ•°é‡è½½ï¼Œæœ€å¥½èƒ½è®©è¯»è€…ä¸€çœ‹è°ƒç”¨ç‚¹ï¼ˆcallsiteï¼‰å°±èƒ¸æœ‰æˆç«¹ï¼Œä¸ç”¨èŠ±å¿ƒæ€çŒœæµ‹è°ƒç”¨çš„é‡è½½å‡½æ•°åˆ°åº•æ˜¯å“ªä¸€ç§ã€‚è¯¥è§„åˆ™é€‚ç”¨äºæ„é€ å‡½æ•°ã€‚</p><p>==å®šä¹‰:==</p><blockquote><p>ä½ å¯ä»¥ç¼–å†™ä¸€ä¸ªå‚æ•°ç±»å‹ä¸º <code>const string&amp;</code> çš„å‡½æ•°,ç„¶åç”¨å¦ä¸€ä¸ªå‚æ•°ç±»å‹ä¸º <code>const char*</code> çš„å‡½æ•°é‡è½½å®ƒ:</p><blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Analyze</span><span class="params">(<span class="type">const</span> string &amp;text)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Analyze</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *text, <span class="type">size_t</span> textlen)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></blockquote></blockquote><p>==ä¼˜ç‚¹:==</p><blockquote><p>é€šè¿‡é‡è½½å‚æ•°ä¸åŒçš„åŒåå‡½æ•°, ä»¤ä»£ç æ›´åŠ ç›´è§‚. æ¨¡æ¿åŒ–ä»£ç éœ€è¦é‡è½½,åŒæ—¶ä¸ºä½¿ç”¨è€…å¸¦æ¥ä¾¿åˆ©.</p></blockquote><p>==ç¼ºç‚¹:==</p><blockquote><p>å¦‚æœå‡½æ•°å•å•é ä¸åŒçš„å‚æ•°ç±»å‹è€Œé‡è½½ï¼ˆacgtyrantæ³¨ï¼šè¿™æ„å‘³ç€å‚æ•°æ•°é‡ä¸å˜ï¼‰ï¼Œè¯»è€…å°±å¾—ååˆ†ç†Ÿæ‚‰ C++äº”èŠ±å…«é—¨çš„åŒ¹é…è§„åˆ™ï¼Œä»¥äº†è§£åŒ¹é…è¿‡ç¨‹å…·ä½“åˆ°åº•å¦‚ä½•ã€‚å¦å¤–ï¼Œå½“æ´¾ç”Ÿç±»åªé‡è½½äº†æŸä¸ªå‡½æ•°çš„éƒ¨åˆ†å˜ä½“ï¼Œç»§æ‰¿è¯­ä¹‰å®¹æ˜“ä»¤äººå›°æƒ‘ã€‚</p></blockquote><p>==ç»“è®º:==</p><blockquote><p>å¦‚æœæ‚¨æ‰“ç®—é‡è½½ä¸€ä¸ªå‡½æ•°, å¯ä»¥è¯•è¯•æ”¹åœ¨å‡½æ•°åé‡ŒåŠ ä¸Šå‚æ•°ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œç”¨<code>AppendString()</code> å’Œ <code>AppendInt()</code> ç­‰ï¼Œè€Œä¸æ˜¯ä¸€å£æ°”é‡è½½å¤šä¸ª <code>Append()</code>.</p></blockquote><h3 id="ç¼ºçœå‚æ•°-1">6.4. ç¼ºçœå‚æ•°</h3><p>==Tip==</p><p>æˆ‘ä»¬ä¸å…è®¸ä½¿ç”¨ç¼ºçœå‡½æ•°å‚æ•°ï¼Œå°‘æ•°æç«¯æƒ…å†µé™¤å¤–ã€‚å°½å¯èƒ½æ”¹ç”¨å‡½æ•°é‡è½½ã€‚</p><p>==ä¼˜ç‚¹:==</p><blockquote><p>å½“æ‚¨æœ‰ä¾èµ–ç¼ºçœå‚æ•°çš„å‡½æ•°æ—¶ï¼Œæ‚¨ä¹Ÿè®¸å¶å°”ä¼šä¿®æ”¹ä¿®æ”¹è¿™äº›ç¼ºçœå‚æ•°ã€‚é€šè¿‡ç¼ºçœå‚æ•°ï¼Œä¸ç”¨å†ä¸ºä¸ªåˆ«æƒ…å†µè€Œç‰¹æ„å®šä¹‰ä¸€å¤§å †å‡½æ•°äº†ã€‚ä¸å‡½æ•°é‡è½½ç›¸æ¯”ï¼Œç¼ºçœå‚æ•°è¯­æ³•æ›´ä¸ºæ¸…æ™°ï¼Œä»£ç å°‘ï¼Œä¹Ÿå¾ˆå¥½åœ°åŒºåˆ†äº†ã€Œå¿…é€‰å‚æ•°ã€å’Œã€Œå¯é€‰å‚æ•°ã€ã€‚</p></blockquote><p>==ç¼ºç‚¹:==</p><blockquote><p>ç¼ºçœå‚æ•°ä¼šå¹²æ‰°å‡½æ•°æŒ‡é’ˆï¼Œå®³å¾—åè€…çš„å‡½æ•°ç­¾åï¼ˆfunctionsignatureï¼‰å¾€å¾€å¯¹ä¸ä¸Šæ‰€å®é™…è¦è°ƒç”¨çš„å‡½æ•°ç­¾åã€‚å³åœ¨ä¸€ä¸ªç°æœ‰å‡½æ•°æ·»åŠ ç¼ºçœå‚æ•°ï¼Œå°±ä¼šæ”¹å˜å®ƒçš„ç±»å‹ï¼Œé‚£ä¹ˆè°ƒç”¨å…¶åœ°å€çš„ä»£ç å¯èƒ½ä¼šå‡ºé”™ï¼Œä¸è¿‡å‡½æ•°é‡è½½å°±æ²¡è¿™é—®é¢˜äº†ã€‚æ­¤å¤–ï¼Œç¼ºçœå‚æ•°ä¼šé€ æˆè‡ƒè‚¿çš„ä»£ç ï¼Œæ¯•ç«Ÿå®ƒä»¬åœ¨æ¯ä¸€ä¸ªè°ƒç”¨ç‚¹ï¼ˆcallsiteï¼‰éƒ½æœ‰é‡å¤ï¼ˆacgtyrantæ³¨ï¼šæˆ‘çŒœå¯èƒ½æ˜¯å› ä¸ºè°ƒç”¨å‡½æ•°çš„ä»£ç è¡¨é¢ä¸Šçœ‹æ¥çœå»äº†ä¸å°‘å‚æ•°ï¼Œä½†ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶è¿˜æ˜¯ä¼šåœ¨æ¯ä¸€ä¸ªè°ƒç”¨ä»£ç é‡Œç»Ÿç»Ÿè¡¥ä¸Šæ‰€æœ‰é»˜è®¤å®å‚ä¿¡æ¯ï¼Œé€ æˆå¤§é‡çš„é‡å¤ï¼‰ã€‚å‡½æ•°é‡è½½æ­£å¥½ç›¸åï¼Œæ¯•ç«Ÿå®ƒä»¬æ‰€è°“çš„ã€Œç¼ºçœå‚æ•°ã€åªä¼šå‡ºç°åœ¨å‡½æ•°å®šä¹‰é‡Œã€‚</p></blockquote><p>==ç»“è®º:==</p><blockquote><p>ç”±äºç¼ºç‚¹å¹¶ä¸æ˜¯å¾ˆä¸¥é‡ï¼Œæœ‰äº›äººä¾æ—§åçˆ±ç¼ºçœå‚æ•°èƒœäºå‡½æ•°é‡è½½ã€‚æ‰€ä»¥é™¤äº†ä»¥ä¸‹æƒ…å†µï¼Œæˆ‘ä»¬è¦æ±‚å¿…é¡»æ˜¾å¼æä¾›æ‰€æœ‰å‚æ•°ï¼ˆacgtyrantæ³¨ï¼šå³ä¸èƒ½å†é€šè¿‡ç¼ºçœå‚æ•°æ¥çœç•¥å‚æ•°äº†ï¼‰ã€‚</p><p>å…¶ä¸€ï¼Œä½äº <code>.cc</code>æ–‡ä»¶é‡Œçš„é™æ€å‡½æ•°æˆ–åŒ¿åç©ºé—´å‡½æ•°ï¼Œæ¯•ç«Ÿéƒ½åªèƒ½åœ¨å±€éƒ¨æ–‡ä»¶é‡Œè°ƒç”¨è¯¥å‡½æ•°äº†ã€‚</p><p>å…¶äºŒï¼Œå¯ä»¥åœ¨æ„é€ å‡½æ•°é‡Œç”¨ç¼ºçœå‚æ•°ï¼Œæ¯•ç«Ÿä¸å¯èƒ½å–å¾—å®ƒä»¬çš„åœ°å€ã€‚</p><p>å…¶ä¸‰ï¼Œå¯ä»¥ç”¨æ¥æ¨¡æ‹Ÿå˜é•¿æ•°ç»„ã€‚</p><blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡ç©º AlphaNum ä»¥æ”¯æŒå››ä¸ªå½¢å‚</span></span><br><span class="line"><span class="function">string <span class="title">StrCat</span><span class="params">(<span class="type">const</span> AlphaNum &amp;a,</span></span></span><br><span class="line"><span class="params"><span class="function">              <span class="type">const</span> AlphaNum &amp;b = gEmptyAlphaNum,</span></span></span><br><span class="line"><span class="params"><span class="function">              <span class="type">const</span> AlphaNum &amp;c = gEmptyAlphaNum,</span></span></span><br><span class="line"><span class="params"><span class="function">              <span class="type">const</span> AlphaNum &amp;d = gEmptyAlphaNum)</span></span>;</span><br></pre></td></tr></table></figure></blockquote></blockquote><h3 id="å˜é•¿æ•°ç»„å’Œ-alloca">6.5. å˜é•¿æ•°ç»„å’Œ alloca()</h3><p>==Tip==</p><p>æˆ‘ä»¬ä¸å…è®¸ä½¿ç”¨å˜é•¿æ•°ç»„å’Œ <code>alloca()</code>.</p><p>==ä¼˜ç‚¹:==</p><blockquote><p>å˜é•¿æ•°ç»„å…·æœ‰æµ‘ç„¶å¤©æˆçš„è¯­æ³•. å˜é•¿æ•°ç»„å’Œ <code>alloca()</code>ä¹Ÿéƒ½å¾ˆé«˜æ•ˆ.</p></blockquote><p>==ç¼ºç‚¹:==</p><blockquote><p>å˜é•¿æ•°ç»„å’Œ <code>alloca()</code> ä¸æ˜¯æ ‡å‡† C++ çš„ç»„æˆéƒ¨åˆ†. æ›´é‡è¦çš„æ˜¯,å®ƒä»¬æ ¹æ®æ•°æ®å¤§å°åŠ¨æ€åˆ†é…å †æ ˆå†…å­˜, ä¼šå¼•èµ·éš¾ä»¥å‘ç°çš„å†…å­˜è¶Šç•Œ bugs:â€œåœ¨æˆ‘çš„æœºå™¨ä¸Šè¿è¡Œçš„å¥½å¥½çš„, å‘å¸ƒåå´è«åå…¶å¦™çš„æŒ‚æ‰äº†â€.</p></blockquote><p>==ç»“è®º:==</p><blockquote><p>æ”¹ç”¨æ›´å®‰å…¨çš„åˆ†é…å™¨ï¼ˆallocatorï¼‰ï¼Œå°±åƒ <code>std::vector</code> æˆ–<code>std::unique_ptr</code>.</p></blockquote><h3 id="å‹å…ƒ">6.6. å‹å…ƒ</h3><p>==Tip==</p><p>æˆ‘ä»¬å…è®¸åˆç†çš„ä½¿ç”¨å‹å…ƒç±»åŠå‹å…ƒå‡½æ•°.</p><p>é€šå¸¸å‹å…ƒåº”è¯¥å®šä¹‰åœ¨åŒä¸€æ–‡ä»¶å†…,é¿å…ä»£ç è¯»è€…è·‘åˆ°å…¶å®ƒæ–‡ä»¶æŸ¥æ‰¾ä½¿ç”¨è¯¥ç§æœ‰æˆå‘˜çš„ç±».ç»å¸¸ç”¨åˆ°å‹å…ƒçš„ä¸€ä¸ªåœ°æ–¹æ˜¯å°† <code>FooBuilder</code> å£°æ˜ä¸º<code>Foo</code> çš„å‹å…ƒ, ä»¥ä¾¿ <code>FooBuilder</code> æ­£ç¡®æ„é€ <code>Foo</code> çš„å†…éƒ¨çŠ¶æ€, è€Œæ— éœ€å°†è¯¥çŠ¶æ€æš´éœ²å‡ºæ¥. æŸäº›æƒ…å†µä¸‹,å°†ä¸€ä¸ªå•å…ƒæµ‹è¯•ç±»å£°æ˜æˆå¾…æµ‹ç±»çš„å‹å…ƒä¼šå¾ˆæ–¹ä¾¿.</p><p>å‹å…ƒæ‰©å¤§äº† (ä½†æ²¡æœ‰æ‰“ç ´) ç±»çš„å°è£…è¾¹ç•Œ. æŸäº›æƒ…å†µä¸‹,ç›¸å¯¹äºå°†ç±»æˆå‘˜å£°æ˜ä¸º <code>public</code>, ä½¿ç”¨å‹å…ƒæ˜¯æ›´å¥½çš„é€‰æ‹©,å°¤å…¶æ˜¯å¦‚æœä½ åªå…è®¸å¦ä¸€ä¸ªç±»è®¿é—®è¯¥ç±»çš„ç§æœ‰æˆå‘˜æ—¶. å½“ç„¶,å¤§å¤šæ•°ç±»éƒ½åªåº”è¯¥é€šè¿‡å…¶æä¾›çš„å…¬æœ‰æˆå‘˜è¿›è¡Œäº’æ“ä½œ.</p><h3 id="å¼‚å¸¸">6.7. å¼‚å¸¸</h3><p>==Tip==</p><p>æˆ‘ä»¬ä¸ä½¿ç”¨ C++ å¼‚å¸¸.</p><p>==ä¼˜ç‚¹:==</p><blockquote><ul><li>å¼‚å¸¸å…è®¸åº”ç”¨é«˜å±‚å†³å®šå¦‚ä½•å¤„ç†åœ¨åº•å±‚åµŒå¥—å‡½æ•°ä¸­ã€Œä¸å¯èƒ½å‘ç”Ÿã€çš„å¤±è´¥ï¼ˆfailuresï¼‰ï¼Œä¸ç”¨ç®¡é‚£äº›å«ç³Šä¸”å®¹æ˜“å‡ºé”™çš„é”™è¯¯ä»£ç ï¼ˆacgtyrantæ³¨ï¼šerror code, æˆ‘çŒœæ˜¯ï¼£è¯­è¨€å‡½æ•°è¿”å›çš„éé›¶ int å€¼ï¼‰ã€‚</li><li>å¾ˆå¤šç°ä»£è¯­è¨€éƒ½ç”¨å¼‚å¸¸ã€‚å¼•å…¥å¼‚å¸¸ä½¿å¾— C++ ä¸ Python, Java ä»¥åŠå…¶å®ƒç±»C++ çš„è¯­è¨€æ›´ä¸€è„‰ç›¸æ‰¿ã€‚</li><li>æœ‰äº›ç¬¬ä¸‰æ–¹ C++ åº“ä¾èµ–å¼‚å¸¸ï¼Œç¦ç”¨å¼‚å¸¸å°±ä¸å¥½ç”¨äº†ã€‚</li><li>å¼‚å¸¸æ˜¯å¤„ç†æ„é€ å‡½æ•°å¤±è´¥çš„å”¯ä¸€é€”å¾„ã€‚è™½ç„¶å¯ä»¥ç”¨å·¥å‚å‡½æ•°ï¼ˆacgtyrantæ³¨ï¼šfactory function, å‡ºè‡ª C++ çš„ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå³ã€Œç®€å•å·¥å‚æ¨¡å¼ã€ï¼‰æˆ–<code>Init()</code> æ–¹æ³•ä»£æ›¿å¼‚å¸¸,ä½†æ˜¯å‰è€…è¦æ±‚åœ¨å †æ ˆåˆ†é…å†…å­˜ï¼Œåè€…ä¼šå¯¼è‡´åˆšåˆ›å»ºçš„å®ä¾‹å¤„äº â€æ— æ•ˆâ€œçŠ¶æ€ã€‚</li><li>åœ¨æµ‹è¯•æ¡†æ¶é‡Œå¾ˆå¥½ç”¨ã€‚</li></ul></blockquote><p>==ç¼ºç‚¹:==</p><blockquote><ul><li>åœ¨ç°æœ‰å‡½æ•°ä¸­æ·»åŠ  <code>throw</code>è¯­å¥æ—¶ï¼Œæ‚¨å¿…é¡»æ£€æŸ¥æ‰€æœ‰è°ƒç”¨ç‚¹ã€‚è¦ä¹ˆè®©æ‰€æœ‰è°ƒç”¨ç‚¹ç»Ÿç»Ÿå…·å¤‡æœ€ä½é™åº¦çš„å¼‚å¸¸å®‰å…¨ä¿è¯ï¼Œè¦ä¹ˆçœ¼ççåœ°çœ‹å¼‚å¸¸ä¸€è·¯æ¬¢å¿«åœ°å¾€ä¸Šè·‘ï¼Œæœ€ç»ˆä¸­æ–­æ‰æ•´ä¸ªç¨‹åºã€‚ä¸¾ä¾‹ï¼Œ<code>f()</code>è°ƒç”¨ <code>g()</code>, <code>g()</code> åˆè°ƒç”¨ <code>h()</code>, ä¸”<code>h</code> æŠ›å‡ºçš„å¼‚å¸¸è¢« <code>f</code> æ•è·ã€‚å½“å¿ƒ <code>g</code>,å¦åˆ™ä¼šæ²¡å¦¥å–„æ¸…ç†å¥½ã€‚</li><li>è¿˜æœ‰æ›´å¸¸è§çš„ï¼Œå¼‚å¸¸ä¼šå½»åº•æ‰°ä¹±ç¨‹åºçš„æ‰§è¡Œæµç¨‹å¹¶éš¾ä»¥åˆ¤æ–­ï¼Œå‡½æ•°ä¹Ÿè®¸ä¼šåœ¨æ‚¨æ„æ–™ä¸åˆ°çš„åœ°æ–¹è¿”å›ã€‚æ‚¨æˆ–è®¸ä¼šåŠ ä¸€å¤§å †ä½•æ—¶ä½•å¤„å¤„ç†å¼‚å¸¸çš„è§„å®šæ¥é™ä½é£é™©ï¼Œç„¶è€Œå¼€å‘è€…çš„è®°å¿†è´Ÿæ‹…æ›´é‡äº†ã€‚</li><li>å¼‚å¸¸å®‰å…¨éœ€è¦RAIIå’Œä¸åŒçš„ç¼–ç å®è·µ.è¦è½»æ¾ç¼–å†™å‡ºæ­£ç¡®çš„å¼‚å¸¸å®‰å…¨ä»£ç éœ€è¦å¤§é‡çš„æ”¯æŒæœºåˆ¶. æ›´è¿›ä¸€æ­¥åœ°è¯´,ä¸ºäº†é¿å…è¯»è€…ç†è§£æ•´ä¸ªè°ƒç”¨è¡¨, å¼‚å¸¸å®‰å…¨å¿…é¡»éš”ç»ä»æŒç»­çŠ¶æ€å†™åˆ° â€œæäº¤â€çŠ¶æ€çš„é€»è¾‘. è¿™ä¸€ç‚¹æœ‰åˆ©æœ‰å¼Š (å› ä¸ºä½ ä¹Ÿè®¸ä¸å¾—ä¸ä¸ºäº†éš”ç¦»æäº¤è€Œæ··æ·†ä»£ç ).å¦‚æœå…è®¸ä½¿ç”¨å¼‚å¸¸, æˆ‘ä»¬å°±ä¸å¾—ä¸æ—¶åˆ»å…³æ³¨è¿™æ ·çš„å¼Šç«¯,å³ä½¿æœ‰æ—¶å®ƒä»¬å¹¶ä¸å€¼å¾—.</li><li>å¯ç”¨å¼‚å¸¸ä¼šå¢åŠ äºŒè¿›åˆ¶æ–‡ä»¶æ•°æ®ï¼Œå»¶é•¿ç¼–è¯‘æ—¶é—´ï¼ˆæˆ–è®¸å½±å“å°ï¼‰ï¼Œè¿˜å¯èƒ½åŠ å¤§åœ°å€ç©ºé—´çš„å‹åŠ›ã€‚</li><li>æ»¥ç”¨å¼‚å¸¸ä¼šå˜ç›¸é¼“åŠ±å¼€å‘è€…å»æ•æ‰ä¸åˆæ—¶å®œï¼Œæˆ–æœ¬æ¥å°±å·²ç»æ²¡æ³•æ¢å¤çš„ã€Œä¼ªå¼‚å¸¸ã€ã€‚æ¯”å¦‚ï¼Œç”¨æˆ·çš„è¾“å…¥ä¸ç¬¦åˆæ ¼å¼è¦æ±‚æ—¶ï¼Œä¹Ÿç”¨ä¸ç€æŠ›å¼‚å¸¸ã€‚å¦‚æ­¤ä¹‹ç±»çš„ä¼ªå¼‚å¸¸åˆ—éƒ½åˆ—ä¸å®Œã€‚</li></ul></blockquote><p>==ç»“è®º:==</p><blockquote><p>ä»è¡¨é¢ä¸Šçœ‹æ¥ï¼Œä½¿ç”¨å¼‚å¸¸åˆ©å¤§äºå¼Š, å°¤å…¶æ˜¯åœ¨æ–°é¡¹ç›®ä¸­. ä½†æ˜¯å¯¹äºç°æœ‰ä»£ç ,å¼•å…¥å¼‚å¸¸ä¼šç‰µè¿åˆ°æ‰€æœ‰ç›¸å…³ä»£ç . å¦‚æœæ–°é¡¹ç›®å…è®¸å¼‚å¸¸å‘å¤–æ‰©æ•£,åœ¨è·Ÿä»¥å‰æœªä½¿ç”¨å¼‚å¸¸çš„ä»£ç æ•´åˆæ—¶ä¹Ÿå°†æ˜¯ä¸ªéº»çƒ¦. å› ä¸º Google ç°æœ‰çš„å¤§å¤šæ•° C++ä»£ç éƒ½æ²¡æœ‰å¼‚å¸¸å¤„ç†, å¼•å…¥å¸¦æœ‰å¼‚å¸¸å¤„ç†çš„æ–°ä»£ç ç›¸å½“å›°éš¾.</p><p>é‰´äº Google ç°æœ‰ä»£ç ä¸æ¥å—å¼‚å¸¸,åœ¨ç°æœ‰ä»£ç ä¸­ä½¿ç”¨å¼‚å¸¸æ¯”åœ¨æ–°é¡¹ç›®ä¸­ä½¿ç”¨çš„ä»£ä»·å¤šå°‘è¦å¤§ä¸€äº›. è¿ç§»è¿‡ç¨‹æ¯”è¾ƒæ…¢,ä¹Ÿå®¹æ˜“å‡ºé”™. æˆ‘ä»¬ä¸ç›¸ä¿¡å¼‚å¸¸çš„ä½¿ç”¨æœ‰æ•ˆæ›¿ä»£æ–¹æ¡ˆ, å¦‚é”™è¯¯ä»£ç ,æ–­è¨€ç­‰ä¼šé€ æˆä¸¥é‡è´Ÿæ‹….</p><p>æˆ‘ä»¬å¹¶ä¸æ˜¯åŸºäºå“²å­¦æˆ–é“å¾·å±‚é¢åå¯¹ä½¿ç”¨å¼‚å¸¸, è€Œæ˜¯åœ¨å®è·µçš„åŸºç¡€ä¸Š.æˆ‘ä»¬å¸Œæœ›åœ¨ Google ä½¿ç”¨æˆ‘ä»¬è‡ªå·±çš„å¼€æºé¡¹ç›®,ä½†é¡¹ç›®ä¸­ä½¿ç”¨å¼‚å¸¸ä¼šä¸ºæ­¤å¸¦æ¥ä¸ä¾¿, å› æ­¤æˆ‘ä»¬ä¹Ÿå»ºè®®ä¸è¦åœ¨ Googleçš„å¼€æºé¡¹ç›®ä¸­ä½¿ç”¨å¼‚å¸¸. å¦‚æœæˆ‘ä»¬éœ€è¦æŠŠè¿™äº›é¡¹ç›®æ¨å€’é‡æ¥æ˜¾ç„¶ä¸å¤ªç°å®.</p><p>å¯¹äº Windows ä»£ç æ¥è¯´, æœ‰ä¸ª <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/exceptions/##windows-code">ç‰¹ä¾‹</a>.</p></blockquote><p>(YuleFox æ³¨: å¯¹äºå¼‚å¸¸å¤„ç†, æ˜¾ç„¶ä¸æ˜¯çŸ­çŸ­å‡ å¥è¯èƒ½å¤Ÿè¯´æ¸…æ¥šçš„,ä»¥æ„é€ å‡½æ•°ä¸ºä¾‹, å¾ˆå¤š C++ ä¹¦ç±ä¸Šéƒ½æåˆ°å½“æ„é€ å¤±è´¥æ—¶åªæœ‰å¼‚å¸¸å¯ä»¥å¤„ç†,Google ç¦æ­¢ä½¿ç”¨å¼‚å¸¸è¿™ä¸€ç‚¹, ä»…ä»…æ˜¯ä¸ºäº†è‡ªèº«çš„æ–¹ä¾¿, è¯´å¤§äº†,æ— éæ˜¯åŸºäºè½¯ä»¶ç®¡ç†æˆæœ¬ä¸Š, å®é™…ä½¿ç”¨ä¸­è¿˜æ˜¯è‡ªå·±å†³å®š)</p><h3 id="è¿è¡Œæ—¶ç±»å‹è¯†åˆ«">6.8. è¿è¡Œæ—¶ç±»å‹è¯†åˆ«</h3><p>==Tip==</p><p>æˆ‘ä»¬ç¦æ­¢ä½¿ç”¨ RTTI.</p><p>==å®šä¹‰:==</p><blockquote><p>RTTI å…è®¸ç¨‹åºå‘˜åœ¨è¿è¡Œæ—¶è¯†åˆ« C++ ç±»å¯¹è±¡çš„ç±»å‹. å®ƒé€šè¿‡ä½¿ç”¨<code>typeid</code> æˆ–è€… <code>dynamic_cast</code> å®Œæˆ.</p></blockquote><p>==ä¼˜ç‚¹:==</p><blockquote><p>RTTI çš„æ ‡å‡†æ›¿ä»£ (ä¸‹é¢å°†æè¿°) éœ€è¦å¯¹æœ‰é—®é¢˜çš„ç±»å±‚çº§è¿›è¡Œä¿®æ”¹æˆ–é‡æ„.æœ‰æ—¶è¿™æ ·çš„ä¿®æ”¹å¹¶ä¸æ˜¯æˆ‘ä»¬æ‰€æƒ³è¦çš„, ç”šè‡³æ˜¯ä¸å¯å–çš„,å°¤å…¶æ˜¯åœ¨ä¸€ä¸ªå·²ç»å¹¿æ³›ä½¿ç”¨çš„æˆ–è€…æˆç†Ÿçš„ä»£ç ä¸­.</p><p>RTTI åœ¨æŸäº›å•å…ƒæµ‹è¯•ä¸­éå¸¸æœ‰ç”¨. æ¯”å¦‚è¿›è¡Œå·¥å‚ç±»æµ‹è¯•æ—¶,ç”¨æ¥éªŒè¯ä¸€ä¸ªæ–°å»ºå¯¹è±¡æ˜¯å¦ä¸ºæœŸæœ›çš„åŠ¨æ€ç±»å‹. RTTIå¯¹äºç®¡ç†å¯¹è±¡å’Œæ´¾ç”Ÿå¯¹è±¡çš„å…³ç³»ä¹Ÿå¾ˆæœ‰ç”¨.</p><p>åœ¨è€ƒè™‘å¤šä¸ªæŠ½è±¡å¯¹è±¡æ—¶ RTTI ä¹Ÿå¾ˆå¥½ç”¨. ä¾‹å¦‚:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Base::Equal</span><span class="params">(Base* other)</span> </span>= <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Derived::Equal</span><span class="params">(Base* other)</span> </span>&#123;</span><br><span class="line">  Derived* that = <span class="built_in">dynamic_cast</span>&lt;Derived*&gt;(other);</span><br><span class="line">  <span class="keyword">if</span> (that == <span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>==ç¼ºç‚¹:==</p><blockquote><p>åœ¨è¿è¡Œæ—¶åˆ¤æ–­ç±»å‹é€šå¸¸æ„å‘³ç€è®¾è®¡é—®é¢˜.å¦‚æœä½ éœ€è¦åœ¨è¿è¡ŒæœŸé—´ç¡®å®šä¸€ä¸ªå¯¹è±¡çš„ç±»å‹,è¿™é€šå¸¸è¯´æ˜ä½ éœ€è¦è€ƒè™‘é‡æ–°è®¾è®¡ä½ çš„ç±».</p><p>éšæ„åœ°ä½¿ç”¨ RTTI ä¼šä½¿ä½ çš„ä»£ç éš¾ä»¥ç»´æŠ¤. å®ƒä½¿å¾—åŸºäºç±»å‹çš„åˆ¤æ–­æ ‘æˆ–è€…switch è¯­å¥æ•£å¸ƒåœ¨ä»£ç å„å¤„. å¦‚æœä»¥åè¦è¿›è¡Œä¿®æ”¹, ä½ å°±å¿…é¡»æ£€æŸ¥å®ƒä»¬.</p></blockquote><p>==ç»“è®º:==</p><blockquote><p>RTTI æœ‰åˆç†çš„ç”¨é€”ä½†æ˜¯å®¹æ˜“è¢«æ»¥ç”¨, å› æ­¤åœ¨ä½¿ç”¨æ—¶è¯·åŠ¡å¿…æ³¨æ„.åœ¨å•å…ƒæµ‹è¯•ä¸­å¯ä»¥ä½¿ç”¨ RTTI, ä½†æ˜¯åœ¨å…¶ä»–ä»£ç ä¸­è¯·å°½é‡é¿å…. å°¤å…¶æ˜¯åœ¨æ–°ä»£ç ä¸­,ä½¿ç”¨ RTTI å‰åŠ¡å¿…ä¸‰æ€.å¦‚æœä½ çš„ä»£ç éœ€è¦æ ¹æ®ä¸åŒçš„å¯¹è±¡ç±»å‹æ‰§è¡Œä¸åŒçš„è¡Œä¸ºçš„è¯,è¯·è€ƒè™‘ç”¨ä»¥ä¸‹çš„ä¸¤ç§æ›¿ä»£æ–¹æ¡ˆä¹‹ä¸€æŸ¥è¯¢ç±»å‹:</p><p>è™šå‡½æ•°å¯ä»¥æ ¹æ®å­ç±»ç±»å‹çš„ä¸åŒè€Œæ‰§è¡Œä¸åŒä»£ç .è¿™æ˜¯æŠŠå·¥ä½œäº¤ç»™äº†å¯¹è±¡æœ¬èº«å»å¤„ç†.</p><p>å¦‚æœè¿™ä¸€å·¥ä½œéœ€è¦åœ¨å¯¹è±¡ä¹‹å¤–å®Œæˆ, å¯ä»¥è€ƒè™‘ä½¿ç”¨åŒé‡åˆ†å‘çš„æ–¹æ¡ˆ,ä¾‹å¦‚ä½¿ç”¨è®¿é—®è€…è®¾è®¡æ¨¡å¼. è¿™å°±èƒ½å¤Ÿåœ¨å¯¹è±¡ä¹‹å¤–è¿›è¡Œç±»å‹åˆ¤æ–­.</p><p>å¦‚æœç¨‹åºèƒ½å¤Ÿä¿è¯ç»™å®šçš„åŸºç±»å®ä¾‹å®é™…ä¸Šéƒ½æ˜¯æŸä¸ªæ´¾ç”Ÿç±»çš„å®ä¾‹,é‚£ä¹ˆå°±å¯ä»¥è‡ªç”±ä½¿ç”¨ dynamic_cast. åœ¨è¿™ç§æƒ…å†µä¸‹, ä½¿ç”¨ dynamic_castä¹Ÿæ˜¯ä¸€ç§æ›¿ä»£æ–¹æ¡ˆ.</p><p>åŸºäºç±»å‹çš„åˆ¤æ–­æ ‘æ˜¯ä¸€ä¸ªå¾ˆå¼ºçš„æš—ç¤º, å®ƒè¯´æ˜ä½ çš„ä»£ç å·²ç»åç¦»æ­£è½¨äº†.ä¸è¦åƒä¸‹é¢è¿™æ ·:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">typeid</span>(*data) == <span class="built_in">typeid</span>(D1)) &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">typeid</span>(*data) == <span class="built_in">typeid</span>(D2)) &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">typeid</span>(*data) == <span class="built_in">typeid</span>(D3)) &#123;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ä¸€æ—¦åœ¨ç±»å±‚çº§ä¸­åŠ å…¥æ–°çš„å­ç±», åƒè¿™æ ·çš„ä»£ç å¾€å¾€ä¼šå´©æºƒ. è€Œä¸”,ä¸€æ—¦æŸä¸ªå­ç±»çš„å±æ€§æ”¹å˜äº†, ä½ å¾ˆéš¾æ‰¾åˆ°å¹¶ä¿®æ”¹æ‰€æœ‰å—å½±å“çš„ä»£ç å—.</p><p>ä¸è¦å»æ‰‹å·¥å®ç°ä¸€ä¸ªç±»ä¼¼ RTTI çš„æ–¹æ¡ˆ. åå¯¹ RTTIçš„ç†ç”±åŒæ ·é€‚ç”¨äºè¿™äº›æ–¹æ¡ˆ, æ¯”å¦‚å¸¦ç±»å‹æ ‡ç­¾çš„ç±»ç»§æ‰¿ä½“ç³». è€Œä¸”,è¿™äº›æ–¹æ¡ˆä¼šæ©ç›–ä½ çš„çœŸå®æ„å›¾.</p></blockquote><h3 id="ç±»å‹è½¬æ¢">6.9. ç±»å‹è½¬æ¢</h3><p>==Tip==</p><p>ä½¿ç”¨ C++ çš„ç±»å‹è½¬æ¢, å¦‚ <code>static_cast&lt;&gt;()</code>. ä¸è¦ä½¿ç”¨<code>int y = (int)x</code> æˆ– <code>int y = int(x)</code>ç­‰è½¬æ¢æ–¹å¼;</p><p>==å®šä¹‰:==</p><blockquote><p>C++ é‡‡ç”¨äº†æœ‰åˆ«äº C çš„ç±»å‹è½¬æ¢æœºåˆ¶, å¯¹è½¬æ¢æ“ä½œè¿›è¡Œå½’ç±».</p></blockquote><p>==ä¼˜ç‚¹:==</p><blockquote><p>C è¯­è¨€çš„ç±»å‹è½¬æ¢é—®é¢˜åœ¨äºæ¨¡æ£±ä¸¤å¯çš„æ“ä½œ; æœ‰æ—¶æ˜¯åœ¨åšå¼ºåˆ¶è½¬æ¢ (å¦‚<code>(int)3.5</code>), æœ‰æ—¶æ˜¯åœ¨åšç±»å‹è½¬æ¢ (å¦‚<code>(int)"hello"</code>). å¦å¤–, C++ çš„ç±»å‹è½¬æ¢åœ¨æŸ¥æ‰¾æ—¶æ›´é†’ç›®.</p></blockquote><p>==ç¼ºç‚¹:==</p><blockquote><p>æ¶å¿ƒçš„è¯­æ³•.</p></blockquote><p>==ç»“è®º:==</p><blockquote><p>ä¸è¦ä½¿ç”¨ C é£æ ¼ç±»å‹è½¬æ¢. è€Œåº”è¯¥ä½¿ç”¨ C++ é£æ ¼.</p><blockquote><ul><li>ç”¨ <code>static_cast</code> æ›¿ä»£ C é£æ ¼çš„å€¼è½¬æ¢,æˆ–æŸä¸ªç±»æŒ‡é’ˆéœ€è¦æ˜ç¡®çš„å‘ä¸Šè½¬æ¢ä¸ºçˆ¶ç±»æŒ‡é’ˆæ—¶.</li><li>ç”¨ <code>const_cast</code> å»æ‰ <code>const</code> é™å®šç¬¦.</li><li>ç”¨ <code>reinterpret_cast</code>æŒ‡é’ˆç±»å‹å’Œæ•´å‹æˆ–å…¶å®ƒæŒ‡é’ˆä¹‹é—´è¿›è¡Œä¸å®‰å…¨çš„ç›¸äº’è½¬æ¢.ä»…åœ¨ä½ å¯¹æ‰€åšä¸€åˆ‡äº†ç„¶äºå¿ƒæ—¶ä½¿ç”¨.</li></ul></blockquote><p>è‡³äº <code>dynamic_cast</code> å‚è§ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/others/##rtti">6.8.è¿è¡Œæ—¶ç±»å‹è¯†åˆ«</a>.</p></blockquote><h3 id="æµ">6.10. æµ</h3><p>==Tip==</p><p>åªåœ¨è®°å½•æ—¥å¿—æ—¶ä½¿ç”¨æµ.</p><p>==å®šä¹‰:==</p><blockquote><p>æµç”¨æ¥æ›¿ä»£ <code>printf()</code> å’Œ <code>scanf()</code>.</p></blockquote><p>==ä¼˜ç‚¹:==</p><blockquote><p>æœ‰äº†æµ, åœ¨æ‰“å°æ—¶ä¸éœ€è¦å…³å¿ƒå¯¹è±¡çš„ç±»å‹.ä¸ç”¨æ‹…å¿ƒæ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸å‚æ•°åˆ—è¡¨ä¸åŒ¹é… (è™½ç„¶åœ¨ gcc ä¸­ä½¿ç”¨<code>printf</code> ä¹Ÿä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜).æµçš„æ„é€ å’Œææ„å‡½æ•°ä¼šè‡ªåŠ¨æ‰“å¼€å’Œå…³é—­å¯¹åº”çš„æ–‡ä»¶.</p></blockquote><p>==ç¼ºç‚¹:==</p><blockquote><p>æµä½¿å¾— <code>pread()</code> ç­‰åŠŸèƒ½å‡½æ•°å¾ˆéš¾æ‰§è¡Œ. å¦‚æœä¸ä½¿ç”¨<code>printf</code> é£æ ¼çš„æ ¼å¼åŒ–å­—ç¬¦ä¸², æŸäº›æ ¼å¼åŒ–æ“ä½œ(å°¤å…¶æ˜¯å¸¸ç”¨çš„æ ¼å¼å­—ç¬¦ä¸² <code>%.*s</code>) ç”¨æµå¤„ç†æ€§èƒ½æ˜¯å¾ˆä½çš„.æµä¸æ”¯æŒå­—ç¬¦ä¸²æ“ä½œç¬¦é‡æ–°æ’åº (%1s), è€Œè¿™ä¸€ç‚¹å¯¹äºè½¯ä»¶å›½é™…åŒ–å¾ˆæœ‰ç”¨.</p></blockquote><p>==ç»“è®º:==</p><blockquote><p>ä¸è¦ä½¿ç”¨æµ, é™¤éæ˜¯æ—¥å¿—æ¥å£éœ€è¦. ä½¿ç”¨ <code>printf</code>ä¹‹ç±»çš„ä»£æ›¿.</p><p>ä½¿ç”¨æµè¿˜æœ‰å¾ˆå¤šåˆ©å¼Š, ä½†ä»£ç ä¸€è‡´æ€§èƒœè¿‡ä¸€åˆ‡. ä¸è¦åœ¨ä»£ç ä¸­ä½¿ç”¨æµ.</p></blockquote><p>==æ‹“å±•è®¨è®º:==</p><blockquote><p>å¯¹è¿™ä¸€æ¡è§„åˆ™å­˜åœ¨ä¸€äº›äº‰è®º, è¿™å„¿ç»™å‡ºç‚¹æ·±å±‚æ¬¡åŸå› . å›æƒ³ä¸€ä¸‹å”¯ä¸€æ€§åŸåˆ™(Only One Way): æˆ‘ä»¬å¸Œæœ›åœ¨ä»»ä½•æ—¶å€™éƒ½åªä½¿ç”¨ä¸€ç§ç¡®å®šçš„ I/O ç±»å‹,ä½¿ä»£ç åœ¨æ‰€æœ‰ I/O å¤„éƒ½ä¿æŒä¸€è‡´. å› æ­¤, æˆ‘ä»¬ä¸å¸Œæœ›ç”¨æˆ·æ¥å†³å®šæ˜¯ä½¿ç”¨æµè¿˜æ˜¯<code>printf + read/write</code>. ç›¸å, æˆ‘ä»¬åº”è¯¥å†³å®šåˆ°åº•ç”¨å“ªä¸€ç§æ–¹å¼.æŠŠæ—¥å¿—ä½œä¸ºç‰¹ä¾‹æ˜¯å› ä¸ºæ—¥å¿—æ˜¯ä¸€ä¸ªéå¸¸ç‹¬ç‰¹çš„åº”ç”¨, è¿˜æœ‰ä¸€äº›æ˜¯å†å²åŸå› .</p><p>æµçš„æ”¯æŒè€…ä»¬ä¸»å¼ æµæ˜¯ä¸äºŒä¹‹é€‰, ä½†è§‚ç‚¹å¹¶ä¸æ˜¯é‚£ä¹ˆæ¸…æ™°æœ‰åŠ›.ä»–ä»¬æŒ‡å‡ºçš„æµçš„æ¯ä¸ªä¼˜åŠ¿ä¹Ÿéƒ½æ˜¯å…¶åŠ£åŠ¿.æµæœ€å¤§çš„ä¼˜åŠ¿æ˜¯åœ¨è¾“å‡ºæ—¶ä¸éœ€è¦å…³å¿ƒæ‰“å°å¯¹è±¡çš„ç±»å‹. è¿™æ˜¯ä¸€ä¸ªäº®ç‚¹. åŒæ—¶,ä¹Ÿæ˜¯ä¸€ä¸ªä¸è¶³: ä½ å¾ˆå®¹æ˜“ç”¨é”™ç±»å‹, è€Œç¼–è¯‘å™¨ä¸ä¼šæŠ¥è­¦.ä½¿ç”¨æµæ—¶å®¹æ˜“é€ æˆçš„è¿™ç±»é”™è¯¯:</p><blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cout &lt;&lt; <span class="keyword">this</span>;   <span class="comment">// è¾“å‡ºåœ°å€</span></span><br><span class="line">cout &lt;&lt; *<span class="keyword">this</span>;  <span class="comment">// è¾“å‡ºå€¼</span></span><br></pre></td></tr></table></figure></blockquote><p>ç”±äº <code>&lt;&lt;</code> è¢«é‡è½½, ç¼–è¯‘å™¨ä¸ä¼šæŠ¥é”™.å°±å› ä¸ºè¿™ä¸€ç‚¹æˆ‘ä»¬åå¯¹ä½¿ç”¨æ“ä½œç¬¦é‡è½½.</p><p>æœ‰äººè¯´ <code>printf</code> çš„æ ¼å¼åŒ–ä¸‘é™‹ä¸å ª, æ˜“è¯»æ€§å·®,ä½†æµä¹Ÿå¥½ä¸åˆ°å“ªå„¿å». çœ‹çœ‹ä¸‹é¢ä¸¤æ®µä»£ç å§, å®ç°ç›¸åŒçš„åŠŸèƒ½, å“ªä¸ªæ›´æ¸…æ™°?</p><blockquote><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cerr &lt;&lt; <span class="string">&quot;Error connecting to &#x27;&quot;</span> &lt;&lt; foo-&gt;bar<span class="function"><span class="params">()</span>-&gt;</span>hostname.first</span><br><span class="line">     &lt;&lt; <span class="string">&quot;:&quot;</span> &lt;&lt; foo-&gt;bar<span class="function"><span class="params">()</span>-&gt;</span>hostname.second &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; strerror(errno);</span><br><span class="line"></span><br><span class="line">fprintf(stderr, <span class="string">&quot;Error connecting to &#x27;%s:%u: %s&quot;</span>,</span><br><span class="line">        foo-&gt;bar<span class="function"><span class="params">()</span>-&gt;</span>hostname.first, foo-&gt;bar<span class="function"><span class="params">()</span>-&gt;</span>hostname.second,</span><br><span class="line">        strerror(errno));</span><br></pre></td></tr></table></figure></blockquote><p>ä½ å¯èƒ½ä¼šè¯´, â€œæŠŠæµå°è£…ä¸€ä¸‹å°±ä¼šæ¯”è¾ƒå¥½äº†â€, è¿™å„¿å¯ä»¥, å…¶ä»–åœ°æ–¹å‘¢?è€Œä¸”ä¸è¦å¿˜äº†, æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä½¿è¯­è¨€æ›´ç´§å‡‘,è€Œä¸æ˜¯æ·»åŠ ä¸€äº›åˆ«äººéœ€è¦å­¦ä¹ çš„æ–°è£…å¤‡.</p><p>æ¯ä¸€ç§æ–¹å¼éƒ½æ˜¯å„æœ‰åˆ©å¼Š, â€œæ²¡æœ‰æœ€å¥½, åªæœ‰æ›´é€‚åˆâ€.ç®€å•æ€§åŸåˆ™å‘Šè¯«æˆ‘ä»¬å¿…é¡»ä»ä¸­é€‰æ‹©å…¶ä¸€, æœ€åå¤§å¤šæ•°å†³å®šé‡‡ç”¨<code>printf + read/write</code>.</p></blockquote><h3 id="å‰ç½®è‡ªå¢å’Œè‡ªå‡">6.11. å‰ç½®è‡ªå¢å’Œè‡ªå‡</h3><p>==Tip==</p><p>å¯¹äºè¿­ä»£å™¨å’Œå…¶ä»–æ¨¡æ¿å¯¹è±¡ä½¿ç”¨å‰ç¼€å½¢å¼ (<code>++i</code>) çš„è‡ªå¢,è‡ªå‡è¿ç®—ç¬¦.</p><p>==å®šä¹‰:==</p><blockquote><p>å¯¹äºå˜é‡åœ¨è‡ªå¢ (<code>++i</code> æˆ– <code>i++</code>) æˆ–è‡ªå‡(<code>--i</code> æˆ– <code>i--</code>) åè¡¨è¾¾å¼çš„å€¼åˆæ²¡æœ‰æ²¡ç”¨åˆ°çš„æƒ…å†µä¸‹,éœ€è¦ç¡®å®šåˆ°åº•æ˜¯ä½¿ç”¨å‰ç½®è¿˜æ˜¯åç½®çš„è‡ªå¢ (è‡ªå‡).</p></blockquote><p>==ä¼˜ç‚¹:==</p><blockquote><p>ä¸è€ƒè™‘è¿”å›å€¼çš„è¯, å‰ç½®è‡ªå¢ (<code>++i</code>) é€šå¸¸è¦æ¯”åç½®è‡ªå¢(<code>i++</code>) æ•ˆç‡æ›´é«˜. å› ä¸ºåç½®è‡ªå¢ (æˆ–è‡ªå‡) éœ€è¦å¯¹è¡¨è¾¾å¼çš„å€¼<code>i</code> è¿›è¡Œä¸€æ¬¡æ‹·è´. å¦‚æœ <code>i</code>æ˜¯è¿­ä»£å™¨æˆ–å…¶ä»–éæ•°å€¼ç±»å‹, æ‹·è´çš„ä»£ä»·æ˜¯æ¯”è¾ƒå¤§çš„.æ—¢ç„¶ä¸¤ç§è‡ªå¢æ–¹å¼å®ç°çš„åŠŸèƒ½ä¸€æ ·, ä¸ºä»€ä¹ˆä¸æ€»æ˜¯ä½¿ç”¨å‰ç½®è‡ªå¢å‘¢?</p></blockquote><p>==ç¼ºç‚¹:==</p><blockquote><p>åœ¨ C å¼€å‘ä¸­, å½“è¡¨è¾¾å¼çš„å€¼æœªè¢«ä½¿ç”¨æ—¶, ä¼ ç»Ÿçš„åšæ³•æ˜¯ä½¿ç”¨åç½®è‡ªå¢,ç‰¹åˆ«æ˜¯åœ¨ <code>for</code> å¾ªç¯ä¸­. æœ‰äº›äººè§‰å¾—åç½®è‡ªå¢æ›´åŠ æ˜“æ‡‚,å› ä¸ºè¿™å¾ˆåƒè‡ªç„¶è¯­è¨€, ä¸»è¯­ (<code>i</code>) åœ¨è°“è¯­åŠ¨è¯ (<code>++</code>)å‰.</p></blockquote><p>==ç»“è®º:==</p><blockquote><p>å¯¹ç®€å•æ•°å€¼ (éå¯¹è±¡), ä¸¤ç§éƒ½æ— æ‰€è°“. å¯¹è¿­ä»£å™¨å’Œæ¨¡æ¿ç±»å‹, ä½¿ç”¨å‰ç½®è‡ªå¢(è‡ªå‡).</p></blockquote><h3 id="const-ç”¨æ³•">6.12. <code>const</code> ç”¨æ³•</h3><p>==Tip==</p><p>æˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½ åœ¨ä»»ä½•å¯èƒ½çš„æƒ…å†µä¸‹éƒ½è¦ä½¿ç”¨ <code>const</code>.æ­¤å¤–æœ‰æ—¶æ”¹ç”¨ C++11 æ¨å‡ºçš„ constexpr æ›´å¥½ã€‚</p><p>==å®šä¹‰:==</p><blockquote><p>åœ¨å£°æ˜çš„å˜é‡æˆ–å‚æ•°å‰åŠ ä¸Šå…³é”®å­— <code>const</code>ç”¨äºæŒ‡æ˜å˜é‡å€¼ä¸å¯è¢«ç¯¡æ”¹ (å¦‚ <code>const int foo</code> ).ä¸ºç±»ä¸­çš„å‡½æ•°åŠ ä¸Š <code>const</code>é™å®šç¬¦è¡¨æ˜è¯¥å‡½æ•°ä¸ä¼šä¿®æ”¹ç±»æˆå‘˜å˜é‡çš„çŠ¶æ€ (å¦‚<code>class Foo &#123; int Bar(char c) const; &#125;;</code>).</p></blockquote><p>==ä¼˜ç‚¹:==</p><blockquote><p>å¤§å®¶æ›´å®¹æ˜“ç†è§£å¦‚ä½•ä½¿ç”¨å˜é‡. ç¼–è¯‘å™¨å¯ä»¥æ›´å¥½åœ°è¿›è¡Œç±»å‹æ£€æµ‹, ç›¸åº”åœ°,ä¹Ÿèƒ½ç”Ÿæˆæ›´å¥½çš„ä»£ç . äººä»¬å¯¹ç¼–å†™æ­£ç¡®çš„ä»£ç æ›´åŠ è‡ªä¿¡,å› ä¸ºä»–ä»¬çŸ¥é“æ‰€è°ƒç”¨çš„å‡½æ•°è¢«é™å®šäº†èƒ½æˆ–ä¸èƒ½ä¿®æ”¹å˜é‡å€¼.å³ä½¿æ˜¯åœ¨æ— é”çš„å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­, äººä»¬ä¹ŸçŸ¥é“ä»€ä¹ˆæ ·çš„å‡½æ•°æ˜¯å®‰å…¨çš„.</p></blockquote><p>==ç¼ºç‚¹:==</p><blockquote><p><code>const</code> æ˜¯å…¥ä¾µæ€§çš„: å¦‚æœä½ å‘ä¸€ä¸ªå‡½æ•°ä¼ å…¥<code>const</code> å˜é‡, å‡½æ•°åŸå‹å£°æ˜ä¸­ä¹Ÿå¿…é¡»å¯¹åº” <code>const</code>å‚æ•° (å¦åˆ™å˜é‡éœ€è¦ <code>const_cast</code> ç±»å‹è½¬æ¢),åœ¨è°ƒç”¨åº“å‡½æ•°æ—¶æ˜¾å¾—å°¤å…¶éº»çƒ¦.</p></blockquote><p>==ç»“è®º:==</p><blockquote><p><code>const</code> å˜é‡, æ•°æ®æˆå‘˜,å‡½æ•°å’Œå‚æ•°ä¸ºç¼–è¯‘æ—¶ç±»å‹æ£€æµ‹å¢åŠ äº†ä¸€å±‚ä¿éšœ; ä¾¿äºå°½æ—©å‘ç°é”™è¯¯. å› æ­¤,æˆ‘ä»¬å¼ºçƒˆå»ºè®®åœ¨ä»»ä½•å¯èƒ½çš„æƒ…å†µä¸‹ä½¿ç”¨ <code>const</code>:</p><blockquote><ul><li>å¦‚æœå‡½æ•°ä¸ä¼šä¿®æ”¹ä¼ ä½ å…¥çš„å¼•ç”¨æˆ–æŒ‡é’ˆç±»å‹å‚æ•°, è¯¥å‚æ•°åº”å£°æ˜ä¸º<code>const</code>.</li><li>å°½å¯èƒ½å°†å‡½æ•°å£°æ˜ä¸º <code>const</code>. è®¿é—®å‡½æ•°åº”è¯¥æ€»æ˜¯<code>const</code>. å…¶ä»–ä¸ä¼šä¿®æ”¹ä»»ä½•æ•°æ®æˆå‘˜, æœªè°ƒç”¨é<code>const</code> å‡½æ•°, ä¸ä¼šè¿”å›æ•°æ®æˆå‘˜é <code>const</code>æŒ‡é’ˆæˆ–å¼•ç”¨çš„å‡½æ•°ä¹Ÿåº”è¯¥å£°æ˜æˆ <code>const</code>.</li><li>å¦‚æœæ•°æ®æˆå‘˜åœ¨å¯¹è±¡æ„é€ ä¹‹åä¸å†å‘ç”Ÿå˜åŒ–, å¯å°†å…¶å®šä¹‰ä¸º<code>const</code>.</li></ul></blockquote><p>ç„¶è€Œ, ä¹Ÿä¸è¦å‘äº†ç–¯ä¼¼çš„ä½¿ç”¨ <code>const</code>. åƒ<code>const int * const * const x;</code> å°±æœ‰äº›è¿‡äº†,è™½ç„¶å®ƒéå¸¸ç²¾ç¡®çš„æè¿°äº†å¸¸é‡ <code>x</code>. å…³æ³¨çœŸæ­£æœ‰å¸®åŠ©æ„ä¹‰çš„ä¿¡æ¯:å‰é¢çš„ä¾‹å­å†™æˆ <code>const int** x</code> å°±å¤Ÿäº†.</p><p>å…³é”®å­— <code>mutable</code> å¯ä»¥ä½¿ç”¨, ä½†æ˜¯åœ¨å¤šçº¿ç¨‹ä¸­æ˜¯ä¸å®‰å…¨çš„,ä½¿ç”¨æ—¶é¦–å…ˆè¦è€ƒè™‘çº¿ç¨‹å®‰å…¨.</p></blockquote><p><code>const</code> çš„ä½ç½®:</p><blockquote><p>æœ‰äººå–œæ¬¢ <code>int const *foo</code> å½¢å¼, ä¸å–œæ¬¢<code>const int* foo</code>, ä»–ä»¬è®¤ä¸ºå‰è€…æ›´ä¸€è‡´å› æ­¤å¯è¯»æ€§ä¹Ÿæ›´å¥½: éµå¾ªäº†<code>const</code> æ€»ä½äºå…¶æè¿°çš„å¯¹è±¡ä¹‹åçš„åŸåˆ™.ä½†æ˜¯ä¸€è‡´æ€§åŸåˆ™ä¸é€‚ç”¨äºæ­¤, â€œä¸è¦è¿‡åº¦ä½¿ç”¨â€çš„å£°æ˜å¯ä»¥å–æ¶ˆå¤§éƒ¨åˆ†ä½ åŸæœ¬æƒ³ä¿æŒçš„ä¸€è‡´æ€§. å°† <code>const</code>æ”¾åœ¨å‰é¢æ‰æ›´æ˜“è¯», å› ä¸ºåœ¨è‡ªç„¶è¯­è¨€ä¸­å½¢å®¹è¯ (<code>const</code>) æ˜¯åœ¨åè¯(<code>int</code>) ä¹‹å‰.</p><p>è¿™æ˜¯è¯´, æˆ‘ä»¬æå€¡ä½†ä¸å¼ºåˆ¶ <code>const</code> åœ¨å‰.ä½†è¦ä¿æŒä»£ç çš„ä¸€è‡´æ€§! (Yang.Y æ³¨: ä¹Ÿå°±æ˜¯ä¸è¦åœ¨ä¸€äº›åœ°æ–¹æŠŠ<code>const</code> å†™åœ¨ç±»å‹å‰é¢, åœ¨å…¶ä»–åœ°æ–¹åˆå†™åœ¨åé¢, ç¡®å®šä¸€ç§å†™æ³•,ç„¶åä¿æŒä¸€è‡´.)</p></blockquote><h3 id="constexpr-ç”¨æ³•">6.13. <code>constexpr</code> ç”¨æ³•</h3><p>==Tip==</p><p>åœ¨ C++11 é‡Œï¼Œç”¨ constexpr æ¥å®šä¹‰çœŸæ­£çš„å¸¸é‡ï¼Œæˆ–å®ç°å¸¸é‡åˆå§‹åŒ–ã€‚</p><p>==å®šä¹‰:==</p><blockquote><p>å˜é‡å¯ä»¥è¢«å£°æ˜æˆ constexprä»¥è¡¨ç¤ºå®ƒæ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„å¸¸é‡ï¼Œå³åœ¨ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶éƒ½ä¸å˜ã€‚å‡½æ•°æˆ–æ„é€ å‡½æ•°ä¹Ÿå¯ä»¥è¢«å£°æ˜æˆconstexpr, ä»¥ç”¨æ¥å®šä¹‰ constexpr å˜é‡ã€‚</p></blockquote><p>==ä¼˜ç‚¹:==</p><blockquote><p>å¦‚ä»Š constexprå°±å¯ä»¥å®šä¹‰æµ®ç‚¹å¼çš„çœŸãƒ»å¸¸é‡ï¼Œä¸ç”¨å†ä¾èµ–å­—é¢å€¼äº†ï¼›ä¹Ÿå¯ä»¥å®šä¹‰ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹ä¸Šçš„å¸¸é‡ï¼›ç”šè‡³ä¹Ÿå¯ä»¥å®šä¹‰å‡½æ•°è°ƒç”¨æ‰€è¿”å›çš„å¸¸é‡ã€‚</p></blockquote><p>==ç¼ºç‚¹:==</p><blockquote><p>è‹¥è¿‡æ—©æŠŠå˜é‡ä¼˜åŒ–æˆ constexprå˜é‡ï¼Œå°†æ¥åˆè¦æŠŠå®ƒæ”¹ä¸ºå¸¸è§„å˜é‡æ—¶ï¼ŒæŒºéº»çƒ¦çš„ï¼›å½“å‰å¯¹constexprå‡½æ•°å’Œæ„é€ å‡½æ•°ä¸­å…è®¸çš„é™åˆ¶å¯èƒ½ä¼šå¯¼è‡´è¿™äº›å®šä¹‰ä¸­è§£å†³çš„æ–¹æ³•æ¨¡ç³Šã€‚</p></blockquote><p>==ç»“è®º:==</p><blockquote><p>é  constexpr ç‰¹æ€§ï¼Œæ–¹æ‰å®ç°äº† C++åœ¨æ¥å£ä¸Šæ‰“é€ çœŸæ­£å¸¸é‡æœºåˆ¶çš„å¯èƒ½ã€‚å¥½å¥½ç”¨ constexpræ¥å®šä¹‰çœŸãƒ»å¸¸é‡ä»¥åŠæ”¯æŒå¸¸é‡çš„å‡½æ•°ã€‚é¿å…å¤æ‚çš„å‡½æ•°å®šä¹‰ï¼Œä»¥ä½¿å…¶èƒ½å¤Ÿä¸constexprä¸€èµ·ä½¿ç”¨ã€‚åƒä¸‡åˆ«ç—´å¿ƒå¦„æƒ³åœ°æƒ³é  constexpr æ¥å¼ºåˆ¶ä»£ç ã€Œå†…è”ã€ã€‚</p></blockquote><h3 id="æ•´å‹">6.14. æ•´å‹</h3><p>==Tip==</p><p>C++ å†…å»ºæ•´å‹ä¸­, ä»…ä½¿ç”¨ <code>int</code>.å¦‚æœç¨‹åºä¸­éœ€è¦ä¸åŒå¤§å°çš„å˜é‡, å¯ä»¥ä½¿ç”¨`<code>ä¸­é•¿åº¦ç²¾ç¡®çš„æ•´å‹, å¦‚</code>int16_t<code>.å¦‚æœæ‚¨çš„å˜é‡å¯èƒ½ä¸å°äº 2^31 (2GiB), å°±ç”¨ 64 ä½å˜é‡æ¯”å¦‚</code>int64_t`.æ­¤å¤–è¦ç•™æ„ï¼Œå“ªæ€•æ‚¨çš„å€¼å¹¶ä¸ä¼šè¶…å‡º intæ‰€èƒ½å¤Ÿè¡¨ç¤ºçš„èŒƒå›´ï¼Œåœ¨è®¡ç®—è¿‡ç¨‹ä¸­ä¹Ÿå¯èƒ½ä¼šæº¢å‡ºã€‚æ‰€ä»¥æ‹¿ä¸å‡†æ—¶ï¼Œå¹²è„†ç”¨æ›´å¤§çš„ç±»å‹ã€‚</p><p>==å®šä¹‰:==</p><blockquote><p>C++ æ²¡æœ‰æŒ‡å®šæ•´å‹çš„å¤§å°. é€šå¸¸äººä»¬å‡å®š <code>short</code> æ˜¯ 16 ä½,<code>int</code> æ˜¯ 32 ä½, <code>long</code> æ˜¯ 32 ä½,<code>long long</code> æ˜¯ 64 ä½.</p></blockquote><p>==ä¼˜ç‚¹:==</p><blockquote><p>ä¿æŒå£°æ˜ç»Ÿä¸€.</p></blockquote><p>==ç¼ºç‚¹:==</p><blockquote><p>C++ ä¸­æ•´å‹å¤§å°å› ç¼–è¯‘å™¨å’Œä½“ç³»ç»“æ„çš„ä¸åŒè€Œä¸åŒ.</p></blockquote><p>==ç»“è®º:==</p><blockquote><p>`<code>å®šä¹‰äº†</code>int16_t<code>,</code>uint32_t<code>,</code>int64_t<code>ç­‰æ•´å‹, åœ¨éœ€è¦ç¡®ä¿æ•´å‹å¤§å°æ—¶å¯ä»¥ä½¿ç”¨å®ƒä»¬ä»£æ›¿</code>short<code>,</code>unsignedlonglong<code>ç­‰. åœ¨ C æ•´å‹ä¸­, åªä½¿ç”¨</code>int<code>. åœ¨åˆé€‚çš„æƒ…å†µä¸‹, æ¨èä½¿ç”¨æ ‡å‡†ç±»å‹å¦‚</code>size_t<code>å’Œ</code>ptrdiff_t`.</p><p>å¦‚æœå·²çŸ¥æ•´æ•°ä¸ä¼šå¤ªå¤§, æˆ‘ä»¬å¸¸å¸¸ä¼šä½¿ç”¨ <code>int</code>, å¦‚å¾ªç¯è®¡æ•°.åœ¨ç±»ä¼¼çš„æƒ…å†µä¸‹ä½¿ç”¨åŸç”Ÿç±»å‹ <code>int</code>. ä½ å¯ä»¥è®¤ä¸º <code>int</code>è‡³å°‘ä¸º 32 ä½, ä½†ä¸è¦è®¤ä¸ºå®ƒä¼šå¤šäº <code>32</code> ä½. å¦‚æœéœ€è¦ 64 ä½æ•´å‹,ç”¨ <code>int64_t</code> æˆ– <code>uint64_t</code>.</p><p>å¯¹äºå¤§æ•´æ•°, ä½¿ç”¨ <code>int64_t</code>.</p><p>ä¸è¦ä½¿ç”¨ <code>uint32_t</code> ç­‰æ— ç¬¦å·æ•´å‹,é™¤éä½ æ˜¯åœ¨è¡¨ç¤ºä¸€ä¸ªä½ç»„è€Œä¸æ˜¯ä¸€ä¸ªæ•°å€¼, æˆ–æ˜¯ä½ éœ€è¦å®šä¹‰äºŒè¿›åˆ¶è¡¥ç æº¢å‡º.å°¤å…¶æ˜¯ä¸è¦ä¸ºäº†æŒ‡å‡ºæ•°å€¼æ°¸ä¸ä¼šä¸ºè´Ÿ, è€Œä½¿ç”¨æ— ç¬¦å·ç±»å‹. ç›¸å,ä½ åº”è¯¥ä½¿ç”¨æ–­è¨€æ¥ä¿æŠ¤æ•°æ®.</p><p>å¦‚æœæ‚¨çš„ä»£ç æ¶‰åŠå®¹å™¨è¿”å›çš„å¤§å°ï¼ˆsizeï¼‰ï¼Œç¡®ä¿å…¶ç±»å‹è¶³ä»¥åº”ä»˜å®¹å™¨å„ç§å¯èƒ½çš„ç”¨æ³•ã€‚æ‹¿ä¸å‡†æ—¶ï¼Œç±»å‹è¶Šå¤§è¶Šå¥½ã€‚</p><p>å°å¿ƒæ•´å‹ç±»å‹è½¬æ¢å’Œæ•´å‹æå‡ï¼ˆacgtyrant æ³¨ï¼šinteger promotions, æ¯”å¦‚<code>int</code> ä¸ <code>unsigned int</code> è¿ç®—æ—¶ï¼Œå‰è€…è¢«æå‡ä¸º<code>unsigned int</code> è€Œæœ‰å¯èƒ½æº¢å‡ºï¼‰ï¼Œæ€»æœ‰æ„æƒ³ä¸åˆ°çš„åæœã€‚</p></blockquote><p>å…³äºæ— ç¬¦å·æ•´æ•°:</p><blockquote><p>æœ‰äº›äºº, åŒ…æ‹¬ä¸€äº›æ•™ç§‘ä¹¦ä½œè€…, æ¨èä½¿ç”¨æ— ç¬¦å·ç±»å‹è¡¨ç¤ºéè´Ÿæ•°.è¿™ç§åšæ³•è¯•å›¾è¾¾åˆ°è‡ªæˆ‘æ–‡æ¡£åŒ–. ä½†æ˜¯, åœ¨ C è¯­è¨€ä¸­, è¿™ä¸€ä¼˜ç‚¹è¢«ç”±å…¶å¯¼è‡´çš„ bugæ‰€æ·¹æ²¡. çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­:</p><blockquote><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for <span class="params">(unsigned int <span class="attr">i</span> = foo.Length()</span>-1; i &gt;= 0; <span class="params">--i</span>) <span class="string">...</span></span><br></pre></td></tr></table></figure></blockquote><p>ä¸Šè¿°å¾ªç¯æ°¸è¿œä¸ä¼šé€€å‡º! æœ‰æ—¶ gcc ä¼šå‘ç°è¯¥ bug å¹¶æŠ¥è­¦,ä½†å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½ä¸ä¼š. ç±»ä¼¼çš„ bug è¿˜ä¼šå‡ºç°åœ¨æ¯”è¾ƒæœ‰ç¬¦åˆå˜é‡å’Œæ— ç¬¦å·å˜é‡æ—¶.ä¸»è¦æ˜¯ C çš„ç±»å‹æå‡æœºåˆ¶ä¼šè‡´ä½¿æ— ç¬¦å·ç±»å‹çš„è¡Œä¸ºå‡ºä¹ä½ çš„æ„æ–™.</p><p>å› æ­¤, ä½¿ç”¨æ–­è¨€æ¥æŒ‡å‡ºå˜é‡ä¸ºéè´Ÿæ•°, è€Œä¸æ˜¯ä½¿ç”¨æ— ç¬¦å·å‹!</p></blockquote><h3 id="ä½ä¸‹çš„å¯ç§»æ¤æ€§">6.15. 64 ä½ä¸‹çš„å¯ç§»æ¤æ€§</h3><p>==Tip==</p><p>ä»£ç åº”è¯¥å¯¹ 64 ä½å’Œ 32 ä½ç³»ç»Ÿå‹å¥½. å¤„ç†æ‰“å°, æ¯”è¾ƒ,ç»“æ„ä½“å¯¹é½æ—¶åº”åˆ‡è®°:</p><ul><li><p>å¯¹äºæŸäº›ç±»å‹, <code>printf()</code> çš„æŒ‡ç¤ºç¬¦åœ¨ 32 ä½å’Œ 64ä½ç³»ç»Ÿä¸Šå¯ç§»æ¤æ€§ä¸æ˜¯å¾ˆå¥½. C99 æ ‡å‡†å®šä¹‰äº†ä¸€äº›å¯ç§»æ¤çš„æ ¼å¼åŒ–æŒ‡ç¤ºç¬¦.ä¸å¹¸çš„æ˜¯, MSVC 7.1 å¹¶éå…¨éƒ¨æ”¯æŒ, è€Œä¸”æ ‡å‡†ä¸­ä¹Ÿæœ‰æ‰€é—æ¼,æ‰€ä»¥æœ‰æ—¶æˆ‘ä»¬ä¸å¾—ä¸è‡ªå·±å®šä¹‰ä¸€ä¸ªä¸‘é™‹çš„ç‰ˆæœ¬ (å¤´æ–‡ä»¶ <code>inttypes.h</code>ä»¿æ ‡å‡†é£æ ¼):</p><blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// printf macros for size_t, in the style of inttypes.h</span></span><br><span class="line">#<span class="meta">#<span class="keyword">ifdef</span> _LP64</span></span><br><span class="line">#<span class="meta">#<span class="keyword">define</span> __PRIS_PREFIX <span class="string">&quot;z&quot;</span></span></span><br><span class="line">#<span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">#<span class="meta">#<span class="keyword">define</span> __PRIS_PREFIX</span></span><br><span class="line">#<span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Use these macros after a % in a printf format string</span></span><br><span class="line"><span class="comment">// to get correct 32/64 bit behavior, like this:</span></span><br><span class="line"><span class="comment">// size_t size = records.size();</span></span><br><span class="line"><span class="comment">// printf(&quot;%&quot;PRIuS&quot;\n&quot;, size);</span></span><br><span class="line">#<span class="meta">#<span class="keyword">define</span> PRIdS __PRIS_PREFIX <span class="string">&quot;d&quot;</span></span></span><br><span class="line">#<span class="meta">#<span class="keyword">define</span> PRIxS __PRIS_PREFIX <span class="string">&quot;x&quot;</span></span></span><br><span class="line">#<span class="meta">#<span class="keyword">define</span> PRIuS __PRIS_PREFIX <span class="string">&quot;u&quot;</span></span></span><br><span class="line">#<span class="meta">#<span class="keyword">define</span> PRIXS __PRIS_PREFIX <span class="string">&quot;X&quot;</span></span></span><br><span class="line">#<span class="meta">#<span class="keyword">define</span> PRIoS __PRIS_PREFIX <span class="string">&quot;o&quot;</span></span></span><br></pre></td></tr></table></figure><table><colgroup><col style="width: 32%" /><col style="width: 21%" /><col style="width: 28%" /><col style="width: 17%" /></colgroup><thead><tr class="header"><th>ç±»å‹</th><th>ä¸è¦ä½¿ç”¨</th><th>ä½¿ç”¨</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr class="odd"><td><code>void *</code> (æˆ–å…¶ä»–æŒ‡é’ˆç±»å‹)</td><td><code>%lx</code></td><td><code>%p</code></td><td></td></tr><tr class="even"><td><code>int64_t</code></td><td><code>%qd, %lld</code></td><td><code>%"PRId64"</code></td><td></td></tr><tr class="odd"><td><code>uint64_t</code></td><td><code>%qu, %llu, %llx</code></td><td><code>%"PRIu64", %"PRIx64"</code></td><td></td></tr><tr class="even"><td><code>size_t</code></td><td><code>%u</code></td><td><code>%"PRIuS", %"PRIxS"</code></td><td>C99 è§„å®š <code>%zu</code></td></tr><tr class="odd"><td><code>ptrdiff_t</code></td><td><code>%d</code></td><td><code>%"PRIdS"</code></td><td>C99 è§„å®š <code>%zd</code></td></tr></tbody></table><p>æ³¨æ„ <code>PRI*</code> å®ä¼šè¢«ç¼–è¯‘å™¨æ‰©å±•ä¸ºç‹¬ç«‹å­—ç¬¦ä¸².å› æ­¤å¦‚æœä½¿ç”¨éå¸¸é‡çš„æ ¼å¼åŒ–å­—ç¬¦ä¸², éœ€è¦å°†å®çš„å€¼è€Œä¸æ˜¯å®åæ’å…¥æ ¼å¼ä¸­. ä½¿ç”¨<code>PRI*</code> å®åŒæ ·å¯ä»¥åœ¨ <code>%</code> ååŒ…å«é•¿åº¦æŒ‡ç¤ºç¬¦. ä¾‹å¦‚,<code>printf("x = %30"PRIuS"\n", x)</code> åœ¨ 32 ä½ Linux ä¸Šå°†è¢«å±•å¼€ä¸º<code>printf("x = %30" "u" "\n", x)</code>, ç¼–è¯‘å™¨å½“æˆ<code>printf("x = %30u\n", x)</code> å¤„ç† (Yang.Y æ³¨: è¿™åœ¨ MSVC 6.0ä¸Šè¡Œä¸é€š, VC 6ç¼–è¯‘å™¨ä¸ä¼šè‡ªåŠ¨æŠŠå¼•å·é—´éš”çš„å¤šä¸ªå­—ç¬¦ä¸²è¿æ¥ä¸€ä¸ªé•¿å­—ç¬¦ä¸²).</p></blockquote></li><li><p>è®°ä½ <code>sizeof(void *) != sizeof(int)</code>.å¦‚æœéœ€è¦ä¸€ä¸ªæŒ‡é’ˆå¤§å°çš„æ•´æ•°è¦ç”¨ <code>intptr_t</code>.</p></li><li><p>ä½ è¦éå¸¸å°å¿ƒçš„å¯¹å¾…ç»“æ„ä½“å¯¹é½, å°¤å…¶æ˜¯è¦æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šçš„ç»“æ„ä½“(Yang.Y æ³¨: æŒä¹…åŒ– - å°†æ•°æ®æŒ‰å­—èŠ‚æµé¡ºåºä¿å­˜åœ¨ç£ç›˜æ–‡ä»¶æˆ–æ•°æ®åº“ä¸­). åœ¨ 64ä½ç³»ç»Ÿä¸­, ä»»ä½•å«æœ‰ <code>int64_t</code>/<code>uint64_t</code>æˆå‘˜çš„ç±»/ç»“æ„ä½“, ç¼ºçœéƒ½ä»¥ 8 å­—èŠ‚åœ¨ç»“å°¾å¯¹é½. å¦‚æœ 32 ä½å’Œ 64ä½ä»£ç è¦å…±ç”¨æŒä¹…åŒ–çš„ç»“æ„ä½“, éœ€è¦ç¡®ä¿ä¸¤ç§ä½“ç³»ç»“æ„ä¸‹çš„ç»“æ„ä½“å¯¹é½ä¸€è‡´.å¤§å¤šæ•°ç¼–è¯‘å™¨éƒ½å…è®¸è°ƒæ•´ç»“æ„ä½“å¯¹é½. gcc ä¸­å¯ä½¿ç”¨<code>__attribute__((packed))</code>. MSVC åˆ™æä¾›äº†<code>##pragma pack()</code> å’Œ <code>__declspec(align())</code>(YuleFox æ³¨, è§£å†³æ–¹æ¡ˆçš„é¡¹ç›®å±æ€§é‡Œä¹Ÿå¯ä»¥ç›´æ¥è®¾ç½®).</p></li><li><p>åˆ›å»º 64 ä½å¸¸é‡æ—¶ä½¿ç”¨ LL æˆ– ULL ä½œä¸ºåç¼€, å¦‚:</p><blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int64_t</span> my_value = <span class="number">0x123456789</span>LL;</span><br><span class="line"><span class="type">uint64_t</span> my_mask = <span class="number">3ULL</span> &lt;&lt; <span class="number">48</span>;</span><br></pre></td></tr></table></figure></blockquote></li><li><p>å¦‚æœä½ ç¡®å®éœ€è¦ 32 ä½å’Œ 64 ä½ç³»ç»Ÿå…·æœ‰ä¸åŒä»£ç , å¯ä»¥ä½¿ç”¨<code>##ifdef _LP64</code> æŒ‡ä»¤æ¥åˆ‡åˆ† 32/64 ä½ä»£ç . (å°½é‡ä¸è¦è¿™ä¹ˆåš,å¦‚æœéç”¨ä¸å¯, å°½é‡ä½¿ä¿®æ”¹å±€éƒ¨åŒ–)</p></li></ul><h3 id="é¢„å¤„ç†å®">6.16. é¢„å¤„ç†å®</h3><p>==Tip==</p><p>ä½¿ç”¨å®æ—¶è¦éå¸¸è°¨æ…, å°½é‡ä»¥å†…è”å‡½æ•°, æšä¸¾å’Œå¸¸é‡ä»£æ›¿ä¹‹.</p><p>å®æ„å‘³ç€ä½ å’Œç¼–è¯‘å™¨çœ‹åˆ°çš„ä»£ç æ˜¯ä¸åŒçš„. è¿™å¯èƒ½ä¼šå¯¼è‡´å¼‚å¸¸è¡Œä¸º,å°¤å…¶å› ä¸ºå®å…·æœ‰å…¨å±€ä½œç”¨åŸŸ.</p><p>å€¼å¾—åº†å¹¸çš„æ˜¯, C++ ä¸­, å®ä¸åƒåœ¨ C ä¸­é‚£ä¹ˆå¿…ä¸å¯å°‘.ä»¥å¾€ç”¨å®å±•å¼€æ€§èƒ½å…³é”®çš„ä»£ç , ç°åœ¨å¯ä»¥ç”¨å†…è”å‡½æ•°æ›¿ä»£. ç”¨å®è¡¨ç¤ºå¸¸é‡å¯è¢«<code>const</code> å˜é‡ä»£æ›¿. ç”¨å® â€œç¼©å†™â€ é•¿å˜é‡åå¯è¢«å¼•ç”¨ä»£æ›¿.ç”¨å®è¿›è¡Œæ¡ä»¶ç¼–è¯‘â€¦ è¿™ä¸ª, åƒä¸‡åˆ«è¿™ä¹ˆåš, ä¼šä»¤æµ‹è¯•æ›´åŠ ç—›è‹¦(<code>##define</code> é˜²æ­¢å¤´æ–‡ä»¶é‡åŒ…å«å½“ç„¶æ˜¯ä¸ªç‰¹ä¾‹).</p><p>å®å¯ä»¥åšä¸€äº›å…¶ä»–æŠ€æœ¯æ— æ³•å®ç°çš„äº‹æƒ…, åœ¨ä¸€äº›ä»£ç åº“ (å°¤å…¶æ˜¯åº•å±‚åº“ä¸­)å¯ä»¥çœ‹åˆ°å®çš„æŸäº›ç‰¹æ€§ (å¦‚ç”¨ <code>##</code> å­—ç¬¦ä¸²åŒ–, ç”¨ <code>###</code>è¿æ¥ç­‰ç­‰). ä½†åœ¨ä½¿ç”¨å‰, ä»”ç»†è€ƒè™‘ä¸€ä¸‹èƒ½ä¸èƒ½ä¸ä½¿ç”¨å®è¾¾åˆ°åŒæ ·çš„ç›®çš„.</p><p>ä¸‹é¢ç»™å‡ºçš„ç”¨æ³•æ¨¡å¼å¯ä»¥é¿å…ä½¿ç”¨å®å¸¦æ¥çš„é—®é¢˜; å¦‚æœä½ è¦å®,å°½å¯èƒ½éµå®ˆ:</p><blockquote><ul><li>ä¸è¦åœ¨ <code>.h</code> æ–‡ä»¶ä¸­å®šä¹‰å®.</li><li>åœ¨é©¬ä¸Šè¦ä½¿ç”¨æ—¶æ‰è¿›è¡Œ <code>##define</code>, ä½¿ç”¨åè¦ç«‹å³<code>##undef</code>.</li><li>ä¸è¦åªæ˜¯å¯¹å·²ç»å­˜åœ¨çš„å®ä½¿ç”¨##undefï¼Œé€‰æ‹©ä¸€ä¸ªä¸ä¼šå†²çªçš„åç§°ï¼›</li><li>ä¸è¦è¯•å›¾ä½¿ç”¨å±•å¼€åä¼šå¯¼è‡´ C++ æ„é€ ä¸ç¨³å®šçš„å®,ä¸ç„¶ä¹Ÿè‡³å°‘è¦é™„ä¸Šæ–‡æ¡£è¯´æ˜å…¶è¡Œä¸º.</li><li>ä¸è¦ç”¨ <code>###</code> å¤„ç†å‡½æ•°ï¼Œç±»å’Œå˜é‡çš„åå­—ã€‚</li></ul></blockquote><h3 id="nullptr-å’Œ-null">6.17. 0, <code>nullptr</code> å’Œ<code>NULL</code></h3><p>==Tip==</p><p>æ•´æ•°ç”¨ <code>0</code>, å®æ•°ç”¨ <code>0.0</code>, æŒ‡é’ˆç”¨<code>nullptr</code> æˆ– <code>NULL</code>, å­—ç¬¦ (ä¸²) ç”¨<code>'\0'</code>.</p><p>æ•´æ•°ç”¨ <code>0</code>, å®æ•°ç”¨ <code>0.0</code>,è¿™ä¸€ç‚¹æ˜¯æ¯«æ— äº‰è®®çš„.</p><p>å¯¹äºæŒ‡é’ˆ (åœ°å€å€¼), åˆ°åº•æ˜¯ç”¨ <code>0</code>, <code>NULL</code> è¿˜æ˜¯<code>nullptr</code>. C++11 é¡¹ç›®ç”¨ <code>nullptr</code>; C++03 é¡¹ç›®åˆ™ç”¨<code>NULL</code>, æ¯•ç«Ÿå®ƒçœ‹èµ·æ¥åƒæŒ‡é’ˆã€‚å®é™…ä¸Šï¼Œä¸€äº› C++ ç¼–è¯‘å™¨å¯¹<code>NULL</code> çš„å®šä¹‰æ¯”è¾ƒç‰¹æ®Šï¼Œå¯ä»¥è¾“å‡ºæœ‰ç”¨çš„è­¦å‘Šï¼Œç‰¹åˆ«æ˜¯<code>sizeof(NULL)</code> å°±å’Œ <code>sizeof(0)</code> ä¸ä¸€æ ·ã€‚</p><p>å­—ç¬¦ (ä¸²) ç”¨ <code>'\0'</code>, ä¸ä»…ç±»å‹æ­£ç¡®è€Œä¸”å¯è¯»æ€§å¥½.</p><h3 id="sizeof">6.18. sizeof</h3><p>==Tip==</p><p>å°½å¯èƒ½ç”¨ <code>sizeof(varname)</code> ä»£æ›¿<code>sizeof(type)</code>.</p><p>ä½¿ç”¨ <code>sizeof(varname)</code>æ˜¯å› ä¸ºå½“ä»£ç ä¸­å˜é‡ç±»å‹æ”¹å˜æ—¶ä¼šè‡ªåŠ¨æ›´æ–°. æ‚¨æˆ–è®¸ä¼šç”¨<code>sizeof(type)</code>å¤„ç†ä¸æ¶‰åŠä»»ä½•å˜é‡çš„ä»£ç ï¼Œæ¯”å¦‚å¤„ç†æ¥è‡ªå¤–éƒ¨æˆ–å†…éƒ¨çš„æ•°æ®æ ¼å¼ï¼Œè¿™æ—¶ç”¨å˜é‡å°±ä¸åˆé€‚äº†ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Struct data;</span><br><span class="line">Struct data; <span class="built_in">memset</span>(&amp;data, <span class="number">0</span>, <span class="built_in">sizeof</span>(data));</span><br></pre></td></tr></table></figure><p>==Warning==</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">memset</span>(&amp;data, <span class="number">0</span>, <span class="built_in">sizeof</span>(Struct));</span><br><span class="line"><span class="keyword">if</span> (raw_size &lt; <span class="built_in">sizeof</span>(<span class="type">int</span>)) &#123;</span><br><span class="line">    <span class="built_in">LOG</span>(ERROR) &lt;&lt; <span class="string">&quot;compressed record not big enough for count: &quot;</span> &lt;&lt; raw_size;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="auto">6.19. auto</h3><p>==Tip==</p><p>ç”¨ <code>auto</code>ç»•è¿‡çƒ¦ççš„ç±»å‹åï¼Œåªè¦å¯è¯»æ€§å¥½å°±ç»§ç»­ç”¨ï¼Œåˆ«ç”¨åœ¨å±€éƒ¨å˜é‡ä¹‹å¤–çš„åœ°æ–¹ã€‚</p><p>==å®šä¹‰ï¼š==</p><blockquote><p>C++11 ä¸­ï¼Œè‹¥å˜é‡è¢«å£°æ˜æˆ <code>auto</code>,é‚£å®ƒçš„ç±»å‹å°±ä¼šè¢«è‡ªåŠ¨åŒ¹é…æˆåˆå§‹åŒ–è¡¨è¾¾å¼çš„ç±»å‹ã€‚æ‚¨å¯ä»¥ç”¨ <code>auto</code>æ¥å¤åˆ¶åˆå§‹åŒ–æˆ–ç»‘å®šå¼•ç”¨ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;string&gt; v;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">auto</span> s1 = v[<span class="number">0</span>];  <span class="comment">// åˆ›å»ºä¸€ä»½ v[0] çš„æ‹·è´ã€‚</span></span><br><span class="line"><span class="type">const</span> <span class="keyword">auto</span>&amp; s2 = v[<span class="number">0</span>];  <span class="comment">// s2 æ˜¯ v[0] çš„ä¸€ä¸ªå¼•ç”¨ã€‚</span></span><br></pre></td></tr></table></figure></blockquote><p>==ä¼˜ç‚¹ï¼š==</p><blockquote><p>C++ ç±»å‹åæœ‰æ—¶åˆé•¿åˆè‡­ï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠæ¨¡æ¿æˆ–å‘½åç©ºé—´çš„æ—¶å€™ã€‚å°±åƒï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sparse_hash_map&lt;string, <span class="type">int</span>&gt;::iterator iter = m.<span class="built_in">find</span>(val);</span><br></pre></td></tr></table></figure><p>è¿”å›ç±»å‹å¥½éš¾è¯»ï¼Œä»£ç ç›®çš„ä¹Ÿä¸å¤Ÿä¸€ç›®äº†ç„¶ã€‚é‡æ„å…¶ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> iter = m.<span class="built_in">find</span>(val);</span><br></pre></td></tr></table></figure><p>å¥½å¤šäº†ã€‚</p><p>æ²¡æœ‰ <code>auto</code>çš„è¯ï¼Œæˆ‘ä»¬ä¸å¾—ä¸åœ¨åŒä¸€ä¸ªè¡¨è¾¾å¼é‡Œå†™åŒä¸€ä¸ªç±»å‹åä¸¤æ¬¡ï¼Œæ— è°“çš„é‡å¤ï¼Œå°±åƒï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diagnostics::ErrorStatus* status = <span class="keyword">new</span> diagnostics::<span class="built_in">ErrorStatus</span>(<span class="string">&quot;xyz&quot;</span>);</span><br></pre></td></tr></table></figure><p>æœ‰äº† auto, å¯ä»¥æ›´æ–¹ä¾¿åœ°ç”¨ä¸­é—´å˜é‡ï¼Œæ˜¾å¼ç¼–å†™å®ƒä»¬çš„ç±»å‹è½»æ¾ç‚¹ã€‚</p></blockquote><p>==ç¼ºç‚¹ï¼š==</p><blockquote><p>ç±»å‹å¤Ÿæ˜æ˜¾æ—¶ï¼Œç‰¹åˆ«æ˜¯åˆå§‹åŒ–å˜é‡æ—¶ï¼Œä»£ç æ‰ä¼šå¤Ÿä¸€ç›®äº†ç„¶ã€‚ä½†ä»¥ä¸‹å°±ä¸ä¸€æ ·äº†ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> i = x.<span class="built_in">Lookup</span>(key);</span><br></pre></td></tr></table></figure><p>çœ‹ä¸å‡ºå…¶ç±»å‹æ˜¯å•¥ï¼Œx çš„ç±»å‹å£°æ˜ææ€•è¿œåœ¨å‡ ç™¾è¡Œä¹‹å¤–äº†ã€‚</p><p>ç¨‹åºå‘˜å¿…é¡»ä¼šåŒºåˆ† <code>auto</code> å’Œ <code>const auto&amp;</code>çš„ä¸åŒä¹‹å¤„ï¼Œå¦åˆ™ä¼šå¤åˆ¶é”™ä¸œè¥¿ã€‚</p><p>auto å’Œ C++11 åˆ—è¡¨åˆå§‹åŒ–çš„åˆä½“ä»¤äººæ‘¸ä¸ç€å¤´è„‘ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">x</span><span class="params">(<span class="number">3</span>)</span></span>;  <span class="comment">// åœ†æ‹¬å·ã€‚</span></span><br><span class="line"><span class="keyword">auto</span> y&#123;<span class="number">3</span>&#125;;  <span class="comment">// å¤§æ‹¬å·ã€‚</span></span><br></pre></td></tr></table></figure><p>å®ƒä»¬ä¸æ˜¯åŒä¸€å›äº‹â€”â€”<code>x</code> æ˜¯ <code>int</code>, <code>y</code>åˆ™æ˜¯ <code>std::initializer_list</code>.å…¶å®ƒä¸€èˆ¬ä¸å¯è§çš„ä»£ç†ç±»å‹ï¼ˆacgtyrant æ³¨ï¼šnormally-invisible proxy types,å®ƒæ¶‰åŠåˆ° C++ é²œä¸ºäººçŸ¥çš„å‘ï¼š<ahref="http://stackoverflow.com/a/17794965/1546088">Why is vector not aSTL container?</a>ï¼‰ä¹Ÿæœ‰å¤§åŒå°å¼‚çš„é™·é˜±ã€‚</p><p>å¦‚æœåœ¨æ¥å£é‡Œç”¨ <code>auto</code>,æ¯”å¦‚å£°æ˜å¤´æ–‡ä»¶é‡Œçš„ä¸€ä¸ªå¸¸é‡ï¼Œé‚£ä¹ˆåªè¦ä»…ä»…å› ä¸ºç¨‹åºå‘˜ä¸€æ—¶ä¿®æ”¹å…¶å€¼è€Œå¯¼è‡´ç±»å‹å˜åŒ–çš„è¯â€”â€”APIè¦ç¿»å¤©è¦†åœ°äº†ã€‚</p></blockquote><p>ç»“è®ºï¼š</p><blockquote><p><code>auto</code>åªèƒ½ç”¨åœ¨å±€éƒ¨å˜é‡é‡Œç”¨ã€‚åˆ«ç”¨åœ¨æ–‡ä»¶ä½œç”¨åŸŸå˜é‡ï¼Œå‘½åç©ºé—´ä½œç”¨åŸŸå˜é‡å’Œç±»æ•°æ®æˆå‘˜é‡Œã€‚æ°¸è¿œåˆ«åˆ—è¡¨åˆå§‹åŒ–<code>auto</code> å˜é‡ã€‚</p><p><code>auto</code> è¿˜å¯ä»¥å’Œ C++11 ç‰¹æ€§ã€Œå°¾ç½®è¿”å›ç±»å‹ï¼ˆtrailing returntypeï¼‰ã€ä¸€èµ·ç”¨ï¼Œä¸è¿‡åè€…åªèƒ½ç”¨åœ¨ lambda è¡¨è¾¾å¼é‡Œã€‚</p></blockquote><h3 id="åˆ—è¡¨åˆå§‹åŒ–">6.20. åˆ—è¡¨åˆå§‹åŒ–</h3><p>==Tip==</p><p>ä½ å¯ä»¥ç”¨åˆ—è¡¨åˆå§‹åŒ–ã€‚</p><p>æ—©åœ¨ C++03 é‡Œï¼Œèšåˆç±»å‹ï¼ˆaggregatetypesï¼‰å°±å·²ç»å¯ä»¥è¢«åˆ—è¡¨åˆå§‹åŒ–äº†ï¼Œæ¯”å¦‚æ•°ç»„å’Œä¸è‡ªå¸¦æ„é€ å‡½æ•°çš„ç»“æ„ä½“ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> &#123; <span class="type">int</span> x; <span class="type">int</span> y; &#125;;</span><br><span class="line">Point p = &#123;<span class="number">1</span>, <span class="number">2</span>&#125;;</span><br></pre></td></tr></table></figure><p>C++11ä¸­ï¼Œè¯¥ç‰¹æ€§å¾—åˆ°è¿›ä¸€æ­¥çš„æ¨å¹¿ï¼Œä»»ä½•å¯¹è±¡ç±»å‹éƒ½å¯ä»¥è¢«åˆ—è¡¨åˆå§‹åŒ–ã€‚ç¤ºèŒƒå¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Vector æ¥æ”¶äº†ä¸€ä¸ªåˆå§‹åŒ–åˆ—è¡¨ã€‚</span></span><br><span class="line">vector&lt;string&gt; v&#123;<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bar&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸è€ƒè™‘ç»†èŠ‚ä¸Šçš„å¾®å¦™å·®åˆ«ï¼Œå¤§è‡´ä¸Šç›¸åŒã€‚</span></span><br><span class="line"><span class="comment">// æ‚¨å¯ä»¥ä»»é€‰å…¶ä¸€ã€‚</span></span><br><span class="line">vector&lt;string&gt; v = &#123;<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bar&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯ä»¥é…åˆ new ä¸€èµ·ç”¨ã€‚</span></span><br><span class="line"><span class="keyword">auto</span> p = <span class="keyword">new</span> vector&lt;string&gt;&#123;<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bar&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// map æ¥æ”¶äº†ä¸€äº› pair, åˆ—è¡¨åˆå§‹åŒ–å¤§æ˜¾ç¥å¨ã€‚</span></span><br><span class="line">map&lt;<span class="type">int</span>, string&gt; m = &#123;&#123;<span class="number">1</span>, <span class="string">&quot;one&quot;</span>&#125;, &#123;<span class="number">2</span>, <span class="string">&quot;2&quot;</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–åˆ—è¡¨ä¹Ÿå¯ä»¥ç”¨åœ¨è¿”å›ç±»å‹ä¸Šçš„éšå¼è½¬æ¢ã€‚</span></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">test_function</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–åˆ—è¡¨å¯è¿­ä»£ã€‚</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i : &#123;<span class="number">-1</span>, <span class="number">-2</span>, <span class="number">-3</span>&#125;) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨å‡½æ•°è°ƒç”¨é‡Œç”¨åˆ—è¡¨åˆå§‹åŒ–ã€‚</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">TestFunction2</span><span class="params">(vector&lt;<span class="type">int</span>&gt; v)</span> </span>&#123;&#125;</span><br><span class="line"><span class="built_in">TestFunction2</span>(&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;);</span><br></pre></td></tr></table></figure><p>ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹ä¹Ÿå¯ä»¥å®šä¹‰æ¥æ”¶ <code>std::initializer_list</code>çš„æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦ï¼Œä»¥è‡ªåŠ¨åˆ—è¡¨åˆå§‹åŒ–ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyType</span> &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="comment">// std::initializer_list ä¸“é—¨æ¥æ”¶ init åˆ—è¡¨ã€‚</span></span><br><span class="line">  <span class="comment">// å¾—ä»¥å€¼ä¼ é€’ã€‚</span></span><br><span class="line">  <span class="built_in">MyType</span>(std::initializer_list&lt;<span class="type">int</span>&gt; init_list) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i : init_list) <span class="built_in">append</span>(i);</span><br><span class="line">  &#125;</span><br><span class="line">  MyType&amp; <span class="keyword">operator</span>=(std::initializer_list&lt;<span class="type">int</span>&gt; init_list) &#123;</span><br><span class="line">    <span class="built_in">clear</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i : init_list) <span class="built_in">append</span>(i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">MyType m&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>&#125;;</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œåˆ—è¡¨åˆå§‹åŒ–ä¹Ÿé€‚ç”¨äºå¸¸è§„æ•°æ®ç±»å‹çš„æ„é€ ï¼Œå“ªæ€•æ²¡æœ‰æ¥æ”¶<code>std::initializer_list</code> çš„æ„é€ å‡½æ•°ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">double</span> d&#123;<span class="number">1.23</span>&#125;;</span><br><span class="line"><span class="comment">// MyOtherType æ²¡æœ‰ std::initializer_list æ„é€ å‡½æ•°ï¼Œ</span></span><br><span class="line"> <span class="comment">// ç›´æ¥ä¸Šæ¥æ”¶å¸¸è§„ç±»å‹çš„æ„é€ å‡½æ•°ã€‚</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyOtherType</span> &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">explicit</span> <span class="title">MyOtherType</span><span class="params">(string)</span></span>;</span><br><span class="line">  <span class="built_in">MyOtherType</span>(<span class="type">int</span>, string);</span><br><span class="line">&#125;;</span><br><span class="line">MyOtherType m = &#123;<span class="number">1</span>, <span class="string">&quot;b&quot;</span>&#125;;</span><br><span class="line"><span class="comment">// ä¸è¿‡å¦‚æœæ„é€ å‡½æ•°æ˜¯æ˜¾å¼çš„ï¼ˆexplictï¼‰ï¼Œæ‚¨å°±ä¸èƒ½ç”¨ `= &#123;&#125;` äº†ã€‚</span></span><br><span class="line">MyOtherType m&#123;<span class="string">&quot;b&quot;</span>&#125;;</span><br></pre></td></tr></table></figure><p>åƒä¸‡åˆ«ç›´æ¥åˆ—è¡¨åˆå§‹åŒ– auto å˜é‡ï¼Œçœ‹ä¸‹ä¸€å¥ï¼Œä¼°è®¡æ²¡äººçœ‹å¾—æ‡‚ï¼š</p><p>==Warning==</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> d = &#123;<span class="number">1.23</span>&#125;;        <span class="comment">// d å³æ˜¯ std::initializer_list&lt;double&gt;</span></span><br><span class="line"><span class="keyword">auto</span> d = <span class="type">double</span>&#123;<span class="number">1.23</span>&#125;;  <span class="comment">// å–„å“‰ -- d å³ä¸º double, å¹¶é std::initializer_list.</span></span><br></pre></td></tr></table></figure><p>è‡³äºæ ¼å¼åŒ–ï¼Œå‚è§ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/formatting/##braced-initializer-list-format">9.7.åˆ—è¡¨åˆå§‹åŒ–æ ¼å¼</a>.</p><h3 id="lambda-è¡¨è¾¾å¼">6.21. Lambda è¡¨è¾¾å¼</h3><p>==Tip==</p><p>é€‚å½“ä½¿ç”¨ lambda è¡¨è¾¾å¼ã€‚åˆ«ç”¨é»˜è®¤ lambdaæ•è·ï¼Œæ‰€æœ‰æ•è·éƒ½è¦æ˜¾å¼å†™å‡ºæ¥ã€‚</p><p>==å®šä¹‰ï¼š==</p><blockquote><p>Lambdaè¡¨è¾¾å¼æ˜¯åˆ›å»ºåŒ¿åå‡½æ•°å¯¹è±¡çš„ä¸€ç§ç®€æ˜“é€”å¾„ï¼Œå¸¸ç”¨äºæŠŠå‡½æ•°å½“å‚æ•°ä¼ ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">std::<span class="built_in">sort</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), [](<span class="type">int</span> x, <span class="type">int</span> y) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Weight</span>(x) &lt; <span class="built_in">Weight</span>(y);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>C++11 é¦–æ¬¡æå‡º Lambdas,è¿˜æä¾›äº†ä¸€ç³»åˆ—å¤„ç†å‡½æ•°å¯¹è±¡çš„å·¥å…·ï¼Œæ¯”å¦‚å¤šæ€åŒ…è£…å™¨ï¼ˆpolymorphic wrapperï¼‰<code>std::function</code>.</p></blockquote><p>==ä¼˜ç‚¹ï¼š==</p><blockquote><ul><li>ä¼ å‡½æ•°å¯¹è±¡ç»™ STL ç®—æ³•ï¼ŒLambdas æœ€ç®€æ˜“ï¼Œå¯è¯»æ€§ä¹Ÿå¥½ã€‚</li><li>Lambdas, <code>std::functions</code> å’Œ <code>std::bind</code>å¯ä»¥æ­é…æˆé€šç”¨å›è°ƒæœºåˆ¶ï¼ˆgeneral purpose callbackmechanismï¼‰ï¼›å†™æ¥æ”¶æœ‰ç•Œå‡½æ•°ä¸ºå‚æ•°çš„å‡½æ•°ä¹Ÿå¾ˆå®¹æ˜“äº†ã€‚</li></ul></blockquote><p>==ç¼ºç‚¹ï¼š==</p><blockquote><ul><li>Lambdas çš„å˜é‡æ•è·ç•¥æ—é—¨å·¦é“ï¼Œå¯èƒ½ä¼šé€ æˆæ‚¬ç©ºæŒ‡é’ˆã€‚</li><li>Lambdas å¯èƒ½ä¼šå¤±æ§ï¼›å±‚å±‚åµŒå¥—çš„åŒ¿åå‡½æ•°éš¾ä»¥é˜…è¯»ã€‚</li></ul></blockquote><p>==ç»“è®ºï¼š==</p><blockquote><ul><li>æŒ‰ format å°ç”¨ lambda è¡¨è¾¾å¼æ€¡æƒ…ã€‚</li><li>ç¦ç”¨é»˜è®¤æ•è·ï¼Œæ•è·éƒ½è¦æ˜¾å¼å†™å‡ºæ¥ã€‚æ‰“æ¯”æ–¹ï¼Œæ¯”èµ·<code>[=](int x) &#123;return x + n;&#125;</code>, æ‚¨è¯¥å†™æˆ<code>[n](int x) &#123;return x + n;&#125;</code> æ‰å¯¹ï¼Œè¿™æ ·è¯»è€…ä¹Ÿå¥½ä¸€çœ¼çœ‹å‡º<code>n</code> æ˜¯è¢«æ•è·çš„å€¼ã€‚</li><li>åŒ¿åå‡½æ•°å§‹ç»ˆè¦ç®€çŸ­ï¼Œå¦‚æœå‡½æ•°ä½“è¶…è¿‡äº†äº”è¡Œï¼Œé‚£ä¹ˆè¿˜ä¸å¦‚èµ·åï¼ˆacgtyrantæ³¨ï¼šå³æŠŠ lambda è¡¨è¾¾å¼èµ‹å€¼ç»™å¯¹è±¡ï¼‰ï¼Œæˆ–æ”¹ç”¨å‡½æ•°ã€‚</li><li>å¦‚æœå¯è¯»æ€§æ›´å¥½ï¼Œå°±æ˜¾å¼å†™å‡º lambd çš„å°¾ç½®è¿”å›ç±»å‹ï¼Œå°±åƒauto.</li></ul></blockquote><h3 id="æ¨¡æ¿ç¼–ç¨‹">6.22. æ¨¡æ¿ç¼–ç¨‹</h3><p>==Tip==</p><p>ä¸è¦ä½¿ç”¨å¤æ‚çš„æ¨¡æ¿ç¼–ç¨‹</p><p>==å®šä¹‰:==</p><blockquote><p>æ¨¡æ¿ç¼–ç¨‹æŒ‡çš„æ˜¯åˆ©ç”¨c++ æ¨¡æ¿å®ä¾‹åŒ–æœºåˆ¶æ˜¯å›¾çµå®Œå¤‡æ€§,å¯ä»¥è¢«ç”¨æ¥å®ç°ç¼–è¯‘æ—¶åˆ»çš„ç±»å‹åˆ¤æ–­çš„ä¸€ç³»åˆ—ç¼–ç¨‹æŠ€å·§</p></blockquote><p>==ä¼˜ç‚¹:==</p><blockquote><p>æ¨¡æ¿ç¼–ç¨‹èƒ½å¤Ÿå®ç°éå¸¸çµæ´»çš„ç±»å‹å®‰å…¨çš„æ¥å£å’Œæå¥½çš„æ€§èƒ½,ä¸€äº›å¸¸è§çš„å·¥å…·æ¯”å¦‚Google Test, std::tuple, std::function å’ŒBoost.Spirit. è¿™äº›å·¥å…·å¦‚æœæ²¡æœ‰æ¨¡æ¿æ˜¯å®ç°ä¸äº†çš„</p></blockquote><p>==ç¼ºç‚¹:==</p><blockquote><ul><li>æ¨¡æ¿ç¼–ç¨‹æ‰€ä½¿ç”¨çš„æŠ€å·§å¯¹äºä½¿ç”¨c++ä¸æ˜¯å¾ˆç†Ÿç»ƒçš„äººæ˜¯æ¯”è¾ƒæ™¦æ¶©, éš¾æ‡‚çš„.åœ¨å¤æ‚çš„åœ°æ–¹ä½¿ç”¨æ¨¡æ¿çš„ä»£ç è®©äººæ›´ä¸å®¹æ˜“è¯»æ‡‚, å¹¶ä¸”debug å’Œç»´æŠ¤èµ·æ¥éƒ½å¾ˆéº»çƒ¦</li><li>æ¨¡æ¿ç¼–ç¨‹ç»å¸¸ä¼šå¯¼è‡´ç¼–è¯‘å‡ºé”™çš„ä¿¡æ¯éå¸¸ä¸å‹å¥½: åœ¨ä»£ç å‡ºé”™çš„æ—¶å€™,å³ä½¿è¿™ä¸ªæ¥å£éå¸¸çš„ç®€å•, æ¨¡æ¿å†…éƒ¨å¤æ‚çš„å®ç°ç»†èŠ‚ä¹Ÿä¼šåœ¨å‡ºé”™ä¿¡æ¯æ˜¾ç¤º.å¯¼è‡´è¿™ä¸ªç¼–è¯‘å‡ºé”™ä¿¡æ¯çœ‹èµ·æ¥éå¸¸éš¾ä»¥ç†è§£.</li><li>å¤§é‡çš„ä½¿ç”¨æ¨¡æ¿ç¼–ç¨‹æ¥å£ä¼šè®©é‡æ„å·¥å…·(Visual Assist X, Refactor forC++ç­‰ç­‰)æ›´éš¾å‘æŒ¥ç”¨é€”. é¦–å…ˆæ¨¡æ¿çš„ä»£ç ä¼šåœ¨å¾ˆå¤šä¸Šä¸‹æ–‡é‡Œé¢æ‰©å±•å¼€æ¥,æ‰€ä»¥å¾ˆéš¾ç¡®è®¤é‡æ„å¯¹æ‰€æœ‰çš„è¿™äº›å±•å¼€çš„ä»£ç æœ‰ç”¨,å…¶æ¬¡æœ‰äº›é‡æ„å·¥å…·åªå¯¹å·²ç»åšè¿‡æ¨¡æ¿ç±»å‹æ›¿æ¢çš„ä»£ç çš„AST æœ‰ç”¨.å› æ­¤é‡æ„å·¥å…·å¯¹è¿™äº›æ¨¡æ¿å®ç°çš„åŸå§‹ä»£ç å¹¶ä¸æœ‰æ•ˆ, å¾ˆéš¾æ‰¾å‡ºå“ªäº›éœ€è¦é‡æ„.</li></ul></blockquote><p>==ç»“è®º:==</p><blockquote><ul><li>æ¨¡æ¿ç¼–ç¨‹æœ‰æ—¶å€™èƒ½å¤Ÿå®ç°æ›´ç®€æ´æ›´æ˜“ç”¨çš„æ¥å£, ä½†æ˜¯æ›´å¤šçš„æ—¶å€™å´é€‚å¾—å…¶å.å› æ­¤æ¨¡æ¿ç¼–ç¨‹æœ€å¥½åªç”¨åœ¨å°‘é‡çš„åŸºç¡€ç»„ä»¶, åŸºç¡€æ•°æ®ç»“æ„ä¸Š,å› ä¸ºæ¨¡æ¿å¸¦æ¥çš„é¢å¤–çš„ç»´æŠ¤æˆæœ¬ä¼šè¢«å¤§é‡çš„ä½¿ç”¨ç»™åˆ†æ‹…æ‰</li><li>åœ¨ä½¿ç”¨æ¨¡æ¿ç¼–ç¨‹æˆ–è€…å…¶ä»–å¤æ‚çš„æ¨¡æ¿æŠ€å·§çš„æ—¶å€™, ä½ ä¸€å®šè¦å†ä¸‰è€ƒè™‘ä¸€ä¸‹.è€ƒè™‘ä¸€ä¸‹ä½ ä»¬å›¢é˜Ÿæˆå‘˜çš„å¹³å‡æ°´å¹³æ˜¯å¦èƒ½å¤Ÿè¯»æ‡‚å¹¶ä¸”èƒ½å¤Ÿç»´æŠ¤ä½ å†™çš„æ¨¡æ¿ä»£ç .æˆ–è€…ä¸€ä¸ªéc++ç¨‹åºå‘˜å’Œä¸€äº›åªæ˜¯åœ¨å‡ºé”™çš„æ—¶å€™å¶å°”çœ‹ä¸€ä¸‹ä»£ç çš„äººèƒ½å¤Ÿè¯»æ‡‚è¿™äº›é”™è¯¯ä¿¡æ¯æˆ–è€…èƒ½å¤Ÿè·Ÿè¸ªå‡½æ•°çš„è°ƒç”¨æµç¨‹.å¦‚æœä½ ä½¿ç”¨é€’å½’çš„æ¨¡æ¿å®ä¾‹åŒ–, æˆ–è€…ç±»å‹åˆ—è¡¨, æˆ–è€…å…ƒå‡½æ•°, åˆæˆ–è€…è¡¨è¾¾å¼æ¨¡æ¿,æˆ–è€…ä¾èµ–SFINAE, æˆ–è€…sizeof çš„trick æ‰‹æ®µæ¥æ£€æŸ¥å‡½æ•°æ˜¯å¦é‡è½½,é‚£ä¹ˆè¿™è¯´æ˜ä½ æ¨¡æ¿ç”¨çš„å¤ªå¤šäº†, è¿™äº›æ¨¡æ¿å¤ªå¤æ‚äº†, æˆ‘ä»¬ä¸æ¨èä½¿ç”¨</li><li>å¦‚æœä½ ä½¿ç”¨æ¨¡æ¿ç¼–ç¨‹, ä½ å¿…é¡»è€ƒè™‘å°½å¯èƒ½çš„æŠŠå¤æ‚åº¦æœ€å°åŒ–,å¹¶ä¸”å°½é‡ä¸è¦è®©æ¨¡æ¿å¯¹å¤–æš´æ¼. ä½ æœ€å¥½åªåœ¨å®ç°é‡Œé¢ä½¿ç”¨æ¨¡æ¿,ç„¶åç»™ç”¨æˆ·æš´éœ²çš„æ¥å£é‡Œé¢å¹¶ä¸ä½¿ç”¨æ¨¡æ¿, è¿™æ ·èƒ½æé«˜ä½ çš„æ¥å£çš„å¯è¯»æ€§.å¹¶ä¸”ä½ åº”è¯¥åœ¨è¿™äº›ä½¿ç”¨æ¨¡æ¿çš„ä»£ç ä¸Šå†™å°½å¯èƒ½è¯¦ç»†çš„æ³¨é‡Š.ä½ çš„æ³¨é‡Šé‡Œé¢åº”è¯¥è¯¦ç»†çš„åŒ…å«è¿™äº›ä»£ç æ˜¯æ€ä¹ˆç”¨çš„,è¿™äº›æ¨¡æ¿ç”Ÿæˆå‡ºæ¥çš„ä»£ç å¤§æ¦‚æ˜¯ä»€ä¹ˆæ ·å­çš„.è¿˜éœ€è¦é¢å¤–æ³¨æ„åœ¨ç”¨æˆ·é”™è¯¯ä½¿ç”¨ä½ çš„æ¨¡æ¿ä»£ç çš„æ—¶å€™éœ€è¦è¾“å‡ºæ›´äººæ€§åŒ–çš„å‡ºé”™ä¿¡æ¯.å› ä¸ºè¿™äº›å‡ºé”™ä¿¡æ¯ä¹Ÿæ˜¯ä½ çš„æ¥å£çš„ä¸€éƒ¨åˆ†,æ‰€ä»¥ä½ çš„ä»£ç å¿…é¡»è°ƒæ•´åˆ°è¿™äº›é”™è¯¯ä¿¡æ¯åœ¨ç”¨æˆ·çœ‹èµ·æ¥åº”è¯¥æ˜¯éå¸¸å®¹æ˜“ç†è§£,å¹¶ä¸”ç”¨æˆ·å¾ˆå®¹æ˜“çŸ¥é“å¦‚ä½•ä¿®æ”¹è¿™äº›é”™è¯¯</li></ul></blockquote><h3 id="boost-åº“">6.23. Boost åº“</h3><p>==Tip==</p><p>åªä½¿ç”¨ Boost ä¸­è¢«è®¤å¯çš„åº“.</p><p>==å®šä¹‰:==</p><blockquote><p><a href="http://www.boost.org/">Boost åº“é›†</a> æ˜¯ä¸€ä¸ªå¹¿å—æ¬¢è¿,ç»è¿‡åŒè¡Œé‰´å®š, å…è´¹å¼€æºçš„ C++ åº“é›†.</p></blockquote><p>==ä¼˜ç‚¹:==</p><blockquote><p>Boostä»£ç è´¨é‡æ™®éè¾ƒé«˜, å¯ç§»æ¤æ€§å¥½, å¡«è¡¥äº† C++ æ ‡å‡†åº“å¾ˆå¤šç©ºç™½,å¦‚å‹åˆ«çš„ç‰¹æ€§, æ›´å®Œå–„çš„ç»‘å®šå™¨, æ›´å¥½çš„æ™ºèƒ½æŒ‡é’ˆã€‚</p></blockquote><p>==ç¼ºç‚¹:==</p><blockquote><p>æŸäº› Boost åº“æå€¡çš„ç¼–ç¨‹å®è·µå¯è¯»æ€§å·®, æ¯”å¦‚å…ƒç¼–ç¨‹å’Œå…¶ä»–é«˜çº§æ¨¡æ¿æŠ€æœ¯,ä»¥åŠè¿‡åº¦ â€œå‡½æ•°åŒ–â€ çš„ç¼–ç¨‹é£æ ¼.</p></blockquote><p>==ç»“è®º:==</p><blockquote><p>ä¸ºäº†å‘é˜…è¯»å’Œç»´æŠ¤ä»£ç çš„äººå‘˜æä¾›æ›´å¥½çš„å¯è¯»æ€§, æˆ‘ä»¬åªå…è®¸ä½¿ç”¨ Boostä¸€éƒ¨åˆ†ç»è®¤å¯çš„ç‰¹æ€§å­é›†. ç›®å‰å…è®¸ä½¿ç”¨ä»¥ä¸‹åº“:</p><blockquote><ul><li><ahref="http://www.boost.org/doc/libs/1_58_0/libs/utility/call_traits.htm">CallTraits</a> : <code>boost/call_traits.hpp</code></li><li><ahref="http://www.boost.org/libs/utility/compressed_pair.htm">CompressedPair</a> : <code>boost/compressed_pair.hpp</code></li><li>[ : <code>boost/graph</code>, except serialization(<code>adj_list_serialize.hpp</code>) and parallel/distributedalgorithms and data structures(<code>boost/graph/parallel/*</code> and<code>boost/graph/distributed/*</code>)</li><li><a href="http://www.boost.org/libs/property_map/">Property Map</a> :<code>boost/property_map.hpp</code></li><li>The part of <ahref="http://www.boost.org/libs/iterator/">Iterator</a> that deals withdefining iterators: <code>boost/iterator/iterator_adaptor.hpp</code>,<code>boost/iterator/iterator_facade.hpp</code>, and<code>boost/function_output_iterator.hpp</code></li><li>The part of <a href="http://www.boost.org/libs/polygon/">Polygon</a>that deals with Voronoi diagram construction and doesnâ€™t depend on therest of Polygon: <code>boost/polygon/voronoi_builder.hpp</code>,<code>boost/polygon/voronoi_diagram.hpp</code>, and<code>boost/polygon/voronoi_geometry_type.hpp</code></li><li><a href="http://www.boost.org/libs/bimap/">Bimap</a> :<code>boost/bimap</code></li><li><ahref="http://www.boost.org/libs/math/doc/html/dist.html">StatisticalDistributions and Functions</a> :<code>boost/math/distributions</code></li><li><a href="http://www.boost.org/libs/multi_index/">Multi-index</a> :<code>boost/multi_index</code></li><li><a href="http://www.boost.org/libs/heap/">Heap</a> :<code>boost/heap</code></li><li>The flat containers from <ahref="http://www.boost.org/libs/container/">Container</a>:<code>boost/container/flat_map</code>, and<code>boost/container/flat_set</code></li></ul></blockquote><p>æˆ‘ä»¬æ­£åœ¨ç§¯æè€ƒè™‘å¢åŠ å…¶å®ƒ Boost ç‰¹æ€§, æ‰€ä»¥åˆ—è¡¨ä¸­çš„è§„åˆ™å°†ä¸æ–­å˜åŒ–.</p><p>ä»¥ä¸‹åº“å¯ä»¥ç”¨ï¼Œä½†ç”±äºå¦‚ä»Šå·²ç»è¢« C++ 11 æ ‡å‡†åº“å–ä»£ï¼Œä¸å†é¼“åŠ±ï¼š</p><blockquote><ul><li><a href="http://www.boost.org/libs/ptr_container/">PointerContainer</a> : <code>boost/ptr_container</code>, æ”¹ç”¨ <ahref="http://en.cppreference.com/w/cpp/memory/unique_ptr">std::unique_ptr</a></li><li><a href="http://www.boost.org/libs/array/">Array</a> :<code>boost/array.hpp</code>, æ”¹ç”¨ <ahref="http://en.cppreference.com/w/cpp/container/array">std::array</a></li></ul></blockquote></blockquote><h3 id="c11">6.24. C++11</h3><p>==Tip==</p><p>é€‚å½“ç”¨ C++11ï¼ˆå‰èº«æ˜¯ C++0xï¼‰çš„åº“å’Œè¯­è¨€æ‰©å±•ï¼Œåœ¨è´µé¡¹ç›®ç”¨ C++11ç‰¹æ€§å‰ä¸‰æ€å¯ç§»æ¤æ€§ã€‚</p><p>==å®šä¹‰ï¼š==</p><blockquote><p>C++11æœ‰ä¼—å¤šè¯­è¨€å’Œåº“ä¸Šçš„<code>å˜é© &lt;https://en.wikipedia.org/wiki/C%2B%2B11&gt;</code>_ã€‚</p></blockquote><p>==ä¼˜ç‚¹ï¼š==</p><blockquote><p>åœ¨äºŒã€‡ä¸€å››å¹´å…«æœˆä¹‹å‰ï¼ŒC++11 ä¸€åº¦æ˜¯å®˜æ–¹æ ‡å‡†ï¼Œè¢«å¤§å¤š C++ç¼–è¯‘å™¨æ”¯æŒã€‚å®ƒæ ‡å‡†åŒ–å¾ˆå¤šæˆ‘ä»¬æ—©å…ˆå°±åœ¨ç”¨çš„ C++æ‰©å±•ï¼Œç®€åŒ–äº†ä¸å°‘æ“ä½œï¼Œå¤§å¤§æ”¹å–„äº†æ€§èƒ½å’Œå®‰å…¨ã€‚</p></blockquote><p>==ç¼ºç‚¹ï¼š==</p><blockquote><p>C++11 ç›¸å¯¹äºå‰èº«ï¼Œå¤æ‚æäº†ï¼š1300 é¡µ vs 800é¡µï¼å¾ˆå¤šå¼€å‘è€…ä¹Ÿä¸æ€ä¹ˆç†Ÿæ‚‰å®ƒã€‚äºæ˜¯ä»é•¿è¿œæ¥çœ‹ï¼Œå‰è€…ç‰¹æ€§å¯¹ä»£ç å¯è¯»æ€§ä»¥åŠç»´æŠ¤ä»£ä»·éš¾ä»¥é¢„ä¼°ã€‚æˆ‘ä»¬è¯´ä¸å‡†ä»€ä¹ˆæ—¶å€™é‡‡çº³å…¶ç‰¹æ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨è¢«è¿«ä¾èµ–è€å®å·¥å…·çš„é¡¹ç›®ä¸Šã€‚</p><p>å’Œ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/others/##boost">6.23.Boost åº“</a> ä¸€æ ·ï¼Œæœ‰äº› C++11æ‰©å±•æå€¡å®åˆ™å¯¹å¯è¯»æ€§æœ‰å®³çš„ç¼–ç¨‹å®è·µâ€”â€”å°±åƒå»é™¤å†—ä½™æ£€æŸ¥ï¼ˆæ¯”å¦‚ç±»å‹åï¼‰ä»¥å¸®åŠ©è¯»è€…ï¼Œæˆ–æ˜¯é¼“åŠ±æ¨¡æ¿å…ƒç¼–ç¨‹ç­‰ç­‰ã€‚æœ‰äº›æ‰©å±•åœ¨åŠŸèƒ½ä¸Šä¸åŸæœ‰æœºåˆ¶å†²çªï¼Œå®¹æ˜“æ‹›è‡´å›°æƒ‘ä»¥åŠè¿ç§»ä»£ä»·ã€‚</p></blockquote><p>==ç¼ºç‚¹ï¼š==</p><blockquote><p>C++11ç‰¹æ€§é™¤äº†ä¸ªåˆ«æƒ…å†µä¸‹ï¼Œå¯ä»¥ç”¨ä¸€ç”¨ã€‚é™¤äº†æœ¬æŒ‡å—ä¼šæœ‰ä¸å°‘ç« èŠ‚ä¼šåŠ ä»¥è®¨è‹¥å¹² C++11ç‰¹æ€§ä¹‹å¤–ï¼Œä»¥ä¸‹ç‰¹æ€§æœ€å¥½ä¸è¦ç”¨ï¼š</p><ul><li>å°¾ç½®è¿”å›ç±»å‹ï¼Œæ¯”å¦‚ç”¨ <code>auto foo() -&gt; int</code> ä»£æ›¿<code>int foo()</code>. ä¸ºäº†å…¼å®¹äºç°æœ‰ä»£ç çš„å£°æ˜é£æ ¼ã€‚</li><li>ç¼–è¯‘æ—¶åˆæ•° ``, å› ä¸ºå®ƒæ¶‰åŠä¸€ä¸ªé‡æ¨¡æ¿çš„æ¥å£é£æ ¼ã€‚</li><li><code>å’Œ</code> å¤´æ–‡ä»¶ï¼Œå› ä¸ºç¼–è¯‘å™¨å°šä¸æ”¯æŒã€‚</li><li>é»˜è®¤ lambda æ•è·ã€‚</li></ul></blockquote><h3 id="è¯‘è€…acgtyrantç¬”è®°-3">è¯‘è€…ï¼ˆacgtyrantï¼‰ç¬”è®°</h3><ol type="1"><li>å®é™…ä¸Šï¼Œ<ahref="http://www.zhihu.com/question/24439516/answer/27858964">ç¼ºçœå‚æ•°ä¼šæ”¹å˜å‡½æ•°ç­¾åçš„å‰ææ˜¯æ”¹å˜äº†å®ƒæ¥æ”¶çš„å‚æ•°æ•°é‡</a>ï¼Œæ¯”å¦‚æŠŠ<code>void a()</code> æ”¹æˆ <code>void a(int b = 0)</code>,å¼€å‘è€…æ”¹å˜å…¶ä»£ç çš„åˆè¡·ä¹Ÿè®¸æ˜¯ï¼Œåœ¨ä¸æ”¹å˜ã€Œä»£ç å…¼å®¹æ€§ã€çš„åŒæ—¶ï¼Œåˆæä¾›äº†å¯é€‰intå‚æ•°çš„ä½™åœ°ï¼Œç„¶è€Œè¿™ç»ˆç©¶ä¼šç ´åå‡½æ•°æŒ‡é’ˆä¸Šçš„å…¼å®¹æ€§ï¼Œæ¯•ç«Ÿå‡½æ•°ç­¾åç¡®å®å˜äº†ã€‚</li><li>æ­¤å¤–æŠŠè‡ªå¸¦ç¼ºçœå‚æ•°çš„å‡½æ•°åœ°å€èµ‹å€¼ç»™æŒ‡é’ˆæ—¶ï¼Œä¼šä¸¢å¤±ç¼ºçœå‚æ•°ä¿¡æ¯ã€‚</li><li>æˆ‘è¿˜å‘ç° <ahref="http://www.zhihu.com/question/24439516/answer/27896004">æ»¥ç”¨ç¼ºçœå‚æ•°ä¼šå®³å¾—è¯»è€…å…‰åªçœ‹è°ƒç”¨ä»£ç çš„è¯ï¼Œä¼šè¯¯ä»¥ä¸ºå…¶å‡½æ•°æ¥å—çš„å‚æ•°æ•°é‡æ¯”å®é™…ä¸Šè¿˜è¦å°‘ã€‚</a></li><li><code>friend</code>å®é™…ä¸Šåªå¯¹å‡½æ•°ï¼ç±»èµ‹äºˆäº†å¯¹å…¶æ‰€åœ¨ç±»çš„è®¿é—®æƒé™ï¼Œå¹¶ä¸æ˜¯æœ‰æ•ˆçš„å£°æ˜è¯­å¥ã€‚æ‰€ä»¥é™¤äº†åœ¨å¤´æ–‡ä»¶ç±»å†…éƒ¨å†™friend å‡½æ•°ï¼ç±»ï¼Œè¿˜è¦åœ¨ç±»ä½œç”¨åŸŸä¹‹å¤–æ­£å¼åœ°å£°æ˜ä¸€éï¼Œæœ€ååœ¨å¯¹åº”çš„<code>.cc</code> æ–‡ä»¶åŠ ä»¥å®šä¹‰ã€‚</li><li>æœ¬é£æ ¼æŒ‡å—éƒ½å¼ºè°ƒäº†ã€Œå‹å…ƒåº”è¯¥å®šä¹‰åœ¨åŒä¸€æ–‡ä»¶å†…ï¼Œé¿å…ä»£ç è¯»è€…è·‘åˆ°å…¶å®ƒæ–‡ä»¶æŸ¥æ‰¾ä½¿ç”¨è¯¥ç§æœ‰æˆå‘˜çš„ç±»ã€ã€‚é‚£ä¹ˆå¯ä»¥æŠŠå…¶å£°æ˜æ”¾åœ¨ç±»å£°æ˜æ‰€åœ¨çš„å¤´æ–‡ä»¶ï¼Œå®šä¹‰ä¹Ÿæ”¾åœ¨ç±»å®šä¹‰æ‰€åœ¨çš„æ–‡ä»¶ã€‚</li><li>ç”±äºå‹å…ƒå‡½æ•°ï¼ç±»å¹¶ä¸æ˜¯ç±»çš„ä¸€éƒ¨åˆ†ï¼Œè‡ªç„¶ä¹Ÿä¸ä¼šæ˜¯ç±»å¯è°ƒç”¨çš„å…¬æœ‰æ¥å£ï¼Œäºæ˜¯æˆ‘ä¸»å¼ å…¨é›†ä¸­æ”¾åœ¨ç±»çš„å°¾éƒ¨ï¼Œå³çš„æ•°æ®æˆå‘˜ä¹‹åï¼Œå‚è€ƒ<ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/classes/##declaration-order">å£°æ˜é¡ºåº</a>ã€‚</li><li><a href="http://www.zhihu.com/question/22889420">å¯¹ä½¿ç”¨ C++å¼‚å¸¸å¤„ç†åº”å…·æœ‰æ€æ ·çš„æ€åº¦ï¼Ÿ</a> éå¸¸å€¼å¾—ä¸€è¯»ã€‚</li><li>æ³¨æ„åˆå§‹åŒ– const å¯¹è±¡æ—¶ï¼Œå¿…é¡»åœ¨åˆå§‹åŒ–çš„åŒæ—¶å€¼åˆå§‹åŒ–ã€‚</li><li>ç”¨æ–­è¨€ä»£æ›¿æ— ç¬¦å·æ•´å‹ç±»å‹ï¼Œæ·±æœ‰å¯å‘ã€‚</li><li>auto åœ¨æ¶‰åŠè¿­ä»£å™¨çš„å¾ªç¯è¯­å¥é‡ŒæŒºå¸¸ç”¨ã€‚</li><li><ahref="http://stackoverflow.com/questions/11215227/should-the-trailing-return-type-syntax-style-become-the-default-for-new-c11-pr">Shouldthe trailing return type syntax style become the default for new C++11programs?</a> è®¨è®ºäº† autoä¸å°¾ç½®è¿”å›ç±»å‹ä¸€èµ·ç”¨çš„å…¨æ–°ç¼–ç é£æ ¼ï¼Œå€¼å¾—ä¸€çœ‹ã€‚</li></ol></div><div class="story post-story"><h2 id="å‘½åçº¦å®š">7. å‘½åçº¦å®š</h2><p>æœ€é‡è¦çš„ä¸€è‡´æ€§è§„åˆ™æ˜¯å‘½åç®¡ç†.å‘½åçš„é£æ ¼èƒ½è®©æˆ‘ä»¬åœ¨ä¸éœ€è¦å»æŸ¥æ‰¾ç±»å‹å£°æ˜çš„æ¡ä»¶ä¸‹å¿«é€Ÿåœ°äº†è§£æŸä¸ªåå­—ä»£è¡¨çš„å«ä¹‰:ç±»å‹, å˜é‡, å‡½æ•°, å¸¸é‡, å®, ç­‰ç­‰, ç”šè‡³.æˆ‘ä»¬å¤§è„‘ä¸­çš„æ¨¡å¼åŒ¹é…å¼•æ“éå¸¸ä¾èµ–è¿™äº›å‘½åè§„åˆ™.</p><p>å‘½åè§„åˆ™å…·æœ‰ä¸€å®šéšæ„æ€§, ä½†ç›¸æ¯”æŒ‰ä¸ªäººå–œå¥½å‘½å, ä¸€è‡´æ€§æ›´é‡è¦,æ‰€ä»¥æ— è®ºä½ è®¤ä¸ºå®ƒä»¬æ˜¯å¦é‡è¦, è§„åˆ™æ€»å½’æ˜¯è§„åˆ™.</p><h3 id="é€šç”¨å‘½åè§„åˆ™">7.1. é€šç”¨å‘½åè§„åˆ™</h3><p><strong>æ€»è¿°</strong></p><p>å‡½æ•°å‘½å, å˜é‡å‘½å, æ–‡ä»¶å‘½åè¦æœ‰æè¿°æ€§; å°‘ç”¨ç¼©å†™.</p><p><strong>è¯´æ˜</strong></p><p>å°½å¯èƒ½ä½¿ç”¨æè¿°æ€§çš„å‘½å, åˆ«å¿ƒç–¼ç©ºé—´,æ¯•ç«Ÿç›¸æ¯”ä¹‹ä¸‹è®©ä»£ç æ˜“äºæ–°è¯»è€…ç†è§£æ›´é‡è¦.ä¸è¦ç”¨åªæœ‰é¡¹ç›®å¼€å‘è€…èƒ½ç†è§£çš„ç¼©å†™, ä¹Ÿä¸è¦é€šè¿‡ç æ‰å‡ ä¸ªå­—æ¯æ¥ç¼©å†™å•è¯.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> price_count_reader;    <span class="comment">// æ— ç¼©å†™</span></span><br><span class="line"><span class="type">int</span> num_errors;            <span class="comment">// &quot;num&quot; æ˜¯ä¸€ä¸ªå¸¸è§çš„å†™æ³•</span></span><br><span class="line"><span class="type">int</span> num_dns_connections;   <span class="comment">// äººäººéƒ½çŸ¥é“ &quot;DNS&quot; æ˜¯ä»€ä¹ˆ</span></span><br><span class="line"><span class="type">int</span> n;                     <span class="comment">// æ¯«æ— æ„ä¹‰.</span></span><br><span class="line"><span class="type">int</span> nerr;                  <span class="comment">// å«ç³Šä¸æ¸…çš„ç¼©å†™.</span></span><br><span class="line"><span class="type">int</span> n_comp_conns;          <span class="comment">// å«ç³Šä¸æ¸…çš„ç¼©å†™.</span></span><br><span class="line"><span class="type">int</span> wgc_connections;       <span class="comment">// åªæœ‰è´µå›¢é˜ŸçŸ¥é“æ˜¯ä»€ä¹ˆæ„æ€.</span></span><br><span class="line"><span class="type">int</span> pc_reader;             <span class="comment">// &quot;pc&quot; æœ‰å¤ªå¤šå¯èƒ½çš„è§£é‡Šäº†.</span></span><br><span class="line"><span class="type">int</span> cstmr_id;              <span class="comment">// åˆ å‡äº†è‹¥å¹²å­—æ¯.</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„, ä¸€äº›ç‰¹å®šçš„å¹¿ä¸ºäººçŸ¥çš„ç¼©å†™æ˜¯å…è®¸çš„, ä¾‹å¦‚ç”¨ <code>i</code>è¡¨ç¤ºè¿­ä»£å˜é‡å’Œç”¨ <code>T</code> è¡¨ç¤ºæ¨¡æ¿å‚æ•°.</p><p>æ¨¡æ¿å‚æ•°çš„å‘½ååº”å½“éµå¾ªå¯¹åº”çš„åˆ†ç±»: ç±»å‹æ¨¡æ¿å‚æ•°åº”å½“éµå¾ª <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/naming/##type-names">ç±»å‹å‘½å</a>çš„è§„åˆ™, è€Œéç±»å‹æ¨¡æ¿åº”å½“éµå¾ª <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/naming/##variable-names">å˜é‡å‘½å</a>çš„è§„åˆ™.</p><h3 id="æ–‡ä»¶å‘½å">7.2. æ–‡ä»¶å‘½å</h3><p><strong>æ€»è¿°</strong></p><p>æ–‡ä»¶åè¦å…¨éƒ¨å°å†™, å¯ä»¥åŒ…å«ä¸‹åˆ’çº¿ (<code>_</code>) æˆ–è¿å­—ç¬¦(<code>-</code>), ä¾ç…§é¡¹ç›®çš„çº¦å®š. å¦‚æœæ²¡æœ‰çº¦å®š, é‚£ä¹ˆ â€œ<code>_</code>â€æ›´å¥½.</p><p><strong>è¯´æ˜</strong></p><p>å¯æ¥å—çš„æ–‡ä»¶å‘½åç¤ºä¾‹:</p><ul><li><code>my_useful_class.cc</code></li><li><code>my-useful-class.cc</code></li><li><code>myusefulclass.cc</code></li><li><code>myusefulclass_test.cc</code> // <code>_unittest</code> å’Œ<code>_regtest</code> å·²å¼ƒç”¨.</li></ul><p>C++ æ–‡ä»¶è¦ä»¥ <code>.cc</code> ç»“å°¾, å¤´æ–‡ä»¶ä»¥ <code>.h</code> ç»“å°¾.ä¸“é—¨æ’å…¥æ–‡æœ¬çš„æ–‡ä»¶åˆ™ä»¥ <code>.inc</code> ç»“å°¾, å‚è§ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/headers/##self-contained-headers">å¤´æ–‡ä»¶è‡ªè¶³</a>.</p><p>ä¸è¦ä½¿ç”¨å·²ç»å­˜åœ¨äº <code>/usr/include</code> ä¸‹çš„æ–‡ä»¶å (Yang.Y æ³¨:å³ç¼–è¯‘å™¨æœç´¢ç³»ç»Ÿå¤´æ–‡ä»¶çš„è·¯å¾„), å¦‚ <code>db.h</code>.</p><p>é€šå¸¸åº”å°½é‡è®©æ–‡ä»¶åæ›´åŠ æ˜ç¡®. <code>http_server_logs.h</code> å°±æ¯”<code>logs.h</code> è¦å¥½. å®šä¹‰ç±»æ—¶æ–‡ä»¶åä¸€èˆ¬æˆå¯¹å‡ºç°, å¦‚<code>foo_bar.h</code> å’Œ <code>foo_bar.cc</code>, å¯¹åº”äºç±»<code>FooBar</code>.</p><p>å†…è”å‡½æ•°å¿…é¡»æ”¾åœ¨ <code>.h</code> æ–‡ä»¶ä¸­. å¦‚æœå†…è”å‡½æ•°æ¯”è¾ƒçŸ­,å°±ç›´æ¥æ”¾åœ¨ <code>.h</code> ä¸­.</p><h3 id="ç±»å‹å‘½å">7.3. ç±»å‹å‘½å</h3><p><strong>æ€»è¿°</strong></p><p>ç±»å‹åç§°çš„æ¯ä¸ªå•è¯é¦–å­—æ¯å‡å¤§å†™, ä¸åŒ…å«ä¸‹åˆ’çº¿:<code>MyExcitingClass</code>, <code>MyExcitingEnum</code>.</p><p><strong>è¯´æ˜</strong></p><p>æ‰€æœ‰ç±»å‹å‘½å â€”â€” ç±», ç»“æ„ä½“, ç±»å‹å®šä¹‰ (<code>typedef</code>), æšä¸¾,ç±»å‹æ¨¡æ¿å‚æ•° â€”â€” å‡ä½¿ç”¨ç›¸åŒçº¦å®š, å³ä»¥å¤§å†™å­—æ¯å¼€å§‹, æ¯ä¸ªå•è¯é¦–å­—æ¯å‡å¤§å†™,ä¸åŒ…å«ä¸‹åˆ’çº¿. ä¾‹å¦‚:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç±»å’Œç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UrlTable</span> &#123; ...</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UrlTableTester</span> &#123; ...</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">UrlTableProperties</span> &#123; ...</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç±»å‹å®šä¹‰</span></span><br><span class="line"><span class="keyword">typedef</span> hash_map&lt;UrlTableProperties *, string&gt; PropertiesMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">// using åˆ«å</span></span><br><span class="line"><span class="keyword">using</span> PropertiesMap = hash_map&lt;UrlTableProperties *, string&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æšä¸¾</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">UrlTableErrors</span> &#123; ...</span><br></pre></td></tr></table></figure><h3 id="å˜é‡å‘½å">7.4. å˜é‡å‘½å</h3><p><strong>æ€»è¿°</strong></p><p>å˜é‡ (åŒ…æ‹¬å‡½æ•°å‚æ•°) å’Œæ•°æ®æˆå‘˜åä¸€å¾‹å°å†™, å•è¯ä¹‹é—´ç”¨ä¸‹åˆ’çº¿è¿æ¥.ç±»çš„æˆå‘˜å˜é‡ä»¥ä¸‹åˆ’çº¿ç»“å°¾, ä½†ç»“æ„ä½“çš„å°±ä¸ç”¨, å¦‚:<code>a_local_variable</code>, <code>a_struct_data_member</code>,<code>a_class_data_member_</code>.</p><p><strong>è¯´æ˜</strong></p><h6 id="æ™®é€šå˜é‡å‘½å">æ™®é€šå˜é‡å‘½å</h6><p>ä¸¾ä¾‹:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">string table_name;  <span class="comment">// å¥½ - ç”¨ä¸‹åˆ’çº¿.</span></span><br><span class="line">string tablename;   <span class="comment">// å¥½ - å…¨å°å†™.</span></span><br><span class="line"></span><br><span class="line">string tableName;  <span class="comment">// å·® - æ··åˆå¤§å°å†™</span></span><br></pre></td></tr></table></figure><h6 id="ç±»æ•°æ®æˆå‘˜">ç±»æ•°æ®æˆå‘˜</h6><p>ä¸ç®¡æ˜¯é™æ€çš„è¿˜æ˜¯éé™æ€çš„, ç±»æ•°æ®æˆå‘˜éƒ½å¯ä»¥å’Œæ™®é€šå˜é‡ä¸€æ ·,ä½†è¦æ¥ä¸‹åˆ’çº¿.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TableInfo</span> &#123;</span><br><span class="line">  ...</span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  string table_name_;  <span class="comment">// å¥½ - ååŠ ä¸‹åˆ’çº¿.</span></span><br><span class="line">  string tablename_;   <span class="comment">// å¥½.</span></span><br><span class="line">  <span class="type">static</span> Pool&lt;TableInfo&gt;* pool_;  <span class="comment">// å¥½.</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h6 id="ç»“æ„ä½“å˜é‡">ç»“æ„ä½“å˜é‡</h6><p>ä¸ç®¡æ˜¯é™æ€çš„è¿˜æ˜¯éé™æ€çš„, ç»“æ„ä½“æ•°æ®æˆå‘˜éƒ½å¯ä»¥å’Œæ™®é€šå˜é‡ä¸€æ ·,ä¸ç”¨åƒç±»é‚£æ ·æ¥ä¸‹åˆ’çº¿:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">UrlTableProperties</span> &#123;</span><br><span class="line">  string name;</span><br><span class="line">  <span class="type">int</span> num_entries;</span><br><span class="line">  <span class="type">static</span> Pool&lt;UrlTableProperties&gt;* pool;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç»“æ„ä½“ä¸ç±»çš„ä½¿ç”¨è®¨è®º, å‚è€ƒ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/classes/##structs-vs-classes">ç»“æ„ä½“vs. ç±»</a>.</p><h3 id="å¸¸é‡å‘½å">7.5. å¸¸é‡å‘½å</h3><p><strong>æ€»è¿°</strong></p><p>å£°æ˜ä¸º <code>constexpr</code> æˆ– <code>const</code> çš„å˜é‡,æˆ–åœ¨ç¨‹åºè¿è¡ŒæœŸé—´å…¶å€¼å§‹ç»ˆä¿æŒä¸å˜çš„, å‘½åæ—¶ä»¥ â€œkâ€ å¼€å¤´, å¤§å°å†™æ··åˆ.ä¾‹å¦‚:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> kDaysInAWeek = <span class="number">7</span>;</span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜</strong></p><p>æ‰€æœ‰å…·æœ‰é™æ€å­˜å‚¨ç±»å‹çš„å˜é‡ (ä¾‹å¦‚é™æ€å˜é‡æˆ–å…¨å±€å˜é‡, å‚è§ <ahref="http://en.cppreference.com/w/cpp/language/storage_duration##Storage_duration">å­˜å‚¨ç±»å‹</a>)éƒ½åº”å½“ä»¥æ­¤æ–¹å¼å‘½å. å¯¹äºå…¶ä»–å­˜å‚¨ç±»å‹çš„å˜é‡, å¦‚è‡ªåŠ¨å˜é‡ç­‰,è¿™æ¡è§„åˆ™æ˜¯å¯é€‰çš„. å¦‚æœä¸é‡‡ç”¨è¿™æ¡è§„åˆ™, å°±æŒ‰ç…§ä¸€èˆ¬çš„å˜é‡å‘½åè§„åˆ™.</p><h3 id="å‡½æ•°å‘½å">7.6. å‡½æ•°å‘½å</h3><p><strong>æ€»è¿°</strong></p><p>å¸¸è§„å‡½æ•°ä½¿ç”¨å¤§å°å†™æ··åˆ, å–å€¼å’Œè®¾å€¼å‡½æ•°åˆ™è¦æ±‚ä¸å˜é‡ååŒ¹é…:<code>MyExcitingFunction()</code>, <code>MyExcitingMethod()</code>,<code>my_exciting_member_variable()</code>,<code>set_my_exciting_member_variable()</code>.</p><p><strong>è¯´æ˜</strong></p><p>ä¸€èˆ¬æ¥è¯´, å‡½æ•°åçš„æ¯ä¸ªå•è¯é¦–å­—æ¯å¤§å†™ (å³ â€œé©¼å³°å˜é‡åâ€ æˆ–â€œå¸•æ–¯å¡å˜é‡åâ€), æ²¡æœ‰ä¸‹åˆ’çº¿. å¯¹äºé¦–å­—æ¯ç¼©å†™çš„å•è¯,æ›´å€¾å‘äºå°†å®ƒä»¬è§†ä½œä¸€ä¸ªå•è¯è¿›è¡Œé¦–å­—æ¯å¤§å†™ (ä¾‹å¦‚, å†™ä½œ<code>StartRpc()</code> è€Œé <code>StartRPC()</code>).</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">AddTableEntry</span>()</span><br><span class="line"><span class="built_in">DeleteUrl</span>()</span><br><span class="line"><span class="built_in">OpenFileOrDie</span>()</span><br></pre></td></tr></table></figure><p>(åŒæ ·çš„å‘½åè§„åˆ™åŒæ—¶é€‚ç”¨äºç±»ä½œç”¨åŸŸä¸å‘½åç©ºé—´ä½œç”¨åŸŸçš„å¸¸é‡,å› ä¸ºå®ƒä»¬æ˜¯ä½œä¸º API çš„ä¸€éƒ¨åˆ†æš´éœ²å¯¹å¤–çš„, å› æ­¤åº”å½“è®©å®ƒä»¬çœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªå‡½æ•°,å› ä¸ºåœ¨è¿™æ—¶,å®ƒä»¬å®é™…ä¸Šæ˜¯ä¸€ä¸ªå¯¹è±¡è€Œéå‡½æ•°çš„è¿™ä¸€äº‹å®å¯¹å¤–ä¸è¿‡æ˜¯ä¸€ä¸ªæ— å…³ç´§è¦çš„å®ç°ç»†èŠ‚.)</p><p>å–å€¼å’Œè®¾å€¼å‡½æ•°çš„å‘½åä¸å˜é‡ä¸€è‡´.ä¸€èˆ¬æ¥è¯´å®ƒä»¬çš„åç§°ä¸å®é™…çš„æˆå‘˜å˜é‡å¯¹åº”, ä½†å¹¶ä¸å¼ºåˆ¶è¦æ±‚. ä¾‹å¦‚<code>int count()</code> ä¸ <code>void set_count(int count)</code>.</p><h3 id="å‘½åç©ºé—´å‘½å">7.7. å‘½åç©ºé—´å‘½å</h3><p><strong>æ€»è¿°</strong></p><p>å‘½åç©ºé—´ä»¥å°å†™å­—æ¯å‘½å. æœ€é«˜çº§å‘½åç©ºé—´çš„åå­—å–å†³äºé¡¹ç›®åç§°.è¦æ³¨æ„é¿å…åµŒå¥—å‘½åç©ºé—´çš„åå­—ä¹‹é—´å’Œå¸¸è§çš„é¡¶çº§å‘½åç©ºé—´çš„åå­—ä¹‹é—´å‘ç”Ÿå†²çª.</p><p>é¡¶çº§å‘½åç©ºé—´çš„åç§°åº”å½“æ˜¯é¡¹ç›®åæˆ–è€…æ˜¯è¯¥å‘½åç©ºé—´ä¸­çš„ä»£ç æ‰€å±çš„å›¢é˜Ÿçš„åå­—.å‘½åç©ºé—´ä¸­çš„ä»£ç ,åº”å½“å­˜æ”¾äºå’Œå‘½åç©ºé—´çš„åå­—åŒ¹é…çš„æ–‡ä»¶å¤¹æˆ–å…¶å­æ–‡ä»¶å¤¹ä¸­.</p><p>æ³¨æ„ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/naming/##general-naming-rules">ä¸ä½¿ç”¨ç¼©å†™ä½œä¸ºåç§°</a>çš„è§„åˆ™åŒæ ·é€‚ç”¨äºå‘½åç©ºé—´. å‘½åç©ºé—´ä¸­çš„ä»£ç æå°‘éœ€è¦æ¶‰åŠå‘½åç©ºé—´çš„åç§°,å› æ­¤æ²¡æœ‰å¿…è¦åœ¨å‘½åç©ºé—´ä¸­ä½¿ç”¨ç¼©å†™.</p><p>è¦é¿å…åµŒå¥—çš„å‘½åç©ºé—´ä¸å¸¸è§çš„é¡¶çº§å‘½åç©ºé—´å‘ç”Ÿåç§°å†²çª.ç”±äºåç§°æŸ¥æ‰¾è§„åˆ™çš„å­˜åœ¨, å‘½åç©ºé—´ä¹‹é—´çš„å†²çªå®Œå…¨æœ‰å¯èƒ½å¯¼è‡´ç¼–è¯‘å¤±è´¥.å°¤å…¶æ˜¯, ä¸è¦åˆ›å»ºåµŒå¥—çš„ <code>std</code> å‘½åç©ºé—´.å»ºè®®ä½¿ç”¨æ›´ç‹¬ç‰¹çš„é¡¹ç›®æ ‡è¯†ç¬¦ (<code>websearch::index</code>,<code>websearch::index_util</code>) è€Œéå¸¸è§çš„ææ˜“å‘ç”Ÿå†²çªçš„åç§° (æ¯”å¦‚<code>websearch::util</code>).</p><p>å¯¹äº <code>internal</code> å‘½åç©ºé—´, è¦å½“å¿ƒåŠ å…¥åˆ°åŒä¸€<code>internal</code> å‘½åç©ºé—´çš„ä»£ç ä¹‹é—´å‘ç”Ÿå†²çª(ç”±äºå†…éƒ¨ç»´æŠ¤äººå‘˜é€šå¸¸æ¥è‡ªåŒä¸€å›¢é˜Ÿ, å› æ­¤å¸¸æœ‰å¯èƒ½å¯¼è‡´å†²çª). åœ¨è¿™ç§æƒ…å†µä¸‹,è¯·ä½¿ç”¨æ–‡ä»¶åä»¥ä½¿å¾—å†…éƒ¨åç§°ç‹¬ä¸€æ— äºŒ (ä¾‹å¦‚å¯¹äº <code>frobber.h</code>,ä½¿ç”¨ <code>websearch::index::frobber_internal</code>).</p><h3 id="æšä¸¾å‘½å">7.8. æšä¸¾å‘½å</h3><p><strong>æ€»è¿°</strong></p><p>æšä¸¾çš„å‘½ååº”å½“å’Œ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/naming/##constant-names">å¸¸é‡</a>æˆ– <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/naming/##macro-names">å®</a>ä¸€è‡´: <code>kEnumName</code> æˆ–æ˜¯ <code>ENUM_NAME</code>.</p><p><strong>è¯´æ˜</strong></p><p>å•ç‹¬çš„æšä¸¾å€¼åº”è¯¥ä¼˜å…ˆé‡‡ç”¨ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/naming/##constant-names">å¸¸é‡</a>çš„å‘½åæ–¹å¼. ä½† <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/naming/##macro-names">å®</a>æ–¹å¼çš„å‘½åä¹Ÿå¯ä»¥æ¥å—. æšä¸¾å <code>UrlTableErrors</code> (ä»¥åŠ<code>AlternateUrlTableErrors</code>) æ˜¯ç±»å‹,æ‰€ä»¥è¦ç”¨å¤§å°å†™æ··åˆçš„æ–¹å¼.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">UrlTableErrors</span> &#123;</span><br><span class="line">    kOK = <span class="number">0</span>,</span><br><span class="line">    kErrorOutOfMemory,</span><br><span class="line">    kErrorMalformedInput,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">AlternateUrlTableErrors</span> &#123;</span><br><span class="line">    OK = <span class="number">0</span>,</span><br><span class="line">    OUT_OF_MEMORY = <span class="number">1</span>,</span><br><span class="line">    MALFORMED_INPUT = <span class="number">2</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>2009 å¹´ 1 æœˆä¹‹å‰, æˆ‘ä»¬ä¸€ç›´å»ºè®®é‡‡ç”¨ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/naming/##macro-names">å®</a>çš„æ–¹å¼å‘½åæšä¸¾å€¼. ç”±äºæšä¸¾å€¼å’Œå®ä¹‹é—´çš„å‘½åå†²çª, ç›´æ¥å¯¼è‡´äº†å¾ˆå¤šé—®é¢˜.ç”±æ­¤, è¿™é‡Œæ”¹ä¸ºä¼˜å…ˆé€‰æ‹©å¸¸é‡é£æ ¼çš„å‘½åæ–¹å¼.æ–°ä»£ç åº”è¯¥å°½å¯èƒ½ä¼˜å…ˆä½¿ç”¨å¸¸é‡é£æ ¼. ä½†æ˜¯è€ä»£ç æ²¡å¿…è¦åˆ‡æ¢åˆ°å¸¸é‡é£æ ¼,é™¤éå®é£æ ¼ç¡®å®ä¼šäº§ç”Ÿç¼–è¯‘æœŸé—®é¢˜.</p><h3 id="å®å‘½å">7.9. å®å‘½å</h3><p><strong>æ€»è¿°</strong></p><p>ä½ å¹¶ä¸æ‰“ç®— <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/others/##preprocessor-macros">ä½¿ç”¨å®</a>,å¯¹å§? å¦‚æœä½ ä¸€å®šè¦ç”¨, åƒè¿™æ ·å‘½å:<code>MY_MACRO_THAT_SCARES_SMALL_CHILDREN</code>.</p><p><strong>è¯´æ˜</strong></p><p>å‚è€ƒ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/others/##preprocessor-macros">é¢„å¤„ç†å®</a>;é€šå¸¸ <em>ä¸åº”è¯¥</em> ä½¿ç”¨å®. å¦‚æœä¸å¾—ä¸ç”¨, å…¶å‘½ååƒæšä¸¾å‘½åä¸€æ ·å…¨éƒ¨å¤§å†™,ä½¿ç”¨ä¸‹åˆ’çº¿:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> ROUND(x) ...</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PI_ROUNDED 3.0</span></span><br></pre></td></tr></table></figure><h3 id="å‘½åè§„åˆ™çš„ç‰¹ä¾‹">7.10. å‘½åè§„åˆ™çš„ç‰¹ä¾‹</h3><p><strong>æ€»è¿°</strong></p><p>å¦‚æœä½ å‘½åçš„å®ä½“ä¸å·²æœ‰ C/C++ å®ä½“ç›¸ä¼¼, å¯å‚è€ƒç°æœ‰å‘½åç­–ç•¥.</p><p><code>bigopen()</code>: å‡½æ•°å, å‚ç…§ <code>open()</code> çš„å½¢å¼</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uint`: `<span class="keyword">typedef</span></span><br></pre></td></tr></table></figure><p><code>bigpos</code>: <code>struct</code> æˆ– <code>class</code>, å‚ç…§<code>pos</code> çš„å½¢å¼</p><p><code>sparse_hash_map</code>: STL å‹å®ä½“; å‚ç…§ STL å‘½åçº¦å®š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LONGLONG_MAX`: å¸¸é‡, å¦‚åŒ `INT_MAX</span><br></pre></td></tr></table></figure><h3 id="è¯‘è€…acgtyrantç¬”è®°-4">è¯‘è€…ï¼ˆacgtyrantï¼‰ç¬”è®°</h3><ol type="1"><li>æ„Ÿè§‰ Google çš„å‘½åçº¦å®šå¾ˆé«˜æ˜, æ¯”å¦‚å†™äº†ç®€å•çš„ç±» QueryResult,æ¥ç€åˆå¯ä»¥ç›´æ¥å®šä¹‰ä¸€ä¸ªå˜é‡ query_result, åŒºåˆ†åº¦å¾ˆå¥½; å†æ¬¡,ç±»å†…å˜é‡ä»¥ä¸‹åˆ’çº¿ç»“å°¾, é‚£ä¹ˆå°±å¯ä»¥ç›´æ¥ä¼ å…¥åŒåçš„å½¢å‚, æ¯”å¦‚<code>TextQuery::TextQuery(std::string word) : word_(word) &#123;&#125;</code> ,å…¶ä¸­ <code>word_</code> è‡ªç„¶æ˜¯ç±»å†…ç§æœ‰æˆå‘˜.</li></ol></div><div class="story post-story"><h2 id="æ³¨é‡Š">8. æ³¨é‡Š</h2><p>æ³¨é‡Šè™½ç„¶å†™èµ·æ¥å¾ˆç—›è‹¦, ä½†å¯¹ä¿è¯ä»£ç å¯è¯»æ€§è‡³å…³é‡è¦.ä¸‹é¢çš„è§„åˆ™æè¿°äº†å¦‚ä½•æ³¨é‡Šä»¥åŠåœ¨å“ªå„¿æ³¨é‡Š. å½“ç„¶ä¹Ÿè¦è®°ä½: æ³¨é‡Šå›ºç„¶å¾ˆé‡è¦,ä½†æœ€å¥½çš„ä»£ç åº”å½“æœ¬èº«å°±æ˜¯æ–‡æ¡£. æœ‰æ„ä¹‰çš„ç±»å‹åå’Œå˜é‡å,è¦è¿œèƒœè¿‡è¦ç”¨æ³¨é‡Šè§£é‡Šçš„å«ç³Šä¸æ¸…çš„åå­—.</p><p>ä½ å†™çš„æ³¨é‡Šæ˜¯ç»™ä»£ç è¯»è€…çœ‹çš„, ä¹Ÿå°±æ˜¯ä¸‹ä¸€ä¸ªéœ€è¦ç†è§£ä½ çš„ä»£ç çš„äºº.æ‰€ä»¥æ…·æ…¨äº›å§, ä¸‹ä¸€ä¸ªè¯»è€…å¯èƒ½å°±æ˜¯ä½ !</p><h3 id="æ³¨é‡Šé£æ ¼">8.1. æ³¨é‡Šé£æ ¼</h3><p><strong>æ€»è¿°</strong></p><p>ä½¿ç”¨ <code>//</code> æˆ– <code>/* */</code>, ç»Ÿä¸€å°±å¥½.</p><p><strong>è¯´æ˜</strong></p><p><code>//</code> æˆ– <code>/* */</code> éƒ½å¯ä»¥; ä½† <code>//</code><em>æ›´</em> å¸¸ç”¨. è¦åœ¨å¦‚ä½•æ³¨é‡ŠåŠæ³¨é‡Šé£æ ¼ä¸Šç¡®ä¿ç»Ÿä¸€.</p><h3 id="æ–‡ä»¶æ³¨é‡Š">8.2. æ–‡ä»¶æ³¨é‡Š</h3><p><strong>æ€»è¿°</strong></p><p>åœ¨æ¯ä¸€ä¸ªæ–‡ä»¶å¼€å¤´åŠ å…¥ç‰ˆæƒå…¬å‘Š.</p><p>æ–‡ä»¶æ³¨é‡Šæè¿°äº†è¯¥æ–‡ä»¶çš„å†…å®¹. å¦‚æœä¸€ä¸ªæ–‡ä»¶åªå£°æ˜, æˆ–å®ç°,æˆ–æµ‹è¯•äº†ä¸€ä¸ªå¯¹è±¡, å¹¶ä¸”è¿™ä¸ªå¯¹è±¡å·²ç»åœ¨å®ƒçš„å£°æ˜å¤„è¿›è¡Œäº†è¯¦ç»†çš„æ³¨é‡Š,é‚£ä¹ˆå°±æ²¡å¿…è¦å†åŠ ä¸Šæ–‡ä»¶æ³¨é‡Š. é™¤æ­¤ä¹‹å¤–çš„å…¶ä»–æ–‡ä»¶éƒ½éœ€è¦æ–‡ä»¶æ³¨é‡Š.</p><p><strong>è¯´æ˜</strong></p><h6 id="æ³•å¾‹å…¬å‘Šå’Œä½œè€…ä¿¡æ¯">æ³•å¾‹å…¬å‘Šå’Œä½œè€…ä¿¡æ¯</h6><p>æ¯ä¸ªæ–‡ä»¶éƒ½åº”è¯¥åŒ…å«è®¸å¯è¯å¼•ç”¨. ä¸ºé¡¹ç›®é€‰æ‹©åˆé€‚çš„è®¸å¯è¯ç‰ˆæœ¬.(æ¯”å¦‚,Apache 2.0, BSD, LGPL, GPL)</p><p>å¦‚æœä½ å¯¹åŸå§‹ä½œè€…çš„æ–‡ä»¶åšäº†é‡å¤§ä¿®æ”¹, è¯·è€ƒè™‘åˆ é™¤åŸä½œè€…ä¿¡æ¯.</p><h6 id="æ–‡ä»¶å†…å®¹">æ–‡ä»¶å†…å®¹</h6><p>å¦‚æœä¸€ä¸ª <code>.h</code> æ–‡ä»¶å£°æ˜äº†å¤šä¸ªæ¦‚å¿µ,åˆ™æ–‡ä»¶æ³¨é‡Šåº”å½“å¯¹æ–‡ä»¶çš„å†…å®¹åšä¸€ä¸ªå¤§è‡´çš„è¯´æ˜, åŒæ—¶è¯´æ˜å„æ¦‚å¿µä¹‹é—´çš„è”ç³».ä¸€ä¸ªä¸€åˆ°ä¸¤è¡Œçš„æ–‡ä»¶æ³¨é‡Šå°±è¶³å¤Ÿäº†,å¯¹äºæ¯ä¸ªæ¦‚å¿µçš„è¯¦ç»†æ–‡æ¡£åº”å½“æ”¾åœ¨å„ä¸ªæ¦‚å¿µä¸­, è€Œä¸æ˜¯æ–‡ä»¶æ³¨é‡Šä¸­.</p><p>ä¸è¦åœ¨ <code>.h</code> å’Œ <code>.cc</code> ä¹‹é—´å¤åˆ¶æ³¨é‡Š,è¿™æ ·çš„æ³¨é‡Šåç¦»äº†æ³¨é‡Šçš„å®é™…æ„ä¹‰.</p><h3 id="ç±»æ³¨é‡Š">8.3. ç±»æ³¨é‡Š</h3><p><strong>æ€»è¿°</strong></p><p>æ¯ä¸ªç±»çš„å®šä¹‰éƒ½è¦é™„å¸¦ä¸€ä»½æ³¨é‡Š, æè¿°ç±»çš„åŠŸèƒ½å’Œç”¨æ³•,é™¤éå®ƒçš„åŠŸèƒ½ç›¸å½“æ˜æ˜¾.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Iterates over the contents of a GargantuanTable.</span></span><br><span class="line"><span class="comment">// Example:</span></span><br><span class="line"><span class="comment">//    GargantuanTableIterator* iter = table-&gt;NewIterator();</span></span><br><span class="line"><span class="comment">//    for (iter-&gt;Seek(&quot;foo&quot;); !iter-&gt;done(); iter-&gt;Next()) &#123;</span></span><br><span class="line"><span class="comment">//      process(iter-&gt;key(), iter-&gt;value());</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">//    delete iter;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GargantuanTableIterator</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜</strong></p><p>ç±»æ³¨é‡Šåº”å½“ä¸ºè¯»è€…ç†è§£å¦‚ä½•ä½¿ç”¨ä¸ä½•æ—¶ä½¿ç”¨ç±»æä¾›è¶³å¤Ÿçš„ä¿¡æ¯,åŒæ—¶åº”å½“æé†’è¯»è€…åœ¨æ­£ç¡®ä½¿ç”¨æ­¤ç±»æ—¶åº”å½“è€ƒè™‘çš„å› ç´ . å¦‚æœç±»æœ‰ä»»ä½•åŒæ­¥å‰æ,è¯·ç”¨æ–‡æ¡£è¯´æ˜. å¦‚æœè¯¥ç±»çš„å®ä¾‹å¯è¢«å¤šçº¿ç¨‹è®¿é—®,è¦ç‰¹åˆ«æ³¨æ„æ–‡æ¡£è¯´æ˜å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ç›¸å…³çš„è§„åˆ™å’Œå¸¸é‡ä½¿ç”¨.</p><p>å¦‚æœä½ æƒ³ç”¨ä¸€å°æ®µä»£ç æ¼”ç¤ºè¿™ä¸ªç±»çš„åŸºæœ¬ç”¨æ³•æˆ–é€šå¸¸ç”¨æ³•,æ”¾åœ¨ç±»æ³¨é‡Šé‡Œä¹Ÿéå¸¸åˆé€‚.</p><p>å¦‚æœç±»çš„å£°æ˜å’Œå®šä¹‰åˆ†å¼€äº†(ä¾‹å¦‚åˆ†åˆ«æ”¾åœ¨äº† <code>.h</code> å’Œ<code>.cc</code> æ–‡ä»¶ä¸­), æ­¤æ—¶, æè¿°ç±»ç”¨æ³•çš„æ³¨é‡Šåº”å½“å’Œæ¥å£å®šä¹‰æ”¾åœ¨ä¸€èµ·,æè¿°ç±»çš„æ“ä½œå’Œå®ç°çš„æ³¨é‡Šåº”å½“å’Œå®ç°æ”¾åœ¨ä¸€èµ·.</p><h3 id="å‡½æ•°æ³¨é‡Š">8.4. å‡½æ•°æ³¨é‡Š</h3><p><strong>æ€»è¿°</strong></p><p>å‡½æ•°å£°æ˜å¤„çš„æ³¨é‡Šæè¿°å‡½æ•°åŠŸèƒ½; å®šä¹‰å¤„çš„æ³¨é‡Šæè¿°å‡½æ•°å®ç°.</p><p><strong>è¯´æ˜</strong></p><h6 id="å‡½æ•°å£°æ˜">å‡½æ•°å£°æ˜</h6><p>åŸºæœ¬ä¸Šæ¯ä¸ªå‡½æ•°å£°æ˜å¤„å‰éƒ½åº”å½“åŠ ä¸Šæ³¨é‡Š, æè¿°å‡½æ•°çš„åŠŸèƒ½å’Œç”¨é€”.åªæœ‰åœ¨å‡½æ•°çš„åŠŸèƒ½ç®€å•è€Œæ˜æ˜¾æ—¶æ‰èƒ½çœç•¥è¿™äº›æ³¨é‡Š(ä¾‹å¦‚,ç®€å•çš„å–å€¼å’Œè®¾å€¼å‡½æ•°). æ³¨é‡Šä½¿ç”¨å™è¿°å¼ (â€œOpens the fileâ€) è€ŒéæŒ‡ä»¤å¼(â€œOpen the fileâ€); æ³¨é‡Šåªæ˜¯ä¸ºäº†æè¿°å‡½æ•°, è€Œä¸æ˜¯å‘½ä»¤å‡½æ•°åšä»€ä¹ˆ. é€šå¸¸,æ³¨é‡Šä¸ä¼šæè¿°å‡½æ•°å¦‚ä½•å·¥ä½œ. é‚£æ˜¯å‡½æ•°å®šä¹‰éƒ¨åˆ†çš„äº‹æƒ….</p><p>å‡½æ•°å£°æ˜å¤„æ³¨é‡Šçš„å†…å®¹:</p><ul><li>å‡½æ•°çš„è¾“å…¥è¾“å‡º.</li><li>å¯¹ç±»æˆå‘˜å‡½æ•°è€Œè¨€: å‡½æ•°è°ƒç”¨æœŸé—´å¯¹è±¡æ˜¯å¦éœ€è¦ä¿æŒå¼•ç”¨å‚æ•°,æ˜¯å¦ä¼šé‡Šæ”¾è¿™äº›å‚æ•°.</li><li>å‡½æ•°æ˜¯å¦åˆ†é…äº†å¿…é¡»ç”±è°ƒç”¨è€…é‡Šæ”¾çš„ç©ºé—´.</li><li>å‚æ•°æ˜¯å¦å¯ä»¥ä¸ºç©ºæŒ‡é’ˆ.</li><li>æ˜¯å¦å­˜åœ¨å‡½æ•°ä½¿ç”¨ä¸Šçš„æ€§èƒ½éšæ‚£.</li><li>å¦‚æœå‡½æ•°æ˜¯å¯é‡å…¥çš„, å…¶åŒæ­¥å‰ææ˜¯ä»€ä¹ˆ?</li></ul><p>ä¸¾ä¾‹å¦‚ä¸‹:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Returns an iterator for this table.  It is the client&#x27;s</span></span><br><span class="line"><span class="comment">// responsibility to delete the iterator when it is done with it,</span></span><br><span class="line"><span class="comment">// and it must not use the iterator once the GargantuanTable object</span></span><br><span class="line"><span class="comment">// on which the iterator was created has been deleted.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// The iterator is initially positioned at the beginning of the table.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// This method is equivalent to:</span></span><br><span class="line"><span class="comment">//    Iterator* iter = table-&gt;NewIterator();</span></span><br><span class="line"><span class="comment">//    iter-&gt;Seek(&quot;&quot;);</span></span><br><span class="line"><span class="comment">//    return iter;</span></span><br><span class="line"><span class="comment">// If you are going to immediately seek to another place in the</span></span><br><span class="line"><span class="comment">// returned iterator, it will be faster to use NewIterator()</span></span><br><span class="line"><span class="comment">// and avoid the extra seek.</span></span><br><span class="line"><span class="function">Iterator* <span class="title">GetIterator</span><span class="params">()</span> <span class="type">const</span></span>;</span><br></pre></td></tr></table></figure><p>ä½†ä¹Ÿè¦é¿å…ç½—ç½—å—¦å—¦, æˆ–è€…å¯¹æ˜¾è€Œæ˜“è§çš„å†…å®¹è¿›è¡Œè¯´æ˜.ä¸‹é¢çš„æ³¨é‡Šå°±æ²¡æœ‰å¿…è¦åŠ ä¸Š â€œå¦åˆ™è¿”å› falseâ€, å› ä¸ºå·²ç»æš—å«å…¶ä¸­äº†:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Returns true if the table cannot hold any more entries.</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">IsTableFull</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><p>æ³¨é‡Šå‡½æ•°é‡è½½æ—¶, æ³¨é‡Šçš„é‡ç‚¹åº”è¯¥æ˜¯å‡½æ•°ä¸­è¢«é‡è½½çš„éƒ¨åˆ†,è€Œä¸æ˜¯ç®€å•çš„é‡å¤è¢«é‡è½½çš„å‡½æ•°çš„æ³¨é‡Š. å¤šæ•°æƒ…å†µä¸‹,å‡½æ•°é‡è½½ä¸éœ€è¦é¢å¤–çš„æ–‡æ¡£, å› æ­¤ä¹Ÿæ²¡æœ‰å¿…è¦åŠ ä¸Šæ³¨é‡Š.</p><p>æ³¨é‡Šæ„é€ /ææ„å‡½æ•°æ—¶, åˆ‡è®°è¯»ä»£ç çš„äººçŸ¥é“æ„é€ /ææ„å‡½æ•°çš„åŠŸèƒ½, æ‰€ä»¥â€œé”€æ¯è¿™ä¸€å¯¹è±¡â€ è¿™æ ·çš„æ³¨é‡Šæ˜¯æ²¡æœ‰æ„ä¹‰çš„.ä½ åº”å½“æ³¨æ˜çš„æ˜¯æ³¨æ˜æ„é€ å‡½æ•°å¯¹å‚æ•°åšäº†ä»€ä¹ˆ (ä¾‹å¦‚, æ˜¯å¦å–å¾—æŒ‡é’ˆæ‰€æœ‰æƒ)ä»¥åŠææ„å‡½æ•°æ¸…ç†äº†ä»€ä¹ˆ. å¦‚æœéƒ½æ˜¯äº›æ— å…³ç´§è¦çš„å†…å®¹, ç›´æ¥çœæ‰æ³¨é‡Š.ææ„å‡½æ•°å‰æ²¡æœ‰æ³¨é‡Šæ˜¯å¾ˆæ­£å¸¸çš„.</p><h6 id="å‡½æ•°å®šä¹‰">å‡½æ•°å®šä¹‰</h6><p>å¦‚æœå‡½æ•°çš„å®ç°è¿‡ç¨‹ä¸­ç”¨åˆ°äº†å¾ˆå·§å¦™çš„æ–¹å¼,é‚£ä¹ˆåœ¨å‡½æ•°å®šä¹‰å¤„åº”å½“åŠ ä¸Šè§£é‡Šæ€§çš„æ³¨é‡Š. ä¾‹å¦‚, ä½ æ‰€ä½¿ç”¨çš„ç¼–ç¨‹æŠ€å·§,å®ç°çš„å¤§è‡´æ­¥éª¤, æˆ–è§£é‡Šå¦‚æ­¤å®ç°çš„ç†ç”±. ä¸¾ä¸ªä¾‹å­,ä½ å¯ä»¥è¯´æ˜ä¸ºä»€ä¹ˆå‡½æ•°çš„å‰åŠéƒ¨åˆ†è¦åŠ é”è€ŒååŠéƒ¨åˆ†ä¸éœ€è¦.</p><p><em>ä¸è¦</em> ä» <code>.h</code>æ–‡ä»¶æˆ–å…¶ä»–åœ°æ–¹çš„å‡½æ•°å£°æ˜å¤„ç›´æ¥å¤åˆ¶æ³¨é‡Š. ç®€è¦é‡è¿°å‡½æ•°åŠŸèƒ½æ˜¯å¯ä»¥çš„,ä½†æ³¨é‡Šé‡ç‚¹è¦æ”¾åœ¨å¦‚ä½•å®ç°ä¸Š.</p><h3 id="å˜é‡æ³¨é‡Š">8.5. å˜é‡æ³¨é‡Š</h3><p><strong>æ€»è¿°</strong></p><p>é€šå¸¸å˜é‡åæœ¬èº«è¶³ä»¥å¾ˆå¥½è¯´æ˜å˜é‡ç”¨é€”. æŸäº›æƒ…å†µä¸‹,ä¹Ÿéœ€è¦é¢å¤–çš„æ³¨é‡Šè¯´æ˜.</p><p><strong>è¯´æ˜</strong></p><h6 id="ç±»æ•°æ®æˆå‘˜-1">ç±»æ•°æ®æˆå‘˜</h6><p>æ¯ä¸ªç±»æ•°æ®æˆå‘˜ (ä¹Ÿå«å®ä¾‹å˜é‡æˆ–æˆå‘˜å˜é‡) éƒ½åº”è¯¥ç”¨æ³¨é‡Šè¯´æ˜ç”¨é€”.å¦‚æœæœ‰éå˜é‡çš„å‚æ•°(ä¾‹å¦‚ç‰¹æ®Šå€¼, æ•°æ®æˆå‘˜ä¹‹é—´çš„å…³ç³»,ç”Ÿå‘½å‘¨æœŸç­‰)ä¸èƒ½å¤Ÿç”¨ç±»å‹ä¸å˜é‡åæ˜ç¡®è¡¨è¾¾, åˆ™åº”å½“åŠ ä¸Šæ³¨é‡Š. ç„¶è€Œ,å¦‚æœå˜é‡ç±»å‹ä¸å˜é‡åå·²ç»è¶³ä»¥æè¿°ä¸€ä¸ªå˜é‡, é‚£ä¹ˆå°±ä¸å†éœ€è¦åŠ ä¸Šæ³¨é‡Š.</p><p>ç‰¹åˆ«åœ°, å¦‚æœå˜é‡å¯ä»¥æ¥å— <code>NULL</code> æˆ– <code>-1</code>ç­‰è­¦æˆ’å€¼, é¡»åŠ ä»¥è¯´æ˜. æ¯”å¦‚:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span>:</span><br><span class="line"> <span class="comment">// Used to bounds-check table accesses. -1 means</span></span><br><span class="line"> <span class="comment">// that we don&#x27;t yet know how many entries the table has.</span></span><br><span class="line"> <span class="type">int</span> num_total_entries_;</span><br></pre></td></tr></table></figure><h6 id="å…¨å±€å˜é‡">å…¨å±€å˜é‡</h6><p>å’Œæ•°æ®æˆå‘˜ä¸€æ ·, æ‰€æœ‰å…¨å±€å˜é‡ä¹Ÿè¦æ³¨é‡Šè¯´æ˜å«ä¹‰åŠç”¨é€”,ä»¥åŠä½œä¸ºå…¨å±€å˜é‡çš„åŸå› . æ¯”å¦‚:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The total number of tests cases that we run through in this regression test.</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> kNumTestCases = <span class="number">6</span>;</span><br></pre></td></tr></table></figure><h3 id="å®ç°æ³¨é‡Š">8.6. å®ç°æ³¨é‡Š</h3><p><strong>æ€»è¿°</strong></p><p>å¯¹äºä»£ç ä¸­å·§å¦™çš„, æ™¦æ¶©çš„, æœ‰è¶£çš„, é‡è¦çš„åœ°æ–¹åŠ ä»¥æ³¨é‡Š.</p><p><strong>è¯´æ˜</strong></p><h6 id="ä»£ç å‰æ³¨é‡Š">ä»£ç å‰æ³¨é‡Š</h6><p>å·§å¦™æˆ–å¤æ‚çš„ä»£ç æ®µå‰è¦åŠ æ³¨é‡Š. æ¯”å¦‚:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Divide result by two, taking into account that x</span></span><br><span class="line"><span class="comment">// contains the carry from the add.</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; result-&gt;<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">  x = (x &lt;&lt; <span class="number">8</span>) + (*result)[i];</span><br><span class="line">  (*result)[i] = x &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  x &amp;= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="è¡Œæ³¨é‡Š">è¡Œæ³¨é‡Š</h6><p>æ¯”è¾ƒéšæ™¦çš„åœ°æ–¹è¦åœ¨è¡Œå°¾åŠ å…¥æ³¨é‡Š. åœ¨è¡Œå°¾ç©ºä¸¤æ ¼è¿›è¡Œæ³¨é‡Š. æ¯”å¦‚:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// If we have enough memory, mmap the data portion too.</span></span><br><span class="line">mmap_budget = <span class="built_in">max</span>&lt;int64&gt;(<span class="number">0</span>, mmap_budget - index_-&gt;<span class="built_in">length</span>());</span><br><span class="line"><span class="keyword">if</span> (mmap_budget &gt;= data_size_ &amp;&amp; !<span class="built_in">MmapData</span>(mmap_chunk_bytes, mlock))</span><br><span class="line">  <span class="keyword">return</span>;  <span class="comment">// Error already logged.</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„, è¿™é‡Œç”¨äº†ä¸¤æ®µæ³¨é‡Šåˆ†åˆ«æè¿°è¿™æ®µä»£ç çš„ä½œç”¨,å’Œæç¤ºå‡½æ•°è¿”å›æ—¶é”™è¯¯å·²ç»è¢«è®°å…¥æ—¥å¿—.</p><p>å¦‚æœä½ éœ€è¦è¿ç»­è¿›è¡Œå¤šè¡Œæ³¨é‡Š, å¯ä»¥ä½¿ä¹‹å¯¹é½è·å¾—æ›´å¥½çš„å¯è¯»æ€§:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">DoSomething</span>();                  <span class="comment">// Comment here so the comments line up.</span></span><br><span class="line"><span class="built_in">DoSomethingElseThatIsLonger</span>();  <span class="comment">// Two spaces between the code and the comment.</span></span><br><span class="line">&#123; <span class="comment">// One space before comment when opening a new scope is allowed,</span></span><br><span class="line">  <span class="comment">// thus the comment lines up with the following comments and code.</span></span><br><span class="line">  <span class="built_in">DoSomethingElse</span>();  <span class="comment">// Two spaces before line comments normally.</span></span><br><span class="line">&#125;</span><br><span class="line">std::vector&lt;string&gt; list&#123;</span><br><span class="line">                    <span class="comment">// Comments in braced lists describe the next element...</span></span><br><span class="line">                    <span class="string">&quot;First item&quot;</span>,</span><br><span class="line">                    <span class="comment">// .. and should be aligned appropriately.</span></span><br><span class="line"><span class="string">&quot;Second item&quot;</span>&#125;;</span><br><span class="line"><span class="built_in">DoSomething</span>(); <span class="comment">/* For trailing block comments, one space is fine. */</span></span><br></pre></td></tr></table></figure><h6 id="å‡½æ•°å‚æ•°æ³¨é‡Š">å‡½æ•°å‚æ•°æ³¨é‡Š</h6><p>å¦‚æœå‡½æ•°å‚æ•°çš„æ„ä¹‰ä¸æ˜æ˜¾, è€ƒè™‘ç”¨ä¸‹é¢çš„æ–¹å¼è¿›è¡Œå¼¥è¡¥:</p><ul><li>å¦‚æœå‚æ•°æ˜¯ä¸€ä¸ªå­—é¢å¸¸é‡, å¹¶ä¸”è¿™ä¸€å¸¸é‡åœ¨å¤šå¤„å‡½æ•°è°ƒç”¨ä¸­è¢«ä½¿ç”¨,ç”¨ä»¥æ¨æ–­å®ƒä»¬ä¸€è‡´, ä½ åº”å½“ç”¨ä¸€ä¸ªå¸¸é‡åè®©è¿™ä¸€çº¦å®šå˜å¾—æ›´æ˜æ˜¾,å¹¶ä¸”ä¿è¯è¿™ä¸€çº¦å®šä¸ä¼šè¢«æ‰“ç ´.</li><li>è€ƒè™‘æ›´æ”¹å‡½æ•°çš„ç­¾å, è®©æŸä¸ª <code>bool</code> ç±»å‹çš„å‚æ•°å˜ä¸º<code>enum</code> ç±»å‹, è¿™æ ·å¯ä»¥è®©è¿™ä¸ªå‚æ•°çš„å€¼è¡¨è¾¾å…¶æ„ä¹‰.</li><li>å¦‚æœæŸä¸ªå‡½æ•°æœ‰å¤šä¸ªé…ç½®é€‰é¡¹,ä½ å¯ä»¥è€ƒè™‘å®šä¹‰ä¸€ä¸ªç±»æˆ–ç»“æ„ä½“ä»¥ä¿å­˜æ‰€æœ‰çš„é€‰é¡¹, å¹¶ä¼ å…¥ç±»æˆ–ç»“æ„ä½“çš„å®ä¾‹.è¿™æ ·çš„æ–¹æ³•æœ‰è®¸å¤šä¼˜ç‚¹, ä¾‹å¦‚è¿™æ ·çš„é€‰é¡¹å¯ä»¥åœ¨è°ƒç”¨å¤„ç”¨å˜é‡åå¼•ç”¨,è¿™æ ·å°±èƒ½æ¸…æ™°åœ°è¡¨æ˜å…¶æ„ä¹‰. åŒæ—¶ä¹Ÿå‡å°‘äº†å‡½æ•°å‚æ•°çš„æ•°é‡,ä½¿å¾—å‡½æ•°è°ƒç”¨æ›´æ˜“è¯»ä¹Ÿæ˜“å†™. é™¤æ­¤ä¹‹å¤–, ä»¥è¿™æ ·çš„æ–¹å¼, å¦‚æœä½ ä½¿ç”¨å…¶ä»–çš„é€‰é¡¹,å°±æ— éœ€å¯¹è°ƒç”¨ç‚¹è¿›è¡Œæ›´æ”¹.</li><li>ç”¨å…·åå˜é‡ä»£æ›¿å¤§æ®µè€Œå¤æ‚çš„åµŒå¥—è¡¨è¾¾å¼.</li><li>ä¸‡ä¸å¾—å·²æ—¶, æ‰è€ƒè™‘åœ¨è°ƒç”¨ç‚¹ç”¨æ³¨é‡Šé˜æ˜å‚æ•°çš„æ„ä¹‰.</li></ul><p>æ¯”å¦‚ä¸‹é¢çš„ç¤ºä¾‹çš„å¯¹æ¯”:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// What are these arguments?</span></span><br><span class="line"><span class="type">const</span> DecimalNumber product = <span class="built_in">CalculateProduct</span>(values, <span class="number">7</span>, <span class="literal">false</span>, <span class="literal">nullptr</span>);</span><br></pre></td></tr></table></figure><p>å’Œ</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ProductOptions options;</span><br><span class="line">options.<span class="built_in">set_precision_decimals</span>(<span class="number">7</span>);</span><br><span class="line">options.<span class="built_in">set_use_cache</span>(ProductOptions::kDontUseCache);</span><br><span class="line"><span class="type">const</span> DecimalNumber product =</span><br><span class="line">    <span class="built_in">CalculateProduct</span>(values, options, <span class="comment">/*completion_callback=*/</span><span class="literal">nullptr</span>);</span><br></pre></td></tr></table></figure><p>å“ªä¸ªæ›´æ¸…æ™°ä¸€ç›®äº†ç„¶.</p><h6 id="ä¸å…è®¸çš„è¡Œä¸º">ä¸å…è®¸çš„è¡Œä¸º</h6><p>ä¸è¦æè¿°æ˜¾è€Œæ˜“è§çš„ç°è±¡, <em>æ°¸è¿œä¸è¦</em> ç”¨è‡ªç„¶è¯­è¨€ç¿»è¯‘ä»£ç ä½œä¸ºæ³¨é‡Š,é™¤éå³ä½¿å¯¹æ·±å…¥ç†è§£ C++ çš„è¯»è€…æ¥è¯´ä»£ç çš„è¡Œä¸ºéƒ½æ˜¯ä¸æ˜æ˜¾çš„.è¦å‡è®¾è¯»ä»£ç çš„äºº C++ æ°´å¹³æ¯”ä½ é«˜, å³ä¾¿ä»–/å¥¹å¯èƒ½ä¸çŸ¥é“ä½ çš„ç”¨æ„:</p><p>ä½ æ‰€æä¾›çš„æ³¨é‡Šåº”å½“è§£é‡Šä»£ç  <em>ä¸ºä»€ä¹ˆ</em> è¦è¿™ä¹ˆåšå’Œä»£ç çš„ç›®çš„,æˆ–è€…æœ€å¥½æ˜¯è®©ä»£ç è‡ªæ–‡æ¡£åŒ–.</p><p>æ¯”è¾ƒè¿™æ ·çš„æ³¨é‡Š:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Find the element in the vector.  &lt;-- å·®: è¿™å¤ªæ˜æ˜¾äº†!</span></span><br><span class="line"><span class="keyword">auto</span> iter = std::<span class="built_in">find</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), element);</span><br><span class="line"><span class="keyword">if</span> (iter != v.<span class="built_in">end</span>()) &#123;</span><br><span class="line">  <span class="built_in">Process</span>(element);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å’Œè¿™æ ·çš„æ³¨é‡Š:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Process &quot;element&quot; unless it was already processed.</span></span><br><span class="line"><span class="keyword">auto</span> iter = std::<span class="built_in">find</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), element);</span><br><span class="line"><span class="keyword">if</span> (iter != v.<span class="built_in">end</span>()) &#123;</span><br><span class="line">  <span class="built_in">Process</span>(element);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªæ–‡æ¡£åŒ–çš„ä»£ç æ ¹æœ¬å°±ä¸éœ€è¦æ³¨é‡Š.ä¸Šé¢ä¾‹å­ä¸­çš„æ³¨é‡Šå¯¹ä¸‹é¢çš„ä»£ç æ¥è¯´å°±æ˜¯æ¯«æ— å¿…è¦çš„:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="built_in">IsAlreadyProcessed</span>(element)) &#123;</span><br><span class="line">  <span class="built_in">Process</span>(element);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ ‡ç‚¹-æ‹¼å†™å’Œè¯­æ³•">8.7. æ ‡ç‚¹, æ‹¼å†™å’Œè¯­æ³•</h3><p><strong>æ€»è¿°</strong></p><p>æ³¨æ„æ ‡ç‚¹, æ‹¼å†™å’Œè¯­æ³•; å†™çš„å¥½çš„æ³¨é‡Šæ¯”å·®çš„è¦æ˜“è¯»çš„å¤š.</p><p><strong>è¯´æ˜</strong></p><p>æ³¨é‡Šçš„é€šå¸¸å†™æ³•æ˜¯åŒ…å«æ­£ç¡®å¤§å°å†™å’Œç»“å°¾å¥å·çš„å®Œæ•´å™è¿°æ€§è¯­å¥.å¤§å¤šæ•°æƒ…å†µä¸‹, å®Œæ•´çš„å¥å­æ¯”å¥å­ç‰‡æ®µå¯è¯»æ€§æ›´é«˜. çŸ­ä¸€ç‚¹çš„æ³¨é‡Š,æ¯”å¦‚ä»£ç è¡Œå°¾æ³¨é‡Š, å¯ä»¥éšæ„ç‚¹, ä½†ä¾ç„¶è¦æ³¨æ„é£æ ¼çš„ä¸€è‡´æ€§.</p><p>è™½ç„¶è¢«åˆ«äººæŒ‡å‡ºè¯¥ç”¨åˆ†å·æ—¶å´ç”¨äº†é€—å·å¤šå°‘æœ‰äº›å°´å°¬,ä½†æ¸…æ™°æ˜“è¯»çš„ä»£ç è¿˜æ˜¯å¾ˆé‡è¦çš„. æ­£ç¡®çš„æ ‡ç‚¹,æ‹¼å†™å’Œè¯­æ³•å¯¹æ­¤ä¼šæœ‰å¾ˆå¤§å¸®åŠ©.</p><h3 id="todo-æ³¨é‡Š">8.8. TODO æ³¨é‡Š</h3><p><strong>æ€»è¿°</strong></p><p>å¯¹é‚£äº›ä¸´æ—¶çš„, çŸ­æœŸçš„è§£å†³æ–¹æ¡ˆ, æˆ–å·²ç»å¤Ÿå¥½ä½†ä»ä¸å®Œç¾çš„ä»£ç ä½¿ç”¨<code>TODO</code> æ³¨é‡Š.</p><p><code>TODO</code> æ³¨é‡Šè¦ä½¿ç”¨å…¨å¤§å†™çš„å­—ç¬¦ä¸² <code>TODO</code>,åœ¨éšåçš„åœ†æ‹¬å·é‡Œå†™ä¸Šä½ çš„åå­—, é‚®ä»¶åœ°å€, bug ID, æˆ–å…¶å®ƒèº«ä»½æ ‡è¯†å’Œä¸è¿™ä¸€<code>TODO</code> ç›¸å…³çš„ issue. ä¸»è¦ç›®çš„æ˜¯è®©æ·»åŠ æ³¨é‡Šçš„äºº(ä¹Ÿæ˜¯å¯ä»¥è¯·æ±‚æä¾›æ›´å¤šç»†èŠ‚çš„äºº) å¯æ ¹æ®è§„èŒƒçš„ <code>TODO</code>æ ¼å¼è¿›è¡ŒæŸ¥æ‰¾. æ·»åŠ  <code>TODO</code> æ³¨é‡Šå¹¶ä¸æ„å‘³ç€ä½ è¦è‡ªå·±æ¥ä¿®æ­£,å› æ­¤å½“ä½ åŠ ä¸Šå¸¦æœ‰å§“åçš„ <code>TODO</code> æ—¶, ä¸€èˆ¬éƒ½æ˜¯å†™ä¸Šè‡ªå·±çš„åå­—.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TODO(kl@gmail.com): Use a &quot;*&quot; here for concatenation operator.</span></span><br><span class="line"><span class="comment">// TODO(Zeke) change this to use relations.</span></span><br><span class="line"><span class="comment">// TODO(bug 12345): remove the &quot;Last visitors&quot; feature</span></span><br></pre></td></tr></table></figure><p>å¦‚æœåŠ  <code>TODO</code> æ˜¯ä¸ºäº†åœ¨ â€œå°†æ¥æŸä¸€å¤©åšæŸäº‹â€,å¯ä»¥é™„ä¸Šä¸€ä¸ªéå¸¸æ˜ç¡®çš„æ—¶é—´ â€œFix by November 2005â€), æˆ–è€…ä¸€ä¸ªæ˜ç¡®çš„äº‹é¡¹(â€œRemove this code when all clients can handle XML responses.â€).</p><h3 id="å¼ƒç”¨æ³¨é‡Š">8.9. å¼ƒç”¨æ³¨é‡Š</h3><p><strong>æ€»è¿°</strong></p><p>é€šè¿‡å¼ƒç”¨æ³¨é‡Šï¼ˆ<code>DEPRECATED</code>commentsï¼‰ä»¥æ ‡è®°æŸæ¥å£ç‚¹å·²å¼ƒç”¨.</p><p>æ‚¨å¯ä»¥å†™ä¸ŠåŒ…å«å…¨å¤§å†™çš„ <code>DEPRECATED</code> çš„æ³¨é‡Š,ä»¥æ ‡è®°æŸæ¥å£ä¸ºå¼ƒç”¨çŠ¶æ€. æ³¨é‡Šå¯ä»¥æ”¾åœ¨æ¥å£å£°æ˜å‰, æˆ–è€…åŒä¸€è¡Œ.</p><p>åœ¨ <code>DEPRECATED</code> ä¸€è¯å, åœ¨æ‹¬å·ä¸­ç•™ä¸‹æ‚¨çš„åå­—,é‚®ç®±åœ°å€ä»¥åŠå…¶ä»–èº«ä»½æ ‡è¯†.</p><p>å¼ƒç”¨æ³¨é‡Šåº”å½“åŒ…æ¶µç®€çŸ­è€Œæ¸…æ™°çš„æŒ‡å¼•, ä»¥å¸®åŠ©å…¶ä»–äººä¿®å¤å…¶è°ƒç”¨ç‚¹. åœ¨ C++ä¸­, ä½ å¯ä»¥å°†ä¸€ä¸ªå¼ƒç”¨å‡½æ•°æ”¹é€ æˆä¸€ä¸ªå†…è”å‡½æ•°, è¿™ä¸€å‡½æ•°å°†è°ƒç”¨æ–°çš„æ¥å£.</p><p>ä»…ä»…æ ‡è®°æ¥å£ä¸º <code>DEPRECATED</code> å¹¶ä¸ä¼šè®©å¤§å®¶ä¸çº¦è€ŒåŒåœ°å¼ƒç”¨,æ‚¨è¿˜å¾—äº²è‡ªä¸»åŠ¨ä¿®æ­£è°ƒç”¨ç‚¹ï¼ˆcallsitesï¼‰, æˆ–æ˜¯æ‰¾ä¸ªå¸®æ‰‹.</p><p>ä¿®æ­£å¥½çš„ä»£ç åº”è¯¥ä¸ä¼šå†æ¶‰åŠå¼ƒç”¨æ¥å£ç‚¹äº†, ç€å®æ”¹ç”¨æ–°æ¥å£ç‚¹.å¦‚æœæ‚¨ä¸çŸ¥ä»ä½•ä¸‹æ‰‹, å¯ä»¥æ‰¾æ ‡è®°å¼ƒç”¨æ³¨é‡Šçš„å½“äº‹äººä¸€èµ·å•†é‡.</p><h3 id="è¯‘è€…-yulefox-ç¬”è®°-3">è¯‘è€… (YuleFox) ç¬”è®°</h3><ol type="1"><li>å…³äºæ³¨é‡Šé£æ ¼, å¾ˆå¤š C++ çš„ coders æ›´å–œæ¬¢è¡Œæ³¨é‡Š, C codersæˆ–è®¸å¯¹å—æ³¨é‡Šä¾ç„¶æƒ…æœ‰ç‹¬é’Ÿ, æˆ–è€…åœ¨æ–‡ä»¶å¤´å¤§æ®µå¤§æ®µçš„æ³¨é‡Šæ—¶ä½¿ç”¨å—æ³¨é‡Š;</li><li>æ–‡ä»¶æ³¨é‡Šå¯ä»¥ç‚«è€€ä½ çš„æˆå°±, ä¹Ÿæ˜¯ä¸ºäº†æ…äº†ç¯“å­åˆ«äººå¯ä»¥æ‰¾ä½ ;</li><li>æ³¨é‡Šè¦è¨€ç®€æ„èµ…, ä¸è¦æ‹–æ²“å†—ä½™,å¤æ‚çš„ä¸œè¥¿ç®€å•åŒ–å’Œç®€å•çš„ä¸œè¥¿å¤æ‚åŒ–éƒ½æ˜¯è¦è¢«é„™è§†çš„;</li><li>å¯¹äº Chinese coders æ¥è¯´, ç”¨è‹±æ–‡æ³¨é‡Šè¿˜æ˜¯ç”¨ä¸­æ–‡æ³¨é‡Š, it is a problem,ä½†ä¸ç®¡æ€æ ·, æ³¨é‡Šæ˜¯ä¸ºäº†è®©åˆ«äººçœ‹æ‡‚,éš¾é“æ˜¯ä¸ºäº†ç‚«è€€ç¼–ç¨‹è¯­è¨€ä¹‹å¤–çš„ä½ çš„æ¯è¯­æˆ–å¤–è¯­æ°´å¹³å—ï¼›</li><li>æ³¨é‡Šä¸è¦å¤ªä¹±, é€‚å½“çš„ç¼©è¿›æ‰ä¼šè®©äººä¹æ„çœ‹.ä½†ä¹Ÿæ²¡æœ‰å¿…è¦è§„å®šæ³¨é‡Šä»ç¬¬å‡ åˆ—å¼€å§‹ (æˆ‘è‡ªå·±å†™ä»£ç çš„æ—¶å€™æ€»å–œæ¬¢è¿™æ ·),UNIX/LINUX ä¸‹è¿˜å¯ä»¥çº¦å®šæ˜¯ä½¿ç”¨ tab è¿˜æ˜¯ space, ä¸ªäººå€¾å‘äº space;</li><li>TODO å¾ˆä¸é”™, æœ‰æ—¶å€™,æ³¨é‡Šç¡®å®æ˜¯ä¸ºäº†æ ‡è®°ä¸€äº›æœªå®Œæˆçš„æˆ–å®Œæˆçš„ä¸å°½å¦‚äººæ„çš„åœ°æ–¹, è¿™æ ·ä¸€æœç´¢,å°±çŸ¥é“è¿˜æœ‰å“ªäº›æ´»è¦å¹², æ—¥å¿—éƒ½çœäº†.</li></ol></div><div class="story post-story"><h2 id="æ ¼å¼">9. æ ¼å¼</h2><p>æ¯ä¸ªäººéƒ½å¯èƒ½æœ‰è‡ªå·±çš„ä»£ç é£æ ¼å’Œæ ¼å¼,ä½†å¦‚æœä¸€ä¸ªé¡¹ç›®ä¸­çš„æ‰€æœ‰äººéƒ½éµå¾ªåŒä¸€é£æ ¼çš„è¯, è¿™ä¸ªé¡¹ç›®å°±èƒ½æ›´é¡ºåˆ©åœ°è¿›è¡Œ.æ¯ä¸ªäººæœªå¿…èƒ½åŒæ„ä¸‹è¿°çš„æ¯ä¸€å¤„æ ¼å¼è§„åˆ™,è€Œä¸”å…¶ä¸­çš„ä¸å°‘è§„åˆ™éœ€è¦ä¸€å®šæ—¶é—´çš„é€‚åº”,ä½†æ•´ä¸ªé¡¹ç›®æœä»ç»Ÿä¸€çš„ç¼–ç¨‹é£æ ¼æ˜¯å¾ˆé‡è¦çš„,åªæœ‰è¿™æ ·æ‰èƒ½è®©æ‰€æœ‰äººè½»æ¾åœ°é˜…è¯»å’Œç†è§£ä»£ç .</p><p>ä¸ºäº†å¸®åŠ©ä½ æ­£ç¡®çš„æ ¼å¼åŒ–ä»£ç , æˆ‘ä»¬å†™äº†ä¸€ä¸ª <ahref="https://raw.githubusercontent.com/google/styleguide/gh-pages/google-c-style.el">emacsé…ç½®æ–‡ä»¶</a>.</p><h3 id="è¡Œé•¿åº¦">9.1. è¡Œé•¿åº¦</h3><p><strong>æ€»è¿°</strong></p><p>æ¯ä¸€è¡Œä»£ç å­—ç¬¦æ•°ä¸è¶…è¿‡ 80.</p><p>æˆ‘ä»¬ä¹Ÿè®¤è¯†åˆ°è¿™æ¡è§„åˆ™æ˜¯æœ‰äº‰è®®çš„, ä½†å¾ˆå¤šå·²æœ‰ä»£ç éƒ½éµç…§è¿™ä¸€è§„åˆ™,å› æ­¤æˆ‘ä»¬æ„Ÿè§‰ä¸€è‡´æ€§æ›´é‡è¦.</p><p><strong>ä¼˜ç‚¹</strong></p><p>æå€¡è¯¥åŸåˆ™çš„äººè®¤ä¸ºå¼ºè¿«ä»–ä»¬è°ƒæ•´ç¼–è¾‘å™¨çª—å£å¤§å°æ˜¯å¾ˆé‡è›®çš„è¡Œä¸º.å¾ˆå¤šäººåŒæ—¶å¹¶æ’å¼€å‡ ä¸ªä»£ç çª—å£, æ ¹æœ¬æ²¡æœ‰å¤šä½™çš„ç©ºé—´æ‹‰ä¼¸çª—å£.å¤§å®¶éƒ½æŠŠçª—å£æœ€å¤§å°ºå¯¸åŠ ä»¥é™å®š, å¹¶ä¸” 80 åˆ—å®½æ˜¯ä¼ ç»Ÿæ ‡å‡†.é‚£ä¹ˆä¸ºä»€ä¹ˆè¦æ”¹å˜å‘¢?</p><p><strong>ç¼ºç‚¹</strong></p><p>åå¯¹è¯¥åŸåˆ™çš„äººåˆ™è®¤ä¸ºæ›´å®½çš„ä»£ç è¡Œæ›´æ˜“é˜…è¯». 80 åˆ—çš„é™åˆ¶æ˜¯ä¸Šä¸ªä¸–çºª 60å¹´ä»£çš„å¤§å‹æœºçš„å¤æ¿ç¼ºé™·; ç°ä»£è®¾å¤‡å…·æœ‰æ›´å®½çš„æ˜¾ç¤ºå±,å¯ä»¥å¾ˆè½»æ¾åœ°æ˜¾ç¤ºæ›´å¤šä»£ç .</p><p><strong>ç»“è®º</strong></p><p>80 ä¸ªå­—ç¬¦æ˜¯æœ€å¤§å€¼.</p><p>å¦‚æœæ— æ³•åœ¨ä¸ä¼¤å®³æ˜“è¯»æ€§çš„æ¡ä»¶ä¸‹è¿›è¡Œæ–­è¡Œ, é‚£ä¹ˆæ³¨é‡Šè¡Œå¯ä»¥è¶…è¿‡ 80 ä¸ªå­—ç¬¦,è¿™æ ·å¯ä»¥æ–¹ä¾¿å¤åˆ¶ç²˜è´´. ä¾‹å¦‚, å¸¦æœ‰å‘½ä»¤ç¤ºä¾‹æˆ– URL çš„è¡Œå¯ä»¥è¶…è¿‡ 80ä¸ªå­—ç¬¦.</p><p>åŒ…å«é•¿è·¯å¾„çš„ <code>#include</code> è¯­å¥å¯ä»¥è¶…å‡º80åˆ—.</p><p><ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/headers/##define-guard">å¤´æ–‡ä»¶ä¿æŠ¤</a>å¯ä»¥æ— è§†è¯¥åŸåˆ™.</p><h3 id="é-ascii-å­—ç¬¦">9.2. é ASCII å­—ç¬¦</h3><p><strong>æ€»è¿°</strong></p><p>å°½é‡ä¸ä½¿ç”¨é ASCII å­—ç¬¦, ä½¿ç”¨æ—¶å¿…é¡»ä½¿ç”¨ UTF-8 ç¼–ç .</p><p><strong>è¯´æ˜</strong></p><p>å³ä½¿æ˜¯è‹±æ–‡, ä¹Ÿä¸åº”å°†ç”¨æˆ·ç•Œé¢çš„æ–‡æœ¬ç¡¬ç¼–ç åˆ°æºä»£ç ä¸­, å› æ­¤é ASCIIå­—ç¬¦åº”å½“å¾ˆå°‘è¢«ç”¨åˆ°. ç‰¹æ®Šæƒ…å†µä¸‹å¯ä»¥é€‚å½“åŒ…å«æ­¤ç±»å­—ç¬¦. ä¾‹å¦‚,ä»£ç åˆ†æå¤–éƒ¨æ•°æ®æ–‡ä»¶æ—¶, å¯ä»¥é€‚å½“ç¡¬ç¼–ç æ•°æ®æ–‡ä»¶ä¸­ä½œä¸ºåˆ†éš”ç¬¦çš„é ASCIIå­—ç¬¦ä¸²; æ›´å¸¸è§çš„æ˜¯ (ä¸éœ€è¦æœ¬åœ°åŒ–çš„) å•å…ƒæµ‹è¯•ä»£ç å¯èƒ½åŒ…å«é ASCII å­—ç¬¦ä¸².æ­¤ç±»æƒ…å†µä¸‹, åº”ä½¿ç”¨ UTF-8 ç¼–ç , å› ä¸ºå¾ˆå¤šå·¥å…·éƒ½å¯ä»¥ç†è§£å’Œå¤„ç† UTF-8ç¼–ç .</p><p>åå…­è¿›åˆ¶ç¼–ç ä¹Ÿå¯ä»¥, èƒ½å¢å¼ºå¯è¯»æ€§çš„æƒ…å†µä¸‹å°¤å…¶é¼“åŠ± â€”â€” æ¯”å¦‚<code>"\xEF\xBB\xBF"</code>, æˆ–è€…æ›´ç®€æ´åœ°å†™ä½œ <code>u8"\uFEFF"</code>,åœ¨ Unicode ä¸­æ˜¯ <em>é›¶å®½åº¦ æ— é—´æ–­</em> çš„é—´éš”ç¬¦å·,å¦‚æœä¸ç”¨åå…­è¿›åˆ¶ç›´æ¥æ”¾åœ¨ UTF-8 æ ¼å¼çš„æºæ–‡ä»¶ä¸­, æ˜¯çœ‹ä¸åˆ°çš„.</p><p>(Yang.Y æ³¨: <code>"\xEF\xBB\xBF"</code> é€šå¸¸ç”¨ä½œ UTF-8 with BOMç¼–ç æ ‡è®°)</p><p>ä½¿ç”¨ <code>u8</code> å‰ç¼€æŠŠå¸¦ <code>uXXXX</code>è½¬ä¹‰åºåˆ—çš„å­—ç¬¦ä¸²å­—é¢å€¼ç¼–ç æˆ UTF-8. ä¸è¦ç”¨åœ¨æœ¬èº«å°±å¸¦ UTF-8å­—ç¬¦çš„å­—ç¬¦ä¸²å­—é¢å€¼ä¸Š, å› ä¸ºå¦‚æœç¼–è¯‘å™¨ä¸æŠŠæºä»£ç è¯†åˆ«æˆ UTF-8,è¾“å‡ºå°±ä¼šå‡ºé”™.</p><p>åˆ«ç”¨ C++11 çš„ <code>char16_t</code> å’Œ <code>char32_t</code>, å®ƒä»¬å’ŒUTF-8 æ–‡æœ¬æ²¡æœ‰å…³ç³», <code>wchar_t</code> åŒç†, é™¤éä½ å†™çš„ä»£ç è¦è°ƒç”¨Windows API, åè€…å¹¿æ³›ä½¿ç”¨äº† <code>wchar_t</code>.</p><h3 id="ç©ºæ ¼è¿˜æ˜¯åˆ¶è¡¨ä½">9.3. ç©ºæ ¼è¿˜æ˜¯åˆ¶è¡¨ä½</h3><p><strong>æ€»è¿°</strong></p><p>åªä½¿ç”¨ç©ºæ ¼, æ¯æ¬¡ç¼©è¿› 2 ä¸ªç©ºæ ¼.</p><p><strong>è¯´æ˜</strong></p><p>æˆ‘ä»¬ä½¿ç”¨ç©ºæ ¼ç¼©è¿›. ä¸è¦åœ¨ä»£ç ä¸­ä½¿ç”¨åˆ¶è¡¨ç¬¦.ä½ åº”è¯¥è®¾ç½®ç¼–è¾‘å™¨å°†åˆ¶è¡¨ç¬¦è½¬ä¸ºç©ºæ ¼.</p><h3 id="å‡½æ•°å£°æ˜ä¸å®šä¹‰">9.4. å‡½æ•°å£°æ˜ä¸å®šä¹‰</h3><p><strong>æ€»è¿°</strong></p><p>è¿”å›ç±»å‹å’Œå‡½æ•°ååœ¨åŒä¸€è¡Œ, å‚æ•°ä¹Ÿå°½é‡æ”¾åœ¨åŒä¸€è¡Œ,å¦‚æœæ”¾ä¸ä¸‹å°±å¯¹å½¢å‚åˆ†è¡Œ, åˆ†è¡Œæ–¹å¼ä¸ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/formatting/##function-calls">å‡½æ•°è°ƒç”¨</a>ä¸€è‡´.</p><p><strong>è¯´æ˜</strong></p><p>å‡½æ•°çœ‹ä¸Šå»åƒè¿™æ ·:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ReturnType <span class="title">ClassName::FunctionName</span><span class="params">(Type par_name1, Type par_name2)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">DoSomething</span>();</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœåŒä¸€è¡Œæ–‡æœ¬å¤ªå¤š, æ”¾ä¸ä¸‹æ‰€æœ‰å‚æ•°:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ReturnType <span class="title">ClassName::ReallyLongFunctionName</span><span class="params">(Type par_name1, Type par_name2,</span></span></span><br><span class="line"><span class="params"><span class="function">                                             Type par_name3)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">DoSomething</span>();</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”šè‡³è¿ç¬¬ä¸€ä¸ªå‚æ•°éƒ½æ”¾ä¸ä¸‹:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ReturnType <span class="title">LongClassName::ReallyReallyReallyLongFunctionName</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    Type par_name1,  <span class="comment">// 4 space indent</span></span></span></span><br><span class="line"><span class="params"><span class="function">    Type par_name2,</span></span></span><br><span class="line"><span class="params"><span class="function">    Type par_name3)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">DoSomething</span>();  <span class="comment">// 2 space indent</span></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ä»¥ä¸‹å‡ ç‚¹:</p><ul><li>ä½¿ç”¨å¥½çš„å‚æ•°å.</li><li>åªæœ‰åœ¨å‚æ•°æœªè¢«ä½¿ç”¨æˆ–è€…å…¶ç”¨é€”éå¸¸æ˜æ˜¾æ—¶, æ‰èƒ½çœç•¥å‚æ•°å.</li><li>å¦‚æœè¿”å›ç±»å‹å’Œå‡½æ•°ååœ¨ä¸€è¡Œæ”¾ä¸ä¸‹, åˆ†è¡Œ.</li><li>å¦‚æœè¿”å›ç±»å‹ä¸å‡½æ•°å£°æ˜æˆ–å®šä¹‰åˆ†è¡Œäº†, ä¸è¦ç¼©è¿›.</li><li>å·¦åœ†æ‹¬å·æ€»æ˜¯å’Œå‡½æ•°ååœ¨åŒä¸€è¡Œ.</li><li>å‡½æ•°åå’Œå·¦åœ†æ‹¬å·é—´æ°¸è¿œæ²¡æœ‰ç©ºæ ¼.</li><li>åœ†æ‹¬å·ä¸å‚æ•°é—´æ²¡æœ‰ç©ºæ ¼.</li><li>å·¦å¤§æ‹¬å·æ€»åœ¨æœ€åä¸€ä¸ªå‚æ•°åŒä¸€è¡Œçš„æœ«å°¾å¤„, ä¸å¦èµ·æ–°è¡Œ.</li><li>å³å¤§æ‹¬å·æ€»æ˜¯å•ç‹¬ä½äºå‡½æ•°æœ€åä¸€è¡Œ, æˆ–è€…ä¸å·¦å¤§æ‹¬å·åŒä¸€è¡Œ.</li><li>å³åœ†æ‹¬å·å’Œå·¦å¤§æ‹¬å·é—´æ€»æ˜¯æœ‰ä¸€ä¸ªç©ºæ ¼.</li><li>æ‰€æœ‰å½¢å‚åº”å°½å¯èƒ½å¯¹é½.</li><li>ç¼ºçœç¼©è¿›ä¸º 2 ä¸ªç©ºæ ¼.</li><li>æ¢è¡Œåçš„å‚æ•°ä¿æŒ 4 ä¸ªç©ºæ ¼çš„ç¼©è¿›.</li></ul><p>æœªè¢«ä½¿ç”¨çš„å‚æ•°, æˆ–è€…æ ¹æ®ä¸Šä¸‹æ–‡å¾ˆå®¹æ˜“çœ‹å‡ºå…¶ç”¨é€”çš„å‚æ•°,å¯ä»¥çœç•¥å‚æ•°å:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span> &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Foo</span>(Foo&amp;&amp;);</span><br><span class="line">  <span class="built_in">Foo</span>(<span class="type">const</span> Foo&amp;);</span><br><span class="line">  Foo&amp; <span class="keyword">operator</span>=(Foo&amp;&amp;);</span><br><span class="line">  Foo&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Foo&amp;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æœªè¢«ä½¿ç”¨çš„å‚æ•°å¦‚æœå…¶ç”¨é€”ä¸æ˜æ˜¾çš„è¯, åœ¨å‡½æ•°å®šä¹‰å¤„å°†å‚æ•°åæ³¨é‡Šèµ·æ¥:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Rotate</span><span class="params">(<span class="type">double</span> radians)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> : <span class="keyword">public</span> Shape &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Rotate</span><span class="params">(<span class="type">double</span> radians)</span> <span class="keyword">override</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Circle::Rotate</span><span class="params">(<span class="type">double</span> <span class="comment">/*radians*/</span>)</span> </span>&#123;&#125;</span><br><span class="line"><span class="comment">// å·® - å¦‚æœå°†æ¥æœ‰äººè¦å®ç°, å¾ˆéš¾çŒœå‡ºå˜é‡çš„ä½œç”¨.</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Circle::Rotate</span><span class="params">(<span class="type">double</span>)</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>å±æ€§, å’Œå±•å¼€ä¸ºå±æ€§çš„å®, å†™åœ¨å‡½æ•°å£°æ˜æˆ–å®šä¹‰çš„æœ€å‰é¢,å³è¿”å›ç±»å‹ä¹‹å‰:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">MUST_USE_RESULT <span class="type">bool</span> <span class="title">IsOK</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><h3 id="lambda-è¡¨è¾¾å¼-1">9.5. Lambda è¡¨è¾¾å¼</h3><p><strong>æ€»è¿°</strong></p><p>Lambda è¡¨è¾¾å¼å¯¹å½¢å‚å’Œå‡½æ•°ä½“çš„æ ¼å¼åŒ–å’Œå…¶ä»–å‡½æ•°ä¸€è‡´; æ•è·åˆ—è¡¨åŒç†,è¡¨é¡¹ç”¨é€—å·éš”å¼€.</p><p><strong>è¯´æ˜</strong></p><p>è‹¥ç”¨å¼•ç”¨æ•è·, åœ¨å˜é‡åå’Œ <code>&amp;</code> ä¹‹é—´ä¸ç•™ç©ºæ ¼.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> x = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">auto</span> add_to_x = [&amp;x](<span class="type">int</span> n) &#123; x += n; &#125;;</span><br></pre></td></tr></table></figure><p>çŸ­ lambda å°±å†™å¾—å’Œå†…è”å‡½æ•°ä¸€æ ·.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">std::set&lt;<span class="type">int</span>&gt; blacklist = &#123;<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; digits = &#123;<span class="number">3</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">1</span>&#125;;</span><br><span class="line">digits.<span class="built_in">erase</span>(std::<span class="built_in">remove_if</span>(digits.<span class="built_in">begin</span>(), digits.<span class="built_in">end</span>(), [&amp;blacklist](<span class="type">int</span> i) &#123;</span><br><span class="line">               <span class="keyword">return</span> blacklist.<span class="built_in">find</span>(i) != blacklist.<span class="built_in">end</span>();</span><br><span class="line">             &#125;),</span><br><span class="line">             digits.<span class="built_in">end</span>());</span><br></pre></td></tr></table></figure><h3 id="å‡½æ•°è°ƒç”¨">9.6. å‡½æ•°è°ƒç”¨</h3><p><strong>æ€»è¿°</strong></p><p>è¦ä¹ˆä¸€è¡Œå†™å®Œå‡½æ•°è°ƒç”¨, è¦ä¹ˆåœ¨åœ†æ‹¬å·é‡Œå¯¹å‚æ•°åˆ†è¡Œ,è¦ä¹ˆå‚æ•°å¦èµ·ä¸€è¡Œä¸”ç¼©è¿›å››æ ¼. å¦‚æœæ²¡æœ‰å…¶å®ƒé¡¾è™‘çš„è¯, å°½å¯èƒ½ç²¾ç®€è¡Œæ•°,æ¯”å¦‚æŠŠå¤šä¸ªå‚æ•°é€‚å½“åœ°æ”¾åœ¨åŒä¸€è¡Œé‡Œ.</p><p><strong>è¯´æ˜</strong></p><p>å‡½æ•°è°ƒç”¨éµå¾ªå¦‚ä¸‹å½¢å¼ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> retval = <span class="built_in">DoSomething</span>(argument1, argument2, argument3);</span><br></pre></td></tr></table></figure><p>å¦‚æœåŒä¸€è¡Œæ”¾ä¸ä¸‹, å¯æ–­ä¸ºå¤šè¡Œ, åé¢æ¯ä¸€è¡Œéƒ½å’Œç¬¬ä¸€ä¸ªå®å‚å¯¹é½,å·¦åœ†æ‹¬å·åå’Œå³åœ†æ‹¬å·å‰ä¸è¦ç•™ç©ºæ ¼ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> retval = <span class="built_in">DoSomething</span>(averyveryveryverylongargument1,</span><br><span class="line">                          argument2, argument3);</span><br></pre></td></tr></table></figure><p>å‚æ•°ä¹Ÿå¯ä»¥æ”¾åœ¨æ¬¡è¡Œ, ç¼©è¿›å››æ ¼ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (...) &#123;</span><br><span class="line">  ...</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">if</span> (...) &#123;</span><br><span class="line">    <span class="built_in">DoSomething</span>(</span><br><span class="line">        argument1, argument2,  <span class="comment">// 4 ç©ºæ ¼ç¼©è¿›</span></span><br><span class="line">        argument3, argument4);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>æŠŠå¤šä¸ªå‚æ•°æ”¾åœ¨åŒä¸€è¡Œä»¥å‡å°‘å‡½æ•°è°ƒç”¨æ‰€éœ€çš„è¡Œæ•°, é™¤éå½±å“åˆ°å¯è¯»æ€§.æœ‰äººè®¤ä¸ºæŠŠæ¯ä¸ªå‚æ•°éƒ½ç‹¬ç«‹æˆè¡Œ, ä¸ä»…æ›´å¥½è¯», è€Œä¸”æ–¹ä¾¿ç¼–è¾‘å‚æ•°. ä¸è¿‡,æ¯”èµ·æ‰€è°“çš„å‚æ•°ç¼–è¾‘, æˆ‘ä»¬æ›´çœ‹é‡å¯è¯»æ€§, ä¸”åè€…æ¯”è¾ƒå¥½åŠï¼š</p><p>å¦‚æœä¸€äº›å‚æ•°æœ¬èº«å°±æ˜¯ç•¥å¤æ‚çš„è¡¨è¾¾å¼, ä¸”é™ä½äº†å¯è¯»æ€§,é‚£ä¹ˆå¯ä»¥ç›´æ¥åˆ›å»ºä¸´æ—¶å˜é‡æè¿°è¯¥è¡¨è¾¾å¼, å¹¶ä¼ é€’ç»™å‡½æ•°ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> my_heuristic = scores[x] * y + bases[x];</span><br><span class="line"><span class="type">bool</span> retval = <span class="built_in">DoSomething</span>(my_heuristic, x, y, z);</span><br></pre></td></tr></table></figure><p>æˆ–è€…æ”¾ç€ä¸ç®¡, è¡¥å……ä¸Šæ³¨é‡Šï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> retval = <span class="built_in">DoSomething</span>(scores[x] * y + bases[x],  <span class="comment">// Score heuristic.</span></span><br><span class="line">                          x, y, z);</span><br></pre></td></tr></table></figure><p>å¦‚æœæŸå‚æ•°ç‹¬ç«‹æˆè¡Œ, å¯¹å¯è¯»æ€§æ›´æœ‰å¸®åŠ©çš„è¯, é‚£ä¹Ÿå¯ä»¥å¦‚æ­¤åš.å‚æ•°çš„æ ¼å¼å¤„ç†åº”å½“ä»¥å¯è¯»æ€§è€Œéå…¶ä»–ä½œä¸ºæœ€é‡è¦çš„åŸåˆ™.</p><p>æ­¤å¤–, å¦‚æœä¸€ç³»åˆ—å‚æ•°æœ¬èº«å°±æœ‰ä¸€å®šçš„ç»“æ„,å¯ä»¥é…Œæƒ…åœ°æŒ‰å…¶ç»“æ„æ¥å†³å®šå‚æ•°æ ¼å¼ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡ 3x3 çŸ©é˜µè½¬æ¢ widget.</span></span><br><span class="line">my_widget.<span class="built_in">Transform</span>(x1, x2, x3,</span><br><span class="line">                    y1, y2, y3,</span><br><span class="line">                    z1, z2, z3);</span><br></pre></td></tr></table></figure><h3 id="åˆ—è¡¨åˆå§‹åŒ–æ ¼å¼">9.7. åˆ—è¡¨åˆå§‹åŒ–æ ¼å¼</h3><p><strong>æ€»è¿°</strong></p><p>æ‚¨å¹³æ—¶æ€ä¹ˆæ ¼å¼åŒ–å‡½æ•°è°ƒç”¨, å°±æ€ä¹ˆæ ¼å¼åŒ– <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/others/##braced-initializer-list">åˆ—è¡¨åˆå§‹åŒ–</a>.</p><p><strong>è¯´æ˜</strong></p><p>å¦‚æœåˆ—è¡¨åˆå§‹åŒ–ä¼´éšç€åå­—, æ¯”å¦‚ç±»å‹æˆ–å˜é‡å,æ ¼å¼åŒ–æ—¶å°†å°†åå­—è§†ä½œå‡½æ•°è°ƒç”¨å, {} è§†ä½œå‡½æ•°è°ƒç”¨çš„æ‹¬å·. å¦‚æœæ²¡æœ‰åå­—,å°±è§†ä½œåå­—é•¿åº¦ä¸ºé›¶.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸€è¡Œåˆ—è¡¨åˆå§‹åŒ–ç¤ºèŒƒ.</span></span><br><span class="line"><span class="keyword">return</span> &#123;foo, bar&#125;;</span><br><span class="line"><span class="built_in">functioncall</span>(&#123;foo, bar&#125;);</span><br><span class="line">pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; p&#123;foo, bar&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“ä¸å¾—ä¸æ–­è¡Œæ—¶.</span></span><br><span class="line"><span class="built_in">SomeFunction</span>(</span><br><span class="line">    &#123;<span class="string">&quot;assume a zero-length name before &#123;&quot;</span>&#125;,  <span class="comment">// å‡è®¾åœ¨ &#123; å‰æœ‰é•¿åº¦ä¸ºé›¶çš„åå­—.</span></span><br><span class="line">    some_other_function_parameter);</span><br><span class="line">SomeType variable&#123;</span><br><span class="line">    some, other, values,</span><br><span class="line">    &#123;<span class="string">&quot;assume a zero-length name before &#123;&quot;</span>&#125;,  <span class="comment">// å‡è®¾åœ¨ &#123; å‰æœ‰é•¿åº¦ä¸ºé›¶çš„åå­—.</span></span><br><span class="line">    SomeOtherType&#123;</span><br><span class="line">        <span class="string">&quot;Very long string requiring the surrounding breaks.&quot;</span>,  <span class="comment">// éå¸¸é•¿çš„å­—ç¬¦ä¸², å‰åéƒ½éœ€è¦æ–­è¡Œ.</span></span><br><span class="line">        some, other values&#125;,</span><br><span class="line">    SomeOtherType&#123;<span class="string">&quot;Slightly shorter string&quot;</span>,  <span class="comment">// ç¨çŸ­çš„å­—ç¬¦ä¸².</span></span><br><span class="line">                  some, other, values&#125;&#125;;</span><br><span class="line">SomeType variable&#123;</span><br><span class="line">    <span class="string">&quot;This is too long to fit all in one line&quot;</span>&#125;;  <span class="comment">// å­—ç¬¦ä¸²è¿‡é•¿, å› æ­¤æ— æ³•æ”¾åœ¨åŒä¸€è¡Œ.</span></span><br><span class="line">MyType m = &#123;  <span class="comment">// æ³¨æ„äº†, æ‚¨å¯ä»¥åœ¨ &#123; å‰æ–­è¡Œ.</span></span><br><span class="line">    superlongvariablename1,</span><br><span class="line">    superlongvariablename2,</span><br><span class="line">    &#123;<span class="type">short</span>, interior, list&#125;,</span><br><span class="line">    &#123;interiorwrappinglist,</span><br><span class="line">     interiorwrappinglist2&#125;&#125;;</span><br></pre></td></tr></table></figure><h3 id="æ¡ä»¶è¯­å¥">9.8. æ¡ä»¶è¯­å¥</h3><p><strong>æ€»è¿°</strong></p><p>å€¾å‘äºä¸åœ¨åœ†æ‹¬å·å†…ä½¿ç”¨ç©ºæ ¼. å…³é”®å­— <code>if</code> å’Œ<code>else</code> å¦èµ·ä¸€è¡Œ.</p><p><strong>è¯´æ˜</strong></p><p>å¯¹åŸºæœ¬æ¡ä»¶è¯­å¥æœ‰ä¸¤ç§å¯ä»¥æ¥å—çš„æ ¼å¼. ä¸€ç§åœ¨åœ†æ‹¬å·å’Œæ¡ä»¶ä¹‹é—´æœ‰ç©ºæ ¼,å¦ä¸€ç§æ²¡æœ‰.</p><p>æœ€å¸¸è§çš„æ˜¯æ²¡æœ‰ç©ºæ ¼çš„æ ¼å¼. å“ªä¸€ç§éƒ½å¯ä»¥, æœ€é‡è¦çš„æ˜¯ <em>ä¿æŒä¸€è‡´</em>.å¦‚æœä½ æ˜¯åœ¨ä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶, å‚è€ƒå½“å‰å·²æœ‰æ ¼å¼. å¦‚æœæ˜¯å†™æ–°çš„ä»£ç ,å‚è€ƒç›®å½•ä¸‹æˆ–é¡¹ç›®ä¸­å…¶å®ƒæ–‡ä»¶. è¿˜åœ¨çŠ¹è±«çš„è¯, å°±ä¸è¦åŠ ç©ºæ ¼äº†.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (condition) &#123;  <span class="comment">// åœ†æ‹¬å·é‡Œæ²¡æœ‰ç©ºæ ¼.</span></span><br><span class="line">  ...  <span class="comment">// 2 ç©ºæ ¼ç¼©è¿›.</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (...) &#123;  <span class="comment">// else ä¸ if çš„å³æ‹¬å·åŒä¸€è¡Œ.</span></span><br><span class="line">  ...</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ æ›´å–œæ¬¢åœ¨åœ†æ‹¬å·å†…éƒ¨åŠ ç©ºæ ¼:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( condition ) &#123;  <span class="comment">// åœ†æ‹¬å·ä¸ç©ºæ ¼ç´§é‚» - ä¸å¸¸è§</span></span><br><span class="line">  ...  <span class="comment">// 2 ç©ºæ ¼ç¼©è¿›.</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;  <span class="comment">// else ä¸ if çš„å³æ‹¬å·åŒä¸€è¡Œ.</span></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„æ‰€æœ‰æƒ…å†µä¸‹ <code>if</code> å’Œå·¦åœ†æ‹¬å·é—´éƒ½æœ‰ä¸ªç©ºæ ¼.å³åœ†æ‹¬å·å’Œå·¦å¤§æ‹¬å·ä¹‹é—´ä¹Ÿè¦æœ‰ä¸ªç©ºæ ¼:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(condition)     <span class="comment">// å·® - IF åé¢æ²¡ç©ºæ ¼.</span></span><br><span class="line"><span class="keyword">if</span> (condition)&#123;   <span class="comment">// å·® - &#123; å‰é¢æ²¡ç©ºæ ¼.</span></span><br><span class="line"><span class="keyword">if</span>(condition)&#123;    <span class="comment">// å˜æœ¬åŠ å‰åœ°å·®.</span></span><br><span class="line"><span class="keyword">if</span> (condition) &#123;  <span class="comment">// å¥½ - IF å’Œ &#123; éƒ½ä¸ç©ºæ ¼ç´§é‚».</span></span><br></pre></td></tr></table></figure><p>å¦‚æœèƒ½å¢å¼ºå¯è¯»æ€§, ç®€çŸ­çš„æ¡ä»¶è¯­å¥å…è®¸å†™åœ¨åŒä¸€è¡Œ.åªæœ‰å½“è¯­å¥ç®€å•å¹¶ä¸”æ²¡æœ‰ä½¿ç”¨ <code>else</code> å­å¥æ—¶ä½¿ç”¨:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (x == kFoo) <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Foo</span>();</span><br><span class="line"><span class="keyword">if</span> (x == kBar) <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Bar</span>();</span><br></pre></td></tr></table></figure><p>å¦‚æœè¯­å¥æœ‰ <code>else</code> åˆ†æ”¯åˆ™ä¸å…è®¸:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸å…è®¸ - å½“æœ‰ ELSE åˆ†æ”¯æ—¶ IF å—å´å†™åœ¨åŒä¸€è¡Œ</span></span><br><span class="line"><span class="keyword">if</span> (x) <span class="built_in">DoThis</span>();</span><br><span class="line"><span class="keyword">else</span> <span class="built_in">DoThat</span>();</span><br></pre></td></tr></table></figure><p>é€šå¸¸, å•è¡Œè¯­å¥ä¸éœ€è¦ä½¿ç”¨å¤§æ‹¬å·, å¦‚æœä½ å–œæ¬¢ç”¨ä¹Ÿæ²¡é—®é¢˜;å¤æ‚çš„æ¡ä»¶æˆ–å¾ªç¯è¯­å¥ç”¨å¤§æ‹¬å·å¯è¯»æ€§ä¼šæ›´å¥½. ä¹Ÿæœ‰ä¸€äº›é¡¹ç›®è¦æ±‚<code>if</code> å¿…é¡»æ€»æ˜¯ä½¿ç”¨å¤§æ‹¬å·:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (condition)</span><br><span class="line">  <span class="built_in">DoSomething</span>();  <span class="comment">// 2 ç©ºæ ¼ç¼©è¿›.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (condition) &#123;</span><br><span class="line">  <span class="built_in">DoSomething</span>();  <span class="comment">// 2 ç©ºæ ¼ç¼©è¿›.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†å¦‚æœè¯­å¥ä¸­æŸä¸ª <code>if-else</code> åˆ†æ”¯ä½¿ç”¨äº†å¤§æ‹¬å·çš„è¯,å…¶å®ƒåˆ†æ”¯ä¹Ÿå¿…é¡»ä½¿ç”¨:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸å¯ä»¥è¿™æ ·å­ - IF æœ‰å¤§æ‹¬å· ELSE å´æ²¡æœ‰.</span></span><br><span class="line"><span class="keyword">if</span> (condition) &#123;</span><br><span class="line">  foo;</span><br><span class="line">&#125; <span class="keyword">else</span></span><br><span class="line">  bar;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸å¯ä»¥è¿™æ ·å­ - ELSE æœ‰å¤§æ‹¬å· IF å´æ²¡æœ‰.</span></span><br><span class="line"><span class="keyword">if</span> (condition)</span><br><span class="line">  foo;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">  bar;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åªè¦å…¶ä¸­ä¸€ä¸ªåˆ†æ”¯ç”¨äº†å¤§æ‹¬å·, ä¸¤ä¸ªåˆ†æ”¯éƒ½è¦ç”¨ä¸Šå¤§æ‹¬å·.</span></span><br><span class="line"><span class="keyword">if</span> (condition) &#123;</span><br><span class="line">  foo;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  bar;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¾ªç¯å’Œå¼€å…³é€‰æ‹©è¯­å¥">9.9. å¾ªç¯å’Œå¼€å…³é€‰æ‹©è¯­å¥</h3><p><strong>æ€»è¿°</strong></p><p><code>switch</code> è¯­å¥å¯ä»¥ä½¿ç”¨å¤§æ‹¬å·åˆ†æ®µ, ä»¥è¡¨æ˜ casesä¹‹é—´ä¸æ˜¯è¿åœ¨ä¸€èµ·çš„. åœ¨å•è¯­å¥å¾ªç¯é‡Œ, æ‹¬å·å¯ç”¨å¯ä¸ç”¨. ç©ºå¾ªç¯ä½“åº”ä½¿ç”¨<code>&#123;&#125;</code> æˆ– <code>continue</code>.</p><p><strong>è¯´æ˜</strong></p><p><code>switch</code> è¯­å¥ä¸­çš„ <code>case</code>å—å¯ä»¥ä½¿ç”¨å¤§æ‹¬å·ä¹Ÿå¯ä»¥ä¸ç”¨, å–å†³äºä½ çš„ä¸ªäººå–œå¥½. å¦‚æœç”¨çš„è¯,è¦æŒ‰ç…§ä¸‹æ–‡æ‰€è¿°çš„æ–¹æ³•.</p><p>å¦‚æœæœ‰ä¸æ»¡è¶³ <code>case</code> æ¡ä»¶çš„æšä¸¾å€¼, <code>switch</code>åº”è¯¥æ€»æ˜¯åŒ…å«ä¸€ä¸ª <code>default</code> åŒ¹é… (å¦‚æœæœ‰è¾“å…¥å€¼æ²¡æœ‰ caseå»å¤„ç†, ç¼–è¯‘å™¨å°†ç»™å‡º warning). å¦‚æœ <code>default</code>åº”è¯¥æ°¸è¿œæ‰§è¡Œä¸åˆ°, ç®€å•çš„åŠ æ¡ <code>assert</code>:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (var) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">0</span>: &#123;  <span class="comment">// 2 ç©ºæ ¼ç¼©è¿›</span></span><br><span class="line">    ...      <span class="comment">// 4 ç©ºæ ¼ç¼©è¿›</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">1</span>: &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">default</span>: &#123;</span><br><span class="line">    <span class="built_in">assert</span>(<span class="literal">false</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å•è¯­å¥å¾ªç¯é‡Œ, æ‹¬å·å¯ç”¨å¯ä¸ç”¨ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; kSomeNumber; ++i)</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;I love you\n&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; kSomeNumber; ++i) &#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;I take it back\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç©ºå¾ªç¯ä½“åº”ä½¿ç”¨ <code>&#123;&#125;</code> æˆ– <code>continue</code>,è€Œä¸æ˜¯ä¸€ä¸ªç®€å•çš„åˆ†å·.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (condition) &#123;</span><br><span class="line">  <span class="comment">// åå¤å¾ªç¯ç›´åˆ°æ¡ä»¶å¤±æ•ˆ.</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; kSomeNumber; ++i) &#123;&#125;  <span class="comment">// å¯ - ç©ºå¾ªç¯ä½“.</span></span><br><span class="line"><span class="keyword">while</span> (condition) <span class="keyword">continue</span>;  <span class="comment">// å¯ - contunue è¡¨æ˜æ²¡æœ‰é€»è¾‘.</span></span><br><span class="line"><span class="keyword">while</span> (condition);  <span class="comment">// å·® - çœ‹èµ·æ¥ä»…ä»…åªæ˜¯ while/loop çš„éƒ¨åˆ†ä¹‹ä¸€.</span></span><br></pre></td></tr></table></figure><h3 id="æŒ‡é’ˆå’Œå¼•ç”¨è¡¨è¾¾å¼">9.10. æŒ‡é’ˆå’Œå¼•ç”¨è¡¨è¾¾å¼</h3><p><strong>æ€»è¿°</strong></p><p>å¥ç‚¹æˆ–ç®­å¤´å‰åä¸è¦æœ‰ç©ºæ ¼. æŒ‡é’ˆ/åœ°å€æ“ä½œç¬¦ (<code>*, &amp;</code>)ä¹‹åä¸èƒ½æœ‰ç©ºæ ¼.</p><p><strong>è¯´æ˜</strong></p><p>ä¸‹é¢æ˜¯æŒ‡é’ˆå’Œå¼•ç”¨è¡¨è¾¾å¼çš„æ­£ç¡®ä½¿ç”¨èŒƒä¾‹:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x = *p;</span><br><span class="line">p = &amp;x;</span><br><span class="line">x = r.y;</span><br><span class="line">x = r-&gt;y;</span><br></pre></td></tr></table></figure><p>æ³¨æ„:</p><ul><li>åœ¨è®¿é—®æˆå‘˜æ—¶, å¥ç‚¹æˆ–ç®­å¤´å‰åæ²¡æœ‰ç©ºæ ¼.</li><li>æŒ‡é’ˆæ“ä½œç¬¦ <code>*</code> æˆ– <code>&amp;</code> åæ²¡æœ‰ç©ºæ ¼.</li></ul><p>åœ¨å£°æ˜æŒ‡é’ˆå˜é‡æˆ–å‚æ•°æ—¶, æ˜Ÿå·ä¸ç±»å‹æˆ–å˜é‡åç´§æŒ¨éƒ½å¯ä»¥:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¥½, ç©ºæ ¼å‰ç½®.</span></span><br><span class="line"><span class="type">char</span> *c;</span><br><span class="line"><span class="type">const</span> string &amp;str;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¥½, ç©ºæ ¼åç½®.</span></span><br><span class="line"><span class="type">char</span>* c;</span><br><span class="line"><span class="type">const</span> string&amp; str;</span><br><span class="line"><span class="type">int</span> x, *y;  <span class="comment">// ä¸å…è®¸ - åœ¨å¤šé‡å£°æ˜ä¸­ä¸èƒ½ä½¿ç”¨ &amp; æˆ– *</span></span><br><span class="line"><span class="type">char</span> * c;  <span class="comment">// å·® - * ä¸¤è¾¹éƒ½æœ‰ç©ºæ ¼</span></span><br><span class="line"><span class="type">const</span> string &amp; str;  <span class="comment">// å·® - &amp; ä¸¤è¾¹éƒ½æœ‰ç©ºæ ¼.</span></span><br></pre></td></tr></table></figure><p>åœ¨å•ä¸ªæ–‡ä»¶å†…è¦ä¿æŒé£æ ¼ä¸€è‡´, æ‰€ä»¥, å¦‚æœæ˜¯ä¿®æ”¹ç°æœ‰æ–‡ä»¶,è¦éµç…§è¯¥æ–‡ä»¶çš„é£æ ¼.</p><h3 id="å¸ƒå°”è¡¨è¾¾å¼">9.11. å¸ƒå°”è¡¨è¾¾å¼</h3><p><strong>æ€»è¿°</strong></p><p>å¦‚æœä¸€ä¸ªå¸ƒå°”è¡¨è¾¾å¼è¶…è¿‡ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/formatting/##line-length">æ ‡å‡†è¡Œå®½</a>,æ–­è¡Œæ–¹å¼è¦ç»Ÿä¸€ä¸€ä¸‹.</p><p><strong>è¯´æ˜</strong></p><p>ä¸‹ä¾‹ä¸­, é€»è¾‘ä¸ (<code>&amp;&amp;</code>) æ“ä½œç¬¦æ€»ä½äºè¡Œå°¾:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (this_one_thing &gt; this_other_thing &amp;&amp;</span><br><span class="line">    a_third_thing == a_fourth_thing &amp;&amp;</span><br><span class="line">    yet_another &amp;&amp; last_one) &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„, ä¸Šä¾‹çš„é€»è¾‘ä¸ (<code>&amp;&amp;</code>) æ“ä½œç¬¦å‡ä½äºè¡Œå°¾.è¿™ä¸ªæ ¼å¼åœ¨ Google é‡Œå¾ˆå¸¸è§, è™½ç„¶æŠŠæ‰€æœ‰æ“ä½œç¬¦æ”¾åœ¨å¼€å¤´ä¹Ÿå¯ä»¥.å¯ä»¥è€ƒè™‘é¢å¤–æ’å…¥åœ†æ‹¬å·, åˆç†ä½¿ç”¨çš„è¯å¯¹å¢å¼ºå¯è¯»æ€§æ˜¯å¾ˆæœ‰å¸®åŠ©çš„. æ­¤å¤–,ç›´æ¥ç”¨ç¬¦å·å½¢å¼çš„æ“ä½œç¬¦, æ¯”å¦‚ <code>&amp;&amp;</code> å’Œ <code>~</code>,ä¸è¦ç”¨è¯è¯­å½¢å¼çš„ <code>and</code> å’Œ <code>compl</code>.</p><h3 id="å‡½æ•°è¿”å›å€¼">9.12. å‡½æ•°è¿”å›å€¼</h3><p><strong>æ€»è¿°</strong></p><p>ä¸è¦åœ¨ <code>return</code> è¡¨è¾¾å¼é‡ŒåŠ ä¸Šéå¿…é¡»çš„åœ†æ‹¬å·.</p><p><strong>è¯´æ˜</strong></p><p>åªæœ‰åœ¨å†™ <code>x = expr</code> è¦åŠ ä¸Šæ‹¬å·çš„æ—¶å€™æ‰åœ¨<code>return expr;</code> é‡Œä½¿ç”¨æ‹¬å·.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> result;                  <span class="comment">// è¿”å›å€¼å¾ˆç®€å•, æ²¡æœ‰åœ†æ‹¬å·.</span></span><br><span class="line"><span class="comment">// å¯ä»¥ç”¨åœ†æ‹¬å·æŠŠå¤æ‚è¡¨è¾¾å¼åœˆèµ·æ¥, æ”¹å–„å¯è¯»æ€§.</span></span><br><span class="line"><span class="keyword">return</span> (some_long_condition &amp;&amp;</span><br><span class="line">        another_condition);</span><br><span class="line"><span class="keyword">return</span> (value);                <span class="comment">// æ¯•ç«Ÿæ‚¨ä»æ¥ä¸ä¼šå†™ var = (value);</span></span><br><span class="line"><span class="keyword">return</span>(result);                <span class="comment">// return å¯ä¸æ˜¯å‡½æ•°ï¼</span></span><br></pre></td></tr></table></figure><h3 id="å˜é‡åŠæ•°ç»„åˆå§‹åŒ–">9.13. å˜é‡åŠæ•°ç»„åˆå§‹åŒ–</h3><p><strong>æ€»è¿°</strong></p><p>ç”¨ <code>=</code>, <code>()</code> å’Œ <code>&#123;&#125;</code> å‡å¯.</p><p><strong>è¯´æ˜</strong></p><p>æ‚¨å¯ä»¥ç”¨ <code>=</code>, <code>()</code> å’Œ <code>&#123;&#125;</code>,ä»¥ä¸‹çš„ä¾‹å­éƒ½æ˜¯æ­£ç¡®çš„ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> x = <span class="number">3</span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">x</span><span class="params">(<span class="number">3</span>)</span></span>;</span><br><span class="line"><span class="type">int</span> x&#123;<span class="number">3</span>&#125;;</span><br><span class="line"><span class="function">string <span class="title">name</span><span class="params">(<span class="string">&quot;Some Name&quot;</span>)</span></span>;</span><br><span class="line">string name = <span class="string">&quot;Some Name&quot;</span>;</span><br><span class="line">string name&#123;<span class="string">&quot;Some Name&quot;</span>&#125;;</span><br></pre></td></tr></table></figure><p>è¯·åŠ¡å¿…å°å¿ƒåˆ—è¡¨åˆå§‹åŒ– <code>&#123;...&#125;</code> ç”¨<code>std::initializer_list</code> æ„é€ å‡½æ•°åˆå§‹åŒ–å‡ºçš„ç±»å‹.éç©ºåˆ—è¡¨åˆå§‹åŒ–å°±ä¼šä¼˜å…ˆè°ƒç”¨ <code>std::initializer_list</code>,ä¸è¿‡ç©ºåˆ—è¡¨åˆå§‹åŒ–é™¤å¤–, åè€…åŸåˆ™ä¸Šä¼šè°ƒç”¨é»˜è®¤æ„é€ å‡½æ•°. ä¸ºäº†å¼ºåˆ¶ç¦ç”¨<code>std::initializer_list</code> æ„é€ å‡½æ•°, è¯·æ”¹ç”¨æ‹¬å·.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">v</span><span class="params">(<span class="number">100</span>, <span class="number">1</span>)</span></span>;  <span class="comment">// å†…å®¹ä¸º 100 ä¸ª 1 çš„å‘é‡.</span></span><br><span class="line">vector&lt;<span class="type">int</span>&gt; v&#123;<span class="number">100</span>, <span class="number">1</span>&#125;;  <span class="comment">// å†…å®¹ä¸º 100 å’Œ 1 çš„å‘é‡.</span></span><br></pre></td></tr></table></figure><p>æ­¤å¤–, åˆ—è¡¨åˆå§‹åŒ–ä¸å…è®¸æ•´å‹ç±»å‹çš„å››èˆäº”å…¥,è¿™å¯ä»¥ç”¨æ¥é¿å…ä¸€äº›ç±»å‹ä¸Šçš„ç¼–ç¨‹å¤±è¯¯.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">pi</span><span class="params">(<span class="number">3.14</span>)</span></span>;  <span class="comment">// å¥½ - pi == 3.</span></span><br><span class="line"><span class="type">int</span> pi&#123;<span class="number">3.14</span>&#125;;  <span class="comment">// ç¼–è¯‘é”™è¯¯: ç¼©çª„è½¬æ¢.</span></span><br></pre></td></tr></table></figure><h3 id="é¢„å¤„ç†æŒ‡ä»¤">9.14. é¢„å¤„ç†æŒ‡ä»¤</h3><p><strong>æ€»è¿°</strong></p><p>é¢„å¤„ç†æŒ‡ä»¤ä¸è¦ç¼©è¿›, ä»è¡Œé¦–å¼€å§‹.</p><p><strong>è¯´æ˜</strong></p><p>å³ä½¿é¢„å¤„ç†æŒ‡ä»¤ä½äºç¼©è¿›ä»£ç å—ä¸­, æŒ‡ä»¤ä¹Ÿåº”ä»è¡Œé¦–å¼€å§‹.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¥½ - æŒ‡ä»¤ä»è¡Œé¦–å¼€å§‹</span></span><br><span class="line">  <span class="keyword">if</span> (lopsided_score) &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> DISASTER_PENDING      <span class="comment">// æ­£ç¡® - ä»è¡Œé¦–å¼€å§‹</span></span></span><br><span class="line">    <span class="built_in">DropEverything</span>();</span><br><span class="line">#<span class="meta"># <span class="keyword">if</span> NOTIFY               <span class="comment">// éå¿…è¦ - ## åè·Ÿç©ºæ ¼</span></span></span><br><span class="line">    <span class="built_in">NotifyClient</span>();</span><br><span class="line">#<span class="meta"># <span class="keyword">endif</span></span></span><br><span class="line">#<span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="built_in">BackToNormal</span>();</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// å·® - æŒ‡ä»¤ç¼©è¿›</span></span><br><span class="line">  <span class="keyword">if</span> (lopsided_score) &#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">if</span> DISASTER_PENDING  <span class="comment">// å·® - &quot;#if&quot; åº”è¯¥æ”¾åœ¨è¡Œå¼€å¤´</span></span></span><br><span class="line">    <span class="built_in">DropEverything</span>();</span><br><span class="line">    #<span class="meta">#<span class="keyword">endif</span>                <span class="comment">// å·® - &quot;##endif&quot; ä¸è¦ç¼©è¿›</span></span></span><br><span class="line">    <span class="built_in">BackToNormal</span>();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="ç±»æ ¼å¼">9.15. ç±»æ ¼å¼</h3><p><strong>æ€»è¿°</strong></p><p>è®¿é—®æ§åˆ¶å—çš„å£°æ˜ä¾æ¬¡åºæ˜¯ <code>public:</code>,<code>protected:</code>, <code>private:</code>, æ¯ä¸ªéƒ½ç¼©è¿› 1 ä¸ªç©ºæ ¼.</p><p><strong>è¯´æ˜</strong></p><p>ç±»å£°æ˜ (ä¸‹é¢çš„ä»£ç ä¸­ç¼ºå°‘æ³¨é‡Š, å‚è€ƒ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/comments/##class-comments">ç±»æ³¨é‡Š</a>)çš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> : <span class="keyword">public</span> OtherClass &#123;</span><br><span class="line"> <span class="keyword">public</span>:      <span class="comment">// æ³¨æ„æœ‰ä¸€ä¸ªç©ºæ ¼çš„ç¼©è¿›</span></span><br><span class="line">  <span class="built_in">MyClass</span>();  <span class="comment">// æ ‡å‡†çš„ä¸¤ç©ºæ ¼ç¼©è¿›</span></span><br><span class="line">  <span class="function"><span class="keyword">explicit</span> <span class="title">MyClass</span><span class="params">(<span class="type">int</span> var)</span></span>;</span><br><span class="line">  ~<span class="built_in">MyClass</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">SomeFunction</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">SomeFunctionThatDoesNothing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">set_some_var</span><span class="params">(<span class="type">int</span> var)</span> </span>&#123; some_var_ = var; &#125;</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">some_var</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> some_var_; &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  <span class="function"><span class="type">bool</span> <span class="title">SomeInternalFunction</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> some_var_;</span><br><span class="line">  <span class="type">int</span> some_other_var_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ³¨æ„äº‹é¡¹:</p><ul><li>æ‰€æœ‰åŸºç±»ååº”åœ¨ 80 åˆ—é™åˆ¶ä¸‹å°½é‡ä¸å­ç±»åæ”¾åœ¨åŒä¸€è¡Œ.</li><li>å…³é”®è¯ <code>public:</code>, <code>protected:</code>,<code>private:</code> è¦ç¼©è¿› 1 ä¸ªç©ºæ ¼.</li><li>é™¤ç¬¬ä¸€ä¸ªå…³é”®è¯ (ä¸€èˆ¬æ˜¯ <code>public</code>) å¤–,å…¶ä»–å…³é”®è¯å‰è¦ç©ºä¸€è¡Œ. å¦‚æœç±»æ¯”è¾ƒå°çš„è¯ä¹Ÿå¯ä»¥ä¸ç©º.</li><li>è¿™äº›å…³é”®è¯åä¸è¦ä¿ç•™ç©ºè¡Œ.</li><li><code>public</code> æ”¾åœ¨æœ€å‰é¢, ç„¶åæ˜¯ <code>protected</code>,æœ€åæ˜¯ <code>private</code>.</li><li>å…³äºå£°æ˜é¡ºåºçš„è§„åˆ™è¯·å‚è€ƒ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/classes/##declaration-order">å£°æ˜é¡ºåº</a>ä¸€èŠ‚.</li></ul><h3 id="æ„é€ å‡½æ•°åˆå§‹å€¼åˆ—è¡¨">9.16. æ„é€ å‡½æ•°åˆå§‹å€¼åˆ—è¡¨</h3><p><strong>æ€»è¿°</strong></p><p>æ„é€ å‡½æ•°åˆå§‹åŒ–åˆ—è¡¨æ”¾åœ¨åŒä¸€è¡Œæˆ–æŒ‰å››æ ¼ç¼©è¿›å¹¶æ’å¤šè¡Œ.</p><p><strong>è¯´æ˜</strong></p><p>ä¸‹é¢ä¸¤ç§åˆå§‹å€¼åˆ—è¡¨æ–¹å¼éƒ½å¯ä»¥æ¥å—:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœæ‰€æœ‰å˜é‡èƒ½æ”¾åœ¨åŒä¸€è¡Œ:</span></span><br><span class="line">MyClass::<span class="built_in">MyClass</span>(<span class="type">int</span> var) : <span class="built_in">some_var_</span>(var) &#123;</span><br><span class="line">  <span class="built_in">DoSomething</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœä¸èƒ½æ”¾åœ¨åŒä¸€è¡Œ,</span></span><br><span class="line"><span class="comment">// å¿…é¡»ç½®äºå†’å·å, å¹¶ç¼©è¿› 4 ä¸ªç©ºæ ¼</span></span><br><span class="line">MyClass::<span class="built_in">MyClass</span>(<span class="type">int</span> var)</span><br><span class="line">    : <span class="built_in">some_var_</span>(var), <span class="built_in">some_other_var_</span>(var + <span class="number">1</span>) &#123;</span><br><span class="line">  <span class="built_in">DoSomething</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœåˆå§‹åŒ–åˆ—è¡¨éœ€è¦ç½®äºå¤šè¡Œ, å°†æ¯ä¸€ä¸ªæˆå‘˜æ”¾åœ¨å•ç‹¬çš„ä¸€è¡Œ</span></span><br><span class="line"><span class="comment">// å¹¶é€è¡Œå¯¹é½</span></span><br><span class="line">MyClass::<span class="built_in">MyClass</span>(<span class="type">int</span> var)</span><br><span class="line">    : <span class="built_in">some_var_</span>(var),             <span class="comment">// 4 space indent</span></span><br><span class="line">      <span class="built_in">some_other_var_</span>(var + <span class="number">1</span>) &#123;  <span class="comment">// lined up</span></span><br><span class="line">  <span class="built_in">DoSomething</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å³å¤§æ‹¬å· &#125; å¯ä»¥å’Œå·¦å¤§æ‹¬å· &#123; æ”¾åœ¨åŒä¸€è¡Œ</span></span><br><span class="line"><span class="comment">// å¦‚æœè¿™æ ·åšåˆé€‚çš„è¯</span></span><br><span class="line">MyClass::<span class="built_in">MyClass</span>(<span class="type">int</span> var)</span><br><span class="line">    : <span class="built_in">some_var_</span>(var) &#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="å‘½åç©ºé—´æ ¼å¼åŒ–">9.17. å‘½åç©ºé—´æ ¼å¼åŒ–</h3><p><strong>æ€»è¿°</strong></p><p>å‘½åç©ºé—´å†…å®¹ä¸ç¼©è¿›.</p><p><strong>è¯´æ˜</strong></p><p><ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/scoping/##namespaces">å‘½åç©ºé—´</a>ä¸è¦å¢åŠ é¢å¤–çš„ç¼©è¿›å±‚æ¬¡, ä¾‹å¦‚:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;  <span class="comment">// æ­£ç¡®. å‘½åç©ºé—´å†…æ²¡æœ‰é¢å¤–çš„ç¼©è¿›.</span></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;  <span class="comment">// namespace</span></span><br></pre></td></tr></table></figure><p>ä¸è¦åœ¨å‘½åç©ºé—´å†…ç¼©è¿›:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é”™, ç¼©è¿›å¤šä½™äº†.</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;  <span class="comment">// namespace</span></span><br></pre></td></tr></table></figure><p>å£°æ˜åµŒå¥—å‘½åç©ºé—´æ—¶, æ¯ä¸ªå‘½åç©ºé—´éƒ½ç‹¬ç«‹æˆè¡Œ.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> foo &#123;</span><br><span class="line"><span class="keyword">namespace</span> bar &#123;</span><br></pre></td></tr></table></figure><h3 id="æ°´å¹³ç•™ç™½">9.19. æ°´å¹³ç•™ç™½</h3><p><strong>æ€»è¿°</strong></p><p>æ°´å¹³ç•™ç™½çš„ä½¿ç”¨æ ¹æ®åœ¨ä»£ç ä¸­çš„ä½ç½®å†³å®š.æ°¸è¿œä¸è¦åœ¨è¡Œå°¾æ·»åŠ æ²¡æ„ä¹‰çš„ç•™ç™½.</p><p><strong>è¯´æ˜</strong></p><h6 id="é€šç”¨">é€šç”¨</h6><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">(<span class="type">bool</span> b)</span> </span>&#123;  <span class="comment">// å·¦å¤§æ‹¬å·å‰æ€»æ˜¯æœ‰ç©ºæ ¼.</span></span><br><span class="line">  ...</span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;  <span class="comment">// åˆ†å·å‰ä¸åŠ ç©ºæ ¼.</span></span><br><span class="line"><span class="comment">// åˆ—è¡¨åˆå§‹åŒ–ä¸­å¤§æ‹¬å·å†…çš„ç©ºæ ¼æ˜¯å¯é€‰çš„.</span></span><br><span class="line"><span class="comment">// å¦‚æœåŠ äº†ç©ºæ ¼, é‚£ä¹ˆä¸¤è¾¹éƒ½è¦åŠ ä¸Š.</span></span><br><span class="line"><span class="type">int</span> x[] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"><span class="type">int</span> x[] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»§æ‰¿ä¸åˆå§‹åŒ–åˆ—è¡¨ä¸­çš„å†’å·å‰åæ’æœ‰ç©ºæ ¼.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span> : <span class="keyword">public</span> Bar &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="comment">// å¯¹äºå•è¡Œå‡½æ•°çš„å®ç°, åœ¨å¤§æ‹¬å·å†…åŠ ä¸Šç©ºæ ¼</span></span><br><span class="line">  <span class="comment">// ç„¶åæ˜¯å‡½æ•°å®ç°</span></span><br><span class="line">  <span class="built_in">Foo</span>(<span class="type">int</span> b) : <span class="built_in">Bar</span>(), <span class="built_in">baz_</span>(b) &#123;&#125;  <span class="comment">// å¤§æ‹¬å·é‡Œé¢æ˜¯ç©ºçš„è¯, ä¸åŠ ç©ºæ ¼.</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Reset</span><span class="params">()</span> </span>&#123; baz_ = <span class="number">0</span>; &#125;  <span class="comment">// ç”¨æ‹¬å·æŠŠå¤§æ‹¬å·ä¸å®ç°åˆ†å¼€.</span></span><br><span class="line">  ...</span><br></pre></td></tr></table></figure><p>æ·»åŠ å†—ä½™çš„ç•™ç™½ä¼šç»™å…¶ä»–äººç¼–è¾‘æ—¶é€ æˆé¢å¤–è´Ÿæ‹…. å› æ­¤, è¡Œå°¾ä¸è¦ç•™ç©ºæ ¼.å¦‚æœç¡®å®šä¸€è¡Œä»£ç å·²ç»ä¿®æ”¹å®Œæ¯•, å°†å¤šä½™çš„ç©ºæ ¼å»æ‰;æˆ–è€…åœ¨ä¸“é—¨æ¸…ç†ç©ºæ ¼æ—¶å»æ‰ï¼ˆå°¤å…¶æ˜¯åœ¨æ²¡æœ‰å…¶ä»–äººåœ¨å¤„ç†è¿™ä»¶äº‹çš„æ—¶å€™). (Yang.Yæ³¨: ç°åœ¨å¤§éƒ¨åˆ†ä»£ç ç¼–è¾‘å™¨ç¨åŠ è®¾ç½®å, éƒ½æ”¯æŒè‡ªåŠ¨åˆ é™¤è¡Œé¦–/è¡Œå°¾ç©ºæ ¼,å¦‚æœä¸æ”¯æŒ, è€ƒè™‘æ¢ä¸€æ¬¾ç¼–è¾‘å™¨æˆ– IDE)</p><h6 id="å¾ªç¯å’Œæ¡ä»¶è¯­å¥">å¾ªç¯å’Œæ¡ä»¶è¯­å¥</h6><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (b) &#123;          <span class="comment">// if æ¡ä»¶è¯­å¥å’Œå¾ªç¯è¯­å¥å…³é”®å­—åå‡æœ‰ç©ºæ ¼.</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;          <span class="comment">// else å‰åæœ‰ç©ºæ ¼.</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> (test) &#123;&#125;   <span class="comment">// åœ†æ‹¬å·å†…éƒ¨ä¸ç´§é‚»ç©ºæ ¼.</span></span><br><span class="line"><span class="keyword">switch</span> (i) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i) &#123;</span><br><span class="line"><span class="keyword">switch</span> ( i ) &#123;    <span class="comment">// å¾ªç¯å’Œæ¡ä»¶è¯­å¥çš„åœ†æ‹¬å·é‡Œå¯ä»¥ä¸ç©ºæ ¼ç´§é‚».</span></span><br><span class="line"><span class="keyword">if</span> ( test ) &#123;     <span class="comment">// åœ†æ‹¬å·, ä½†è¿™å¾ˆå°‘è§. æ€»ä¹‹è¦ä¸€è‡´.</span></span><br><span class="line"><span class="keyword">for</span> ( <span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i ) &#123;</span><br><span class="line"><span class="keyword">for</span> ( ; i &lt; <span class="number">5</span> ; ++i) &#123;  <span class="comment">// å¾ªç¯é‡Œå†… ; åæ’æœ‰ç©ºæ ¼, ;  å‰å¯ä»¥åŠ ä¸ªç©ºæ ¼.</span></span><br><span class="line"><span class="keyword">switch</span> (i) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">1</span>:         <span class="comment">// switch case çš„å†’å·å‰æ— ç©ºæ ¼.</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="keyword">case</span> <span class="number">2</span>: <span class="keyword">break</span>;  <span class="comment">// å¦‚æœå†’å·æœ‰ä»£ç , åŠ ä¸ªç©ºæ ¼.</span></span><br></pre></td></tr></table></figure><h6 id="æ“ä½œç¬¦">æ“ä½œç¬¦</h6><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// èµ‹å€¼è¿ç®—ç¬¦å‰åæ€»æ˜¯æœ‰ç©ºæ ¼.</span></span><br><span class="line">x = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¶å®ƒäºŒå…ƒæ“ä½œç¬¦ä¹Ÿå‰åæ’æœ‰ç©ºæ ¼, ä¸è¿‡å¯¹äºè¡¨è¾¾å¼çš„å­å¼å¯ä»¥ä¸åŠ ç©ºæ ¼.</span></span><br><span class="line"><span class="comment">// åœ†æ‹¬å·å†…éƒ¨æ²¡æœ‰ç´§é‚»ç©ºæ ¼.</span></span><br><span class="line">v = w * x + y / z;</span><br><span class="line">v = w*x + y/z;</span><br><span class="line">v = w * (x + z);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨å‚æ•°å’Œä¸€å…ƒæ“ä½œç¬¦ä¹‹é—´ä¸åŠ ç©ºæ ¼.</span></span><br><span class="line">x = <span class="number">-5</span>;</span><br><span class="line">++x;</span><br><span class="line"><span class="keyword">if</span> (x &amp;&amp; !y)</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure><h6 id="æ¨¡æ¿å’Œè½¬æ¢">æ¨¡æ¿å’Œè½¬æ¢</h6><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°–æ‹¬å·(&lt; and &gt;) ä¸ä¸ç©ºæ ¼ç´§é‚», &lt; å‰æ²¡æœ‰ç©ºæ ¼, &gt; å’Œ ( ä¹‹é—´ä¹Ÿæ²¡æœ‰.</span></span><br><span class="line">vector&lt;string&gt; x;</span><br><span class="line">y = <span class="built_in">static_cast</span>&lt;<span class="type">char</span>*&gt;(x);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ç±»å‹ä¸æŒ‡é’ˆæ“ä½œç¬¦ä¹‹é—´ç•™ç©ºæ ¼ä¹Ÿå¯ä»¥, ä½†è¦ä¿æŒä¸€è‡´.</span></span><br><span class="line">vector&lt;<span class="type">char</span> *&gt; x;</span><br></pre></td></tr></table></figure><h3 id="å‚ç›´ç•™ç™½">9.19. å‚ç›´ç•™ç™½</h3><p><strong>æ€»è¿°</strong></p><p>å‚ç›´ç•™ç™½è¶Šå°‘è¶Šå¥½.</p><p><strong>è¯´æ˜</strong></p><p>è¿™ä¸ä»…ä»…æ˜¯è§„åˆ™è€Œæ˜¯åŸåˆ™é—®é¢˜äº†: ä¸åœ¨ä¸‡ä¸å¾—å·², ä¸è¦ä½¿ç”¨ç©ºè¡Œ. å°¤å…¶æ˜¯:ä¸¤ä¸ªå‡½æ•°å®šä¹‰ä¹‹é—´çš„ç©ºè¡Œä¸è¦è¶…è¿‡ 2 è¡Œ, å‡½æ•°ä½“é¦–å°¾ä¸è¦ç•™ç©ºè¡Œ,å‡½æ•°ä½“ä¸­ä¹Ÿä¸è¦éšæ„æ·»åŠ ç©ºè¡Œ.</p><p>åŸºæœ¬åŸåˆ™æ˜¯: åŒä¸€å±å¯ä»¥æ˜¾ç¤ºçš„ä»£ç è¶Šå¤š, è¶Šå®¹æ˜“ç†è§£ç¨‹åºçš„æ§åˆ¶æµ. å½“ç„¶,è¿‡äºå¯†é›†çš„ä»£ç å—å’Œè¿‡äºç–æ¾çš„ä»£ç å—åŒæ ·éš¾çœ‹, è¿™å–å†³äºä½ çš„åˆ¤æ–­.ä½†é€šå¸¸æ˜¯å‚ç›´ç•™ç™½è¶Šå°‘è¶Šå¥½.</p><p>ä¸‹é¢çš„è§„åˆ™å¯ä»¥è®©åŠ å…¥çš„ç©ºè¡Œæ›´æœ‰æ•ˆ:</p><ul><li>å‡½æ•°ä½“å†…å¼€å¤´æˆ–ç»“å°¾çš„ç©ºè¡Œå¯è¯»æ€§å¾®ä¹å…¶å¾®.</li><li>åœ¨å¤šé‡ if-else å—é‡ŒåŠ ç©ºè¡Œæˆ–è®¸æœ‰ç‚¹å¯è¯»æ€§.</li></ul><h3 id="è¯‘è€…-yulefox-ç¬”è®°-4">è¯‘è€… (YuleFox) ç¬”è®°</h3><ol type="1"><li>å¯¹äºä»£ç æ ¼å¼, å› äºº, ç³»ç»Ÿè€Œå¼‚å„æœ‰ä¼˜ç¼ºç‚¹,ä½†åŒä¸€ä¸ªé¡¹ç›®ä¸­éµå¾ªåŒä¸€æ ‡å‡†è¿˜æ˜¯æœ‰å¿…è¦çš„;</li><li>è¡Œå®½åŸåˆ™ä¸Šä¸è¶…è¿‡ 80 åˆ—, æŠŠ 22 å¯¸çš„æ˜¾ç¤ºå±éƒ½å å®Œ, æ€ä¹ˆä¹Ÿè¯´ä¸è¿‡å»;</li><li>å°½é‡ä¸ä½¿ç”¨é ASCII å­—ç¬¦, å¦‚æœä½¿ç”¨çš„è¯, å‚è€ƒ UTF-8 æ ¼å¼ (å°¤å…¶æ˜¯UNIX/Linux ä¸‹, Windows ä¸‹å¯ä»¥è€ƒè™‘å®½å­—ç¬¦),å°½é‡ä¸å°†å­—ç¬¦ä¸²å¸¸é‡è€¦åˆåˆ°ä»£ç ä¸­, æ¯”å¦‚ç‹¬ç«‹å‡ºèµ„æºæ–‡ä»¶,è¿™ä¸ä»…ä»…æ˜¯é£æ ¼é—®é¢˜äº†;</li><li>UNIX/Linux ä¸‹æ— æ¡ä»¶ä½¿ç”¨ç©ºæ ¼, MSVC çš„è¯ä½¿ç”¨ Tab ä¹Ÿæ— å¯åšé;</li><li>å‡½æ•°å‚æ•°, é€»è¾‘æ¡ä»¶, åˆå§‹åŒ–åˆ—è¡¨: è¦ä¹ˆæ‰€æœ‰å‚æ•°å’Œå‡½æ•°åæ”¾åœ¨åŒä¸€è¡Œ,è¦ä¹ˆæ‰€æœ‰å‚æ•°å¹¶æ’åˆ†è¡Œ;</li><li>é™¤å‡½æ•°å®šä¹‰çš„å·¦å¤§æ‹¬å·å¯ä»¥ç½®äºè¡Œé¦–å¤–, åŒ…æ‹¬å‡½æ•°/ç±»/ç»“æ„ä½“/æšä¸¾å£°æ˜,å„ç§è¯­å¥çš„å·¦å¤§æ‹¬å·ç½®äºè¡Œå°¾, æ‰€æœ‰å³å¤§æ‹¬å·ç‹¬ç«‹æˆè¡Œ;</li><li><code>.</code>/<code>-&gt;</code> æ“ä½œç¬¦å‰åä¸ç•™ç©ºæ ¼,<code>*</code>/<code>&amp;</code> ä¸è¦å‰åéƒ½ç•™, ä¸€ä¸ªå°±å¯,é å·¦é å³ä¾å„äººå–œå¥½;</li><li>é¢„å¤„ç†æŒ‡ä»¤/å‘½åç©ºé—´ä¸ä½¿ç”¨é¢å¤–ç¼©è¿›,ç±»/ç»“æ„ä½“/æšä¸¾/å‡½æ•°/è¯­å¥ä½¿ç”¨ç¼©è¿›;</li><li>åˆå§‹åŒ–ç”¨ <code>=</code> è¿˜æ˜¯ <code>()</code> ä¾ä¸ªäººå–œå¥½,ç»Ÿä¸€å°±å¥½;</li><li><code>return</code> ä¸è¦åŠ  <code>()</code>;</li><li>æ°´å¹³/å‚ç›´ç•™ç™½ä¸è¦æ»¥ç”¨, æ€ä¹ˆæ˜“è¯»æ€ä¹ˆæ¥.</li><li>å…³äº UNIX/Linux é£æ ¼ä¸ºä»€ä¹ˆè¦æŠŠå·¦å¤§æ‹¬å·ç½®äºè¡Œå°¾ (<code>.cc</code>æ–‡ä»¶çš„å‡½æ•°å®ç°å¤„, å·¦å¤§æ‹¬å·ä½äºè¡Œé¦–), æˆ‘çš„ç†è§£æ˜¯ä»£ç çœ‹ä¸Šå»æ¯”è¾ƒç®€çº¦,æƒ³æƒ³è¡Œé¦–é™¤äº†å‡½æ•°ä½“è¢«ä¸€å¯¹å¤§æ‹¬å·å°åœ¨ä¸€èµ·ä¹‹å¤–,åªæœ‰å³å¤§æ‹¬å·çš„ä»£ç çœ‹ä¸Šå»ç¡®å®ä¹Ÿèˆ’æœ; Windowsé£æ ¼å°†å·¦å¤§æ‹¬å·ç½®äºè¡Œé¦–çš„ä¼˜ç‚¹æ˜¯åŒ¹é…æƒ…å†µä¸€ç›®äº†ç„¶.</li></ol><h3 id="è¯‘è€…acgtyrantç¬”è®°-5">è¯‘è€…ï¼ˆacgtyrantï¼‰ç¬”è®°</h3><ol type="1"><li>80 è¡Œé™åˆ¶äº‹å®ä¸Šæœ‰åŠ©äºé¿å…ä»£ç å¯è¯»æ€§å¤±æ§, æ¯”å¦‚è¶…å¤šé‡åµŒå¥—å—,è¶…å¤šé‡å‡½æ•°è°ƒç”¨ç­‰ç­‰.</li><li>Linux ä¸Šè®¾ç½®å¥½äº† Locale å°±å‡ ä¹ä¸€åŠ³æ°¸é€¸è®¾ç½®å¥½æ‰€æœ‰å¼€å‘ç¯å¢ƒçš„ç¼–ç ,ä¸åƒå¥‡è‘©çš„ Windows.</li><li>Google å¼ºè°ƒæœ‰ä¸€å¯¹ if-else æ—¶, ä¸è®ºæœ‰æ²¡æœ‰åµŒå¥—, éƒ½è¦æœ‰å¤§æ‹¬å·. Appleæ­£å¥½ <a href="http://coolshell.cn/articles/11112.html">æœ‰æ ½è¿‡è·Ÿå¤´</a>.</li><li>å…¶å®æˆ‘ä¸»å¼ æŒ‡é’ˆï¼åœ°å€æ“ä½œç¬¦ä¸å˜é‡åç´§é‚», <code>int* a, b</code> vs<code>int *a, b</code>, æ–°æ‰‹ä¼šè¯¯ä»¥ä¸ºå‰è€…çš„ <code>b</code> æ˜¯<code>int *</code> å˜é‡, ä½†åè€…å°±ä¸ä¸€æ ·äº†, é«˜ä¸‹ç«‹åˆ¤.</li><li>åœ¨è¿™é£æ ¼æŒ‡å—é‡Œæˆ‘æ‰åˆšçŸ¥é“ C++ åŸæ¥è¿˜æœ‰æ‰€è°“çš„ <ahref="http://en.cppreference.com/w/cpp/language/operator_alternative">Alternativeoperator representations</a>, å¤§æ¦‚æ²¡äººç”¨å§.</li><li>æ³¨æ„æ„é€ å‡½æ•°åˆå§‹å€¼åˆ—è¡¨ï¼ˆConstructer InitializerListï¼‰ä¸åˆ—è¡¨åˆå§‹åŒ–ï¼ˆInitializer Listï¼‰æ˜¯ä¸¤ç äº‹,æˆ‘å°±å·®ç‚¹æ··æ·†äº†å®ƒä»¬çš„ç¿»è¯‘.</li><li>äº‹å®ä¸Š, å¦‚æœæ‚¨ç†Ÿæ‚‰è‹±è¯­æœ¬èº«çš„ä¹¦å†™è§„åˆ™,å°±ä¼šå‘ç°è¯¥é£æ ¼æŒ‡å—åœ¨æ ¼å¼ä¸Šçš„è§„å®šä¸è‹±è¯­è¯­æ³•ç›¸å½“ä¸€è„‰ç›¸æ‰¿.æ¯”å¦‚æ™®é€šæ ‡ç‚¹ç¬¦å·å’Œå•è¯åé¢è¿˜æœ‰æ–‡æœ¬çš„è¯, æ€»ä¼šç•™ä¸€ä¸ªç©ºæ ¼;ç‰¹æ®Šç¬¦å·ä¸å•è¯ä¹‹é—´å°±ä¸ç”¨ç•™äº†, æ¯”å¦‚ <code>if (true)</code> ä¸­çš„åœ†æ‹¬å·ä¸<code>true</code>.</li><li>æœ¬é£æ ¼æŒ‡å—æ²¡æœ‰æ˜ç¡®è§„å®š void å‡½æ•°é‡Œè¦ä¸è¦ç”¨ return è¯­å¥, ä¸è¿‡å°±Google å¼€æºé¡¹ç›® leveldb å¹¶æ²¡æœ‰å†™; æ­¤å¤–ä» <ahref="http://stackoverflow.com/questions/9316717/is-a-blank-return-statement-at-the-end-of-a-function-whos-return-type-is-void-ne">Isa blank return statement at the end of a function whos return type isvoid necessary?</a> æ¥çœ‹, <code>return;</code> æ¯” <code>return ;</code>æ›´çº¦å®šä¿—æˆï¼ˆäº‹å®ä¸Š cpplint ä¼šå¯¹åè€…æŠ¥é”™, æŒ‡å‡ºåˆ†å·å‰æœ‰å¤šä½™çš„ç©ºæ ¼ï¼‰,ä¸”å¯ç”¨æ¥æå‰è·³å‡ºå‡½æ•°æ ˆ.</li></ol></div><div class="story post-story"><h2 id="è§„åˆ™ç‰¹ä¾‹">10. è§„åˆ™ç‰¹ä¾‹</h2><p>å‰é¢è¯´æ˜çš„ç¼–ç¨‹ä¹ æƒ¯åŸºæœ¬éƒ½æ˜¯å¼ºåˆ¶æ€§çš„. ä½†æ‰€æœ‰ä¼˜ç§€çš„è§„åˆ™éƒ½å…è®¸ä¾‹å¤–,è¿™é‡Œå°±æ˜¯æ¢è®¨è¿™äº›ç‰¹ä¾‹.</p><h3 id="ç°æœ‰ä¸åˆè§„èŒƒçš„ä»£ç ">10.1. ç°æœ‰ä¸åˆè§„èŒƒçš„ä»£ç </h3><p><strong>æ€»è¿°</strong></p><p>å¯¹äºç°æœ‰ä¸ç¬¦åˆæ—¢å®šç¼–ç¨‹é£æ ¼çš„ä»£ç å¯ä»¥ç½‘å¼€ä¸€é¢.</p><p><strong>è¯´æ˜</strong></p><p>å½“ä½ ä¿®æ”¹ä½¿ç”¨å…¶ä»–é£æ ¼çš„ä»£ç æ—¶,ä¸ºäº†ä¸ä»£ç åŸæœ‰é£æ ¼ä¿æŒä¸€è‡´å¯ä»¥ä¸ä½¿ç”¨æœ¬æŒ‡å—çº¦å®š. å¦‚æœä¸æ”¾å¿ƒ,å¯ä»¥ä¸ä»£ç åŸä½œè€…æˆ–ç°åœ¨çš„è´Ÿè´£äººå‘˜å•†è®¨. è®°ä½, <em>ä¸€è‡´æ€§</em>ä¹ŸåŒ…æ‹¬åŸæœ‰çš„ä¸€è‡´æ€§.</p><h3 id="windows-ä»£ç ">10.2. Windows ä»£ç </h3><p><strong>æ€»è¿°</strong></p><p>Windows ç¨‹åºå‘˜æœ‰è‡ªå·±çš„ç¼–ç¨‹ä¹ æƒ¯, ä¸»è¦æºäº Windows å¤´æ–‡ä»¶å’Œå…¶å®ƒMicrosoft ä»£ç . æˆ‘ä»¬å¸Œæœ›ä»»ä½•äººéƒ½å¯ä»¥é¡ºåˆ©è¯»æ‡‚ä½ çš„ä»£ç , æ‰€ä»¥é’ˆå¯¹æ‰€æœ‰å¹³å°çš„C++ ç¼–ç¨‹åªç»™å‡ºä¸€ä¸ªå•ç‹¬çš„æŒ‡å—.</p><p><strong>è¯´æ˜</strong></p><p>å¦‚æœä½ ä¹ æƒ¯ä½¿ç”¨ Windows ç¼–ç é£æ ¼,è¿™å„¿æœ‰å¿…è¦é‡ç”³ä¸€ä¸‹æŸäº›ä½ å¯èƒ½ä¼šå¿˜è®°çš„æŒ‡å—:</p><ul><li>ä¸è¦ä½¿ç”¨åŒˆç‰™åˆ©å‘½åæ³• (æ¯”å¦‚æŠŠæ•´å‹å˜é‡å‘½åæˆ <code>iNum</code>). ä½¿ç”¨Google å‘½åçº¦å®š, åŒ…æ‹¬å¯¹æºæ–‡ä»¶ä½¿ç”¨ <code>.cc</code> æ‰©å±•å.</li><li>Windows å®šä¹‰äº†å¾ˆå¤šåŸç”Ÿç±»å‹çš„åŒä¹‰è¯ (YuleFox æ³¨: è¿™ä¸€ç‚¹, æˆ‘ä¹Ÿå¾ˆåæ„Ÿ),å¦‚ <code>DWORD</code>, <code>HANDLE</code> ç­‰ç­‰. åœ¨è°ƒç”¨ Windows APIæ—¶è¿™æ˜¯å®Œå…¨å¯ä»¥æ¥å—ç”šè‡³é¼“åŠ±çš„. å³ä½¿å¦‚æ­¤, è¿˜æ˜¯å°½é‡ä½¿ç”¨åŸæœ‰çš„ C++ ç±»å‹,ä¾‹å¦‚ä½¿ç”¨ <code>const TCHAR *</code> è€Œä¸æ˜¯ <code>LPCTSTR</code>.</li><li>ä½¿ç”¨ Microsoft Visual C++ è¿›è¡Œç¼–è¯‘æ—¶, å°†è­¦å‘Šçº§åˆ«è®¾ç½®ä¸º 3 æˆ–æ›´é«˜,å¹¶å°†æ‰€æœ‰è­¦å‘Š(warnings)å½“ä½œé”™è¯¯(errors)å¤„ç†.</li><li>ä¸è¦ä½¿ç”¨ <code>##pragma once</code>; è€Œåº”è¯¥ä½¿ç”¨ Googleçš„å¤´æ–‡ä»¶ä¿æŠ¤è§„åˆ™. å¤´æ–‡ä»¶ä¿æŠ¤çš„è·¯å¾„åº”è¯¥ç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½• (Yang.Y æ³¨: å¦‚<code>##ifndef SRC_DIR_BAR_H_</code>, å‚è€ƒ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/headers/##define-guard">##defineä¿æŠ¤</a> ä¸€èŠ‚).</li><li>é™¤éä¸‡ä¸å¾—å·², ä¸è¦ä½¿ç”¨ä»»ä½•éæ ‡å‡†çš„æ‰©å±•, å¦‚ <code>##pragma</code> å’Œ<code>__declspec</code>. ä½¿ç”¨ <code>__declspec(dllimport)</code> å’Œ<code>__declspec(dllexport)</code> æ˜¯å…è®¸çš„, ä½†å¿…é¡»é€šè¿‡å®æ¥ä½¿ç”¨, æ¯”å¦‚<code>DLLIMPORT</code> å’Œ <code>DLLEXPORT</code>,è¿™æ ·å…¶ä»–äººåœ¨åˆ†äº«ä½¿ç”¨è¿™äº›ä»£ç æ—¶å¯ä»¥å¾ˆå®¹æ˜“åœ°ç¦ç”¨è¿™äº›æ‰©å±•.</li></ul><p>ç„¶è€Œ, åœ¨ Windows ä¸Šä»ç„¶æœ‰ä¸€äº›æˆ‘ä»¬å¶å°”éœ€è¦è¿åçš„è§„åˆ™:</p><ul><li>é€šå¸¸æˆ‘ä»¬ <ahref="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/classes/##multiple-inheritance">ç¦æ­¢ä½¿ç”¨å¤šé‡ç»§æ‰¿</a>,ä½†åœ¨ä½¿ç”¨ COM å’Œ ATL/WTL ç±»æ—¶å¯ä»¥ä½¿ç”¨å¤šé‡ç»§æ‰¿. ä¸ºäº†å®ç° COM æˆ– ATL/WTLç±»/æ¥å£, ä½ å¯èƒ½ä¸å¾—ä¸ä½¿ç”¨å¤šé‡å®ç°ç»§æ‰¿.</li><li>è™½ç„¶ä»£ç ä¸­ä¸åº”è¯¥ä½¿ç”¨å¼‚å¸¸, ä½†æ˜¯åœ¨ ATL å’Œéƒ¨åˆ† STLï¼ˆåŒ…æ‹¬ Visual C++ çš„STL) ä¸­å¼‚å¸¸è¢«å¹¿æ³›ä½¿ç”¨. ä½¿ç”¨ ATL æ—¶, åº”å®šä¹‰<code>_ATL_NO_EXCEPTIONS</code> ä»¥ç¦ç”¨å¼‚å¸¸. ä½ éœ€è¦ç ”ç©¶ä¸€ä¸‹æ˜¯å¦èƒ½å¤Ÿç¦ç”¨STL çš„å¼‚å¸¸, å¦‚æœæ— æ³•ç¦ç”¨, å¯ä»¥å¯ç”¨ç¼–è¯‘å™¨å¼‚å¸¸. (æ³¨æ„è¿™åªæ˜¯ä¸ºäº†ç¼–è¯‘ STL,è‡ªå·±çš„ä»£ç é‡Œä»ç„¶ä¸åº”å½“åŒ…å«å¼‚å¸¸å¤„ç†).</li><li>é€šå¸¸ä¸ºäº†åˆ©ç”¨å¤´æ–‡ä»¶é¢„ç¼–è¯‘, æ¯ä¸ªæ¯ä¸ªæºæ–‡ä»¶çš„å¼€å¤´éƒ½ä¼šåŒ…å«ä¸€ä¸ªåä¸º<code>StdAfx.h</code> æˆ– <code>precompile.h</code> çš„æ–‡ä»¶.ä¸ºäº†ä½¿ä»£ç æ–¹ä¾¿ä¸å…¶ä»–é¡¹ç›®å…±äº«, è¯·é¿å…æ˜¾å¼åŒ…å«æ­¤æ–‡ä»¶ (é™¤äº†åœ¨<code>precompile.cc</code> ä¸­), ä½¿ç”¨ <code>/FI</code>ç¼–è¯‘å™¨é€‰é¡¹ä»¥è‡ªåŠ¨åŒ…å«è¯¥æ–‡ä»¶.</li><li>èµ„æºå¤´æ–‡ä»¶é€šå¸¸å‘½åä¸º <code>resource.h</code> ä¸”åªåŒ…å«å®,è¿™ä¸€æ–‡ä»¶ä¸éœ€è¦éµå®ˆæœ¬é£æ ¼æŒ‡å—.</li></ul></div><div class="story post-story"><h2 id="ç»“æŸè¯­">11. ç»“æŸè¯­</h2><p>è¿ç”¨å¸¸è¯†å’Œåˆ¤æ–­åŠ›, å¹¶ä¸” <em>ä¿æŒä¸€è‡´</em>.</p><p>ç¼–è¾‘ä»£ç æ—¶, èŠ±ç‚¹æ—¶é—´çœ‹çœ‹é¡¹ç›®ä¸­çš„å…¶å®ƒä»£ç , å¹¶ç†Ÿæ‚‰å…¶é£æ ¼.å¦‚æœå…¶å®ƒä»£ç ä¸­ <code>if</code> è¯­å¥ä½¿ç”¨ç©ºæ ¼, é‚£ä¹ˆä½ ä¹Ÿè¦ä½¿ç”¨.å¦‚æœå…¶ä¸­çš„æ³¨é‡Šç”¨æ˜Ÿå· (*) å›´æˆä¸€ä¸ªç›’å­çŠ¶, é‚£ä¹ˆä½ åŒæ ·è¦è¿™ä¹ˆåš.</p><p>é£æ ¼æŒ‡å—çš„é‡ç‚¹åœ¨äºæä¾›ä¸€ä¸ªé€šç”¨çš„ç¼–ç¨‹è§„èŒƒ,è¿™æ ·å¤§å®¶å¯ä»¥æŠŠç²¾åŠ›é›†ä¸­åœ¨å®ç°å†…å®¹è€Œä¸æ˜¯è¡¨ç°å½¢å¼ä¸Š.æˆ‘ä»¬å±•ç¤ºçš„æ˜¯ä¸€ä¸ªæ€»ä½“çš„çš„é£æ ¼è§„èŒƒ, ä½†å±€éƒ¨é£æ ¼ä¹Ÿå¾ˆé‡è¦,å¦‚æœä½ åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­æ–°åŠ çš„ä»£ç å’ŒåŸæœ‰ä»£ç é£æ ¼ç›¸å»ç”šè¿œ,è¿™å°±ç ´åäº†æ–‡ä»¶æœ¬èº«çš„æ•´ä½“ç¾è§‚, ä¹Ÿè®©æ‰“ä¹±è¯»è€…åœ¨é˜…è¯»ä»£ç æ—¶çš„èŠ‚å¥,æ‰€ä»¥è¦å°½é‡é¿å….</p><p>å¥½äº†, å…³äºç¼–ç é£æ ¼å†™çš„å¤Ÿå¤šäº†; ä»£ç æœ¬èº«æ‰æ›´æœ‰è¶£. å°½æƒ…äº«å—å§!</p></div>]]></content>
    
    
    <summary type="html">&lt;p&gt;Google C/C++ è§„èŒƒæ–‡æ¡£ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="è®¡ç®—æœºç§‘å­¦" scheme="http://adversarr.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/"/>
    
    
    <category term="ç¼–ç¨‹" scheme="http://adversarr.github.io/tags/%E7%BC%96%E7%A8%8B/"/>
    
    <category term="C++" scheme="http://adversarr.github.io/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>Real-Time Cloth Simulation</title>
    <link href="http://adversarr.github.io/2022/09/30/CG/SortByCato/ContactDetection/ClothSimu/"/>
    <id>http://adversarr.github.io/2022/09/30/CG/SortByCato/ContactDetection/ClothSimu/</id>
    <published>2022-09-30T01:16:33.203Z</published>
    <updated>2022-11-05T01:55:42.640Z</updated>
    
    <content type="html"><![CDATA[<p>Real-Time Cloth Simulation on GPU -- by Huaming Wang 2021</p><span id="more"></span><div class="story post-story"><h2 id="introduction">Introduction</h2><p>Dynamic Solverï¼š</p><ul><li>High resolution</li><li>High nonlinearity</li><li>High stiffness â€” å¤šæ¬¡è¿­ä»£ã€è®¡ç®—é‡</li></ul><p>Collision:</p><ul><li>Collision detection</li><li>Collision Response.</li></ul><h3 id="problem-definitions">Problem Definitions</h3><h4 id="terms">Terms</h4><p>Position Vector: <span class="math display">\[\mathbf x = [\mathbf x_0 \mathbf x_1 \cdots \mathbf x_N]&#39;\]</span> Velocity: <span class="math display">\[\mathbf v = \dot {\mathbf x}\quad \mathbf M = diag(m_0, \dots, m_N)\]</span> Energy â€“ Holonomic(Position only): <spanclass="math display">\[E(\mathbf x)\]</span> ä¾‹å¦‚ï¼š</p><ol type="1"><li>é‡åŠ›åŠ¿èƒ½</li><li>å¼¹ç°§èƒ½é‡</li><li>Fixing Energy â€” <span class="math inline">\(\frac{\sigma}2 (\mathbfx_i -\mathbf y_i)^2\)</span></li></ol><h4 id="time-integration">Time Integration</h4><p>å¸¸ç”¨ï¼šéšå¼æ¬§æ‹‰æ³•</p><p>æ±‚è§£æ–¹æ³•ï¼š</p><ol type="1"><li>æ¶ˆå» <span class="math inline">\(\mathbf v^{t + \Deltat}\)</span></li><li>è½¬åŒ–ä¸ºéçº¿æ€§ä¼˜åŒ–é—®é¢˜</li></ol><p>ä»è€Œï¼Œæ•´ä¸ªé—®é¢˜éƒ½å˜ä¸ºï¼š <span class="math display">\[\mathbf x^{t + \Delta t} = \arg\min_{\mathbf x} F(\mathbf x)\]</span> å…¶ä¸­ <span class="math inline">\(F\)</span>ç”±åŠ¨èƒ½å’ŒåŠ¿èƒ½ç»„æˆã€‚</p><h4 id="ç¢°æ’">ç¢°æ’</h4><p>ä½œä¸ºçº¦æŸé¡¹å‡ºç°ï¼š <span class="math display">\[\mathbf x^{t + \Delta t} = \arg\min_{\mathbf x} F(\mathbf x) \\s.t.\quad \mathbf x^{t + \Delta t} \in \Omega\]</span> <img src="/2022/09/30/CG/SortByCato/ContactDetection/ClothSimu/image-20220414210701587.png" class="lazyload" data-srcset="/2022/09/30/CG/SortByCato/ContactDetection/ClothSimu/image-20220414210701587.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" class=" lazyload" title="image-20220414210701587"></p><p>ä¸Šå¼å­˜åœ¨éš§ç©¿é—®é¢˜(Tunnel)ã€‚æ•…é‡‡ç”¨CCDã€‚ <span class="math display">\[\mathbf x^{t + \Delta t} = \arg\min_{\mathbf x} F(\mathbf x) \\s.t.\quad s \mathbf x^t + (1-s)  \mathbf x^{t + \Delta t} \in \Omega\forall s\in [0,1]\]</span></p></div><div class="story post-story"><h2 id="dynamics">Dynamics</h2><p>éçº¿æ€§ä¼˜åŒ–é€šå¸¸æœ‰å¦‚ä¸‹çš„å½¢å¼ï¼š <span class="math display">\[\mathbf x ^{k+1} = \mathbf x^k - \alpha^{k + 1}\left(A^{k+1}\right)^{-1} \mathrm{grad}\]</span></p><h3 id="newton-æ³•">Newton æ³•</h3><p>ä¼˜ç‚¹</p><ul><li>2 é˜¶æ–¹æ³•</li><li>Hessian Matrix</li></ul><p>é—®é¢˜</p><ul><li>å¦‚ä½•æ±‚è§£ <span class="math inline">\(A^{-1}f\)</span> â€”è®¡ç®—é‡å¤§</li><li>ä¸ä¸€å®šæ”¶æ•›<ul><li>å‡å° <span class="math inline">\(\alpha\)</span></li><li>è¦æ±‚ Hessian æ­£å®š</li></ul></li></ul><h3 id="æ¢¯åº¦ä¸‹é™">æ¢¯åº¦ä¸‹é™</h3><p><span class="math display">\[A = \mathrm{id}\]</span></p><p>ä¼˜ç‚¹</p><ul><li>GPU++</li><li>ç®€å•</li></ul><p>ç¼ºç‚¹</p><ul><li>1é˜¶æ”¶æ•› â€“ æ…¢</li><li>æ²¡æœ‰ä»»ä½•å®æ—¶æ¨¡æ‹Ÿå™¨ä½¿ç”¨</li></ul><h3 id="projective-dynamics">Projective Dynamics</h3><p>ç”¨å¸¸çŸ©é˜µä»£æ›¿ <span class="math inline">\(A\)</span></p><p>ä¼˜ç‚¹ï¼š</p><ul><li>CPU++ï¼Œï¼ˆC å¯ä»¥è¢«é¢„åˆ†è§£ï¼‰</li><li>æ”¶æ•›å¿« â€” smoother</li></ul><p>ç¼ºç‚¹</p><ul><li>GPUä¸å‹å¥½</li><li>1é˜¶æ”¶æ•›é€Ÿåº¦ï¼ˆæ€»ä½“ä¸Šå¾ˆæ…¢ï¼‰</li></ul><h3 id="diagonal-hessian">Diagonal Hessian</h3><p><span class="math display">\[\mathbf A^{k+1} = \mathrm{diag\ grad}\]</span></p><p>ä¼˜ç‚¹</p><ul><li>æ”¶æ•›å¿«äºGD</li><li>GPU++</li></ul><p>ç¼ºç‚¹</p><ul><li>é€Ÿåº¦ä»ç„¶å·®äºç‰›é¡¿</li></ul><h3 id="lower-hessian">Lower Hessian</h3><p>ä½¿ç”¨hessiançš„ä¸‹ä¸‰è§’</p><p>ä¼˜ç¼ºç‚¹åŒ Diag Hess</p><img src="/2022/09/30/CG/SortByCato/ContactDetection/ClothSimu/image-20220414212056199.png" class="lazyload" data-srcset="/2022/09/30/CG/SortByCato/ContactDetection/ClothSimu/image-20220414212056199.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" class=" lazyload" title="æ€»ç»“å¯¹æ¯”"><h3 id="acceleration">Acceleration</h3><ul><li>Chebyshev â€” GPU Firendly</li><li>Multiscale Acceleration</li></ul><h3 id="conclusion">Conclusion</h3><p>CPUï¼šProjective Dynamics + Newton-Raphson</p><p>GPUï¼šChebyshev + Diagonal Hessian / Newton + PCG</p><h3 id="more">More</h3><h4 id="pbd-position-based-dynamics">PBD â€” Position-Based Dynamics</h4><p><strong>NVCLOTH</strong></p><h4 id="regular-grid-mesh">Regular Grid Mesh</h4><ul><li>Avoid Topology info</li><li>mem access</li><li>more suitable for high resolution</li></ul></div><div class="story post-story"><h2 id="ç¢°æ’-1">ç¢°æ’</h2><p>ä¸¤éƒ¨åˆ†ï¼šç¢°æ’æ£€æµ‹ + ç¢°æ’å“åº” å…·ä½“çœ‹ç»¼è¿°</p><h3 id="æ£€æµ‹">æ£€æµ‹</h3><p>mesh -&gt; pair -&gt; collision</p><h3 id="response">Response</h3><ol type="1"><li>Iterative Position-Based Repulsion</li><li>Impact Zone Method</li><li>Untangling</li></ol></div><div class="story post-story"><h2 id="other-topics">Other Topics</h2><ul><li>Friction</li><li>Nonelastic</li><li>Locking</li><li>Physical model and measurement</li></ul></div>]]></content>
    
    
    <summary type="html">&lt;p&gt;Real-Time Cloth Simulation on GPU -- by Huaming Wang 2021&lt;/p&gt;</summary>
    
    
    
    <category term="è®¡ç®—æœºå›¾å½¢å­¦" scheme="http://adversarr.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/"/>
    
    
    <category term="ä»¿çœŸæ¨¡æ‹Ÿ" scheme="http://adversarr.github.io/tags/%E4%BB%BF%E7%9C%9F%E6%A8%A1%E6%8B%9F/"/>
    
    <category term="å¸ƒæ–™" scheme="http://adversarr.github.io/tags/%E5%B8%83%E6%96%99/"/>
    
  </entry>
  
  <entry>
    <title>Particle-In-Cell Method</title>
    <link href="http://adversarr.github.io/2022/09/30/CG/SortByCato/MPM/apic/"/>
    <id>http://adversarr.github.io/2022/09/30/CG/SortByCato/MPM/apic/</id>
    <published>2022-09-29T16:00:00.000Z</published>
    <updated>2022-11-05T01:36:02.109Z</updated>
    
    <content type="html"><![CDATA[<p>Paper Reading: The Affine Particle In Cell.</p><span id="more"></span><div class="story post-story"><h2 id="introduction">Introduction</h2><p>ç›¸æ¯”äºä¹‹å‰çš„æ–¹æ³•</p><ol type="1"><li>ä¿ç•™äº† PIC çš„ç¨³å®šæ€§ï¼Œä½†è§£å†³äº†è€—æ•£/è¯¯å·®é—®é¢˜</li><li>ä¿ç•™äº† FLIP çš„åŠ¨é‡ã€è§’åŠ¨é‡å®ˆæ’ç‰¹æ€§ï¼Œä½†è§£å†³äº†ä¸ç¨³å®šçš„é—®é¢˜</li></ol><p>ä¸»è¦æ€æƒ³ï¼šç”¨ä¸€ä¸ªä»¿å°„å˜æ¢æ¥ä»£æ›¿åŸæœ¬çš„ç®€å•æ’å€¼ï¼Œä»è€Œè§£å†³p-&gt;gé˜¶æ®µçš„æ•°æ®ä¸¢å¤±ã€‚</p><h3 id="mpm">MPM</h3><ol type="1"><li>æ¬§æ‹‰ç½‘æ ¼<ol type="1"><li>æ±‚åŠ›ç®€å•ï¼šå‡åŒ€ç½‘æ ¼ä¸Šçš„æ‹‰æ™®æ‹‰æ–¯ç®—å­å®¹æ˜“è®¡ç®—</li><li>æ±‚è¿åŠ¨å›°éš¾</li></ol></li><li>æ‹‰æ ¼æœ—æ—¥ç²’å­<ol type="1"><li>æ±‚è¿åŠ¨ç®€å•</li><li>å®¹æ˜“è®©ç‰©ç†é‡å®ˆæ’</li><li>æ±‚åŠ›å›°éš¾ï¼šéš¾ä»¥ç¦»æ•£åŒ–ã€é‚»å±…æŸ¥æ‰¾è¾ƒä¸ºå›°éš¾</li></ol></li></ol><p>å»ºç«‹ä»Euler Gridåˆ°LagrangeParticleçš„ä¿¡æ¯ä¼ é€’ï¼Œæ¥æè¿°ä¸€ä¸ªè¿ç»­ä½“ä»‹è´¨ã€‚</p><p>é—®é¢˜å‡ºç°åœ¨ä¿¡æ¯ä¼ é€’è¿‡ç¨‹ä¸­ï¼šå­˜åœ¨ä¿¡æ¯ä¸¢å¤±çš„æƒ…å†µï¼ˆç»´æ•°ä¸åŒï¼Œä¼šäº§ç”Ÿé™ç»´çš„æƒ…å†µï¼‰</p><h3 id="pic">PIC</h3><p>Pâ†’Gï¼š</p><ol type="1"><li>mass: <span class="math inline">\(m_i^n = \sum_p w_{ip}^nm_p\)</span></li><li>velocity/linear momentum: <span class="math inline">\(m_i^n \mathbfv_i ^ n = \sum_p w_{ip}^n m_p \mathbf v_p^n\)</span></li></ol><p>G update: use NS-equation and backward-euler.</p><ol type="1"><li>velocity: <span class="math inline">\(\mathbf v_i ^n \rightarrow\mathbf v_i ^{n+1}\)</span></li></ol><p>Gâ†’P:</p><ol type="1"><li>velocity: <span class="math inline">\(\mathbf v_p^{n+1} = \sum_iw_{ip}^n \mathbf v_i ^ {n+1}\)</span></li></ol><p>P update: newton equations:</p><ol type="1"><li>position: <span class="math inline">\(\mathbf x = \mathbf x +\mathbf v \Delta t\)</span></li></ol><p>Pâ†’Gä¿è§’åŠ¨é‡ï¼Œä½†Gâ†’Påªä¼ é€’åŠ¨é‡ï¼Œè§’åŠ¨é‡ä¸ä¿æŒã€‚</p><h3 id="flip">FLIP</h3></div><div class="story post-story"><h2 id="apic">APIC</h2><h3 id="rpic">RPIC</h3><p>åœ¨æ¯ä¸€ä¸ªparticleä¸Šæ·»åŠ è§’åŠ¨é‡<span class="math inline">\(L _ p ^n\)</span>ï¼Œå¹¶ç”¨åŠ¨é‡ç›¸åŒçš„æ–¹æ³•æ‰§è¡ŒPâ†’G</p><p>Pâ†’G:</p><ol type="1"><li>Angular Momentum: <span class="math inline">\(m_i^n \mathbf v_i ^ n= \sum _ p w_{ip}^n m _ p (\mathbf v_p ^ n + ((\mathbfK_p^n)^{-1}\mathbf L _ p ^ n)\times (\mathbf x_i^n - \mathbf x _ p ^n))\)</span></li></ol><blockquote><p>å…¶ä¸­ <span class="math inline">\(\mathbf K\)</span>æ˜¯è½¬åŠ¨æƒ¯é‡å¼ é‡ï¼Œä¸”<span class="math inline">\(\mathbf \omega = (\mathbfK)^{-1} \mathbf L\)</span></p></blockquote><p>Gâ†’P:</p><ol type="1"><li>Angular Momentum: <span class="math inline">\(L_p^{n+1}= \sum_i w_{ip} ^ n (\mathbf x_i^n - \mathbf x _ p ^n)\times m_p \mathbf v_{i}^{n+1}\)</span></li></ol><p>ç®€å•ç²—æš´çš„ä¿æŒè§’åŠ¨é‡çš„æ–¹æ³•ã€‚</p><p>è‡³æ­¤ï¼Œè½¬åŠ¨åŠ¨èƒ½ä¿æŒã€å¹³åŠ¨åŠ¨èƒ½ä¿æŒã€‚å¯¹äºåˆšä½“è¿åŠ¨ï¼Œå…¶èƒ½é‡èƒ½å¤Ÿä¿æŒï¼Œä¿¡æ¯æ— æŸå¤±ã€‚</p><p>ä½†è€ƒè™‘åˆ°æµä½“ä¸å…·æœ‰åˆšæ€§ï¼Œä»è€Œè¿˜éœ€è¦ä¿æŒshearing modeä¸‹çš„è¿åŠ¨ã€‚</p><h3 id="affine-pic">Affine PIC</h3><p>æ ¸å¿ƒï¼šç²’å­çš„é€Ÿåº¦åœºæ˜¯åˆ†ç‰‡ä»¿å°„çš„ã€‚</p><p>è§£å†³RPICä¸­æ— æ³•è¿›è¡Œshearingçš„é—®é¢˜ã€‚</p><p><span class="math display">\[P\rightarrow G: \mathbf v_i^n = \sum_p w_{ip}^n \mathbf (v_p^n +C_p^n(\mathbf x_i - \mathbf x_p))\]</span></p><p>Problem: How to define <span class="math inline">\(C\)</span>efficiently. see <ahref="https://www.math.ucla.edu/~cffjiang/research/apic/tech-doc.pdf">tech-doc</a>.</p><p>Pâ†’G:</p><ol type="1"><li>mass</li><li>momentum: <span class="math inline">\(m_i\mathbf v_i ^n = \sum_pw_{ip}^n m_p(\mathbf v_p^n +B_p ^n(D_p^n)^{-1}(\mathbf x_i^n - \mathbfx_i^p))\)</span></li></ol><p>Gâ†’P:</p><ol type="1"><li>update: <span class="math inline">\(B _ p ^{n+1} = \sum _ iw_{ip}^{n}\mathbf v_i^{n+1}(\mathbf x_i^n - \mathbfx_p^n)^T\)</span></li><li>velocity.</li></ol></div>]]></content>
    
    
    <summary type="html">&lt;p&gt;Paper Reading: The Affine Particle In Cell.&lt;/p&gt;</summary>
    
    
    
    <category term="Anything" scheme="http://adversarr.github.io/categories/Anything/"/>
    
    
    <category term="Computer Graphic" scheme="http://adversarr.github.io/tags/Computer-Graphic/"/>
    
    <category term="PIC" scheme="http://adversarr.github.io/tags/PIC/"/>
    
    <category term="Fluid Simulation" scheme="http://adversarr.github.io/tags/Fluid-Simulation/"/>
    
  </entry>
  
  <entry>
    <title>ç¦»æ•£å¾®åˆ†å‡ ä½• - 1 - Introduction</title>
    <link href="http://adversarr.github.io/2022/08/08/CG/DiscreteGeometry/c1/"/>
    <id>http://adversarr.github.io/2022/08/08/CG/DiscreteGeometry/c1/</id>
    <published>2022-08-07T16:00:00.000Z</published>
    <updated>2022-09-30T01:16:33.180Z</updated>
    
    <content type="html"><![CDATA[<p>ç¦»æ•£å¾®åˆ†å‡ ä½• - 1 - Introduction</p><span id="more"></span><div class="story post-story"><h2 id="introduction">Introduction</h2><p>Application:</p><ul><li>Geometry Processing: Up-sample / Down-sample â€” 3d-surface</li><li>Shape Analysis</li><li>Machine Learning.</li><li>Numerical Simu</li></ul></div><div class="story post-story"><h2 id="what-will-we-learn-wont">What will we learn / Won't</h2><ol type="1"><li>Diff Geometry</li><li>Geo Processing</li><li>Central â€” Link These two perspectives</li></ol><p>Won't</p><ol type="1"><li>view points on diff geometry</li><li>huge number of algorithms</li></ol></div><div class="story post-story"><h2 id="what-is-diff-geo">What is Diff Geo</h2><h3 id="diff-geo">Diff Geo</h3><ol type="1"><li>Talk about local properties of shape</li><li>and thier connection to global properties of shape</li><li>Lang of geometry physics</li></ol><h3 id="discrete-diff-geo">Discrete Diff Geo</h3><ol type="1"><li>infinity no longer allowed</li><li>expressed in terms of lenghs, angles</li><li>Loss is littow: captures many fundamental ideas</li></ol><blockquote><p>Translate continuous to discrete</p></blockquote><h3 id="how-to">How to</h3><p>DDG â€” obtain discrete definitions</p><ol type="1"><li>write down several equivalent definitions in the smooth setting</li><li>apply each smooth definition to an object in discrete</li><li>Determine which properties are captured by each resultinginequivalent discrete definition</li></ol></div><div class="story post-story"><h2 id="example-discrete-curvature">Example: Discrete Curvature</h2><h3 id="curves-in-the-plane">Curves in the Plane</h3><p>in 2D, a <strong>parameterized curve</strong> is a map taking eachpoint in an interval <span class="math inline">\([0, L]\)</span>.</p><p>Discrete Curves in the Plane:</p><ul><li><p>piecewise linear parameterized curve, vertices connected bystraight line segments</p></li><li><p>view as a interval <spanclass="math inline">\(\rightarrow\)</span> Segments</p></li></ul><h3 id="tangentnormalcurvature">Tangent/Normal/Curvature</h3><p>unit tangent: <span class="math display">\[T(s) := \frac{d}{ds} \gamma(s) / |\frac{d}{ds}\gamma(s)|\]</span> unit Normal: <span class="math display">\[N(s) = \mathcal JT(s)\]</span></p><ul><li><span class="math inline">\(\mathcal J\)</span>è¡¨ç¤ºé¡ºæ—¶é’ˆæ—‹è½¬</li></ul><p>curvature can be expressed as the rate of change in the tangent.<span class="math display">\[\kappa(s):=\langle N, \frac{d}{ds} T\rangle\]</span></p><ul><li>Key idea 1 â€” curvature is a second devirative.</li><li>Key idea 2 â€” curvature can have sign.</li></ul><h3 id="to-discrete">To Discrete</h3><p>in continuous:</p><ol type="1"><li>Turning angle</li><li>length variation</li><li>steiner formula</li><li>osculating curve</li></ol><h3 id="integrated-curvature">Integrated Curvature</h3><p><span class="math display">\[\int _ b ^ a \kappa(s) \mathrm ds = \varphi(b) - \varphi(a)\]</span></p><p>consider <span class="math inline">\(\gamma_{i - 1}\)</span>, <spanclass="math inline">\(\gamma_{i}\)</span>,<spanclass="math inline">\(\gamma_{i + 1}\)</span> <spanclass="math display">\[\theta _ i =: \kappa_i ^A\quad (\text{turning angle})\]</span></p><ul><li>integrated rather than pointwise values</li><li>total change in angle, not derivative.</li></ul><h3 id="length-variation">Length Variation</h3><blockquote><p>The fastest way to descrease the length of a curve is to move it inthe normal direction, with speed proportioonal to curvature</p></blockquote><p>Intuition â€” in flat rigions, normal motions doesn't change curvelength.</p><p>å˜åˆ†ï¼š <span class="math display">\[\eta(0) = \eta(L) = 0\]</span> Gradient of Length for a line segment</p></div>]]></content>
    
    
    <summary type="html">&lt;p&gt;ç¦»æ•£å¾®åˆ†å‡ ä½• - 1 - Introduction&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>ç¦»æ•£å¾®åˆ†å‡ ä½• - 1 - Introduction</title>
    <link href="http://adversarr.github.io/2022/08/08/CG/DiscreteGeometry/c2a/"/>
    <id>http://adversarr.github.io/2022/08/08/CG/DiscreteGeometry/c2a/</id>
    <published>2022-08-07T16:00:00.000Z</published>
    <updated>2022-11-04T04:04:16.235Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><h2 id="combinatorial-surfaces-mesh">Combinatorial Surfacesï¼ˆMeshï¼‰</h2><h3 id="what-is-a-mesh">What is a mesh?</h3><ol type="1"><li>simplical complex<ol type="1"><li>Abstract/geometric</li><li>Oriented, manifold simplical complex.</li></ol></li><li>Cell complex</li><li>Data structures.</li></ol><h3 id="connection-to-dg">Connection to DG?</h3><ol type="1"><li>Topological space. &lt;-&gt; Abstract simplical complex</li></ol><div class="story post-story"><h2 id="convex-set">Convex Set</h2><ol type="1"><li>Definition.</li><li>Convex Hull</li></ol><h3 id="simplex">Simplex</h3><ol type="1"><li>Definition: Linear Independence</li><li>Definition: Affine Independence(<span class="math inline">\(v_i =p_i - p_0\)</span> are linear indenpendent)</li></ol><p>Definition: a k-simplex is the convex hull of <spanclass="math inline">\(k+1\)</span> affine-independent points, which wecall its vertices.</p><h3 id="barycentric-coordinates">Barycentric Coordinates</h3><ul><li>we can describe a simplex more explicitly usingbarycentric-coord.</li></ul><p>any point <span class="math inline">\(p\)</span> inside simplex canbe expressed as a weighted combination of the vertices.</p><p><span class="math display">\[\sigma = \left \{\sum _{i = 0} ^ k t _ i p _ i : \sum _{i = 0} ^ k t_i = 1, t_i \ge 0\right\}\]</span></p><p>Definition: <strong>standard</strong> n-simplex(select <spanclass="math inline">\(p_i = \epsilon _ i\)</span>)</p><h3 id="simplicial-complex">Simplicial Complex</h3><blockquote><p>a bunch of simplicies.</p></blockquote><dl><dt>face</dt><dd>a face of a simplex is any simplex whose vertices are a subset of thevertices of <span class="math inline">\(\sigma\)</span></dd><dt>Simplicial Complex</dt><dd>a collection of simplicies where: 1. the intersection of any twosimplicies is a simplex. 2. every face of every simplex in the complexis also in the complex</dd></dl></div>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;h2 id=&quot;combinatorial-surfaces-mesh&quot;&gt;Combinatorial Surfaces
ï¼ˆMeshï¼‰&lt;/h2&gt;
&lt;h3 id=&quot;what-is-a-mesh&quot;&gt;What is a mesh?&lt;/h3&gt;</summary>
      
    
    
    
    
  </entry>
  
</feed>
